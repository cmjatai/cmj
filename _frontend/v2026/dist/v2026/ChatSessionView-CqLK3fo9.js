import{U as F,z as i,c as x,N as R,w,o as U,V as $,f as c,k as s,q as M,j as B,A as H,n as b,i as k,F as z,r as J,J as K,t as L,L as O,W as P,B as Q,C as G,Q as E,R as X,g as d}from"./vendor-nrg9WaRj.js";import{_ as Y,u as Z,a as ee}from"./main-DdU9x2R_.js";import"./vendor_fortawesome-8Bn9qoRt.js";const se={class:"chat-session-view"},te={class:"chat-header"},ae={key:0,class:"empty-state"},oe={class:"message-bubble"},ne=["innerHTML"],le={key:1,class:"message-wrapper model loading"},re={key:0,class:"chat-input-area"},ie={class:"input-wrapper"},ue=["onKeydown","disabled","maxlength"],ce=["disabled"],de={key:1,class:"chat-input-area permission-denied"},ve={__name:"ChatSessionView",props:{wsEndpoint:{type:String,default:"/ws/chat/"}},setup(N){const V=new F({html:!1,linkify:!0,typographer:!0}),W=Z(),I=ee(),T=R();X();const A=G("EventBus"),j=N,l=i([]),r=i(""),n=i(!1),v=i(!1),a=i(null),g=i(null),u=i(null),f=i(250),C=x(()=>T.params.sessionId||"session_"+Math.random().toString(36).substr(2,9)),_=()=>{if(!p.value)return;a.value&&a.value.close();const e=window.location.protocol==="https:"?"wss:":"ws:",t=window.location.host,h=`${e}//${t}${j.wsEndpoint}${C.value}/`;a.value=new WebSocket(h),a.value.onopen=()=>{n.value=!0},a.value.onmessage=o=>{try{const m=JSON.parse(o.data);q(m)}catch(m){console.error("Error parsing WS message:",m)}},a.value.onclose=o=>{n.value=!1,o.code,o.reason,o.code===4001&&I.addMessage({type:"danger",text:"Você abriu esta conversa em outra guia/janela!",timeout:0})},a.value.onerror=o=>{console.error("Chat WebSocket Error:",o),n.value=!1}},q=e=>{switch(e.type){case"connection_established":e.session_id,e.max_length&&(f.value=e.max_length),e.history&&Array.isArray(e.history)&&(l.value=e.history,y());break;case"chat_message":v.value=!1,l.value.length===1&&A.emit("chat:init:conversation"),l.value.push({role:e.role,content:e.message}),y();break;case"error":v.value=!1,l.value.push({role:"system",content:`Erro: ${e.message}`});break;default:console.warn("Unknown message type:",e.type)}},p=x(()=>W.hasPermission("search.can_use_chat_module")),S=()=>{const e=r.value.trim();!e||!n.value||(l.value.push({role:"user",content:e}),r.value="",v.value=!0,y(),a.value.send(JSON.stringify({message:e})),u.value&&(u.value.style.height="auto"))},D=e=>V.render(e),y=()=>{E(()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)})};return w(r,()=>{E(()=>{u.value&&(u.value.style.height="auto",u.value.style.height=u.value.scrollHeight+"px")})}),w(C,()=>{l.value=[],p.value&&_()}),U(()=>{p.value&&_()}),w(p,e=>{e&&!n.value?_():!e&&n.value&&a.value&&a.value.close()}),$(()=>{a.value&&a.value.close()}),(e,t)=>{const h=H("FontAwesomeIcon");return d(),c("div",se,[s("div",te,[s("h3",null,[M(h,{icon:"hat-wizard"}),t[1]||(t[1]=B(" LegisBee ",-1))]),t[2]||(t[2]=s("h6",null,[B(" Fonte de Dados da LegisBee: "),s("a",{href:"/norma/destaques",target:"_blank",title:"Inicialmente, apenas as normas de destaque estão disponíveis para pesquisa"}," Normas de Destaque ")],-1)),s("span",{class:b(["status-indicator",{connected:n.value}])},null,2)]),s("div",{class:"chat-messages",ref_key:"messagesContainer",ref:g},[l.value.length===0&&p.value?(d(),c("div",ae,[...t[3]||(t[3]=[s("p",null,"Olá! Como posso ajudar você hoje?",-1)])])):k("",!0),(d(!0),c(z,null,J(l.value,(o,m)=>(d(),c("div",{key:m,class:b(["message-wrapper",o.role])},[s("div",oe,[s("div",{class:"message-content",innerHTML:D(o.content)},null,8,ne)])],2))),128)),v.value?(d(),c("div",le,[...t[4]||(t[4]=[s("div",{class:"message-bubble"},[s("span",{class:"typing-dot"}),s("span",{class:"typing-dot"}),s("span",{class:"typing-dot"})],-1)])])):k("",!0)],512),p.value?(d(),c("div",re,[s("div",ie,[s("span",{class:b(["char-counter",{"limit-reached":r.value.length>=f.value}])},L(r.value.length)+" / "+L(f.value),3),K(s("textarea",{"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),onKeydown:P(Q(S,["prevent"]),["enter"]),placeholder:"Digite sua mensagem...",disabled:!n.value||v.value,rows:"2",ref_key:"inputRef",ref:u,maxlength:f.value},null,40,ue),[[O,r.value]])]),s("button",{onClick:S,disabled:!n.value||!r.value.trim()||v.value,class:"send-btn"},[M(h,{icon:"paper-plane"})],8,ce)])):(d(),c("div",de,[t[5]||(t[5]=s("p",null,"LegisBee está em desenvolvimento.",-1)),k("",!0)]))])}}},ge=Y(ve,[["__scopeId","data-v-b0c6fbca"]]);export{ge as default};
