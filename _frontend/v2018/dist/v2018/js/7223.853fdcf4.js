"use strict";(self["webpackChunkportalcmj_frontend"]=self["webpackChunkportalcmj_frontend"]||[]).push([[7223],{7223:function(e,a,t){t.r(a),t.d(a,{default:function(){return E}});var s=function(){var e=this,a=e._self._c;return a("div",{staticClass:"draft-manage container-fluid py-3"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-3 d-flex"},[a("div",{staticClass:"d-flex flex-column w-100"},[a("div",{staticClass:"d-flex"},[a("div",[a("button",{staticClass:"btn btn-primary",attrs:{type:"button",title:"Novo Draft"},on:{click:e.clickAdd}},[e._v("+")])]),a("h1",{staticClass:"ml-2"},[e._v("Draft")])]),a("model-select",{ref:"draftSelect",staticClass:"form-opacity d-flex w-100",attrs:{app:"arq",model:"draft",choice:"descricao",ordering:"descricao",height:8},on:{change:a=>e.draftselected=a}}),e.draftselected?a("div",{staticClass:"d-flex flex-column"},[e._m(0),a("b-form-input",{on:{change:function(a){return e.changeDescricao(a)}},model:{value:e.draftselected.descricao,callback:function(a){e.$set(e.draftselected,"descricao",a)},expression:"draftselected.descricao"}})],1):e._e(),a("div",{staticClass:"drop-area"},[e.draftselected?a("drop-zone",{attrs:{pk:e.draftselected.id,multiple:!0},on:{uploaded:e.uploadedFiles}}):e._e()],1)],1)]),a("div",{staticClass:"col-9 container-manage-list"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.draftselected,expression:"draftselected"}]},[a("draft-manage-list",{ref:"listdraft",attrs:{draftselected:e.draftselected},on:{reloadDrafts:e.reloadDrafts}})],1),a("draft-help")],1)])])},i=[function(){var e=this,a=e._self._c;return a("span",[e._v("Título do Draft: "),a("small",[a("em",[e._v("(edição do draft selecionado acima)")])])])}],r=t(2274),o=function(){var e=this,a=e._self._c;return a("div",{staticClass:"drop_files",attrs:{id:"drop_file"},on:{drop:e.drop_handler,dragover:e.dragover_handler,dragend:e.dragend_handler}},[a("div",{staticClass:"progress",style:`width: ${e.progress}`}),a("label",{staticClass:"drop_zone",attrs:{for:"input_file"}},[e.multiple?a("span",{staticClass:"inner"},[e._v(" Arraste seus arquivos e solte aqui,"),a("br"),a("small",[e._v("ou clique para selecionar")])]):e._e(),e.multiple?e._e():a("span",{staticClass:"inner"},[e._v(" Arraste seu arquivo e solte aqui,"),a("br"),a("small",[e._v("ou clique para selecionar")])]),a("input",{attrs:{multiple:e.multiple?"multiple":null,type:"file",name:"file",id:"input_file"},on:{change:e.selectFiles}})]),a("div",{staticClass:"view"},[e.src?a("img",{attrs:{src:e.src_local}}):e._e()])])},n=[],d=(t(4114),t(2543)),l={name:"drop-zone",props:["src","multiple","pk"],data(){return{src_local:this.src,progress:"0%"}},watch:{src:function(e,a){this.src_local=this.src}},methods:{selectFiles(e){let a=e.currentTarget.files;0!==a.length&&this.sendFiles(a)},sendFiles(e){let a=this,t=new FormData;for(var s=0;s<e.length;s++)t.append("arquivos",e[s]),t.append("lastmodified",e[s].lastModified);a.utils.postModelAction("arq","draft",a.pk,"uploadfiles",t,{onUploadProgress:e=>{let a=Math.round(100*e.loaded/e.total);this.progress=`${a}%`}}).then(e=>{this.progress="0%",a.src_local=a.src+"?"+d.now(),a.$emit("uploaded",e),a.sendMessage({alert:"success",message:"Envio de Arquivos concluído...",time:5})}).catch(e=>a.sendMessage({alert:"danger",message:e.response.data[0]||e.response.data.detail||"Não foi possível enviar os arquivos...",time:10}))},drop_handler(e){if(void 0!==e){e.preventDefault();var a=e.dataTransfer;if(a.items){let e=Array();for(let t=0;t<a.items.length;t++)"file"===a.items[t].kind&&e.push(a.items[t].getAsFile());this.sendFiles(a.files)}else this.sendFiles(a.files)}},dragover_handler(e){e.preventDefault()},dragend_handler(e){let a=e.dataTransfer;if(a.items)for(var t=0;t<a.items.length;t++)a.items.remove(t);else e.dataTransfer.clearData()}}},c=l,m=t(1656),f=(0,m.A)(c,o,n,!1,null,null,null),u=f.exports,p=function(){var e=this,a=e._self._c;return a("div",{staticClass:"draftmanagelist"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col d-flex grade"},[a("div",{staticClass:"btn-group"},[a("button",{staticClass:"btn",attrs:{title:"Atualizar lista"},on:{click:function(a){return e.drawList(0)}}},[a("i",{staticClass:"fas fa-sync-alt"})])]),a("div",{staticClass:"d-flex grade"},[a("b-form-spinbutton",{attrs:{id:"spincols",min:"1",max:"12",inline:""},model:{value:e.cols,callback:function(a){e.cols=a},expression:"cols"}}),a("b-form-spinbutton",{attrs:{id:"spinrows",min:"1",max:"100",inline:""},model:{value:e.rows,callback:function(a){e.rows=a},expression:"rows"}})],1),a("pagination",{attrs:{pagination:e.pagination},on:{nextPage:e.nextPage,previousPage:e.previousPage,currentPage:e.currentPage}}),e.draftselected?a("div",{staticClass:"btn-toolbar",attrs:{role:"toolbar","aria-label":"Toolbar with button groups"}},[a("a",{staticClass:"btn btn-danger",attrs:{title:"Excluir Draft Atual",disabled:null===e.draftselected},on:{click:e.clickDel}},[a("i",{staticClass:"fas fa-trash-alt"})]),a("a",{staticClass:"btn btn-warning text-white ml-2",attrs:{title:"Cancela agendamentos de conversão de PDF -> PDF/A-2b"},on:{click:e.clickSupendeConversao}},[a("i",{staticClass:"fas fa-stop-circle"})]),a("a",{staticClass:"btn btn-primary ml-2 btn-pdf2pdfa",attrs:{title:"Iniciar conversão Básica para PDF/A-2b de todos os arquivos do Draft selecionado."},on:{click:e.clickPdf2Pdfa}},[e._m(0)]),a("a",{staticClass:"btn btn-primary ml-2",attrs:{href:`/api/arq/draft/${e.draftselected.id}/zipfile/?t=${Date.now()}`,target:"_blank",rel:"noopener noreferrer",title:"Baixar todos os arquivos individualmente dentro de um arquivo compactado."}},[a("i",{staticClass:"fas fa-file-archive"})]),a("a",{staticClass:"btn btn-primary ml-2",attrs:{title:"Unir PDFs do Draft em apenas um PDF"},on:{click:e.clickUnir}},[a("i",{staticClass:"fas fa-layer-group"})])]):e._e()],1)]),a("div",{staticClass:"container"},[a("div",{staticClass:"row"},e._l(e.draftmidialist_ordered,function(t,s){return a("draft-midia",{key:`dm${s}`,attrs:{elemento:t,cols:e.cols},on:{redrawDraftMidia:function(a){return e.drawList(-1)},updateElement:e.updateElement}})}),1)])])},h=[function(){var e=this,a=e._self._c;return a("span",[e._v(" PDF ->"),a("br"),e._v("PDF/A-2b ")])}],v=function(){var e=this,a=e._self._c;return a("div",{class:["draft-midia","p-2"],attrs:{id:`dm${e.elemento.id}`}},[a("div",{staticClass:"inner",on:{mouseenter:e.enterInner,mouseleave:e.leaveInner}},[a("div",{class:["inner-status",99===e.elemento.metadata.ocrmypdf.pdfa?"border-green":e.elemento.metadata.ocrmypdf.pdfa>=10?"border-yellow":"border-red"],domProps:{innerHTML:e._s(99===e.elemento.metadata.ocrmypdf.pdfa?"PDF/A-2b":e.elemento.metadata.ocrmypdf.pdfa>=10?"Conversão Agendada":"Não PDF/A-2b")}}),a("div",{ref:"inneraction",staticClass:"inner-action"},[a("div",{directives:[{name:"show",rawName:"v-show",value:10!==e.elemento.metadata.ocrmypdf.pdfa,expression:"elemento.metadata.ocrmypdf.pdfa !== 10"}],ref:"dropleft",staticClass:"dropleft"},[a("button",{ref:"btnDropDownActions",staticClass:"btn btn-sm",attrs:{type:"button","data-toggle":"dropdown","aria-expanded":"true"}},[a("i",{staticClass:"fas fa-ellipsis-v"})]),a("div",{ref:"dropdown",staticClass:"dropdown-menu"},[a("a",{staticClass:"dropdown-item",attrs:{title:"PDF -> PDF/A-2b - Conversão rápida, pode não ser feita devido a erros no arquivo."},on:{click:function(a){return e.clickDraftmidiaAction("pdf2pdfa_rapida")}}},[e._v(" PDF -> PDF/A-2b (Conversão Rápida)")]),a("a",{staticClass:"dropdown-item",attrs:{title:"PDF -> PDF/A-2b - Conversão básica, pode demorar um pouco mais que a rápida por aplicar correção de possíveis erros no arquivo. Utilize caso a rápida tenha falhado."},on:{click:function(a){return e.clickDraftmidiaAction("pdf2pdfa_basica")}}},[e._v(" PDF -> PDF/A-2b (Conversão Básica)")]),a("a",{staticClass:"dropdown-item",attrs:{title:"PDF -> PDF/A-2b - Conversão forçada, faz OCR e é mais lenta que a básica. (útil para arquivos digitalizados.)"},on:{click:function(a){return e.clickDraftmidiaAction("pdf2pdfa_forcada")}}},[e._v(" PDF -> PDF/A-2b (Conversão Forçada)")]),a("a",{staticClass:"dropdown-item",attrs:{title:"PDF -> PDF/A-2b - Conversão Compacta, faz OCR, converte para preto e branco e aplica alta compactação no arquivo (ultra lenta e útil para arquivos digitalizados)."},on:{click:function(a){return e.clickDraftmidiaAction("pdf2pdfa_compacta")}}},[e._v(" PDF -> PDF/A-2b (Conversão de Alta Compactação)")]),a("a",{staticClass:"dropdown-item",attrs:{title:"Gerar um PDF para cada página"},on:{click:function(a){return e.clickDraftmidiaAction("decompor")}}},[e._v("Decompor "),a("i",{staticClass:"fas fa-expand"})]),a("a",{staticClass:"dropdown-item",attrs:{title:"Apagar Mídia"},on:{click:e.clickDel}},[e._v("Apagar "),a("i",{staticClass:"fas fa-trash-alt"})])])])]),a("div",{staticClass:"innerimg"},[a("a",{attrs:{href:e.elemento.arquivo,target:"_blank"}},[a("img",{ref:"imgView",attrs:{src:`${e.elemento.arquivo}?page=${e.page}&dpi=48&nocache=${e.nocache}&u=${e.data}`}})]),a("div",{staticClass:"img-actions"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.elemento.metadata.uploadedfile.paginas>1,expression:"elemento.metadata.uploadedfile.paginas > 1"}]},[a("b-form-spinbutton",{attrs:{id:"spinpages",min:"1",max:e.elemento.metadata.uploadedfile.paginas},model:{value:e.page,callback:function(a){e.page=a},expression:"page"}})],1),a("button",{staticClass:"btn btn-sm btn-outline-primary",on:{click:function(a){return e.clickRotate(-90)}}},[a("i",{staticClass:"fas fa-undo"})]),a("button",{staticClass:"btn btn-sm btn-outline-primary",on:{click:function(a){return e.clickRotate(90)}}},[a("i",{staticClass:"fas fa-redo"})])])]),a("div",{class:["innerdesc"]},[a("strong",{domProps:{innerHTML:e._s(e.elemento.metadata.uploadedfile.name)}}),a("small",{domProps:{innerHTML:e._s(`${e.elemento.arquivo_size[1]} MB`)}}),a("small",{directives:[{name:"show",rawName:"v-show",value:99===e.elemento.metadata.ocrmypdf.pdfa,expression:"elemento.metadata.ocrmypdf.pdfa === 99"}]},[e._v("PDF/A-2b com OCR")])])])])},g=[],D=t(4692),b={name:"draft-midia",props:["elemento","cols"],data(){return{page:1,data:(new Date).getTime(),nocache:""}},watch:{elemento(e,a){const t=this.elemento.metadata.ocrmypdf.pdfa;t>=10&&t<=20&&this.timeoutUpdate()}},mounted(){this.nocache="";const e=this.elemento.metadata.ocrmypdf.pdfa;e>=10&&e<=20&&this.timeoutUpdate()},methods:{timeoutUpdate(){let e=this;setTimeout(()=>{e.utils.getModel("arq","draftmidia",e.elemento.id).then(a=>{const t=a.data.metadata.ocrmypdf.pdfa;t>=10&&t<=20?e.timeoutUpdate():e.$emit("updateElement",a.data)})},5e3)},enterInner(e){const a=this,t=a.$refs.inneraction,s=a.$refs.btnDropDownActions,i=e.currentTarget.getBoundingClientRect();t.style.left=i.left+i.width-s.offsetWidth-2+"px",t.style.top=`${i.top+2}px`},leaveInner(e){const a=this,t=a.$refs.dropleft;D(t).dropdown("hide")},clickDel(){const e=this;e.utils.deleteModel("arq","draftmidia",e.elemento.id).then(a=>{e.$emit("redrawDraftMidia")}).catch(a=>{e.sendMessage({alert:"danger",message:a.response.data.message,time:10})})},clickDraftmidiaAction(e){const a=this;a.utils.patchModelAction("arq","draftmidia",a.elemento.id,e).then(e=>{a.data=(new Date).getTime(),a.nocache=(new Date).getTime(),a.$nextTick(()=>{a.$refs.imgView.src=`${a.elemento.arquivo}?page=${a.page}&dpi=48&nocache=${a.nocache}&u=${a.data}`,a.$emit("redrawDraftMidia")})}).catch(e=>{a.sendMessage({alert:"danger",message:e.response.data.message,time:10})})},clickRotate(e){const a=this;a.utils.getByMetadata({action:"rotate",app:"arq",model:"draftmidia",id:a.elemento.id},`page=${a.page}&angulo=${e}`,"PATCH").then(e=>{a.data=(new Date).getTime(),a.$emit("updateElement",e.data)}).catch(e=>{a.sendMessage({alert:"danger",message:e.response.data.message,time:10})})}}},_=b,C=(0,m.A)(_,v,g,!1,null,null,null),P=C.exports,q=t(1580),w=t(2543),F={name:"draft-manage-list",props:["draftselected"],components:{DraftMidia:P,Pagination:q.A},data(){return{pagination:{},draftmidialist:{},cols:4,rows:3}},computed:{draftmidialist_ordered:{get(){return w.orderBy(this.draftmidialist,["sequencia"],["asc"])}}},watch:{draftselected(e,a){this.fetchMidias(e)},rows(e,a){this.fetchMidias(this.draftselected)},cols(e,a){this.fetchMidias(this.draftselected)}},mounted(){this.changeMatriz()},methods:{clickUnir(){const e=this;e.utils.patchModelAction("arq","draft",this.draftselected.id,"unirmidias").then(e=>{this.fetchMidias(this.draftselected)}).catch(a=>{e.sendMessage({alert:"danger",message:a.response.data.message,time:10})})},clickSupendeConversao(){const e=this;e.utils.patchModelAction("arq","draft",this.draftselected.id,"cancela_pdf2pdfa").then(e=>{this.fetchMidias(this.draftselected)}).catch(a=>{e.sendMessage({alert:"danger",message:a.response.data.message,time:10})})},clickPdf2Pdfa(){const e=this;e.utils.patchModelAction("arq","draft",this.draftselected.id,"pdf2pdfa").then(e=>{this.fetchMidias(this.draftselected)}).catch(a=>{e.sendMessage({alert:"danger",message:a.response.data.message,time:10})})},clickDel(){const e=this;this.utils.deleteModel("arq","draft",this.draftselected.id).then(a=>{e.$emit("reloadDrafts")}).catch(a=>{e.sendMessage({alert:"danger",message:a.response.data.message,time:10})})},drawList(e){let a=Object.keys(this.draftmidialist).length;-1===e?this.fetchMidias(this.draftselected,a>1?this.pagination.page:this.pagination.previous_page||1):this.fetchMidias(this.draftselected,a>0?this.pagination.page:this.pagination.previous_page||1)},changeMatriz(){let e=document.getElementsByClassName("draft-midia"),a=this;w.each(e,function(e,t){e.style.maxWidth=100/a.cols+"%",e.style.flex=`0 0 ${100/a.cols}%`})},currentPage(e){null!==e&&e>=0&&this.fetchMidias(this.draftselected,e)},updateElement(e){this.$set(this.draftmidialist,e.id,e)},nextPage(){this.fetchMidias(this.draftselected,this.pagination.next_page)},previousPage(){this.fetchMidias(this.draftselected,this.pagination.previous_page)},fetchMidias(e,a=1){let t=this;null!==e&&e.id>0?(t.$set(t,"draftmidialist",{}),t.$nextTick().then(function(){t.utils.getModelOrderedList("arq","draftmidia","sequencia",a,`&draft=${e.id}&page_size=${t.rows*t.cols}`).then(e=>{t.$set(t,"pagination",e.data.pagination),w.each(e.data.results,function(e,a){t.$set(t.draftmidialist,e.id,e)})}).then(function(){t.changeMatriz()}).catch(e=>t.sendMessage({alert:"danger",message:"Não foi possível recuperar a lista...",time:5}))})):t.$set(t,"draftmidialist",{})}}},A=F,M=(0,m.A)(A,p,h,!1,null,null,null),k=M.exports,x=function(){var e=this;e._self._c;return e._m(0)},$=[function(){var e=this,a=e._self._c;return a("div",[a("hr"),a("h3",[e._v("O que é o Draft?")]),a("h5",{staticStyle:{"padding-left":"5vw","padding-bottom":"1em"}},[e._v(" Draft é uma ferramenta para criação e edição de arquivos PDF/A-2b,"),a("br"),e._v("além de também fazer OCR e converter DOC, DOCx, ODT, XLS, XLSX, ODS, TIF, TIFF, PNG e JPG para PDFs."),a("br")]),e._v(" Esta área é só sua. Os Drafts criados aqui não são públicos e não são vistos por outros usuários."),a("br"),e._v(' Cada Draft é uma área de criação independente. Clique no botão "+" acima para incluir um novo Draft.'),a("br"),a("br"),e._v(" Em um Draft você pode incluir vários PDFs, bem como desmembrar, excluir, rotacionar e reunir páginas. "),a("br"),e._v(" Alem de arquivos DOC, DOCx, ODT, XLS, XLSX, ODS, PNG e JPG, que serão imediatamente convertidos para PDF."),a("br"),a("br"),e._v(' No Draft é possível adicionar vários PDFs e clicar no botão "PDF -> PDF/A-2b" que acionará uma tarefa interna do Draft que transformará seus arquivos em PDF/A-2b com OCR. Com seus arquivos já editados, você poderá baixá-los em um arquivo compactado se em seu Draft houver mais que um arquivo ou ainda clicar sobre ele e abrir uma nova janela para então salvar em seus documentos locais.'),a("br"),a("div",{staticClass:"d-none"},[e._v(" Nas próximas versões da ferramenta, em breve, será adicionado reposicionamento de páginas e baixa/alta compactação de imagens para geração de PDFs reduzidos."),a("br")]),e._v(" No canto superior esquerdo de cada arquivo aparece um círculo que pode possuir três cores: "),a("ul",[a("li",[e._v("Círculo vermelho - Significa que o arquivo não foi analisado desde a adição ou devido a edições, e não há garantia que possua OCR ou seja um PDF/A-2b.")]),a("li",[e._v('Circulo amarelo - Significa que você acionou um conversor "PDF -> PDF/A-2b" e que o Draft está trabalhando nessa tarefa. Tal tarefa não é feita em seu computador e neste momento está sendo feita em nuvem, o que significa que você pode fechar o site, ir fazer outras tarefas e, mais tarde, pegar seus arquivos já convertidos. Isso mesmo: se forem muitos arquivos e/ou muitas páginas, o processo de conversão pode demorar de minutos a horas. ')]),a("li",[e._v('Circulo verde - O processamento de "PDF -> PDF/A-2b" já está concluído e você pode baixar seu arquivo.')])]),e._v(' Já no canto superior direito, em "'),a("small",[a("i",{staticClass:"fas fa-ellipsis-v"})]),e._v('", você encontra as opções exclusivas do PDF em edição, que seria: '),a("ul",[a("li",[e._v('"PDF -> PDF/A-2b" - do PDF em específico.')]),a("li",[e._v('"Decompor" - que decompõe um PDF de várias páginas em vários PDFs de uma página.')]),a("li",[e._v('"Excluir" - que exclui apenas o PDF em edição.')])]),a("strong",[e._v(" E, muito importante, seu Draft será automaticamente apagado depois de uma semana que você o criar, afinal, é um "),a("em",[e._v("Draft")]),e._v(' ("rascunho", em inglês). ')])])}],y={name:"draft-help"},T=y,O=(0,m.A)(T,x,$,!1,null,null,null),z=O.exports,S={name:"draft-manage",components:{DropZone:u,ModelSelect:r.A,DraftManageList:k,DraftHelp:z},data(){return{draftselected:null}},methods:{reloadDrafts(){this.draftselected=null,this.$refs.draftSelect.fetchModel()},clickAdd(){const e=this;this.utils.postModel("arq","draft",{descricao:`New Draft ${(new Date).toLocaleString()}`}).then(a=>{e.$refs.draftSelect.fetchModel()}).catch(e=>{})},uploadedFiles(e){"OK"===e.statusText&&this.$refs.listdraft.fetchMidias(this.draftselected,1)},changeDescricao(e){const a=this;a.utils.patchModel("arq","draft",a.draftselected.id,{descricao:e}).then(e=>{a.$refs.draftSelect.fetchModel()})}}},N=S,L=(0,m.A)(N,s,i,!1,null,null,null),E=L.exports}}]);