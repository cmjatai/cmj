(self["webpackChunkPortalCMJ_Frontend_v2018"]=self["webpackChunkPortalCMJ_Frontend_v2018"]||[]).push([[4649],{4649:function(t,e,i){"use strict";i(3792),i(3362),i(9085),i(9391),i(8111),i(7588),i(6099),i(3500),i(1774),i(2008),i(113),i(2489),i(116),i(3110),i(9432),i(8335);var o=window.$;function n(t,e,i){var o=new Date,n=new Date;null!==i&&0!==i||(i=1),n.setTime(o.getTime()+864e5*i),document.cookie=t+"="+escape(e)+";expires="+n.toGMTString()}function a(t){var e=" "+document.cookie,i=e.indexOf(" "+t+"=");if(-1===i&&(i=e.indexOf(";"+t+"=")),-1===i||""===t)return"";var o=e.indexOf(";",i+1);return-1===o&&(o=e.length),unescape(e.substring(i+t.length+2,o))}function s(t){o(t).append('<div style="text-align:center;"><i style="font-size: 200%;" class="fa fa-refresh fa-spin"></i></div>')}function d(t){o(function(){var e={},i=o("body").children("#container_ds");i.length>0&&o(i).remove(),i=o('<div id="container_ds"/>'),o("body").prepend(i);var n=o('[data-sapl-ta="DispositivoSearch"]');n.each(function(){var n=o(this),a=n.attr("data-type-selection"),d=n.attr("data-field"),r=n.attr("data-function"),l=function(t){if("checkbox"===a){var e=n.find('input[name="ta_select_all"]');e.off(),e.on("change",function(t){o(this).closest("ul").find('input[name="'+d+'"]').prop("checked",this.checked)})}else{var i=n.find("input");i.off(),i.attr("type","hidden"),o('<a class="text-danger">').insertBefore(i).append(o('<span aria-hidden="true">&times;</span>')).on("click",function(){2===o(this).closest("ul").find("li").length?o(this).closest("ul").remove():o(this).closest("li").remove()})}};l();var c=function(t){var i=o('select[name="tipo_ta"]').val(),n=o('select[name="tipo_model"]').val(),l=o('input[name="num_ta"]').val(),c=o('input[name="ano_ta"]').val(),p=o('input[name="tipo_resultado"]:checked').val(),u=o('input[name="rotulo_dispositivo"]').val(),f=o('input[name="texto_dispositivo"]').val(),m=o('select[name="max_results"]').val(),v=o('input[name="texto_articulado_do_editor"]').val(),h="";u.length>0||f.length>0?(o('input[name="tipo_resultado"]').prop("disabled",!1),o('input[name="tipo_resultado"]').each(function(t,e){e.parentElement.classList.remove("disabled")}),o('input[name="tipo_resultado"]').closest("#div_id_tipo_resultado").css("opacity","1")):(o('input[name="tipo_resultado"]').filter('[value="False"]').prop("checked",!0),o('input[name="tipo_resultado"]').prop("disabled",!0),o('input[name="tipo_resultado"]').each(function(t,e){e.parentElement.classList.add("disabled")}),o('input[name="tipo_resultado"]').closest("#div_id_tipo_resultado").css("opacity","0.3"),p="False"),e={tipo_ta:i,tipo_model:n,num_ta:l,ano_ta:c,texto:f,rotulo:u,tipo_resultado:p,max_results:m,data_type_selection:a,data_field:d,data_function:r,texto_articulado_do_editor:v},window.localStorage.setItem("dispositivo_search_form_data",JSON.stringify(e)),h="/ta/search_fragment_form",o(".result-busca-dispositivo").html(""),s(".result-busca-dispositivo"),o.get(h,e).done(function(t){if(o(".result-busca-dispositivo").html(t),"checkbox"===a){var e=o(".result-busca-dispositivo").find('input[name="ta_select_all"]');e.off(),e.on("change",function(t){o(this).closest("ul").find('input[name="'+d+'"]').prop("checked",this.checked)})}})},p=function(t){var e=o('input[name="rotulo_dispositivo"]').val(),i=o('input[name="texto_dispositivo"]').val();e.length>0||i.length>0?(o('input[name="tipo_resultado"]').prop("disabled",!1),o('input[name="tipo_resultado"]').each(function(t,e){e.parentElement.classList.remove("disabled")}),o('input[name="tipo_resultado"]').closest("#div_id_tipo_resultado").css("opacity","1")):(o('input[name="tipo_resultado"]').filter('[value="False"]').prop("checked",!0),o('input[name="tipo_resultado"]').prop("disabled",!0),o('input[name="tipo_resultado"]').each(function(t,e){e.parentElement.classList.add("disabled")}),o('input[name="tipo_resultado"]').closest("#div_id_tipo_resultado").css("opacity","0.3"))},u=n.children("#buttonDs");u.length>0&&o(u).remove(),u=o('<div id="buttonDs" class="clearfix"/>'),n.prepend(u);var f=o("<button>").text(t["text_button"]).attr("type","button").attr("class","btn btn-sm btn-success btn-modal-open");u.append(f),f.on("click",function(){o.get(t["url_form"],function(s){i.html(s);var r=o("#modal-ds");r.find('select[name="tipo_ta"]').change(function(t){var i="";i="/ta/search_fragment_form?action=get_tipos&tipo_ta="+this.value,r.find('label[for="id_tipo_model"]').html("Tipos de "+this.children[this.selectedIndex].innerHTML);var n=r.find('select[name="tipo_model"]');n.empty(),o('<option value="">Carregando...</option>').appendTo(n),o.get(i).done(function(t){for(var i in n.empty(),t)for(var a in t[i])n.append(o("<option>").attr("value",a).text(t[i][a]));setTimeout(function(){o('select[name="tipo_model"]').val(e.tipo_model)},200)})}),r.find('input[name="texto_dispositivo"], input[name="rotulo_dispositivo"]').on("keyup",p),r.find(".btn-busca").click(c),r.find("#btn-modal-select").click(function(){var e=n.find("ul");"radio"===a&&e.remove();var i=r.find('[name="'+d+'"]:checked');i.closest("ul").find("input:not(:checked)").filter('[name!="ta_select_all"]').closest("li").remove(),i.closest("ul").each(function(){var t=n.find("#"+this.id);if(0!==t.length){var e=o(this).find("input");e.each(function(){t.find("#"+this.id).length>0||t.append(o(this).closest("li"))})}else n.append(this)}),l(),r.modal("hide"),"post_selected"in t&&t["post_selected"](t["params_post_selected"])});try{e=JSON.parse(window.localStorage.getItem("dispositivo_search_form_data")),o('input[name="num_ta"]').val(e.num_ta),o('input[name="ano_ta"]').val(e.ano_ta),o('input[name="rotulo_dispositivo"]').val(e.rotulo),o('input[name="texto_dispositivo"]').val(e.texto),o('select[name="max_results"]').val(e.max_results),o('input[name="tipo_resultado"]').filter('[value="'.concat(e.tipo_resultado,'"]')).attr("checked",!0)}catch(u){}setTimeout(function(){try{o('select[name="tipo_ta"]').val(e.tipo_ta),o('select[name="tipo_ta"]').trigger("change")}catch(u){}},200),r.modal("show")})}),"autostart"in t&&t["autostart"]&&f.trigger("click")})})}var r={SetCookie:n,ReadCookie:a,insertWaitAjax:s,DispositivoSearch:d},l=(i(7495),i(5746),i(4692)),c=window.$,p=i(7546);function u(t){"function"===typeof l&&t instanceof l&&(t=t[0]);var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function f(t,e){for(var i=null,o=c(".dptt"),n=0;n<o.length;n++)if(!c(o[n]).hasClass("displaynone")&&u(o[n])){i=n+1<o.length?o[n+1]:o[n];break}if(c(".cp .tipo-vigencias a").removeClass("active"),c(t).addClass("active"),c(".dptt.desativado").removeClass("displaynone"),c(".desativado > .dn").removeClass("displaynone"),c(".dptt.revogado").removeClass("displaynone"),c(".dtxt").removeClass("displaynone"),c(".dtxt.diff").remove(),c(".nota-alteracao").removeClass("displaynone"),e&&c('.dtxt[id^="da"').each(function(){if(!(c(this).html().search(/<\/\w+>/g)>0)){var t=c(this).attr("pk"),e=c(this).attr("pks"),i=c("#d"+e).contents().filter(function(){return this.nodeType===Node.TEXT_NODE}),o=c("#da"+t).contents().filter(function(){return this.nodeType===Node.TEXT_NODE}),n=p.diffWordsWithSpace(c(i).text(),c(o).text());if(n.length>0){c("#d"+e).closest(".desativado").addClass("displaynone");var a=c("#da"+t).clone();c("#da"+t).after(a),c("#da"+t).addClass("displaynone"),c(a).addClass("diff").html(""),n.forEach(function(t){var e=document.createElement("span"),i=t.value;t.removed?(c(e).addClass("desativado"),i+=" "):t.added&&c(e).addClass("added"),e.appendChild(document.createTextNode(i)),c(a).append(e)})}}}),i)try{c("html, body").animate({scrollTop:c(i).parent().offset().top-60},0)}catch(a){}}function m(t,e){for(var i=null,o=c(".dptt"),n=0;n<o.length;n++)if(!c(o[n]).hasClass("displaynone")&&u(o[n])){i=n+1<o.length?o[n+1]:o[n];break}if(c(".cp .tipo-vigencias a").removeClass("active"),c(t).addClass("active"),c(".dptt.desativado").addClass("displaynone"),c(".desativado > .dn").addClass("displaynone"),c(".nota-alteracao").removeClass("displaynone"),c(".dptt.revogado").removeClass("displaynone"),e||c(".nota-alteracao").addClass("displaynone"),i)try{c("html, body").animate({scrollTop:c(i).parent().offset().top-60},0)}catch(a){}}function v(t,e){m(t,e),c(".dptt.revogado").addClass("displaynone")}var h={isElementInViewport:u,textoMultiVigente:f,textoVigente:m,textoVigenteSemRevogados:v},_=window.$;function g(t,e){_("html, body").animate({scrollTop:_("#dne"+t).offset().top-window.innerHeight/5},300),window.refreshDatePicker(),_("#dne"+t+" #button-id-submit-form").click(b),_("#dne"+t+" .btn-close-container").click(function(){_(this).closest(".dne-nota").removeClass("dne-nota"),_(this).closest(".dne-form").html("")}),"nota"===e?_("#dne"+t+' select[name="tipo"]').change(function(e){var i="";i="text/"+t+"/nota/create?action=modelo_nota&id_tipo="+this.value,_.get(i).done(function(e){_("#dne"+t+' textarea[name="texto"]').val(e)})}):"vide"===e&&window.DispositivoSearch({url_form:"/ta/search_form",text_button:"Definir Dispositivo"})}function b(t){var e="",i="nota",o=null,n=_("#id_dispositivo").val();void 0===n&&(n=_("#id_dispositivo_base").val(),i="vide"),o=_("#id_pk").val(),e="text/"+n+"/"+i+"/",e+=null===o||""===o?"create":o+"/edit",_.post(e,_("#dne"+n+" form").serialize(),function(t){if("string"===typeof t)if(t.indexOf("<form")>=0)_("#dne"+n+" .dne-form").html(t),g(n,i);else{_("#dne"+n+" .dne-form").closest(".dpt").html(t),y();try{_("html, body").animate({scrollTop:_("#dne"+n).offset().top-window.innerHeight/3},300)}catch(e){}}})}function w(t){var e=_(t).attr("model"),i=_(t).closest(".dn").attr("pk"),o=_(t).attr("pk"),n="text/"+i+"/"+e+"/"+o+"/delete";_.get(n,function(t){_("#dne"+i+" .dne-form").closest(".dpt").html(t),y()})}function k(t){var e="",i=_(t).attr("model"),o=_(".dne-nota .dne-form").closest(".dne").attr("pk");if(null!=o&&(_("#dne"+o).removeClass("dne-nota"),_("#dne"+o+" .dne-form").html("")),t.className.indexOf("create")>=0)o=_(t).attr("pk"),e="text/"+o+"/"+i+"/create";else if(t.className.indexOf("edit")>=0){var n=_(t).attr("pk");o=_(t).closest(".dn").attr("pk"),e="text/"+o+"/"+i+"/"+n+"/edit"}_("#dne"+o).addClass("dne-nota"),_.get(e).done(function(t){_("#dne"+o+" .dne-form").html(t),g(o,i)}).fail(function(){y()})}function y(){_(".dne-nota").removeClass("dne-nota"),_(".dne-form").html(""),_(".dne .btn-action").off(),_(".dn .btn-action").off(),_(".dne .btn-action, .dn .btn-action").not(".btn-nota-delete").not(".btn-vide-delete").click(function(){k(this)}),_(".dn .btn-nota-delete, .dn .btn-vide-delete").click(function(){w(this)})}var C={onEventsDneExec:g,onSubmitEditNVForm:b,onDelete:w,onReadyNotasVides:y},x=(i(6016),i(2543)),E=i(4692);x.forEach(x.merge(x.merge(r,C),h),function(t,e){window[e]=t}),E(document).ready(function(){setTimeout(function(){var t=location.href.split("#");if(2===t.length)try{E("html, body").animate({scrollTop:E("#dptt"+t[1]).offset().top-window.innerHeight/9},0)}catch(e){}},100),E("#btn_font_menos").click(function(){E(".dpt").css("font-size","-=1")}),E("#btn_font_mais").click(function(){E(".dpt").css("font-size","+=1")}),E(".dpt.bloco_alteracao .dpt").each(function(){var t=parseInt(E(this).attr("nivel"));E(this).css("z-index",15-t)}),E(".cp-linha-vigencias > li:not(:first-child):not(:last-child) > a").click(function(t){E(".cp-linha-vigencias > li").removeClass("active"),E(this).closest("li").addClass("active"),t.preventDefault()}),E("main").click(function(t){t.target!==this&&t.target!==this.firstElementChild||E(".cp-linha-vigencias > li").removeClass("active")}),window.onReadyNotasVides()})},6016:function(t,e,i){var o=i(4692);i(8706),i(2008),i(113),i(3418),i(2062),i(8111),i(2489),i(116),i(1701),i(6099),i(7764);var n=window.$;window.DispositivoEdit=function(){var t,e="textarea";if(!(this instanceof window.DispositivoEdit))return t||(t=new window.DispositivoEdit),t;t=this,window.DispositivoEdit=function(){return t},t.bindActionsEditorType=function(i){e=this.getAttribute("editortype"),window.SetCookie("editortype",e,30);var o=n(this).closest(".dpt"),a=o.attr("pk");t.clearEditSelected(),t.triggerBtnDptEdit(a),i.preventDefault()},t.bindActionsClick=function(e){var i=this.getAttribute("pk"),o={action:this.getAttribute("action"),tipo_pk:this.getAttribute("tipo_pk"),perfil_pk:this.getAttribute("perfil_pk"),variacao:this.getAttribute("variacao"),pk_bloco:this.getAttribute("pk_bloco")},a=i+"/refresh";t.waitShow(),n.get(a,o).done(function(e){t.clearEditSelected(),null!=e.pk&&t.message(e)}).fail(t.waitHide).always(t.waitHide)},t.clearEditSelected=function(){n(".dpt-selected > .dpt-form").html(""),n(".dpt-actions, .dpt-actions-bottom").html(""),window.tinymce.remove(),n(".dpt-selected").removeClass("dpt-selected")},t.editDispositivo=function(e){var i=e.target.classList.contains("dpt-link")?e.target:e.target.parentElement.classList.contains("dpt-link")?e.target.parentElement:null;if(!(i&&i.getAttribute("href")&&i.getAttribute("href").length>0)){var o=n(this).closest(".dpt");if(o.hasClass("dpt-selected"))"editor-close"===this.getAttribute("action")&&t.clearEditSelected();else{t.clearEditSelected(),t.loadActionsEdit(o);var a=o.attr("formtype");o.on(a,t[a]),t.loadForm(o,a)}}},t.gc=function(){setTimeout(function(){n(".dpt:not(.dpt-selected) > .dpt-form").html("")},500)},t.get_form_base=function(){var e=n(this);e.addClass("dpt-selected");var i=e.children().filter(".dpt-form");i.find("form").submit(t.onSubmitEditFormBase),t.scrollTo(e),e.off("get_form_base");var o=e.find(".btn-fechar");o.on("click",function(e){t.clearEditSelected(),e.preventDefault()});var a=e.find(".btns-excluir");e.find(".dpt-actions-bottom").first().append(a),a.find(".btn-outline-danger").on("click",t.bindActionsClick)},t.get_form_alteracao=function(){var e=n(this);e.off("get_form_alteracao"),n(".dpt-actions, .dpt-actions-bottom").html("");var i=e.children().filter(".dpt-form").children().first(),o="".concat(i[0]["id_dispositivo_search_form"].value,"?ta_base_id=").concat(i[0]["id_texto_articulado_do_editor"].value);window.DispositivoSearch({url_form:o,text_button:"Selecionar",autostart:!0}),t.scrollTo(e),i.submit(t.onSubmitFormRegistraAlteracao);var a=e.find(".btn-fechar");a.on("click",function(i){t.clearEditSelected(),t.triggerBtnDptEdit(e.attr("pk")),i.preventDefault()})},t.get_form_inclusao=function(){var e=n(this);e.off("get_form_inclusao"),n(".dpt-actions, .dpt-actions-bottom").html("");var i=e.children().filter(".dpt-form").children().first(),o="".concat(i[0]["id_dispositivo_search_form"].value,"?ta_base_id=").concat(i[0]["id_texto_articulado_do_editor"].value);window.DispositivoSearch({url_form:o,text_button:"Selecionar",post_selected:t.allowed_inserts_registro_inclusao,params_post_selected:{pk_bloco:e.attr("pk")},autostart:!0}),t.scrollTo(e),i.submit(t.onSubmitFormRegistraInclusao);var a=e.find(".btn-fechar");a.on("click",function(i){t.clearEditSelected(),t.triggerBtnDptEdit(e.attr("pk")),i.preventDefault()})},t.get_form_revogacao=function(){var e=n(this);e.off("get_form_revogacao"),n(".dpt-actions, .dpt-actions-bottom").html("");var i=e.children().filter(".dpt-form").children().first(),o="".concat(i[0]["id_dispositivo_search_form"].value,"?ta_base_id=").concat(i[0]["id_texto_articulado_do_editor"].value);window.DispositivoSearch({url_form:o,text_button:"Selecionar",autostart:!0}),t.scrollTo(e),i.submit(t.onSubmitFormRegistraRevogacao);var a=e.find(".btn-fechar");a.on("click",function(){t.clearEditSelected(),t.triggerBtnDptEdit(e.attr("pk"))})},t.allowed_inserts_registro_inclusao=function(e){var i=n("#id"+e.pk_bloco+" input[name='dispositivo_base_para_inclusao']");if(0!==i.length){var o=i[0].value,a={action:"get_actions_allowed_inserts_registro_inclusao",pk_bloco:e.pk_bloco},s=o+"/refresh";t.waitShow(),n.get(s,a).done(function(e){n(".allowed_inserts").html(e),n(".allowed_inserts").find(".btn-action").on("click",t.bindActionsClick)}).fail(t.waitHide).always(t.waitHide)}},t.loadActionsEdit=function(i){var o=i.attr("pk"),a=o+"/refresh?action=get_actions";n.get(a).done(function(o){i.find(".dpt-actions").first().html(o),i.find(".btn-action").on("click",t.bindActionsClick),i.find(".btn-compila").on("click",t.loadFormsCompilacao),i.find(".btn-editor-type").on("click",t.bindActionsEditorType),"construct"===e&&(i.find(".btn-group-inserts").first().addClass("open show"),i.find(".btn-group-inserts ul").first().addClass("show")),i.find(".btn-group-inserts button").mouseenter(function(t){i.find(".btn-group-inserts ul").removeClass("show"),i.find(".btn-group-inserts").removeClass("open show"),n(this.parentElement).addClass("open show"),n(this.parentElement).find("ul").addClass("show")}),i.find(".btn-group-inserts").mouseleave(function(t){i.find(".btn-group-inserts ul").removeClass("show"),i.find(".btn-group-inserts").removeClass("open show")}),t.gc()})},t.loadForm=function(i,o){var a=i.attr("pk"),s=i.children().filter(".dpt-form");if(1===s.length){var d=a+"/refresh?action="+o;n.get(d).done(function(t){"construct"!==e&&(s.html(t),"tinymce"===e&&window.initTextRichEditor()),i.trigger(o)}).always(function(){t.waitHide()})}},t.loadFormsCompilacao=function(e){var i=n(this).closest(".dpt"),o=this.getAttribute("action");i.on(o,t[o]),t.loadForm(i,o)},t.modalMessage=function(t,e,i){return null!==t&&""!==t&&(n("#modal-message #message").html(t),n("#modal-message").modal("show"),n("#modal-message, #modal-message .alert button").off(),n("#modal-message .alert").removeClass("alert-success alert-info alert-warning alert-danger alert-danger"),n("#modal-message .alert").addClass(e),null!=i&&n("#modal-message").on("hidden.bs.modal",i),n("#modal-message .alert button").on("click",function(){n("#modal-message").modal("hide")}),!0)},t.message=function(e){if(void 0!==e.message)if(e.message.modal)t.modalMessage(e.message.value,"alert-"+e.message.type,function(){t.waitShow(),t.refreshScreenFocusPk(e)});else{if(t.refreshScreenFocusPk(e),!("message"in e))return;var i=n(".cp-notify");i.removeClass("hide");var o=i.find(".message");o.text(e.message.value),o.removeClass("bg-primary bg-success bg-info bg-warning bg-danger").addClass("bg-"+e.message.type),setTimeout(function(){i.addClass("hide")},e.message.time?e.message.time:3e3)}else t.refreshScreenFocusPk(e)},t.offClicks=function(){n(".btn-dpt-edit").off()},t.onClicks=function(e){var i;i=null==e?n(".btn-dpt-edit"):n(e).find(".btn-dpt-edit"),i.on("click",t.editDispositivo)},t.onSubmitFormRegistraAlteracao=function(e){if(void 0===this.dispositivo_alterado)return t.modalMessage("Nenhum dispositivo selecionado","alert-info"),void(null!=e&&e.preventDefault());var i=void 0===this.dispositivo_alterado.length?[this.dispositivo_alterado]:Array.from(this.dispositivo_alterado),o={csrfmiddlewaretoken:this.csrfmiddlewaretoken.value,dispositivo_alterado:i.filter(function(t,e,i){return t.checked}).map(function(t){return t.value}),formtype:"get_form_alteracao"},a=n(this).closest(".dpt").attr("pk")+"/refresh";t.waitShow(),n.post(a,o).done(function(e){t.clearEditSelected(),null!=e.pk?t.message(e):alert("Erro na resposta!")}).always(function(){t.waitHide()}),null!=e&&e.preventDefault()},t.onSubmitFormRegistraInclusao=function(e){var i={csrfmiddlewaretoken:this["csrfmiddlewaretoken"].value,dispositivo_base_para_inclusao:this["dispositivo_base_para_inclusao"].value,formtype:"get_form_inclusao"},o=n(this).closest(".dpt").attr("pk")+"/refresh";t.waitShow(),n.post(o,i).done(function(e){t.clearEditSelected(),null!=e.pk?t.message(e):alert("Erro na resposta!")}).always(function(){t.waitHide()}),null!=e&&e.preventDefault()},t.onSubmitFormRegistraRevogacao=function(e){if(void 0===this.dispositivo_revogado)return t.modalMessage("Nenhum dispositivo selecionado","alert-info"),void(null!=e&&e.preventDefault());var i=void 0===this.dispositivo_revogado.length?[this.dispositivo_revogado]:Array.from(this.dispositivo_revogado),o={csrfmiddlewaretoken:this.csrfmiddlewaretoken.value,dispositivo_revogado:i.filter(function(t,e,i){return t.checked}).map(function(t){return t.value}),revogacao_em_bloco:this.revogacao_em_bloco.value,formtype:"get_form_revogacao"},a=n(this).closest(".dpt").attr("pk")+"/refresh";t.waitShow(),n.post(a,o).done(function(e){t.clearEditSelected(),null!=e.pk?t.message(e):alert("Erro na resposta!")}).always(function(){t.waitHide()}),null!=e&&e.preventDefault()},t.onSubmitEditFormBase=function(e){var i=this,o="",a="",s="",d=window.tinymce.get("id_texto"),r=window.tinymce.get("id_texto_atualizador");o=null!=d?d.getContent():this["id_texto"].value,null!=r?a=r.getContent():"id_texto_atualizador"in this&&(a=this["id_texto_atualizador"].value),"visibilidade"in this&&(s=this["visibilidade"].value);var l={csrfmiddlewaretoken:this["csrfmiddlewaretoken"].value,texto:o,texto_atualizador:a,visibilidade:s,formtype:"get_form_base"},c=n(this).closest(".dpt").attr("pk")+"/refresh";t.waitShow(),n.post(c,l).done(function(e){if("string"===typeof e){var o=n(i).closest(".dpt");return o=n("#"+o.replaceWith(e).attr("id")),t.onClicks(o),void t.waitHide()}t.clearEditSelected(),null!=e.pk?t.message(e):alert("Erro na resposta!")}).always(function(){t.waitHide()}),null!=e&&e.preventDefault()},t.refreshContent=function(e,i){if(0!==e.length){var o=e.shift(),a=o+"/refresh";n.get(a).done(function(a){var s=n("#id"+o).closest(".dpt");s=n("#"+s.replaceWith(a).attr("id")),t.onClicks(s),t.reloadFunctionsDraggables(),i>0&&t.triggerBtnDptEdit(i),t.refreshContent(e)})}else t.waitHide()},t.refreshScreenFocusPk=function(e){if(t.waitShow(),-1===e.pai[0]){t.waitShow();var i=location.href.split("#")[0];location.href=i+"#"+e.pk,location.reload(!0)}else t.refreshContent(e.pai,e.pk)},t.reloadFunctionsDraggables=function(){var t=n(".dpt-alts");t.length>0&&(t.sortable({connectWith:".dpt-alts",items:".sorting-initialize",revert:!0,distance:15,start:function(t,e){},stop:function(t,e){var i=e.item.attr("pk"),o=e.item.closest(".dpt-alts").closest(".dpt").attr("pk"),a=i+"/refresh?action=json_drag_move_dpt_alterado&index="+e.item.index()+"&bloco_pk="+o;n.get(a).done(function(t){})}}),t.find(".dpt").one("mouseenter",function(){o(this).addClass("sorting-initialize"),t.sortable("refresh")}),n(".dpt-alts .dpt").draggable({connectToSortable:".dpt-alts",revert:"invalid",zIndex:1,distance:15,drag:function(t,e){n(".dpt-alts").addClass("drag")},stop:function(t,e){n(".dpt-alts").removeClass("drag")}}),t.disableSelection())},t.scrollTo=function(t){try{n("html, body").animate({scrollTop:t.offset().top-window.innerHeight/9},100)}catch(e){}},t.triggerBtnDptEdit=function(t){var e=n("#id"+t+" > .dpt-text.btn-dpt-edit");0===e.length&&(e=n("#id"+t+" > .dpt-actions-fixed > .btn-dpt-edit")),e.first().trigger("click")},t.waitHide=function(){n("#wait_message").addClass("displaynone")},t.waitShow=function(){n("#wait_message").removeClass("displaynone")},t.init=function(){n(".dpt-actions-fixed").first().css("opacity","1"),e=window.ReadCookie("editortype"),null!==e&&""!==e||(e="textarea",window.SetCookie("editortype",e,30)),t.offClicks(),t.onClicks(),t.reloadFunctionsDraggables();var i=location.href.split("#");2===i.length&&""!==i[1]&&t.triggerBtnDptEdit(i[1]),n("main").click(function(e){e.target!==this&&e.target!==this.firstElementChild||t.clearEditSelected()}),t.waitHide()},t.init()},n(document).ready(function(){o(".cpe").length>0&&window.DispositivoEdit()})}}]);