"use strict";(self["webpackChunkportalcmj_frontend"]=self["webpackChunkportalcmj_frontend"]||[]).push([[8644],{8644:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});var s=function(){var e=this,a=e._self._c;return a("div",{staticClass:"vue-loa-detail"},[e._m(0),e.loa.ano&&e.chartDataLoa?e._e():a("div",{staticClass:"container"},[a("strong",{staticClass:"d-block mx-5 my-5"},[e._v("Carregando Dados Gráficos...")])]),e.loa.ano&&e.chartDataLoa?a("div",{staticClass:"container"},[e._m(1),a("div",{staticClass:"row c-fields"},[a("div",{staticClass:"col-md-3"},[e._v(" Órgãos "),a("model-select",{ref:"orgaoSelect",attrs:{app:"loa",model:"orgao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`&loa=${e.qs_loa}&page_size=100`},on:{change:a=>e.despesa.orgaoselected=a},model:{value:e.despesa.orgaoselected,callback:function(a){e.$set(e.despesa,"orgaoselected",a)},expression:"despesa.orgaoselected"}}),e._v(" Unidades Orçamentárias "),a("model-select",{ref:"unidadeSelect",attrs:{app:"loa",model:"unidadeorcamentaria",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}${e.qs_orgao}`},on:{change:a=>e.despesa.unidadeselected=a},model:{value:e.despesa.unidadeselected,callback:function(a){e.$set(e.despesa,"unidadeselected",a)},expression:"despesa.unidadeselected"}})],1),a("div",{staticClass:"col-md-3"},[e._v(" Funções "),a("model-select",{ref:"funcaoSelect",attrs:{app:"loa",model:"funcao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.funcaoselected=a},model:{value:e.despesa.funcaoselected,callback:function(a){e.$set(e.despesa,"funcaoselected",a)},expression:"despesa.funcaoselected"}}),e._v(" Subfunções "),a("model-select",{ref:"subfuncaoSelect",attrs:{app:"loa",model:"subfuncao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.subfuncaoselected=a},model:{value:e.despesa.subfuncaoselected,callback:function(a){e.$set(e.despesa,"subfuncaoselected",a)},expression:"despesa.subfuncaoselected"}})],1),a("div",{staticClass:"col-md-3"},[e._v(" Programas "),a("model-select",{ref:"programaSelect",attrs:{app:"loa",model:"programa",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.programaselected=a},model:{value:e.despesa.programaselected,callback:function(a){e.$set(e.despesa,"programaselected",a)},expression:"despesa.programaselected"}}),e._v(" Ações "),a("model-select",{ref:"acaoSelect",attrs:{app:"loa",model:"acao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.acaoselected=a},model:{value:e.despesa.acaoselected,callback:function(a){e.$set(e.despesa,"acaoselected",a)},expression:"despesa.acaoselected"}})],1),a("div",{staticClass:"col-md-3 c-groups pl-4"},[a("div",{},[a("strong",[e._v("Agrupamentos")]),a("b-form-select",{attrs:{options:e.agrupamentos__options,"select-size":1},model:{value:e.despesa.agrupamentoselected,callback:function(a){e.$set(e.despesa,"agrupamentoselected",a)},expression:"despesa.agrupamentoselected"}}),a("strong",[e._v("Máximo de Itens")]),a("b-form-select",{attrs:{options:e.itens,"select-size":1},model:{value:e.despesa.itensselected,callback:function(a){e.$set(e.despesa,"itensselected",a)},expression:"despesa.itensselected"}})],1),a("div",{staticClass:"col mt-1 text-right"},[a("b-button",{staticClass:"bg-secondary",attrs:{size:"sm"},on:{click:function(a){return e.clearFilters(e.event)}}},[e._v("Limpar Pesquisa")])],1)])]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 container-doughnut p-3 mt-3"},[e.chartDataLoa?a("DoughnutChart",{attrs:{height:e.height,plugins:e.pluginsDun,chartDataUser:e.chartDataLoa}}):e._e(),a("b-table",{staticClass:"local_table",attrs:{striped:"",hover:"",items:e.despesas_agrupadas_table}})],1),a("div",{staticClass:"col-12 mt-3",domProps:{innerHTML:e._s(e.loa.yaml_obs&&e.loa.yaml_obs.GRAFICO_DESPESAS_MATERIA?e.loa.yaml_obs.GRAFICO_DESPESAS_MATERIA:"")}}),e.espelho?a("div",{staticClass:"col-12 mt-3"},[e._m(2),a("div",{staticClass:"d-flex justify-content-between"},[a("label",{staticClass:"d-block text-blue",attrs:{for:"check_espec"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.check_espec,expression:"check_espec"}],attrs:{type:"checkbox",id:"check_espec"},domProps:{checked:Array.isArray(e.check_espec)?e._i(e.check_espec,null)>-1:e.check_espec},on:{change:function(a){var t=e.check_espec,s=a.target,o=!!s.checked;if(Array.isArray(t)){var c=null,r=e._i(t,c);s.checked?r<0&&(e.check_espec=t.concat([c])):r>-1&&(e.check_espec=t.slice(0,r).concat(t.slice(r+1)))}else e.check_espec=o}}}),e._v(" Alinhar Especificação ")]),a("label",{staticClass:"d-block text-blue",attrs:{for:"check_filter"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.check_filter,expression:"check_filter"}],attrs:{type:"checkbox",id:"check_filter"},domProps:{checked:Array.isArray(e.check_filter)?e._i(e.check_filter,null)>-1:e.check_filter},on:{change:function(a){var t=e.check_filter,s=a.target,o=!!s.checked;if(Array.isArray(t)){var c=null,r=e._i(t,c);s.checked?r<0&&(e.check_filter=t.concat([c])):r>-1&&(e.check_filter=t.slice(0,r).concat(t.slice(r+1)))}else e.check_filter=o}}}),e._v(" Mostrar apenas itens alterados por Emendas Impositivas ")])]),a("table",{staticClass:"table table-sm table-bordered table-striped table_espelho"},[e._m(3),a("tbody",e._l(e.espelho_filtered,function(t,s){return a("tr",{key:s,class:[t[8]?"agrupamento text-blue":""]},[a("td",[a("div",[a("span",{staticClass:"dotacao",domProps:{innerHTML:e._s(e.check_espec?e.space2nbsp(t[0]):t[0])}}),a("span",[e._v(" - ")]),a("span",[e._v(e._s(t[3]))])])]),a("td",{domProps:{innerHTML:e._s(t[2])}}),a("td",{domProps:{innerHTML:e._s(t[6])}}),a("td",{domProps:{innerHTML:e._s(t[7])}})])}),0)])]):e._e(),e.chartDataHist?a("div",{staticClass:"col-12 container-barchart p-3 mt-3"},[a("div",{staticClass:"btn-barchart-left",on:{click:function(a){return e.clickSlice(-1,"hist")}}},[a("i",{staticClass:"fa fa-chevron-left"})]),a("div",{staticClass:"btn-barchart-right",on:{click:function(a){return e.clickSlice(1,"hist")}}},[a("i",{staticClass:"fa fa-chevron-right"})]),a("BarChart",{attrs:{plugins:e.pluginsBar,chartDataUser:e.chartDataHist,cssClasses:"barchart-component"}})],1):e._e(),e.chartDataExec?a("div",{staticClass:"col-12 container-barchart p-3 mt-3"},[a("div",{staticClass:"btn-barchart-left",on:{click:function(a){return e.clickSlice(-1,"exec")}}},[a("i",{staticClass:"fa fa-chevron-left"})]),a("div",{staticClass:"btn-barchart-right",on:{click:function(a){return e.clickSlice(1,"exec")}}},[a("i",{staticClass:"fa fa-chevron-right"})]),a("BarChart",{attrs:{plugins:e.pluginsExec,chartDataUser:e.chartDataExec,cssClasses:"barchart-2"}}),a("div",{staticClass:"fonte small pt-5"},[e._v(" FONTE: Os dados são extraídos no período noturno dos portais de transparência do "),a("a",{attrs:{href:"http://prefeituradejatai.sigepnet.com.br"}},[e._v("Poder Executivo")]),e._v(" e do "),a("a",{attrs:{href:"http://camaradejatai.sigepnet.com.br"}},[e._v("Poder Legislativo")]),e._v(', portanto, os valores se referem a movimentação do dia anterior. Os valores extraídos são sempre os divulgados como "Valor Bruto", não sendo possível atualmente, possuir uma coluna com o "Valor Líquido" por esta, apesar de estar presente nos dados humanamente visíveis, não está nos dados abertos no format CSV. A totalização dos valores pode possuir variações de 1 a 2% com o mostrado nos portais de transparência. Abaixo uma listagem de cada Órgão, com sua última data e último código de despesa extraída. '),a("ul",e._l(e.data_exec,function(t,s){return a("li",{key:s},[e._v(" "+e._s(t[6])+" - "+e._s(t[5])+" - "+e._s(t[0])+"-"+e._s(t[1])+" ")])}),0)])],1):e._e()])]):e._e(),a("resize-observer",{on:{notify:e.handleResize}})],1)},o=[function(){var e=this,a=e._self._c;return a("h2",{staticClass:"pt-4 legend"},[e._v("Resumo Gráfico das Despesas Orçamentárias da LOA"),a("br"),a("small",[e._v("(Valores originais do projeto do Poder Executivo, sem aplicação das Emendas Impositivas)")])])},function(){var e=this,a=e._self._c;return a("strong",{staticClass:"d-block mx-3 my-2"},[e._v(" Utilize os filtros abaixo e/ou aplique agrupamentos para visões diferentes, "),a("span",{staticClass:"text-danger"},[e._v("o gráfico e tabela serão atualizados automaticamente")]),e._v(". ")])},function(){var e=this,a=e._self._c;return a("h2",{staticClass:"legend"},[e._v("Espelho das Despesas Orçamentárias da LOA"),a("br"),a("small",[e._v("(Valores com Emendas Impositivas Aplicadas)")])])},function(){var e=this,a=e._self._c;return a("thead",[a("tr",[a("th",[e._v("Código / Especificação")]),a("th",[e._v("Valor Orçamentário")]),a("th",[e._v("Emendas Impositivas")]),a("th",[e._v("Saldo")])])])}],c=(t(4114),t(8111),t(2489),t(2274)),r=function(){var e=this,a=e._self._c;return e.chartData?a("Doughnut",{attrs:{"chart-options":e.chartOptions,"chart-data":e.chartData,"chart-id":e.chartId,"dataset-id-key":e.datasetIdKey,plugins:e.plugins,"css-classes":e.cssClasses,styles:e.styles,width:e.width,height:e.height}}):e._e()},l=[],n=(t(7588),t(1701),t(7317)),i=t(9203),d=t(7237);d.t1.register(d.hE,d.m_,d.s$,i.A,d.Bs,d.PP);var u={name:"DoughnutChart",components:{Doughnut:n.nu},props:{chartId:{type:String,default:"doughnut-chart"},chartDataUser:{type:Object,default:()=>{}},datasetIdKey:{type:String,default:"label"},width:{type:Number,default:1140},height:{type:Number,default:500},cssClasses:{default:"",type:String},styles:{type:Object,default:()=>{}},plugins:{type:Array,default:()=>[]}},data(){return{chartData:null,chartOptions:{responsive:!0,maintainAspectRatio:!1,layout:{padding:15},onHover:e=>{},plugins:{title:{display:!0,text:"",padding:{top:-15,bottom:20}},legend:{position:"left",onHover:this.handleHover,onLeave:this.handleLeave,onClick:this.handleClick,labels:{font:{family:"'Courier New', Courier, monospace",size:15},padding:2}},datalabels:{formatter:(e,a)=>{let t=a.dataset.data,s=0;t.map(e=>{s+=e});let o=(e/s*100).toFixed(1)+"%";return o},color:"#fff"}}}}},watch:{plugins:function(e,a){this.chartOptions.plugins.title.text=e[0].title.text}},methods:{handleClick(e,a,t){},handleHover(e,a,t){t.chart.data.datasets[0].backgroundColor.forEach((e,t,s)=>{s[t]=t===a.index||9===e.length?e:e+"3d"}),t.chart.update()},handleLeave(e,a,t){t.chart.data.datasets[0].backgroundColor.forEach((e,a,t)=>{t[a]=9===e.length?e.slice(0,-2):e}),t.chart.update()}},mounted:function(){this.chartOptions.plugins.title.text=this.plugins[0].title.text,this.chartData=this.chartDataUser}},p=u,h=t(1656),_=(0,h.A)(p,r,l,!1,null,null,null),f=_.exports,m=t(1642),g=t(382),v=t(2543),b={name:"LoaDetail",components:{BarChart:m.A,DoughnutChart:f,ModelSelect:c.A},data(){return{check_filter:!1,check_espec:!1,loa:{id:this.$route.params.pkloa},espelho:null,chartDataLoa:null,chartDataHist:null,chartDataExec:null,data_exec:null,height:450,pluginsExec:[{title:{display:!0,text:""}}],pluginsBar:[{title:{display:!0,text:""}}],pluginsDun:[{title:{display:!0,text:""}}],despesas_agrupadas:[],despesa:{orgaoselected:null,unidadeselected:null,funcaoselected:null,subfuncaoselected:null,programaselected:null,acaoselected:null,agrupamentoselected:"unidade",itensselected:15},filters:["orgaoselected","unidadeselected","funcaoselected","subfuncaoselected","programaselected","acaoselected"],agrupamentos:{orgao:"Órgãos",unidade:"Unidades Orçamentárias",funcao:"Funções",subfuncao:"SubFunções",programa:"Programas",acao:"Ações",natureza_1:"Natureza - Nível 1",natureza_2:"Natureza - Nível 2",natureza_3:"Natureza - Nível 3",natureza_4:"Natureza - Nível 4",natureza_5:"Natureza - Nível 5",fonte:"Fonte de Recurso"},tipos_agrups:["orgao","unidade","funcao","subfuncao","programa","acao","natureza_1","natureza_2","natureza_3","natureza_4","natureza_5","fonte"],itens:[{value:5,text:"05 Maiores"},{value:10,text:"10 Maiores"},{value:15,text:"15 Maiores"},{value:20,text:"20 Maiores"},{value:25,text:"25 Maiores"},{value:999,text:"Todos os Itens"}],itens_hist:[{value:5,text:"05 Itens"},{value:10,text:"10 Itens"},{value:15,text:"15 Itens"},{value:20,text:"20 Itens"}],barchart_exec_offset:0,barchart_exec_length:0,barchart_offset:0,barchart_length:0,barchart_max_items__select:5,barchart_max_items:5,barchart_colors:this.build_colors(20,"a0")}},computed:{espelho_filtered:function(){return this.espelho?this.check_filter?this.espelho.filter(e=>""!==e[4]||""!==e[5]||""!==e[6]):this.espelho:[]},qs_loa:function(){const e=this.loa.id;return e?`&loa=${e}&despesa_set__isnull=False`:""},qs_orgao:function(){const e=this.despesa.orgaoselected;return e&&e.id?`&orgao=${e.id}`:""},agrupamentos__options:function(){const e=this,a=[];return v.forOwn(e.agrupamentos,function(e,t){a.push({text:e,value:t})}),a},despesas_agrupadas_table:function(){const e=this,a=[];let t=v.orderBy(v.filter(e.despesas_agrupadas,e=>e.alt),["codigo"]);return v.each(t,function(e,t){a.push({"Código":e.codigo,"Especificação":e.especificacao,"Valor no Orçamento":e.vm_str,"Emendas Imposititivas":e.alt_str,"Saldo Final":e.saldo_str})}),a}},watch:{barchart_max_items__select:{handler(e,a){this.barchart_exec_offset=0,this.barchart_offset=0,this.barchart_max_items=Number(e),this.fetch("",1)}},"despesa.orgaoselected":{deep:!0,immediate:!0,handler(e,a){const t=this;(a||e)&&a!==e&&t.$nextTick().then(function(){t.tipos_agrups.indexOf(t.despesa.agrupamentoselected)<t.tipos_agrups.indexOf("unidade")&&(t.despesa.agrupamentoselected="unidade"),t.fetch()})}},"despesa.unidadeselected":{deep:!0,immediate:!0,handler(e,a){const t=this;(a||e)&&a!==e&&t.$nextTick().then(function(){t.tipos_agrups.indexOf(t.despesa.agrupamentoselected)<t.tipos_agrups.indexOf("funcao")&&(t.despesa.agrupamentoselected="funcao"),t.fetch()})}},"despesa.funcaoselected":{deep:!0,immediate:!0,handler(e,a){const t=this;(a||e)&&a!==e&&t.$nextTick().then(function(){t.tipos_agrups.indexOf(t.despesa.agrupamentoselected)<t.tipos_agrups.indexOf("subfuncao")&&(t.despesa.agrupamentoselected="subfuncao"),t.fetch()})}},"despesa.subfuncaoselected":{deep:!0,immediate:!0,handler(e,a){const t=this;(a||e)&&a!==e&&t.$nextTick().then(function(){t.tipos_agrups.indexOf(t.despesa.agrupamentoselected)<t.tipos_agrups.indexOf("programa")&&(t.despesa.agrupamentoselected="programa"),t.fetch()})}},"despesa.programaselected":{deep:!0,immediate:!0,handler(e,a){const t=this;(a||e)&&a!==e&&t.$nextTick().then(function(){t.tipos_agrups.indexOf(t.despesa.agrupamentoselected)<t.tipos_agrups.indexOf("acao")&&(t.despesa.agrupamentoselected="acao"),t.fetch()})}},"despesa.acaoselected":{deep:!0,immediate:!0,handler(e,a){const t=this;(a||e)&&a!==e&&t.$nextTick().then(function(){t.tipos_agrups.indexOf(t.despesa.agrupamentoselected)<t.tipos_agrups.indexOf("natureza_1")&&(t.despesa.agrupamentoselected="natureza_5"),t.fetch()})}},"despesa.agrupamentoselected":{deep:!0,immediate:!0,handler(e,a){const t=this;(a||e)&&a!==e&&t.$nextTick().then(function(){t.fetch()})}},"despesa.itensselected":{deep:!0,immediate:!0,handler(e,a){const t=this;t.$nextTick().then(function(){(a||e)&&a!==e&&t.fetch()})}}},methods:{space2nbsp(e){return e.replace(/ /g,"&nbsp;")},clearFilters(e){const a=this;a.despesa={orgaoselected:null,unidadeselected:null,funcaoselected:null,subfuncaoselected:null,programaselected:null,acaoselected:null,agrupamentoselected:"funcao",itensselected:20}},clickSlice(e,a){"hist"===a?(-1===e&&this.barchart_offset>0||1===e&&this.barchart_offset+this.barchart_max_items<this.barchart_length)&&(this.barchart_offset+=e,this.fetch("",1)):(-1===e&&this.barchart_exec_offset>0||1===e&&this.barchart_exec_offset+this.barchart_max_items<this.barchart_exec_length)&&(this.barchart_exec_offset+=e,this.fetch("",1))},handleResize(){},fetch(e="",a=0){const t=this,s={orgao:t.despesa.orgaoselected?t.despesa.orgaoselected.codigo:null,unidade:t.despesa.unidadeselected?`${t.despesa.unidadeselected.codigo}/${t.despesa.unidadeselected.orgao}`:null,funcao:t.despesa.funcaoselected?t.despesa.funcaoselected.codigo:null,subfuncao:t.despesa.subfuncaoselected?t.despesa.subfuncaoselected.codigo:null,programa:t.despesa.programaselected?t.despesa.programaselected.codigo:null,acao:t.despesa.acaoselected?t.despesa.acaoselected.codigo:null,agrupamento:""===e?t.despesa.agrupamentoselected:e,itens:t.despesa.itensselected};t.$nextTick().then(()=>0!==a?this:t.loa&&t.loa.id?(t.barchart_offset=0,t.barchart_exec_offset=0,s.hist=a,void t.utils.postModelAction("loa","loa",t.loa.id,"despesas_agrupadas",s).then(a=>{let o=[],c=t.build_colors(a.data.length),r=[];v.each(a.data,function(e,a){o.push(`${e.vm_str} / ${e.codigo}-${e.especificacao}`),r.push(e.vm)});const l={labels:o,datasets:[{data:r,backgroundColor:c,hoverOffset:50}]};if(null===t.chartDataLoa)return void(t.chartDataLoa=l);t.$set(t.chartDataLoa,"labels",o),t.$set(t.chartDataLoa.datasets,""===e?0:1,{data:r,backgroundColor:c,hoverOffset:50});const n=[`ORÇAMENTO DE ${t.loa.ano} DO MUNICÍPIO DE JATAÍ`],i=[];v.forOwn(t.despesa,function(e,a){t.filters.includes(a)&&null!==e&&i.push(e.especificacao)}),v.isEmpty(i)||n.push(`FILTRADO POR: ${i.join(" / ")}`),n.push(`Orçamento das despesas agrupadas por: ${t.agrupamentos[s.agrupamento]}`),v.isEmpty(r)?n.push("Sem dados para mostrar"):n.push(`R$ ${a.data.length>0?a.data[0].vm_soma:"0,00"}.`),t.$set(t.pluginsDun,0,{title:{display:!0,text:n}})}).then(e=>{this.handleResize()}).catch(e=>t.sendMessage({alert:"danger",message:"Não foi possível recuperar a lista...",time:5}))):this).then(()=>{t.utils.postModelAction("loa","loa",t.loa.id,"espelho",s).then(e=>{t.espelho=e.data})})},build_colors(e,a=""){const t=[];if(e<1)return t;let s=Math.floor(360*Math.random()),o=0,c=(e,a,t,s=a*Math.min(t,1-t),o=(a,o=(a+e/30)%12)=>t-s*Math.max(Math.min(o-3,9-o,1),-1))=>[o(0),o(8),o(4)],r=(e,a,t)=>"#"+[e,a,t].map(e=>Math.round(255*e).toString(16).padStart(2,0)).join("");for(let l=0;l<e;l++){let e=`${r(...c(s,Math.max(.8,Math.random()),.4))}`;o=30*Math.random()+(s<150?50:25),s=(s+o)%360,t.push(`${e}${a}`)}return t},build_colors_hsl(e){const a=[];if(e<1)return a;let t=Math.floor(360*Math.random()),s=0;for(let o=0;o<e;o++){let e="hsl( "+t+", 100%, 40%)";s=30*Math.random()+(t<150?50:25),t=(t+s)%360,a.push(e)}return a},build_colors_random(e){const a="0123456789ABCDEF",t=[];for(let s=0;s<e;s++){let e="#";for(let t=0;t<6;t++)e+=a[Math.floor(Math.random()*(t%2===0?14:16))];t.push(e)}return t}},mounted:function(){const e=this;e.$nextTick().then(()=>{e.utils.getModel("loa","loa",e.loa.id).then(a=>{const t=g.Ay.load(a.data.yaml_obs);a.data.yaml_obs=t,e.loa=a.data})})}},x=b,k=(0,h.A)(x,s,o,!1,null,"a56fc06c",null),C=k.exports}}]);