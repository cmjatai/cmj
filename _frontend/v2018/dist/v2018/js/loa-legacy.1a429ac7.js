(function(){"use strict";var e={5461:function(e,a,n){n(3792),n(3362),n(9085),n(9391),n(1774);var t=n(4335),i=n(7552),r=n(6654),o=(n(4423),n(8744)),s=n(7262),d=(n(2008),n(113),n(4114),n(8111),n(2489),n(116),n(7588),n(3110),n(9432),n(6099),n(1699),n(8335),n(3500),n(2953),n(2543)),c=n(4692),l=function(){function e(a){(0,i.A)(this,e),this.container=a,this.form=a.find("form"),this.init()}return(0,r.A)(e,[{key:"isObjectEmpty",value:function(e){var a=!0;return d.forOwn(e,function(e,n){Array.isArray(e)&&e.length>0?a=!1:Array.isArray(e)||["",null,void 0].includes(e)||(a=!1)}),a}},{key:"init",value:function(){var e,a=this.form,n=new FormData(a[0]),t={},i=(0,s.A)(n.entries());try{for(i.s();!(e=i.n()).done;){var r=(0,o.A)(e.value,2),l=r[0],p=r[1];l in t?(Array.isArray(t[l])||(t[l]=[t[l]]),t[l].push(p)):""!==p&&(t[l]=p)}}catch(b){i.e(b)}finally{i.f()}delete t.agrupamento,delete t.tipo_agrupamento,delete t.pdf;var u=function(){var e=new FormData(a[0]),n=e.getAll("parlamentares"),t=e.getAll("fase"),i=e.get("finalidade"),r=e.getAll("tipo");return{parlamentares:n.length>0?n:[],fase:t.length>0?t:[],finalidade:""!==i?[i]:[],tipo:r.length>0?r:[]}};if(this.isObjectEmpty(t))try{var f=localStorage.getItem("portalcmj_emendaloa_filter");if(f){var m=JSON.parse(f);if(!this.isObjectEmpty(m)){d.forOwn(m,function(e,n){d.forEach(a.find('input[name="'.concat(n,'"]')),function(a){Array.isArray(e)&&e.includes(a.value)||e===a.value?(a.checked=!0,c('label[for="'.concat(a.id,'"] span')).addClass("active")):Array.isArray(e)?Array.isArray(e)&&e.length>0&&"text"===a.type&&(a.value=e[0]):a.value=e})});var v=u();this.isObjectEmpty(v)||(window.loadingCMJ("Atualizando listagem..."),a.submit())}}}catch(k){localStorage.removeItem("portalcmj_emendaloa_filter")}else{var h=u();localStorage.setItem("portalcmj_emendaloa_filter",JSON.stringify(h))}var g=function(e){var n=u();localStorage.setItem("portalcmj_emendaloa_filter",JSON.stringify(n)),window.loadingCMJ("Atualizando listagem..."),a.submit()},_=a.find('input[type="checkbox"][name="agrupamento"]'),y=a.find('input[type="radio"][name="tipo_agrupamento"]');_.change(function(e){0===_.filter(":checked").length&&y.filter('[value="sem_registro"]').prop("checked",!0)}).change(),y.change(function(e){e.target.checked&&"sem_registro"===e.target.value?(_.not('[value="despesa__unidade"]').prop("disabled",!0).prop("checked",!1).parent().addClass("d-none"),_.filter('[value="despesa__unidade"]').prop("disabled",!1).parent().removeClass("d-none"),_.filter('[value="despesa__unidade"]').prop("checked",!0)):e.target.checked?(_.prop("disabled",!1).parent().removeClass("d-none"),0===_.filter(":checked").length&&(_.length>1?c(_[1]).prop("checked",!0):_.length>0&&c(_[0]).prop("checked",!0))):_.prop("disabled",!1).parent().removeClass("d-none")}).change(),a.find('#div_id_parlamentares input[type="checkbox"]').change(function(e){g()}),a.find('button[type="button"]').click(function(e){g()}),a.find('input[type="submit"]').click(function(e){window.loadingCMJ("Gerando Listagem em PDF...")}),a.keypress(function(e){if(13===e.keyCode)return e.preventDefault(),!1})}}])}(),p=n(4922),u=n(9203),f=function(){function e(a){(0,i.A)(this,e),this.container=a,this.form=a.find("form")}return(0,r.A)(e,[{key:"toggleTipo",value:function(){var e=this.form,a=e.find('select[name="tipo"]')[0],n=e.find("#div_id_parl_assinantes"),t=e.find("#div_id_parlamentares__valor"),i=e.find('input[name="valor"]')[0];"0"!==a.value?n.length>0&&(i.setAttribute("readonly","readonly"),n.find("input").prop("disabled",!0),n[0].classList.add("d-none")):t.length>0&&(i.removeAttribute("readonly"),t.find("input").prop("disabled",!0),t[0].classList.add("d-none")),e.find('select[name="tipo"]').change(function(e){var a=e.target;"0"===a.value?(t.find("input").prop("disabled",!0),t[0].classList.add("d-none"),n[0].classList.remove("d-none"),n.find("input").prop("disabled",!1),i.removeAttribute("readonly")):(n.find("input").prop("disabled",!0),n[0].classList.add("d-none"),t[0].classList.remove("d-none"),t.find("input").prop("disabled",!1),i.setAttribute("readonly","readonly"))})}}])}(),m=function(e){function a(e){var n;return(0,i.A)(this,a),n=(0,p.A)(this,a,[e]),n.init(),n}return(0,u.A)(a,e),(0,r.A)(a,[{key:"init",value:function(){this.toggleTipo()}}])}(f),v=n(748),h=n(4634),g=(n(8706),n(8598),n(2010),n(5506),n(4864),n(7465),n(7495),n(7745),n(8781),n(8543),n(5440),n(9978),n(5746),n(2762),n(2543)),_=n.n(g),y=n(4692),b=n.n(y),k=function(e){function a(e){var n;return(0,i.A)(this,a),n=(0,p.A)(this,a,[e]),n.pk=window.location.href.matchAll(/emendaloa\/(\d+)\//g).next().value[1],n.urlBase="/api/loa/emendaloa/".concat(n.pk),n.ano_loa=n.form.find('input[name="ano_loa"')[0].value,n.pkObject=null,n.init(),n}return(0,u.A)(a,e),(0,r.A)(a,[{key:"init",value:function(){var e=(0,h.A)((0,v.A)().m(function e(){return(0,v.A)().w(function(e){while(1)switch(e.n){case 0:return e.n=1,this.loadPkObject();case 1:this.toggleTipo(),this.setupPreview(),this.setupRegistroRender(),this.loadRegistrosContabeis(),this.setupBuscaDespesa(),this.setupFormEvents(),this.setupPopovers(),this.form.trigger("change");case 2:return e.a(2)}},e,this)}));function a(){return e.apply(this,arguments)}return a}()},{key:"loadPkObject",value:function(){var e=(0,h.A)((0,v.A)().m(function e(){var a;return(0,v.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,t.A.get("".concat(this.urlBase,"/"));case 1:a=e.v,this.pkObject=a.data,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,this,[[0,2]])}));function a(){return e.apply(this,arguments)}return a}()},{key:"setupPreview",value:function(){var e=this,a=b()(".container-preview");a.html('\n      <div class="inner-preview">\n        <a class="w-100" target="_blank" href="'.concat(this.urlBase,'/view/">\n          <img src="').concat(this.urlBase,"/view/?page=1&u=").concat(Date.now(),'"/>\n        </a>\n      </div>\n      <div class="btn-toolbar justify-content-between">\n        <div class="btn-group btn-group-sm">\n          <label for="id_lineHeight">\n            <span>Entrelinha (%)</span>\n            <input type="number"\n              name="lineHeight" value="').concat(this.pkObject.metadata.style.lineHeight,'"\n              step="5"\n              min="100"\n              max="350"\n              class="numberinput form-control text-center"\n              id="id_lineHeight">\n          </label>\n        </div>\n        <div>\n          <label for="id_espacoAssinatura">\n          <input type="checkbox"\n            ').concat(this.pkObject.metadata.style.espacoAssinatura?"checked":"",'\n            name="espacoAssinatura"\n            class="form-check-input"\n            id="id_espacoAssinatura">\n          <span>Incluir espaço para Assinaturas</span>\n          </label>\n        </div>\n      </div>\n    ')),this.previewImg=a.find("img")[0],this.previewImg.onload=function(){e.previewImg.style.opacity=1,e.loadPkObject()}}},{key:"updatePreview",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.previewImg){this.previewImg.style.opacity=.35;for(var a="?page=1&u=".concat(Date.now()),n=0,t=Object.entries(e);n<t.length;n++){var i=(0,o.A)(t[n],2),r=i[0],s=i[1];a+="&".concat(r,"=").concat(s)}this.previewImg.src="".concat(this.urlBase,"/view/").concat(a)}}},{key:"setupRegistroRender",value:function(){var e=this.form.find(".registro-render");e.html(""),b()('<div class="inner"></div>').appendTo(e),b()('<div class="footer"></div>').appendTo(e)}},{key:"loadRegistrosContabeis",value:function(){var e=this,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.form.find(".registro-render .inner"),i=this.form.find(".registro-render .footer");t.A.get("/api/loa/emendaloa/".concat(this.pk,"/totais/")).then(function(e){i.html(""),b()('\n          <div class="row">\n            <div class="col-12 totais">TOTAIS:</div>\n            <div class="col">\n              <span class="key">Inserções</span>\n              <span class="value">'.concat(e.data.soma_insercoes,'</span>\n            </div>\n            <div class="col">\n              <span class="key">Deduções</span>\n              <span class="value">').concat(e.data.soma_deducoes,'</span>\n            </div>\n            <div class="col text-').concat("0,00"===e.data.divergencia_registros?"blue":"red",'">\n              <span class="key">Inserções + Deduções</span>\n              <span class="value">').concat(e.data.divergencia_registros,'</span>\n            </div>\n            <div class="col text-').concat("0,00"===e.data.divergencia_emenda?"blue":"red",'">\n              <span class="key">Emenda - Inserções</span>\n              <span class="value">').concat(e.data.divergencia_emenda,"</span>\n            </div>\n          </div>\n        ")).appendTo(i)}),t.A.get("/api/loa/emendaloaregistrocontabil/?emendaloa=".concat(this.pk,"&get_all=true")).then(function(t){a&&n.html(""),_().each(t.data,function(a){if(!(n.find('.item-rc[pk="'.concat(a.id,'"]')).length>0)){var t=b()('<div class="item-rc" pk="'.concat(a.id,'"></div>'));t.appendTo(n);var i=a.__str__,r=i.search(/(\d) /g),o=0;while(r>0&&r<15&&o<20)i=i.replace(/^R\$/g,"R$ "),r=i.search(/(\d) /g),o+=1;i=i.split(" - "),i[0]="<strong>".concat(i[0],"</strong>"),i=i.join(" - "),i=i.replaceAll(" ","&nbsp;"),b()('<span class="texto">'.concat(i,"</span>")).appendTo(t),b()('<span class="btn btn-sm btn-delete text-danger"><i class="far fa-trash-alt"></i></span>').appendTo(t).click(function(a){return e.handleDeleteRegistro(a)})}})})}},{key:"handleDeleteRegistro",value:function(e){var a=this,n=e.target.closest(".item-rc").getAttribute("pk"),i=this.form.find(".registro-render .inner");t.A.delete("/api/loa/emendaloaregistrocontabil/".concat(n,"/")).then(function(){a.form.trigger("change"),e.target.closest(".item-rc").remove(),a.loadRegistrosContabeis(),a.updatePreview()}).catch(function(e){_().isString(e.response)||_().isString(e.response.data)?b()('<div class="alert alert-danger">'.concat(e.message,"</div>")).appendTo(i):_().forOwn(e.response.data,function(e,n){a.form.find("input[name=despesa_".concat(n,"], input[name=").concat(n,"_despesa]")).addClass("is-invalid"),b()('<div class="alert alert-danger">'.concat(_().isString(e)?e:e[0],"</div>")).appendTo(i)})})}},{key:"setupBuscaDespesa",value:function(){var e=this,a=this.form.find(".busca-render"),n=this.form.find('input[name="busca_despesa"]'),t=this.form.find("#add_registro"),i=this.form.find("#clean_form_search");i.click(function(){t[0].data=null,e.form.find('input[name^="despesa_"], input[name$="_despesa"]').val("").attr("readonly",!1).removeClass("is-invalid")}),t.click(function(){return e.handleAddRegistro(t,a)}),n.keyup(function(n){return e.handleBuscaDespesaKeyup(n,t,a)})}},{key:"handleAddRegistro",value:function(e,a){var n=this,i=e[0].data,r={emendaloa:this.pk,despesa:i,codigo:this.form.find('input[name="despesa_codigo"]').val(),orgao:this.form.find('input[name="despesa_orgao"]').val(),unidade:this.form.find('input[name="despesa_unidade"]').val(),especificacao:this.form.find('input[name="despesa_especificacao"]').val(),natureza:this.form.find('input[name="despesa_natureza"]').val(),fonte:this.form.find('input[name="despesa_fonte"]').val(),valor:this.form.find('input[name="valor_despesa"]').val()};a.html("");var o=b()('<div class="inner"></div>');t.A.post("/api/loa/emendaloaregistrocontabil/create_for_emendaloa_update/",r).then(function(){e[0].data=null,n.form.find('input[name^="despesa_"], input[name$="_despesa"]').val("").attr("readonly",!1).removeClass("is-invalid"),b()('<div class="alert alert-info>Registro de Despesa Adicionado com sucesso.</div>').appendTo(o),n.loadRegistrosContabeis(),n.updatePreview(),n.form.trigger("change")}).catch(function(e){_().isString(e.response)||_().isString(e.response.data)?b()('<div class="alert alert-danger">'.concat(e.message,"</div>")).appendTo(o):_().forOwn(e.response.data,function(e,a){n.form.find("input[name=despesa_".concat(a,"], input[name=").concat(a,"_despesa]")).addClass("is-invalid"),b()('<div class="alert alert-danger">'.concat(_().isString(e)?e:e[0],"</div>")).appendTo(o)})}).finally(function(){o.appendTo(a)})}},{key:"handleBuscaDespesaKeyup",value:function(e,a,n){var i=this;if(""===e.target.value.trim())return a[0].data=null,this.form.find('input[name^="despesa_"]').attr("readonly",!1),this.form.find('input[name^="despesa_"], input[name$="_despesa"]').removeClass("is-invalid"),void n.html("");t.A.get("/api/loa/despesaconsulta/search/?page_size=10&ano=".concat(this.ano_loa,"&q=").concat(e.target.value)).then(function(t){n.html("");var r=b()('<div class="inner"></div>');if(r.appendTo(n),_().isEmpty(t.data.results))a[0].data=null,i.form.find('input[name^="despesa_"]').attr("readonly",!1),b()('<div class="alert alert-warning">\n            Nenhuma despesa encontrada nos anexos da LOA com esta informação. Você pode ainda fazer o registro manualmente no formulário acima.\n          </div>').appendTo(r);else if(t.data.pagination.total_entries>10){var o='<div class="alert alert-warning">\n            <em>Mostrando 10 primeiros resultados de '.concat(t.data.pagination.total_entries,".<br>Informe mais termos no campo de busca para reduzir os resultados.</em>\n          </div>");b()(o).appendTo(r)}var s=e.target.value.trim().split(" ");_().each(t.data.results,function(e){var t="Órgão...: ".concat(e.cod_orgao," - ").concat(e.esp_orgao,"\n              Und Orç.: ").concat(e.cod_unidade," - ").concat(e.esp_unidade,"\n              Código..: ").concat(e.codigo," - ").concat(e.especificacao,"\n              Natureza: ").concat(e.cod_natureza," - ").concat(e.esp_natureza," // Fonte: ").concat(e.cod_fonte,"\n              Val.Orç.: ").concat(e.str_valor," | Saldo: ").concat(e.str_saldo);_().each(s,function(e){if(!(e.length<3)){var a=new RegExp("(".concat(e,")"),"ig");t=t.replace(a,'<strong class="highlight">$1</strong>')}}),t=t.replaceAll("\n","<br/>");var o='<div class="small item" pk="'.concat(e.id,'">').concat(t,"</div>"),d=b()(o).appendTo(r);d.click(function(t){i.form.find('input[name="despesa_codigo"]').val(e.codigo),i.form.find('input[name="despesa_orgao"]').val(e.cod_orgao),i.form.find('input[name="despesa_unidade"]').val(e.cod_unidade),i.form.find('input[name="despesa_especificacao"]').val(e.especificacao),i.form.find('input[name="despesa_natureza"]').val(e.cod_natureza),i.form.find('input[name="despesa_fonte"]').val(e.cod_fonte),i.form.find('input[name^="despesa_"]').attr("readonly",!0);var r=t.currentTarget.getAttribute("pk");a[0].data=r,n.html("")})})})}},{key:"setupFormEvents",value:function(){var e=this,a=this.form.find('input[name="busca_despesa"]'),n=this.form.find(".busca-render");this.form.keypress(function(e){if(13===e.keyCode){if(e.preventDefault(),e.target===a[0]){var t=n.find(".inner"),i=t.children();1===i.length&&i.trigger("click")}return!1}}),this.form.find('select[name="fase"]').change(function(e){var a=e.target;"10"===a.value?a.classList.add("is-invalid"):a.classList.remove("is-invalid")}),this.form.change(function(a){return e.handleAutoSave(a)})}},{key:"handleAutoSave",value:function(e){var a=this,n={},i=e.target.name,r=e.target.value;if(i){var o="/",s=e.target.getAttribute("parlamentar_id");if(null!==s)n["valor"]=r,n["parlamentar_id"]=s,o="/updatevalorparlamentar/";else{if("lineHeight"===i)return void this.updatePreview({lineHeight:r});if("espacoAssinatura"===i)return void this.updatePreview({espacoAssinatura:e.target.checked});"parl_assinantes"===i?(o="/update_parlassinantes/",n["parlamentar_id"]=r,n["checked"]=e.target.checked):"valor"===i?(o="/updatevaloremenda/",n["valor"]=r):n[i]=r}this.previewImg&&(this.previewImg.style.opacity=.35),t.A.patch("".concat(this.urlBase).concat(o),n).then(function(e){a.form.find('input[name="lineHeight"]').val(e.data.metadata.style.lineHeight),a.form.find('input[name="valor"]').val(e.data.valor),"tipo"===i&&window.location.reload(),a.loadRegistrosContabeis(!0),a.updatePreview()}).catch(function(){window.location.reload()})}}},{key:"setupPopovers",value:function(){}}])}(f),A=n(4692),w=(0,r.A)(function e(){(0,i.A)(this,e);var a=A(".container-loa");a.hasClass("emendaloa-update")?this.EmendaLoaUpdate=new k(a):a.hasClass("emendaloa-create")?this.EmendaLoaCreate=new m(a):a.hasClass("emendaloa-list")&&(this.EmendaLoaList=new l(a))}),T=function(){function e(a){(0,i.A)(this,e),this.container=a,this.form=a.find("form"),this.pk=window.location.href.matchAll(/agrupamento\/(\d+)\//g).next().value[1],this.urlBase="/api/loa/agrupamento/".concat(this.pk),this.ano_loa=this.form.find('input[name="ano_loa"')[0].value,this.init()}return(0,r.A)(e,[{key:"init",value:function(){this.setupRegistroRender(),this.loadRegistrosContabeis(),this.setupBuscaDespesa(),this.setupEmendasAgrupamento(),this.setupFormEvents(),this.form.trigger("change")}},{key:"setupRegistroRender",value:function(){var e=this.form.find(".registro-render");e.html(""),b()('<div class="inner"></div>').appendTo(e),b()('<div class="footer"></div>').appendTo(e)}},{key:"loadRegistrosContabeis",value:function(){var e=this,a=this.form.find(".registro-render .inner");t.A.get("/api/loa/agrupamentoregistrocontabil/?agrupamento=".concat(this.pk,"&get_all=true")).then(function(n){_().each(n.data,function(n){if(!(a.find('.item-rc[pk="'.concat(n.id,'"]')).length>0)){var t=b()('<div class="item-rc" pk="'.concat(n.id,'"></div>'));t.appendTo(a);var i=n.__str__,r=i.search(/(\d)%/g),o=0;while(r>0&&r<6&&o<10)i=" "+i,r=i.search(/(\d)%/g),o+=1;i=i.split(" - "),i[0]="<strong>".concat(i[0],"</strong>"),i=i.join(" - "),i=i.replaceAll(" ","&nbsp;"),b()('<span class="texto">'.concat(i,"</span>")).appendTo(t),b()('<span class="btn btn-sm btn-delete text-danger"><i class="far fa-trash-alt"></i></span>').appendTo(t).click(function(a){return e.handleDeleteRegistro(a)})}})})}},{key:"handleDeleteRegistro",value:function(e){var a=this,n=e.target.closest(".item-rc").getAttribute("pk");t.A.delete("/api/loa/agrupamentoregistrocontabil/".concat(n,"/")).then(function(){a.form.trigger("change"),e.target.closest(".item-rc").remove(),a.loadRegistrosContabeis()})}},{key:"setupBuscaDespesa",value:function(){var e=this,a=this.form.find(".busca-render"),n=this.form.find('input[name="busca_despesa"]'),t=this.form.find("#add_registro"),i=this.form.find("#clean_form_search");i.click(function(){t[0].data=null,e.form.find('input[name^="despesa_"], input[name$="_despesa"]').val("").attr("readonly",!1).removeClass("is-invalid")}),t.click(function(){return e.handleAddRegistro(t,a)}),n.keyup(function(n){return e.handleBuscaDespesaKeyup(n,t,a)})}},{key:"handleAddRegistro",value:function(e,a){var n=this,i=e[0].data,r={agrupamento:this.pk,despesa:i,codigo:this.form.find('input[name="despesa_codigo"]').val(),orgao:this.form.find('input[name="despesa_orgao"]').val(),unidade:this.form.find('input[name="despesa_unidade"]').val(),especificacao:this.form.find('input[name="despesa_especificacao"]').val(),natureza:this.form.find('input[name="despesa_natureza"]').val(),fonte:this.form.find('input[name="despesa_fonte"]').val(),percentual:this.form.find('input[name="perc_despesa"]').val()};a.html("");var o=b()('<div class="inner"></div>');t.A.post("/api/loa/agrupamentoregistrocontabil/create_for_agrupamento_update/",r).then(function(){e[0].data=null,n.form.find('input[name^="despesa_"], input[name$="_despesa"]').val("").attr("readonly",!1).removeClass("is-invalid"),n.form.find('input[name="perc_despesa"]').val("100,00"),b()('<div class="alert alert-info>Registro de Despesa Adicionado com sucesso.</div>').appendTo(o),n.loadRegistrosContabeis(),n.form.trigger("change")}).catch(function(e){_().isString(e.response)||_().isString(e.response.data)?b()('<div class="alert alert-danger">'.concat(e.message,"</div>")).appendTo(o):_().forOwn(e.response.data,function(e,a){n.form.find("input[name=despesa_".concat(a,"], input[name=").concat(a,"_despesa]")).addClass("is-invalid"),b()('<div class="alert alert-danger">'.concat(_().isString(e)?e:e[0],"</div>")).appendTo(o)})}).finally(function(){o.appendTo(a)})}},{key:"handleBuscaDespesaKeyup",value:function(e,a,n){var i=this;if(this.form.find('input[name^="despesa_"], input[name$="_despesa"]').removeClass("is-invalid"),""===e.target.value.trim())return a[0].data=null,this.form.find('input[name^="despesa_"]').attr("readonly",!1),void n.html("");t.A.get("/api/loa/despesaconsulta/search/?page_size=5&ano=".concat(this.ano_loa,"&q=").concat(e.target.value)).then(function(t){n.html("");var r=b()('<div class="inner"></div>');r.appendTo(n),_().isEmpty(t.data.results)&&(a[0].data=null,i.form.find('input[name^="despesa_"]').attr("readonly",!1),b()('<div class="alert alert-warning">\n            Nenhuma despesa encontrada nos anexos da LOA com esta informação. Você pode ainda fazer o registro manualmente no formulário acima.\n          </div>').appendTo(r));var o=e.target.value.trim().split(" ");_().each(t.data.results,function(e){var t="\n              Órgão...: ".concat(e.cod_orgao," - ").concat(e.esp_orgao,"\n              Und Orç.: ").concat(e.cod_unidade," - ").concat(e.esp_unidade,"\n              Código..: ").concat(e.codigo," - ").concat(e.especificacao,"\n              Natureza: ").concat(e.cod_natureza," - ").concat(e.esp_natureza," // Fonte: ").concat(e.cod_fonte,"\n              Val.Orç.: ").concat(e.str_valor," | Saldo: ").concat(e.str_saldo);_().each(o,function(e){var a=new RegExp("(".concat(e,")"),"ig");t=t.replace(a,'<strong class="highlight">$1</strong>')}),t=t.replaceAll("\n","<br/>");var s='<div class="small item" pk="'.concat(e.id,'">').concat(t,"</div>"),d=b()(s).appendTo(r);d.click(function(t){i.form.find('input[name="despesa_codigo"]').val(e.codigo),i.form.find('input[name="despesa_orgao"]').val(e.cod_orgao),i.form.find('input[name="despesa_unidade"]').val(e.cod_unidade),i.form.find('input[name="despesa_especificacao"]').val(e.especificacao),i.form.find('input[name="despesa_natureza"]').val(e.cod_natureza),i.form.find('input[name="despesa_fonte"]').val(e.cod_fonte),i.form.find('input[name^="despesa_"]').attr("readonly",!0);var r=t.currentTarget.getAttribute("pk");a[0].data=r,n.html("")})})})}},{key:"setupEmendasAgrupamento",value:function(){var e=this,a=this.form.find('input[name="busca_emendaloa"]');this.loadEmendasAgrupamento(),a.keyup(function(a){return e.handleBuscaEmendaKeyup(a)})}},{key:"loadEmendasAgrupamento",value:function(){var e=this,a=this.form.find(".emendaloa-selecteds"),n=this.form.find(".busca-render-emendaloa");t.A.get("/api/loa/agrupamento/".concat(this.pk,"/emendas/?&get_all=true")).then(function(i){a.html("");var r=b()('<div class="inner"></div>');r.appendTo(a),_().each(i.data,function(a){var i=b()('<div class="inner-item"></div>').appendTo(r);e.renderEmendaItem(a,i);var o=b()('<div class="inner-actions"></div>').appendTo(i);b()('<span class="btn btn-delete text-danger" pk="'.concat(a.id,'" title="Remover Emenda do Agrupamento."><i class="far fa-trash-alt"></i></span>')).appendTo(o).click(function(a){var i=a.currentTarget.getAttribute("pk"),o={agrupamento:e.pk,emendaloa:i};t.A.post("/api/loa/agrupamentoemendaloa/delete/",o).then(function(){e.loadEmendasAgrupamento()}).catch(function(e){n.find(".alert").remove(),r.prepend(b()('<div class="alert alert-danger">'.concat(e.message,"</div>")))})})})})}},{key:"handleBuscaEmendaKeyup",value:function(e){var a=this;if(!e.ctrlKey){var n=this.form.find(".busca-render-emendaloa"),i=this.form.find(".emendaloa-selecteds");if(""!==e.target.value.trim())if(e.target.value.trim().length<3)n.html("Digite ao menos três letras");else{var r=e.target.value.trim().split(" ").filter(function(e){return e.length>=3});t.A.get("/api/loa/emendaloa/search/?&get_all=true&ano=".concat(this.ano_loa,"&q=").concat(r.join(" "))).then(function(e){n.html("");var o=b()('<div class="inner"></div>');o.appendTo(n),_().each(e.data,function(e){if(!(i.find('.item-emendaloa[pk="'.concat(e.id,'"]')).length>0)){var s=b()('<div class="inner-item"></div>').appendTo(o),d=a.renderEmendaItem(e,s,!0);_().each(r,function(e){var a=new RegExp("(".concat(e,")"),"ig");d=d.replace(a,'<strong class="highlight">$1</strong>')}),s.html(d);var c=b()('<div class="inner-actions"></div>').appendTo(s);10!==e.fase&&b()('<span class="btn text-blue" pk="'.concat(e.id,'" title="Adicionar Emenda ao Agrupamento."><i class="far fa-arrow-alt-circle-right"></i></i></span>')).appendTo(c).click(function(e){var i=e.currentTarget.getAttribute("pk"),r={agrupamento:a.pk,emendaloa:i,emendaloa__fase:15};t.A.post("/api/loa/agrupamentoemendaloa/",r).then(function(e){n.find('.item-emendaloa[pk="'.concat(e.data.emendaloa,'"]')).parent().remove(),a.loadEmendasAgrupamento()}).catch(function(e){n.find(".alert").remove(),o.prepend(b()('<div class="pt-2"><div class="alert alert-danger">'.concat(e.response.data[0],"</div></div>")))})})}})})}else n.html("")}}},{key:"renderEmendaItem",value:function(e,a){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=[];0===e.tipo?_().each(e.str_parlamentares,function(e){e=e.split(" - "),t.push(e[1])}):t=e.str_parlamentares,t=t.join("<br>");var i='<div class="item-emendaloa" pk="'.concat(e.id,'">\n        Valor da Emenda ').concat(0!==e.tipo?"Impositiva":"Modificativa",": <strong>R$ ").concat(e.str_valor,"</strong><br>\n        <strong>").concat(e.indicacao,'</strong><br>\n        <a href="').concat(e.link_detail_backend,'/edit" target="_blank">').concat(e.finalidade,"</a><br>\n        <small>").concat(t,'</small><br>\n        <span class="fase ').concat(10===e.fase?"bg-danger":12===e.fase?"bg-warning":"bg-green",'">').concat(e.str_fase,"</span>\n      </div>");if(n)return i;b()(i).appendTo(a)}},{key:"setupFormEvents",value:function(){var e=this,a=this.form.find('input[name="busca_despesa"]'),n=this.form.find(".busca-render");this.form.keypress(function(e){if(13===e.keyCode){if(e.preventDefault(),e.target===a[0]){var t=n.find(".inner"),i=t.children();1===i.length&&i.trigger("click")}return!1}}),this.form.find('select[name="fase"]').change(function(e){var a=e.target;"10"===a.value?a.classList.add("is-invalid"):a.classList.remove("is-invalid")}),this.form.change(function(a){return e.handleAutoSave(a)})}},{key:"handleAutoSave",value:function(e){var a=this,n={},i=e.target.name,r=e.target.value;if(i){var o="/";n[i]=r,t.A.patch("".concat(this.urlBase).concat(o),n).then(function(){a.loadRegistrosContabeis()}).catch(function(){})}}}])}(),C=n(4692),O=(0,r.A)(function e(){(0,i.A)(this,e);var a=C(".container-loa");a.hasClass("agrupamento-update")&&(this.AgrupamentoUpdate=new T(a))}),R=n(2543),E=function(){function e(){(0,i.A)(this,e),"undefined"!==typeof window&&(window.AppLOA=this),this.EmendaLoaCRUD=null,this.AgrupamentoCRUD=null}return(0,r.A)(e,[{key:"run",value:function(){this.EmendaLoaCRUD=new w,this.AgrupamentoCRUD=new O}},{key:"isObjectEmpty",value:function(e){var a=!0;return R.forOwn(e,function(e,n){Array.isArray(e)&&e.length>0?a=!1:Array.isArray(e)||["",null,void 0].includes(e)||(a=!1)}),a}}])}(),j=new E,x=n(4692);t.A.defaults.headers.get["Cache-Control"]="no-cache, no-store, must-revalidate",t.A.defaults.headers.get["Pragma"]="no-cache",t.A.defaults.headers.get["Expires"]="0",t.A.defaults.xsrfCookieName="csrftoken",t.A.defaults.xsrfHeaderName="X-CSRFToken",x(document).ready(function(){x(".container-loa").length>0&&j.run()})}},a={};function n(t){var i=a[t];if(void 0!==i)return i.exports;var r=a[t]={id:t,loaded:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=e,function(){var e=[];n.O=function(a,t,i,r){if(!t){var o=1/0;for(l=0;l<e.length;l++){t=e[l][0],i=e[l][1],r=e[l][2];for(var s=!0,d=0;d<t.length;d++)(!1&r||o>=r)&&Object.keys(n.O).every(function(e){return n.O[e](t[d])})?t.splice(d--,1):(s=!1,r<o&&(o=r));if(s){e.splice(l--,1);var c=i();void 0!==c&&(a=c)}}return a}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[t,i,r]}}(),function(){n.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(a,{a:a}),a}}(),function(){n.d=function(e,a){for(var t in a)n.o(a,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){n.j=341}(),function(){var e={341:0};n.O.j=function(a){return 0===e[a]};var a=function(a,t){var i,r,o=t[0],s=t[1],d=t[2],c=0;if(o.some(function(a){return 0!==e[a]})){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(d)var l=d(n)}for(a&&a(t);c<o.length;c++)r=o[c],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(l)},t=self["webpackChunkportalcmj_frontend"]=self["webpackChunkportalcmj_frontend"]||[];t.forEach(a.bind(null,0)),t.push=a.bind(null,t.push.bind(t))}();var t=n.O(void 0,[1603,5914,3976,8023,5386,1774],function(){return n(5461)});t=n.O(t)})();