"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[650],{2650:function(e,a,s){s.r(a),s.d(a,{default:function(){return h}});var t=function(){var e=this,a=e._self._c;return a("div",{staticClass:"vue-loa-list"},[a("h1",[e._v("Histograma das Despesas")]),e.chartDataHist?e._e():a("div",{staticClass:"container"},[a("strong",{staticClass:"d-block mx-5 my-5"},[e._v("Carregando Dados Gráficos...")])]),e.chartDataHist?a("div",{staticClass:"container"},[a("em",{staticClass:"d-block mx-3 my-2 text-gray"},[e._v("Utilize os filtros abaixo e/ou aplique agrupamentos para visões diferentes (Opções de filtro com base na LOA mais recente)")]),a("div",{staticClass:"row c-fields"},[a("div",{staticClass:"col-md-3"},[e._v(" Órgãos "),a("model-select",{ref:"orgaoSelect",attrs:{app:"loa",model:"orgao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.orgaoselected=a},model:{value:e.despesa.orgaoselected,callback:function(a){e.$set(e.despesa,"orgaoselected",a)},expression:"despesa.orgaoselected"}}),e._v(" Unidades Orçamentárias "),a("model-select",{ref:"unidadeSelect",attrs:{app:"loa",model:"unidadeorcamentaria",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}${e.qs_orgao}`},on:{change:a=>e.despesa.unidadeselected=a},model:{value:e.despesa.unidadeselected,callback:function(a){e.$set(e.despesa,"unidadeselected",a)},expression:"despesa.unidadeselected"}})],1),a("div",{staticClass:"col-md-3"},[e._v(" Funções "),a("model-select",{ref:"funcaoSelect",attrs:{app:"loa",model:"funcao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.funcaoselected=a},model:{value:e.despesa.funcaoselected,callback:function(a){e.$set(e.despesa,"funcaoselected",a)},expression:"despesa.funcaoselected"}}),e._v(" Subfunções "),a("model-select",{ref:"subfuncaoSelect",attrs:{app:"loa",model:"subfuncao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.subfuncaoselected=a},model:{value:e.despesa.subfuncaoselected,callback:function(a){e.$set(e.despesa,"subfuncaoselected",a)},expression:"despesa.subfuncaoselected"}})],1),a("div",{staticClass:"col-md-3"},[e._v(" Programas "),a("model-select",{ref:"programaSelect",attrs:{app:"loa",model:"programa",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.programaselected=a},model:{value:e.despesa.programaselected,callback:function(a){e.$set(e.despesa,"programaselected",a)},expression:"despesa.programaselected"}}),e._v(" Ações "),a("model-select",{ref:"acaoSelect",attrs:{app:"loa",model:"acao",choice:"__str__",ordering:"codigo",required:!1,extra_query:`${e.qs_loa}`},on:{change:a=>e.despesa.acaoselected=a},model:{value:e.despesa.acaoselected,callback:function(a){e.$set(e.despesa,"acaoselected",a)},expression:"despesa.acaoselected"}})],1),a("div",{staticClass:"col-md-1"}),a("div",{staticClass:"col-md-2 c-groups"},[a("div",{},[a("strong",[e._v("Agrupamentos")]),a("b-form-select",{attrs:{options:e.agrupamentos__options,"select-size":1},model:{value:e.despesa.agrupamentoselected,callback:function(a){e.$set(e.despesa,"agrupamentoselected",a)},expression:"despesa.agrupamentoselected"}}),a("strong",[e._v("Histograma")]),a("b-form-select",{attrs:{options:e.itens_hist,"select-size":1},model:{value:e.barchart_max_items__select,callback:function(a){e.barchart_max_items__select=a},expression:"barchart_max_items__select"}})],1),a("div",{staticClass:"col mt-1 text-right"},[a("b-button",{staticClass:"bg-secondary",attrs:{size:"sm"},on:{click:function(a){return e.clearFilters(e.event)}}},[e._v("Limpar Pesquisa")])],1)])]),a("div",{staticClass:"row"},[e.chartDataHist?a("div",{staticClass:"col-12 container-barchart p-3 mt-3"},[a("div",{staticClass:"btn-barchart-left",on:{click:function(a){return e.clickSlice(-1,"hist")}}},[a("i",{staticClass:"fa fa-chevron-left"})]),a("div",{staticClass:"btn-barchart-right",on:{click:function(a){return e.clickSlice(1,"hist")}}},[a("i",{staticClass:"fa fa-chevron-right"})]),a("BarChart",{attrs:{plugins:e.pluginsBar,chartDataUser:e.chartDataHist,cssClasses:"barchart-component"}})],1):e._e()])]):e._e(),a("resize-observer",{on:{notify:e.handleResize}})],1)},o=[],c=(s(4114),s(8111),s(2489),s(9736)),r=s(4951),n=s(382),l=s(2543),d={name:"LoaList",components:{BarChart:r.A,ModelSelect:c.A},data(){return{loa:{id:null,ano:null},chartDataHist:null,height:550,pluginsBar:[{title:{display:!0,text:""}}],pluginsDun:[{title:{display:!0,text:""}}],despesas_agrupadas:[],despesa:{orgaoselected:null,unidadeselected:null,funcaoselected:null,subfuncaoselected:null,programaselected:null,acaoselected:null,agrupamentoselected:"funcao",itensselected:20},filters:["orgaoselected","unidadeselected","funcaoselected","subfuncaoselected","programaselected","acaoselected"],agrupamentos:{orgao:"Órgãos",unidade:"Unidades Orçamentárias",funcao:"Funções",subfuncao:"SubFunções",programa:"Programas",acao:"Ações",natureza_1:"Natureza - Nível 1",natureza_2:"Natureza - Nível 2",natureza_3:"Natureza - Nível 3",natureza_4:"Natureza - Nível 4",natureza_5:"Natureza - Nível 5",fonte:"Fonte de Recurso"},tipos_agrups:["orgao","unidade","funcao","subfuncao","programa","acao","natureza_1","natureza_2","natureza_3","natureza_4","natureza_5","fonte"],itens:[{value:5,text:"05 Maiores"},{value:10,text:"10 Maiores"},{value:15,text:"15 Maiores"},{value:20,text:"20 Maiores"},{value:25,text:"25 Maiores"},{value:999,text:"Todos os Itens"}],itens_hist:[{value:5,text:"05 Itens"},{value:10,text:"10 Itens"},{value:15,text:"15 Itens"},{value:20,text:"20 Itens"}],barchart_exec_offset:0,barchart_exec_length:0,barchart_offset:0,barchart_length:0,barchart_max_items__select:5,barchart_max_items:5,barchart_colors:this.build_colors(20,"a0")}},computed:{qs_loa:function(){const e=this.loa.id||null;return e?`&loa=${e}&despesa_set__isnull=False`:""},qs_orgao:function(){const e=this.despesa.orgaoselected;return e&&e.id?`&orgao=${e.id}`:""},agrupamentos__options:function(){const e=this,a=[];return l.forOwn(e.agrupamentos,function(e,s){a.push({text:e,value:s})}),a},despesas_agrupadas_table:function(){const e=this,a=[];let s=l.orderBy(l.filter(e.despesas_agrupadas,e=>e.alt),["codigo"]);return l.each(s,function(e,s){a.push({"Código":e.codigo,"Especificação":e.especificacao,"Valor no Orçamento":e.vm_str,"Emendas Imposititivas":e.alt_str,"Saldo Final":e.saldo_str})}),a}},watch:{barchart_max_items__select:{handler(e,a){this.barchart_exec_offset=0,this.barchart_offset=0,this.barchart_max_items=Number(e),this.fetch("",1)}},"despesa.orgaoselected":{deep:!0,immediate:!0,handler(e,a){const s=this;(a||e)&&a!==e&&s.$nextTick().then(function(){s.tipos_agrups.indexOf(s.despesa.agrupamentoselected)<s.tipos_agrups.indexOf("unidade")&&(s.despesa.agrupamentoselected="unidade"),s.fetch()})}},"despesa.unidadeselected":{deep:!0,immediate:!0,handler(e,a){const s=this;(a||e)&&a!==e&&s.$nextTick().then(function(){s.tipos_agrups.indexOf(s.despesa.agrupamentoselected)<s.tipos_agrups.indexOf("funcao")&&(s.despesa.agrupamentoselected="funcao"),s.fetch()})}},"despesa.funcaoselected":{deep:!0,immediate:!0,handler(e,a){const s=this;(a||e)&&a!==e&&s.$nextTick().then(function(){s.tipos_agrups.indexOf(s.despesa.agrupamentoselected)<s.tipos_agrups.indexOf("subfuncao")&&(s.despesa.agrupamentoselected="subfuncao"),s.fetch()})}},"despesa.subfuncaoselected":{deep:!0,immediate:!0,handler(e,a){const s=this;(a||e)&&a!==e&&s.$nextTick().then(function(){s.tipos_agrups.indexOf(s.despesa.agrupamentoselected)<s.tipos_agrups.indexOf("programa")&&(s.despesa.agrupamentoselected="programa"),s.fetch()})}},"despesa.programaselected":{deep:!0,immediate:!0,handler(e,a){const s=this;(a||e)&&a!==e&&s.$nextTick().then(function(){s.tipos_agrups.indexOf(s.despesa.agrupamentoselected)<s.tipos_agrups.indexOf("acao")&&(s.despesa.agrupamentoselected="acao"),s.fetch()})}},"despesa.acaoselected":{deep:!0,immediate:!0,handler(e,a){const s=this;(a||e)&&a!==e&&s.$nextTick().then(function(){s.tipos_agrups.indexOf(s.despesa.agrupamentoselected)<s.tipos_agrups.indexOf("natureza_1")&&(s.despesa.agrupamentoselected="natureza_5"),s.fetch()})}},"despesa.agrupamentoselected":{deep:!0,immediate:!0,handler(e,a){const s=this;(a||e)&&a!==e&&s.$nextTick().then(function(){s.fetch()})}},"despesa.itensselected":{deep:!0,immediate:!0,handler(e,a){const s=this;s.$nextTick().then(function(){(a||e)&&a!==e&&s.fetch()})}}},methods:{clearFilters(e){const a=this;a.despesa={orgaoselected:null,unidadeselected:null,funcaoselected:null,subfuncaoselected:null,programaselected:null,acaoselected:null,agrupamentoselected:"funcao",itensselected:20}},clickSlice(e,a){"hist"===a?(-1===e&&this.barchart_offset>0||1===e&&this.barchart_offset+this.barchart_max_items<this.barchart_length)&&(this.barchart_offset+=e,this.fetch("",1)):(-1===e&&this.barchart_exec_offset>0||1===e&&this.barchart_exec_offset+this.barchart_max_items<this.barchart_exec_length)&&(this.barchart_exec_offset+=e,this.fetch("",1))},handleResize(){},fetch(e="",a=0){const s=this,t={orgao:s.despesa.orgaoselected?s.despesa.orgaoselected.codigo:null,unidade:s.despesa.unidadeselected?`${s.despesa.unidadeselected.codigo}/${s.despesa.unidadeselected.orgao}`:null,funcao:s.despesa.funcaoselected?s.despesa.funcaoselected.codigo:null,subfuncao:s.despesa.subfuncaoselected?s.despesa.subfuncaoselected.codigo:null,programa:s.despesa.programaselected?s.despesa.programaselected.codigo:null,acao:s.despesa.acaoselected?s.despesa.acaoselected.codigo:null,agrupamento:""===e?s.despesa.agrupamentoselected:e,itens:s.despesa.itensselected};s.$nextTick().then(()=>{t.hist=1,s.utils.postModelAction("loa","loa",s.loa.id,"despesas_agrupadas",t).then(e=>{let a=e.data.labels.slice(s.barchart_offset,s.barchart_offset+s.barchart_max_items),o=s.barchart_colors,c=[];l.each(e.data.anos,function(a,t){let r=[];0===t&&0===s.barchart_offset&&(s.barchart_length=e.data.pre_datasets[a].length),l.each(e.data.pre_datasets[a].slice(s.barchart_offset,s.barchart_offset+s.barchart_max_items),function(e,a){r.push(e.vm)}),c.push({label:a,data:r,backgroundColor:o[t]})});let r={labels:a,datasets:c};if(null===s.chartDataHist)return void(s.chartDataHist=r);const n=["HISTOGRAMA DO ORÇAMENTO DO MUNICÍPIO DE JATAÍ"],d=[];l.forOwn(s.despesa,function(e,a){s.filters.includes(a)&&null!==e&&d.push(e.especificacao)}),l.isEmpty(d)||n.push(`FILTRADO POR: ${d.join(" / ")}`),n.push(`Orçamento das despesas agrupadas por: ${s.agrupamentos[t.agrupamento]}`),s.$set(s.chartDataHist,"labels",a),s.$set(s.chartDataHist,"datasets",c),s.$set(s.pluginsBar,0,{title:{display:!0,text:n}})}).then(e=>{this.handleResize()}).catch(e=>s.sendMessage({alert:"danger",message:"Não foi possível recuperar a lista...",time:5}))})},build_colors(e,a=""){const s=[];if(e<1)return s;let t=Math.floor(360*Math.random()),o=0,c=(e,a,s,t=a*Math.min(s,1-s),o=(a,o=(a+e/30)%12)=>s-t*Math.max(Math.min(o-3,9-o,1),-1))=>[o(0),o(8),o(4)],r=(e,a,s)=>"#"+[e,a,s].map(e=>Math.round(255*e).toString(16).padStart(2,0)).join("");for(let n=0;n<e;n++){let e=`${r(...c(t,Math.max(.8,Math.random()),.4))}`;o=30*Math.random()+(t<150?50:25),t=(t+o)%360,s.push(`${e}${a}`)}return s},build_colors_hsl(e){const a=[];if(e<1)return a;let s=Math.floor(360*Math.random()),t=0;for(let o=0;o<e;o++){let e="hsl( "+s+", 100%, 40%)";t=30*Math.random()+(s<150?50:25),s=(s+t)%360,a.push(e)}return a},build_colors_random(e){const a="0123456789ABCDEF",s=[];for(let t=0;t<e;t++){let e="#";for(let s=0;s<6;s++)e+=a[Math.floor(Math.random()*(s%2===0?14:16))];s.push(e)}return s}},mounted:function(){const e=this;e.$nextTick().then(()=>{e.utils.getModelList("loa","loa",1,"&o=-ano").then(a=>{const s=a.data.results[0],t=n.Ay.load(s.yaml_obs);s.yaml_obs=t,e.loa=s})})}},i=d,u=s(845),p=(0,u.A)(i,t,o,!1,null,"782b5692",null),h=p.exports}}]);
//# sourceMappingURL=650.a2ae2509.js.map