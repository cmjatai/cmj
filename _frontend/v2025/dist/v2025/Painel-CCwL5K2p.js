import{v as M,y as Z,c as P,_ as F,w as H,f as b,g as f,k as e,i as L,E as z,j as ne,G as ae,H as fe,F as le,r as oe,t as q,I as R,D as w,q as U,C as se,l as Q,J as G,K as ye,T as de,n as ge,L as ie,o as me,u as ve,M as he,N as _e}from"./vendor-oGbRXWXa.js";import{_ as ee,u as te,a as re,R as j,b as ue}from"./main-DXRBByPr.js";import{a as J}from"./TeleportStore-BZE0PeMz.js";import{F as pe}from"./vendor_fortawesome-Dto-hSUx.js";const we={class:"container"},be={class:"row py-2"},$e={class:"col-3 py-2"},Se={class:"form-group"},xe={id:"div_id_display_title",class:"custom-control custom-checkbox"},Ee={key:0,class:"col-3"},Me=["value"],Pe={class:"col-6"},ke={class:"row py-2"},Ne={class:"col-6"},Ve={id:"div_id_config",class:"form-group"},We={class:"col-6"},Ce={id:"div_id_styles",class:"form-group"},Oe={class:"container"},Je={class:"row"},ze={class:"col-12"},Te={id:"div_id_description",class:"form-group"},Ie={class:"container actions pt-3"},Be={class:"row"},De={class:"col-12"},Ue={class:"btn-group"},Ae={__name:"WidgetEditor",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(V){const W=M(null),g=te(),h=re(),y=Z("EventBus"),_=V,s=M({"":"Nenhum componente selecionado",WidgetSessaoPlenariaTitulo:"WidgetSessaoPlenariaTitulo - Título da Sessão Plenária vinculada ao Painel",WidgetCronometroEvento:"WidgetCronometroEvento - Cronômetro do Evento vinculado ao Painel",WidgetCronometroPalavra:"WidgetCronometroPalavra - Cronômetro da Palavra vinculada ao Painel"}),a=P(()=>g.data_cache.painelset_widget?.[_.widgetSelected]||null),m=P(()=>F.orderBy(F.filter(g.data_cache.painelset_widget,{parent:_.widgetSelected})||[],["position"],["asc"])),d=P(()=>!a.value||!a.value.config?"":JSON.stringify(a.value.config,null,2)),k=P(()=>!a.value||!a.value.styles?"":JSON.stringify({component:a.value.styles.component||{},title:a.value.styles.title||{},inner:a.value.styles.inner||{}},null,2)),o=M({config:d.value,styles:k.value}),E=t=>{y.emit("painelset:editorarea:close"),y.emit("painelset:editorarea:resize",0)},p=()=>{if(a.value)try{const t=JSON.parse(o.value.config),l=JSON.parse(o.value.styles);a.value.styles=l,a.value.config=t,o.value.config=JSON.stringify(t,null,2),o.value.styles=JSON.stringify(l,null,2),C({config:t,styles:l})}catch(t){h.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${t.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",t),o.value.config=d.value,o.value.styles=k.value}},T=t=>{console.log("WidgetEditor.vue: changeForm event:",t);const l={...a.value};delete l.id,s.value[l.vue_component]===void 0&&(l.vue_component=""),["styles","config"].includes(t.target.name)||C(l)},C=async t=>{try{await j.Utils.patchModel({app:"painelset",model:"widget",id:a.value.id,form:t}),h.addMessage({type:"info",text:"Widget atualizado.",timeout:2e3}),console.log("WidgetEditor.vue: patchModel updated successfully.")}catch(l){h.addMessage({type:"danger",text:"Erro ao salvar as alterações do Widget.",timeout:5e3}),console.error("Erro ao salvar as alterações do Widget:",l)}};H(()=>a.value,t=>{t&&(o.value.config=d.value,o.value.styles=k.value)});const r=t=>{a.value&&confirm(`Confirma a exclusão do Widget: ${a.value.name} ?`)&&j.Utils.deleteModel({app:"painelset",model:"widget",id:a.value.id}).then(()=>{console.log("Widget deleted successfully"),y.emit("painelset:editorarea:close","force")}).catch(l=>{console.error("Error deleting widget:",l)})};return(t,l)=>{const $=se("FontAwesomeIcon");return f(),b("div",{ref_key:"painelsetWidgetEditor",ref:W,key:`painelset-widget-editor-${a.value?.id}`,class:"painelset-widget-editor"},[e("form",{action:"",onChange:l[8]||(l[8]=S=>T(S))},[e("fieldset",null,[l[18]||(l[18]=e("legend",null,"Configurações do Widget",-1)),e("div",we,[e("div",be,[e("div",$e,[e("div",Se,[e("div",xe,[z(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":l[0]||(l[0]=S=>a.value.config.displayTitle=S),id:"id_display_title"},null,512),[[ae,a.value.config.displayTitle]]),l[9]||(l[9]=ne("  ",-1)),l[10]||(l[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do widget? ",-1)),l[11]||(l[11]=e("br",null,null,-1)),l[12]||(l[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),m.value.length===0?(f(),b("div",Ee,[l[13]||(l[13]=e("label",{for:"widget-vue-component",class:"form-label"},"Componente Vue",-1)),z(e("select",{class:"form-select","onUpdate:modelValue":l[1]||(l[1]=S=>a.value.vue_component=S),id:"widget-vue-component"},[(f(!0),b(le,null,oe(s.value,(S,K)=>(f(),b("option",{key:`widget-vue-component-option-${K}`,value:K},q(S),9,Me))),128))],512),[[fe,a.value.vue_component]])])):L("",!0),e("div",Pe,[l[14]||(l[14]=e("label",{for:"widget-name",class:"form-label"},"Título do Widget",-1)),z(e("input",{type:"text",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=S=>a.value.name=S),placeholder:"Título do Widget"},null,512),[[R,a.value.name]])])]),e("div",ke,[e("div",Ne,[e("div",Ve,[l[15]||(l[15]=e("label",{for:"widget-config",class:"form-label"},"Configurações do Widget (JSON)",-1)),e("div",null,[z(e("textarea",{id:"widget-config",name:"config",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=S=>o.value.config=S),placeholder:"Configurações do Widget em JSON",rows:"15",onBlur:p},null,544),[[R,o.value.config]])])])]),e("div",We,[e("div",Ce,[l[16]||(l[16]=e("label",{for:"widget-styles",class:"form-label"},"Estilos do Widget (JSON)",-1)),e("div",null,[z(e("textarea",{name:"styles",id:"widget-styles",class:"form-control","onUpdate:modelValue":l[4]||(l[4]=S=>o.value.styles=S),rows:"15",placeholder:"Estilos do Widget em JSON",onBlur:p},null,544),[[R,o.value.styles]])])])])])]),e("div",Oe,[e("div",Je,[e("div",ze,[e("div",Te,[l[17]||(l[17]=e("label",{for:"id_description",class:"form-label"},"Descrição do Widget",-1)),e("div",null,[z(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":l[5]||(l[5]=S=>a.value.description=S),placeholder:"Descrição do Widget",rows:"5"},null,512),[[R,a.value.description]])])])])])]),e("div",Ie,[e("div",Be,[e("div",De,[e("div",Ue,[e("button",{class:"btn btn-secondary",onClick:l[6]||(l[6]=w(S=>E(),["stop","prevent"])),title:"Fechar Editor de Widget"},[U($,{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-danger",onMousedown:w(S=>!1,["stop","prevent"]),onClick:l[7]||(l[7]=w(S=>r(),["stop","prevent"]))},[U($,{icon:"fa-solid fa-trash-can"})],32)])])])])])],32)])}}},Fe=ee(Ae,[["__scopeId","data-v-0afee643"]]),Le=["id"],Re={key:2,class:"inner-widget inner-children"},je={key:3,class:"manager"},Xe={class:"position"},Ye={class:"toolbar"},He={class:"btn-group"},qe={class:"btn-group right"},Ge={__name:"Widget",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(V){const W=te(),g=ue(),h=Z("EventBus"),y=V,_=M(!1),s=M(null),a=M(!1),m=M({}),d=M({x:0,y:0,w:100,h:100,mouseResizeEnter:!1}),k=P(()=>s.value&&J.value===s.value.id),o=P(()=>W.data_cache.painelset_widget?.[y.widgetSelected]||null),E=P(()=>{if(!o.value||!o.value.config?.coords)return{};const i={},n=o.value.config.coords;return n.x!==void 0&&(i.left=`${n.x}%`),n.y!==void 0&&(i.top=`${n.y}%`),n.w!==void 0&&(i.right=`${n.w+n.x>100?0:100-(n.w+n.x)}%`),n.h!==void 0&&(i.bottom=`${n.h+n.y>100?0:100-(n.h+n.y)}%`),i}),p=P(()=>F.orderBy(F.filter(W.data_cache.painelset_widget,{parent:y.widgetSelected})||[],["position"],["asc"]));(async()=>{W.fetchSync({app:"painelset",model:"widget",filters:{parent:y.widgetSelected}}).then(i=>{i&&i.data.results.length>0})})(),h.on("painelset:editorarea:close",(i=null)=>{if(C()){if(i&&i==="force"){_.value=!1,a.value=!1,J.value=null;return}i&&s.value&&i===s.value.id||_.value||(_.value=!1,a.value=!1,J.value=null)}}),H(()=>a.value,i=>{C()&&(i?(h.emit("painelset:editorarea:close",s.value.id),ie(()=>{J.value=s.value.id})):J.value=null)});const C=()=>g.isAuthenticated?g.hasPermission("painelset.change_widget"):!1,r=(i=>{if(console.debug("Received oncomponent event:"),!i||!i.type){console.warn("Invalid oncomponent event received, missing type");return}if(i.type==="extra_styles"){if(!i.extra_styles){console.warn("Invalid extra_styles event, missing extra_styles data");return}const n={...i.extra_styles};m.value=n}}),t=()=>{console.debug("Opening widget editor modal for widget:",o.value),a.value=!a.value},l=()=>{o.value&&confirm(`Confirma a exclusão do Widget: ${o.value.name} e todos seus SubWidgets?`)&&j.Utils.deleteModel({app:"painelset",model:"widget",id:o.value.id}).then(()=>{console.log("Widget deleted successfully")}).catch(i=>{console.error("Error deleting widget:",i)})},$=()=>{if(!o.value)return;const i={...o.value.config,coords:{...o.value.config.coords,x:10,y:10}},n={...o.value,id:void 0,name:`${o.value.name} (Cópia)`,position:p.value.length+1,config:i};j.Utils.createModel({app:"painelset",model:"widget",form:n}).then(A=>{console.log("Widget duplicated successfully:",A.data)}).catch(A=>{console.error("Error duplicating widget:",A)})},S=()=>{if(!o.value)return;const i={name:"Novo Widget",parent:o.value.id,visao:o.value.visao,position:p.value.length+1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30},displayTitle:!0},styles:{component:{},title:{},inner:{}}};j.Utils.createModel({app:"painelset",model:"widget",form:i}).then(n=>{console.log("Default child widget created successfully:",n.data)}).catch(n=>{console.error("Error creating default child widget:",n)})},K=i=>!i||i.x===void 0||i.y===void 0||i.w===void 0||i.h===void 0||i.x===null||i.y===null||i.w===null||i.h===null?!1:i.w>5&&i.w<=100&&i.h>5&&i.h<=100&&i.x>=0&&i.x<=100&&i.y>=0&&i.y<=100&&i.x+i.w<=100&&i.y+i.h<=100,u=i=>{if(!K(i)){console.error("Invalid widget coordinates, aborting update");return}j.Utils.patchModel({app:"painelset",model:"widget",id:o.value.id,form:{config:{...o.value.config,coords:{...o.value.config.coords,x:i.x,y:i.y,w:i.w,h:i.h}}}}).then(n=>{console.log(n.data),console.log("Widget coordinates updated successfully")}).catch(n=>{console.error("Error updating widget coordinates:",n)})},N=i=>{i.preventDefault(),!d.value.mouseResizeEnter&&C()&&(_.value=!_.value,_.value||(a.value=!1),console.log("Activating painel editor teleport for Widget:",y.widgetSelected),h.emit("painelset:editorarea:close",s.value.id))},x=(i,n)=>{if(d.value.mouseResizeEnter=!0,i.preventDefault(),!_.value)return;const A=s.value,O=A.getBoundingClientRect(),v=A.parentElement.getBoundingClientRect(),c={...d.value};console.log("Mouse move detected:",i.clientX,i.clientY,O);const ce=I=>{let B=0,D=0;if(n==="top-left"){const X=I.clientX-O.left,Y=I.clientY-O.top;B=Math.round(X/v.width*100),D=Math.round(Y/v.height*100),c.w=o.value.config.coords.w-B,c.h=o.value.config.coords.h-D,c.x=o.value.config.coords.x+B,c.y=o.value.config.coords.y+D}else if(n==="top-right"){const X=I.clientX-O.right,Y=I.clientY-O.top;B=Math.round(X/v.width*100),D=Math.round(Y/v.height*100),c.w=o.value.config.coords.w+B,c.h=o.value.config.coords.h-D,c.x=o.value.config.coords.x,c.y=o.value.config.coords.y+D}else if(n==="bottom-right"){const X=I.clientX-O.right,Y=I.clientY-O.bottom;B=Math.round(X/v.width*100),D=Math.round(Y/v.height*100),c.w=o.value.config.coords.w+B,c.h=o.value.config.coords.h+D,c.x=o.value.config.coords.x,c.y=o.value.config.coords.y}else if(n==="bottom-left"){const X=I.clientX-O.left,Y=I.clientY-O.bottom;B=Math.round(X/v.width*100),D=Math.round(Y/v.height*100),c.w=o.value.config.coords.w-B,c.h=o.value.config.coords.h+D,c.x=o.value.config.coords.x+B,c.y=o.value.config.coords.y}else if(n==="center-center"){const X=I.clientX-O.left-O.width/2,Y=I.clientY-O.top-O.height/2;B=Math.round(X/v.width*100),D=Math.round(Y/v.height*100),console.debug("Resizing widget...",X,Y,n,B,D,c),c.w=o.value.config.coords.w,c.h=o.value.config.coords.h,c.x=o.value.config.coords.x+B,c.y=o.value.config.coords.y+D}console.debug("Resizing widget...",I.clientX,I.clientY,n,B,D,c),K(c)?(d.value.w=c.w,d.value.h=c.h,d.value.x=c.x,d.value.y=c.y,A.style.right=`${100-(c.w+c.x)}%`,A.style.bottom=`${100-(c.h+c.y)}%`,A.style.left=`${c.x}%`,A.style.top=`${c.y}%`):console.warn("Invalid coordinates during resize, ignoring update")};console.log("Starting resize operation"),window.addEventListener("mousemove",ce),window.addEventListener("mouseup",I=>{window.removeEventListener("mouseup",this),window.removeEventListener("mousemove",ce),I.preventDefault(),d.value.mouseResizeEnter&&(d.value.mouseResizeEnter=!1,u({x:d.value.x,y:d.value.y,w:d.value.w,h:d.value.h}),console.log("Resize operation ended"))})};return(i,n)=>{const A=se("Widget",!0),O=se("FontAwesomeIcon");return f(),b("div",{id:`id-painelset-widget-${o.value?.id}`,ref_key:"painelsetWidget",ref:s,key:`painelset-widget-${o.value?.id}`,class:ge(["painelset-widget",_.value?"editmode":""]),style:G({...o.value?.styles.component||{},...E.value,...m.value}),onMousedown:n[9]||(n[9]=w(v=>N(v),["stop","prevent"])),onClick:w(v=>!1,["stop","prevent"])},[o.value?.config?.displayTitle?(f(),b("div",{key:0,class:"widget-titulo",style:G(o.value?.styles.title||{})},q(o.value?.name),5)):L("",!0),o.value?.vue_component?(f(),b("div",{key:1,class:"inner-widget",style:G(o.value?.styles.inner||{})},[(f(),Q(ye(o.value?.vue_component),{"painel-id":V.painelId,"widget-selected":o.value?.id,onOncomponent:r},null,40,["painel-id","widget-selected"]))],4)):L("",!0),o.value?.vue_component?L("",!0):(f(),b("div",Re,[(f(!0),b(le,null,oe(p.value,(v,c)=>(f(),Q(A,{key:`widget-${v.id}-${c}`,"painel-id":V.painelId,"widget-selected":v.id},null,8,["painel-id","widget-selected"]))),128))])),_.value?(f(),b("div",je,[e("div",Xe,q(o.value?.position),1),e("div",Ye,[e("div",He,[e("button",{class:"btn btn-sm btn-danger",onMousedown:w(v=>!1,["stop","prevent"]),onClick:n[0]||(n[0]=w(v=>l(),["stop","prevent"]))},[U(O,{icon:"fa-solid fa-trash-can"})],32),e("button",{class:"btn btn-sm btn-secondary",onMousedown:w(v=>!1,["stop","prevent"]),onClick:n[1]||(n[1]=w(v=>$(),["stop","prevent"]))},[U(O,{icon:"fa-solid fa-clone"})],32),e("button",{class:"btn btn-sm btn-primary",onMousedown:w(v=>!1,["stop","prevent"]),onClick:n[2]||(n[2]=w(v=>S(),["stop","prevent"]))},[U(O,{icon:"fa-solid fa-plus"})],32)]),e("div",qe,[e("button",{class:"btn btn-sm btn-dark",onMousedown:w(v=>!1,["stop","prevent"]),onClick:n[3]||(n[3]=w(v=>t(),["stop","prevent"]))},[U(O,{icon:"fa-solid fa-pen-to-square"})],32)])]),e("div",{class:"resize-handle top-left",onMousedown:n[4]||(n[4]=v=>x(v,"top-left"))},null,32),e("div",{class:"resize-handle top-right",onMousedown:n[5]||(n[5]=v=>x(v,"top-right"))},null,32),e("div",{class:"resize-handle bottom-left",onMousedown:n[6]||(n[6]=v=>x(v,"bottom-left"))},null,32),e("div",{class:"resize-handle bottom-right",onMousedown:n[7]||(n[7]=v=>x(v,"bottom-right"))},null,32),e("div",{class:"resize-handle center-center",onMousedown:n[8]||(n[8]=v=>x(v,"center-center"))},null,32)])):L("",!0),a.value&&k.value?(f(),Q(de,{key:4,to:"#painelset-editorarea",disabled:!k.value},[U(Fe,{"painel-id":V.painelId,"widget-selected":o.value?.id},null,8,["painel-id","widget-selected"])],8,["disabled"])):L("",!0)],46,Le)}}},Ke=ee(Ge,[["__scopeId","data-v-d3ef2305"]]),Qe={class:"container"},Ze={class:"row py-2"},et={class:"col-3 py-2"},tt={class:"form-group"},lt={id:"div_id_display_title",class:"custom-control custom-checkbox"},ot={class:"col-6"},st={class:"row py-2"},it={class:"col-6"},nt={id:"div_id_config",class:"form-group"},at={class:"col-6"},dt={id:"div_id_styles",class:"form-group"},rt={class:"container"},ut={class:"row"},ct={class:"col-12"},vt={id:"div_id_description",class:"form-group"},pt={class:"container actions pt-3"},ft={class:"row"},gt={class:"col-12 d-flex gap-2"},mt={class:"btn-group"},yt={class:"btn-group"},ht={__name:"VisaoEditor",props:{painelId:{type:Number,default:0},visaoSelected:{type:Number,default:0}},setup(V){const W=Z("EventBus"),g=M(null),h=te(),y=re(),_=V,s=P(()=>h.data_cache.painelset_visaodepainel?.[_.visaoSelected]||null),a=P(()=>!s.value||!s.value.config?"":JSON.stringify(s.value.config,null,2)),m=P(()=>!s.value||!s.value.styles?"":JSON.stringify({component:s.value.styles.component||{},title:s.value.styles.title||{},inner:s.value.styles.inner||{}},null,2)),d=M({config:a.value,styles:m.value}),k=()=>{if(s.value)try{const r=JSON.parse(d.value.config),t=JSON.parse(d.value.styles);s.value.styles=t,s.value.config=r,d.value.config=JSON.stringify(r,null,2),d.value.styles=JSON.stringify(t,null,2),E({config:r,styles:t})}catch(r){y.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${r.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",r),d.value.config=a.value,d.value.styles=m.value}},o=r=>{console.log("VisaoEditor.vue: changeForm event:",r);const t={...s.value};delete t.id,["styles","config"].includes(r.target.name)||E(t)},E=async r=>{try{await j.Utils.patchModel({app:"painelset",model:"visaodepainel",id:s.value.id,form:r}),y.addMessage({type:"info",text:"Visão do Painel atualizado.",timeout:2e3}),console.log("VisaoEditor.vue: patchModel updated successfully.")}catch(t){y.addMessage({type:"danger",text:"Erro ao salvar as alterações do Visão do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Visão do Painel:",t)}};H(()=>s.value,r=>{r&&(d.value.config=a.value,d.value.styles=m.value)});const p=r=>{W.emit("painelset:editorarea:close"),W.emit("painelset:editorarea:resize",0)},T=()=>{s.value&&confirm(`Confirma a exclusão da Visão do Painel: ${s.value.name} ?`)&&j.Utils.deleteModel({app:"painelset",model:"visaodepainel",id:s.value.id}).then(()=>{y.addMessage({type:"info",text:"Visão do Painel excluído com sucesso.",timeout:5e3}),W.emit("painelset:editorarea:close","force")}).catch(r=>{y.addMessage({type:"danger",text:"Erro ao excluir a Visão do Painel.",timeout:5e3}),console.error("Error deleting visaodepainel:",r)})},C=()=>{if(!s.value)return;const r={name:"Novo Widget",parent:null,visao:s.value.id,position:h.data_cache.painelset_widget?Object.values(h.data_cache.painelset_widget).filter(t=>t.visao===s.value.id).length+1:1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30},displayTitle:!0},styles:{component:{},title:{},inner:{}}};j.Utils.createModel({app:"painelset",model:"widget",form:r}).then(t=>{console.log("Default child widget created successfully:",t.data)}).catch(t=>{console.error("Error creating default child widget:",t)})};return(r,t)=>{const l=se("FontAwesomeIcon");return f(),b("div",{ref_key:"painelsetVisaoEditor",ref:g,key:`painelset-visaodepainel-editor-${s.value?.id}`,class:"painelset-visaodepainel-editor"},[e("form",{action:"",onChange:t[8]||(t[8]=$=>o($))},[e("fieldset",null,[t[17]||(t[17]=e("legend",null,"Configurações da Visão do Painel",-1)),e("div",Qe,[e("div",Ze,[e("div",et,[e("div",tt,[e("div",lt,[z(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":t[0]||(t[0]=$=>s.value.config.displayTitle=$),id:"id_display_title"},null,512),[[ae,s.value.config.displayTitle]]),t[9]||(t[9]=ne("  ",-1)),t[10]||(t[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do painel? ",-1)),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),e("div",ot,[t[13]||(t[13]=e("label",{for:"painel-name",class:"form-label"},"Título da Visão do Painel",-1)),z(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=$=>s.value.name=$),placeholder:"Título da Visão do Painel"},null,512),[[R,s.value.name]])])]),e("div",st,[e("div",it,[e("div",nt,[t[14]||(t[14]=e("label",{for:"painel-config",class:"form-label"},"Configurações da Visão do Painel (JSON)",-1)),e("div",null,[z(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=$=>d.value.config=$),placeholder:"Configurações da Visão do Painel em JSON",rows:"15",onBlur:k},null,544),[[R,d.value.config]])])])]),e("div",at,[e("div",dt,[t[15]||(t[15]=e("label",{for:"painel-styles",class:"form-label"},"Estilos da Visão do Painel (JSON)",-1)),e("div",null,[z(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=$=>d.value.styles=$),rows:"15",placeholder:"Estilos da Visão do Painel em JSON",onBlur:k},null,544),[[R,d.value.styles]])])])])])]),e("div",rt,[e("div",ut,[e("div",ct,[e("div",vt,[t[16]||(t[16]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[z(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=$=>s.value.description=$),placeholder:"Descrição do Painel",rows:"5"},null,512),[[R,s.value.description]])])])])])]),e("div",pt,[e("div",ft,[e("div",gt,[e("div",mt,[e("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=w($=>p(),["stop","prevent"])),title:"Fechar Editor da Visão do Painel"},[U(l,{icon:["fas","times"]})]),e("button",{class:"btn btn-danger",onMousedown:w($=>!1,["stop","prevent"]),onClick:t[6]||(t[6]=w($=>T(),["stop","prevent"])),title:"Excluir Visão do Painel"},[U(l,{icon:"fa-solid fa-trash-can"})],32)]),e("div",yt,[e("button",{class:"btn btn-primary",onMousedown:w($=>!1,["stop","prevent"]),onClick:t[7]||(t[7]=w($=>C(),["stop","prevent"])),title:"Adicionar Widget à Visão do Painel"},[U(l,{icon:"fa-solid fa-plus"})],32)])])])])])],32)])}}},_t=ee(ht,[["__scopeId","data-v-4cabdb3f"]]),wt=["id"],bt={key:1,class:"visao-empty"},$t={__name:"VisaoDePainel",props:{painelId:{type:Number,default:0},visaodepainelSelected:{type:Number,default:0}},setup(V){const W=te(),g=ue(),h=V,y=Z("EventBus"),_=M(!1),s=M(null),a=P(()=>J.value===s.value.id);y.on("painelset:editorarea:close",(E=null)=>{if(m()){if(E&&E==="force"){_.value=!1,J.value=null;return}E&&s.value&&E===s.value.id||(J.value=null,_.value=!1)}}),H(()=>_.value,E=>{m()&&(E?(y.emit("painelset:editorarea:close",s.value.id),ie(()=>{J.value=s.value.id})):J.value=null)});const m=()=>g.isAuthenticated?g.hasPermission("painelset.change_visaodepainel"):!1,d=P(()=>W.data_cache.painelset_visaodepainel?.[h.visaodepainelSelected]||null),k=P(()=>F.orderBy(F.filter(W.data_cache.painelset_widget,{visao:h.visaodepainelSelected,parent:null})||[],["position"],["asc"]));return(async()=>{W.fetchSync({app:"painelset",model:"widget",filters:{visaodepainel:h.visaodepainelSelected}}).then(E=>{E&&E.data.results.length>0})})(),(E,p)=>(f(),b("div",{id:`id-painelset-visaodepainel${V.visaodepainelSelected}`,ref_key:"painelsetVisaodepainel",ref:s,key:`painelset-visaodepainel${V.visaodepainelSelected}`,class:"painelset-visaodepainel",style:G(d.value?.styles.component||{}),onClick:p[0]||(p[0]=w(T=>_.value=!_.value,["stop"]))},[d.value?.config?.displayTitle?(f(),b("div",{key:0,class:"visaodepainel-titulo",style:G(d.value?.styles.title||{})},q(d.value?.name),5)):L("",!0),e("div",{class:"inner-visaodepainel",style:G(d.value?.styles.inner||{})},[(f(!0),b(le,null,oe(k.value,(T,C)=>(f(),Q(Ke,{key:`widget-${T.id}-${C}`,"painel-id":V.painelId,"widget-selected":T.id},null,8,["painel-id","widget-selected"]))),128))],4),k.value.length===0?(f(),b("div",bt,[...p[1]||(p[1]=[e("p",null,"Não há widgets configurados para esta visão.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar o primeiro widget à visão.",-1)])])):L("",!0),_.value&&a.value?(f(),Q(de,{key:2,to:"#painelset-editorarea",disabled:!a.value},[U(_t,{"painel-id":V.painelId,"visao-selected":V.visaodepainelSelected},null,8,["painel-id","visao-selected"])],8,["disabled"])):L("",!0)],12,wt))}},St=ee($t,[["__scopeId","data-v-622f4321"]]),xt={class:"container"},Et={class:"row py-2"},Mt={class:"col-3 py-2"},Pt={class:"form-group"},kt={id:"div_id_display_title",class:"custom-control custom-checkbox"},Nt={class:"col-6"},Vt={class:"col-6"},Wt=["value"],Ct={class:"row py-2"},Ot={class:"col-6"},Jt={id:"div_id_config",class:"form-group"},zt={class:"col-6"},Tt={id:"div_id_styles",class:"form-group"},It={class:"container"},Bt={class:"row"},Dt={class:"col-12"},Ut={id:"div_id_description",class:"form-group"},At={class:"container actions pt-3"},Ft={class:"row"},Lt={class:"col-12"},Rt={class:"btn-group"},jt={__name:"PainelEditor",props:{painelId:{type:Number,default:0},painelSelected:{type:Number,default:0}},setup(V){const W=M(null),g=te(),h=re(),y=Z("EventBus"),_=V,s=P(()=>g.data_cache.painelset_painel?.[_.painelSelected]||null),a=P(()=>!s.value||!s.value.config?"":JSON.stringify(s.value.config,null,2)),m=P(()=>!s.value||!s.value.styles?"":JSON.stringify({component:s.value.styles.component||{},title:s.value.styles.title||{},inner:s.value.styles.inner||{}},null,2)),d=M({config:a.value,styles:m.value}),k=P(()=>F.orderBy(g.data_cache.sessao_sessaoplenaria||[],["data_inicio"],["desc"]));me(()=>{g.fetchSync({app:"sessao",model:"sessaoplenaria",params:{o:"-data_inicio"},only_first_page:!0})});const o=()=>{if(s.value)try{const r=JSON.parse(d.value.config),t=JSON.parse(d.value.styles);s.value.styles=t,s.value.config=r,d.value.config=JSON.stringify(r,null,2),d.value.styles=JSON.stringify(t,null,2),p({config:r,styles:t})}catch(r){h.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${r.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",r),d.value.config=a.value,d.value.styles=m.value}},E=r=>{console.log("PainelEditor.vue: changeForm event:",r);const t={...s.value};delete t.id,["styles","config"].includes(r.target.name)||p(t)},p=async r=>{try{await j.Utils.patchModel({app:"painelset",model:"painel",id:s.value.id,form:r}),h.addMessage({type:"info",text:"Painel atualizado.",timeout:2e3}),console.log("PainelEditor.vue: patchModel updated successfully.")}catch(t){h.addMessage({type:"danger",text:"Erro ao salvar as alterações do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Painel:",t)}};H(()=>s.value,r=>{r&&(d.value.config=a.value,d.value.styles=m.value)});const T=r=>{y.emit("painelset:editorarea:close"),y.emit("painelset:editorarea:resize",0)},C=r=>{if(!s.value)return;const t={painel:s.value.id,name:"Nova Visão do Painel",description:"",position:g.data_cache.painelset_visaodepainel?Object.values(g.data_cache.painelset_visaodepainel).filter(l=>l.painel===s.value.id).length+1:1,active:!0,config:{displayTitle:!0},styles:{}};j.Utils.createModel({app:"painelset",model:"visaodepainel",form:t}).then(l=>{h.addMessage({type:"info",text:"Visão do Painel criada com sucesso.",timeout:2e3}),g.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:s.value.id}})}).catch(l=>{h.addMessage({type:"danger",text:"Erro ao criar a Visão do Painel.",timeout:5e3}),console.error("Erro ao criar a Visão do Painel:",l)})};return(r,t)=>(f(),b("div",{ref_key:"painelsetPainelEditor",ref:W,key:`painelset-painel-editor-${s.value?.id}`,class:"painelset-painel-editor"},[e("form",{action:"",onChange:t[8]||(t[8]=l=>E(l))},[e("fieldset",null,[t[19]||(t[19]=e("legend",null,"Configurações do Painel",-1)),e("div",xt,[e("div",Et,[e("div",Mt,[e("div",Pt,[e("div",kt,[z(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":t[0]||(t[0]=l=>s.value.config.displayTitle=l),id:"id_display_title"},null,512),[[ae,s.value.config.displayTitle]]),t[9]||(t[9]=ne("  ",-1)),t[10]||(t[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do painel? ",-1)),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),e("div",Nt,[t[13]||(t[13]=e("label",{for:"painel-name",class:"form-label"},"Título do Painel",-1)),z(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.name=l),placeholder:"Título do Painel"},null,512),[[R,s.value.name]])]),e("div",Vt,[t[15]||(t[15]=e("label",{for:"painel-sessao",class:"form-label"},"Sessão Plenária Associada",-1)),z(e("select",{id:"painel-sessao",name:"sessao_plenaria",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.sessao=l)},[t[14]||(t[14]=e("option",{value:null},"-- Nenhuma --",-1)),(f(!0),b(le,null,oe(k.value,l=>(f(),b("option",{key:`sessao-option-${l.id}`,value:l.id},q(l.__str__)+" ("+q(l.data_inicio)+" - "+q(l.data_fim||"")+") ",9,Wt))),128))],512),[[fe,s.value.sessao]])])]),e("div",Ct,[e("div",Ot,[e("div",Jt,[t[16]||(t[16]=e("label",{for:"painel-config",class:"form-label"},"Configurações do Painel (JSON)",-1)),e("div",null,[z(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=l=>d.value.config=l),placeholder:"Configurações do Painel em JSON",rows:"15",onBlur:o},null,544),[[R,d.value.config]])])])]),e("div",zt,[e("div",Tt,[t[17]||(t[17]=e("label",{for:"painel-styles",class:"form-label"},"Estilos do Painel (JSON)",-1)),e("div",null,[z(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=l=>d.value.styles=l),rows:"15",placeholder:"Estilos do Painel em JSON",onBlur:o},null,544),[[R,d.value.styles]])])])])])]),e("div",It,[e("div",Bt,[e("div",Dt,[e("div",Ut,[t[18]||(t[18]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[z(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.description=l),placeholder:"Descrição do Painel",rows:"5"},null,512),[[R,s.value.description]])])])])])]),e("div",At,[e("div",Ft,[e("div",Lt,[e("div",Rt,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=w(l=>T(),["stop","prevent"])),title:"Fechar Editor do Painel"},[U(ve(pe),{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-primary",onMousedown:w(l=>!1,["stop","prevent"]),onClick:t[7]||(t[7]=w(l=>C(),["stop","prevent"])),title:"Adicionar Visão do Painel"},[U(ve(pe),{icon:"fa-solid fa-plus"})],32)])])])])])],32)]))}},Xt=ee(jt,[["__scopeId","data-v-4f12ebbd"]]),Yt=["id"],Ht={key:2,class:"painel-empty"},qt={class:"btn-group btn-group-sm",role:"group","aria-label":"Visões do Painel"},Gt=["onClick"],Kt={__name:"Painel",props:{painelId:{type:String,default:"0"}},setup(V){const W=Z("EventBus"),g=te(),h=ue(),y=_e(),_=he();g.registerModels("painelset",["painel","visaodepainel","widget","evento","individuo","cronometro"]);const s=V,a=M(!1),m=M(null),d=M(!1),k=M(null),o=M(null),E=M(Number(_.params.painelId)||0),p=M(Number(s.painelId)||E.value||0),T=P(()=>g.data_cache.painelset_painel?.[p.value]||null),C=P(()=>F.orderBy(F.filter(g.data_cache.painelset_visaodepainel,{painel:p.value})||[],["position"],["asc"])),r=P(()=>J.value===m.value.id||C.value.length===0);H(()=>a.value,u=>{if(S()&&(u&&(W.emit("painelset:editorarea:close",m.value.id),ie(()=>{J.value=m.value.id})),C.value.length===0)){J.value=m.value.id,a.value=!0;return}}),H(()=>s.painelId,u=>{u!==p.value&&(p.value=u,l())}),H(()=>p.value,u=>{u&&K(u)}),H(()=>C.value,u=>{if(u.length>0){if(!o.value||!u.find(N=>N.id===o.value)){const N=u.find(x=>x.active===!0);N?o.value=N.id:o.value=u[0].id}}else o.value=null}),W.on("painelset:editorarea:close",(u=null)=>{if(S()){if(C.value.length>0){J.value=null,a.value=!0;return}if(u&&u==="force"){a.value=!1,J.value=null;return}u&&m.value&&u===m.value.id||(J.value=null,a.value=!1)}});const t=()=>{h.isAuthenticated&&(d.value===!1?(d.value=!0,F.each(m.value.getElementsByClassName("painelset-widget"),u=>{u.classList.add("localize")}),k.value&&clearTimeout(k.value),k.value=setTimeout(()=>{d.value=!1,F.each(m.value.getElementsByClassName("painelset-widget"),u=>{u.classList.remove("localize")})},2e3)):(clearTimeout(k.value),k.value=setTimeout(()=>{d.value=!1,F.each(m.value.getElementsByClassName("painelset-widget"),u=>{u.classList.remove("localize")})},2e3)))},l=async()=>{p.value?g.fetchSync({app:"painelset",model:"painel",id:p.value}).then(u=>{u.data.sessao&&g.fetchSync({app:"sessao",model:"sessaoplenaria",id:u.data.sessao}),u.data.evento&&g.fetchSync({app:"painelset",model:"evento",id:u.data.evento}),K(p.value)}).catch(u=>{console.error("Error fetching painel:",u),y.push({name:"painelset_error_404",params:{pathMatch:"error"}})}):g.fetchSync({app:"painelset",model:"evento",params:{end_real__isnull:!0,start_real__isnull:!1}}).then(u=>{if(u&&u.data.results.length>0){const N=u.data.results[0];g.fetchSync({app:"painelset",model:"painel",params:{evento:N.id}}).then(x=>{if(x&&x.data.results.length>0){const i=x.data.results[0];p.value=i.id}else y.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(x=>{console.error("Error fetching painel for evento:",x),y.push({name:"painelset_error_404",params:{pathMatch:"error"}})})}else y.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(u=>{console.error("Error fetching evento:",u),y.push({name:"painelset_error_404",params:{pathMatch:"error"}})})},$=u=>{W.emit("painelset:editorarea:close"),ie(()=>{o.value=u})},S=()=>h.isAuthenticated?h.hasPermission("painelset.change_painel"):!1;me(()=>{l(),setTimeout(()=>{C.value.length===0&&(a.value=!0,J.value=m.value.id)},1e3)});const K=async u=>{g.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:u}}).then(N=>{if(N&&N.data.results.length>0){const x=N.data.results.find(i=>i.active===!0);x?o.value=x.id:o.value=N.data.results[0].id}})};return(u,N)=>(f(),b("div",{id:`id-painelset-painel-${p.value}`,ref_key:"painelsetPainel",ref:m,key:`painelset-painel-${p.value}`,class:"painelset-painel",style:G(T.value?.styles.component||{}),onMousemove:N[2]||(N[2]=x=>t())},[T.value?.config?.displayTitle?(f(),b("div",{key:0,class:"painel-titulo",style:G(T.value?.styles.title||{})},q(T.value?.name),5)):L("",!0),o.value?(f(),b("div",{key:1,class:"inner-painelset-painel",style:G(T.value?.styles.inner||{})},[(f(),Q(St,{key:`visaodepainel-${o.value.id}`,"painel-id":p.value,"visaodepainel-selected":o.value},null,8,["painel-id","visaodepainel-selected"]))],4)):(f(),b("div",Ht,[...N[3]||(N[3]=[e("p",null,"Não há visões de painel configuradas para este painel.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar a primeira visão do painel.",-1)])])),e("div",{class:"actions",onClick:N[0]||(N[0]=w(x=>a.value=!a.value,["stop","prevent"]))},[e("div",qt,[(f(!0),b(le,null,oe(C.value,(x,i)=>(f(),b("button",{key:`${x.id}_${i}`,class:ge([{active:x.id===o.value},"btn btn-primary"]),onClick:w(n=>$(x.id),["stop","prevent"])},q(x.position),11,Gt))),128))])]),a.value&&r.value?(f(),Q(de,{key:3,to:"#painelset-editorarea",disabled:!r.value},[U(Xt,{"painel-id":p.value,"painel-selected":p.value},null,8,["painel-id","painel-selected"])],8,["disabled"])):L("",!0),L("",!0)],44,Yt))}},ll=ee(Kt,[["__scopeId","data-v-bc5b6f48"]]);export{ll as default};
