import{v as M,y as q,c as P,_ as A,w as j,f as x,g as f,k as e,i as D,D as J,j as le,E as oe,G as ue,F as ee,r as te,t as H,H as U,I as w,q as I,C as Q,l as Y,J as X,K as ce,T as ie,n as re,L as Z,u as ne,M as ve,o as pe,N as fe}from"./vendor-Dip3oSWq.js";import{_ as G,u as K,a as se,R as F}from"./main-DBh7efuO.js";import{a as W}from"./teleportStore-BGjNhIeB.js";import{F as de}from"./vendor_fortawesome-C15cwA3p.js";const ge={class:"container"},me={class:"row py-2"},ye={class:"col-3 py-2"},he={class:"form-group"},_e={id:"div_id_display_title",class:"custom-control custom-checkbox"},we={key:0,class:"col-3"},be=["value"],$e={class:"col-6"},Se={class:"row py-2"},xe={class:"col-6"},Ee={id:"div_id_config",class:"form-group"},Me={class:"col-6"},Pe={id:"div_id_styles",class:"form-group"},ke={class:"container"},Ne={class:"row"},Ve={class:"col-12"},We={id:"div_id_description",class:"form-group"},Ce={class:"container actions pt-3"},Je={class:"row"},Oe={class:"col-12"},ze={class:"btn-group"},Te={__name:"WidgetEditor",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(k){const g=M(null),b=K(),$=se(),p=q("EventBus"),m=k,i=M({"":"Nenhum componente selecionado",WidgetSessaoPlenariaTitulo:"WidgetSessaoPlenariaTitulo - Título da Sessão Plenária vinculada ao Painel",WidgetCronometroEvento:"WidgetCronometroEvento - Cronômetro do Evento vinculado ao Painel",WidgetCronometroPalavra:"WidgetCronometroPalavra - Cronômetro da Palavra vinculada ao Painel"}),n=P(()=>b.data_cache.painelset_widget?.[m.widgetSelected]||null),E=P(()=>A.orderBy(A.filter(b.data_cache.painelset_widget,{parent:m.widgetSelected})||[],["position"],["asc"])),l=P(()=>!n.value||!n.value.config?"":JSON.stringify(n.value.config,null,2)),u=P(()=>!n.value||!n.value.styles?"":JSON.stringify({component:n.value.styles.component||{},title:n.value.styles.title||{},inner:n.value.styles.inner||{}},null,2)),y=M({config:l.value,styles:u.value}),h=t=>{p.emit("painelset:editorarea:close"),p.emit("painelset:editorarea:resize",0)},C=()=>{if(n.value)try{const t=JSON.parse(y.value.config),r=JSON.parse(y.value.styles);n.value.styles=r,n.value.config=t,y.value.config=JSON.stringify(t,null,2),y.value.styles=JSON.stringify(r,null,2),_({config:t,styles:r})}catch(t){$.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${t.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",t),y.value.config=l.value,y.value.styles=u.value}},O=t=>{console.log("WidgetEditor.vue: changeForm event:",t);const r={...n.value};delete r.id,i.value[r.vue_component]===void 0&&(r.vue_component=""),["styles","config"].includes(t.target.name)||_(r)},_=async t=>{try{await F.Utils.patchModel({app:"painelset",model:"widget",id:n.value.id,form:t}),$.addMessage({type:"info",text:"Widget atualizado.",timeout:2e3}),console.log("WidgetEditor.vue: patchModel updated successfully.")}catch(r){$.addMessage({type:"danger",text:"Erro ao salvar as alterações do Widget.",timeout:5e3}),console.error("Erro ao salvar as alterações do Widget:",r)}};j(()=>n.value,t=>{t&&(y.value.config=l.value,y.value.styles=u.value)});const s=t=>{n.value&&confirm(`Confirma a exclusão do Widget: ${n.value.name} ?`)&&F.Utils.deleteModel({app:"painelset",model:"widget",id:n.value.id}).then(()=>{console.log("Widget deleted successfully"),p.emit("painelset:editorarea:close","force")}).catch(r=>{console.error("Error deleting widget:",r)})};return(t,r)=>{const S=Q("FontAwesomeIcon");return f(),x("div",{ref_key:"painelsetWidgetEditor",ref:g,key:`painelset-widget-editor-${n.value?.id}`,class:"painelset-widget-editor"},[e("form",{action:"",onChange:r[8]||(r[8]=d=>O(d))},[e("fieldset",null,[r[18]||(r[18]=e("legend",null,"Configurações do Widget",-1)),e("div",ge,[e("div",me,[e("div",ye,[e("div",he,[e("div",_e,[J(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":r[0]||(r[0]=d=>n.value.config.displayTitle=d),id:"id_display_title"},null,512),[[oe,n.value.config.displayTitle]]),r[9]||(r[9]=le("  ",-1)),r[10]||(r[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do widget? ",-1)),r[11]||(r[11]=e("br",null,null,-1)),r[12]||(r[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),E.value.length===0?(f(),x("div",we,[r[13]||(r[13]=e("label",{for:"widget-vue-component",class:"form-label"},"Componente Vue",-1)),J(e("select",{class:"form-select","onUpdate:modelValue":r[1]||(r[1]=d=>n.value.vue_component=d),id:"widget-vue-component"},[(f(!0),x(ee,null,te(i.value,(d,o)=>(f(),x("option",{key:`widget-vue-component-option-${o}`,value:o},H(d),9,be))),128))],512),[[ue,n.value.vue_component]])])):D("",!0),e("div",$e,[r[14]||(r[14]=e("label",{for:"widget-name",class:"form-label"},"Título do Widget",-1)),J(e("input",{type:"text",class:"form-control","onUpdate:modelValue":r[2]||(r[2]=d=>n.value.name=d),placeholder:"Título do Widget"},null,512),[[U,n.value.name]])])]),e("div",Se,[e("div",xe,[e("div",Ee,[r[15]||(r[15]=e("label",{for:"widget-config",class:"form-label"},"Configurações do Widget (JSON)",-1)),e("div",null,[J(e("textarea",{id:"widget-config",name:"config",class:"form-control","onUpdate:modelValue":r[3]||(r[3]=d=>y.value.config=d),placeholder:"Configurações do Widget em JSON",rows:"15",onBlur:C},null,544),[[U,y.value.config]])])])]),e("div",Me,[e("div",Pe,[r[16]||(r[16]=e("label",{for:"widget-styles",class:"form-label"},"Estilos do Widget (JSON)",-1)),e("div",null,[J(e("textarea",{name:"styles",id:"widget-styles",class:"form-control","onUpdate:modelValue":r[4]||(r[4]=d=>y.value.styles=d),rows:"15",placeholder:"Estilos do Widget em JSON",onBlur:C},null,544),[[U,y.value.styles]])])])])])]),e("div",ke,[e("div",Ne,[e("div",Ve,[e("div",We,[r[17]||(r[17]=e("label",{for:"id_description",class:"form-label"},"Descrição do Widget",-1)),e("div",null,[J(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":r[5]||(r[5]=d=>n.value.description=d),placeholder:"Descrição do Widget",rows:"5"},null,512),[[U,n.value.description]])])])])])]),e("div",Ce,[e("div",Je,[e("div",Oe,[e("div",ze,[e("button",{class:"btn btn-secondary",onClick:r[6]||(r[6]=w(d=>h(),["stop","prevent"])),title:"Fechar Editor de Widget"},[I(S,{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-danger",onMousedown:w(d=>!1,["stop","prevent"]),onClick:r[7]||(r[7]=w(d=>s(),["stop","prevent"]))},[I(S,{icon:"fa-solid fa-trash-can"})],32)])])])])])],32)])}}},Be=G(Te,[["__scopeId","data-v-0afee643"]]),Ie=["id"],De={key:2,class:"inner-widget inner-children"},Ue={key:3,class:"manager"},Ae={class:"position"},Fe={class:"toolbar"},Le={class:"btn-group"},Re={class:"btn-group right"},je={__name:"Widget",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(k){const g=K(),b=q("EventBus"),$=k,p=M(!1),m=M(null),i=M(!1),n=M({x:0,y:0,w:100,h:100,mouseResizeEnter:!1}),E=P(()=>m.value&&W.value===m.value.id),l=P(()=>g.data_cache.painelset_widget?.[$.widgetSelected]||null),u=P(()=>{if(!l.value||!l.value.config?.coords)return{};const o={},a=l.value.config.coords;return a.x!==void 0&&(o.left=`${a.x}%`),a.y!==void 0&&(o.top=`${a.y}%`),a.w!==void 0&&(o.right=`${a.w+a.x>100?0:100-(a.w+a.x)}%`),a.h!==void 0&&(o.bottom=`${a.h+a.y>100?0:100-(a.h+a.y)}%`),o}),y=P(()=>A.orderBy(A.filter(g.data_cache.painelset_widget,{parent:$.widgetSelected})||[],["position"],["asc"]));(async()=>{g.fetchSync({app:"painelset",model:"widget",filters:{parent:$.widgetSelected}}).then(o=>{o&&o.data.results.length>0})})(),b.on("painelset:editorarea:close",(o=null)=>{if(o&&o==="force"){p.value=!1,i.value=!1,W.value=null;return}o&&m.value&&o===m.value.id||p.value||(p.value=!1,i.value=!1,W.value=null)}),j(()=>i.value,o=>{o?(b.emit("painelset:editorarea:close",m.value.id),Z(()=>{W.value=m.value.id})):W.value=null});const C=()=>{console.debug("Opening widget editor modal for widget:",l.value),i.value=!i.value},O=()=>{l.value&&confirm(`Confirma a exclusão do Widget: ${l.value.name} e todos seus SubWidgets?`)&&F.Utils.deleteModel({app:"painelset",model:"widget",id:l.value.id}).then(()=>{console.log("Widget deleted successfully")}).catch(o=>{console.error("Error deleting widget:",o)})},_=()=>{if(!l.value)return;const o={...l.value.config,coords:{...l.value.config.coords,x:10,y:10}},a={...l.value,id:void 0,name:`${l.value.name} (Cópia)`,position:y.value.length+1,config:o};F.Utils.createModel({app:"painelset",model:"widget",form:a}).then(V=>{console.log("Widget duplicated successfully:",V.data)}).catch(V=>{console.error("Error duplicating widget:",V)})},s=()=>{if(!l.value)return;const o={name:"Novo Widget",parent:l.value.id,visao:l.value.visao,position:y.value.length+1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30},displayTitle:!0},styles:{component:{},title:{},inner:{}}};F.Utils.createModel({app:"painelset",model:"widget",form:o}).then(a=>{console.log("Default child widget created successfully:",a.data)}).catch(a=>{console.error("Error creating default child widget:",a)})},t=o=>!o||o.x===void 0||o.y===void 0||o.w===void 0||o.h===void 0||o.x===null||o.y===null||o.w===null||o.h===null?!1:o.w>5&&o.w<=100&&o.h>5&&o.h<=100&&o.x>=0&&o.x<=100&&o.y>=0&&o.y<=100&&o.x+o.w<=100&&o.y+o.h<=100,r=o=>{if(!t(o)){console.error("Invalid widget coordinates, aborting update");return}F.Utils.patchModel({app:"painelset",model:"widget",id:l.value.id,form:{config:{...l.value.config,coords:{...l.value.config.coords,x:o.x,y:o.y,w:o.w,h:o.h}}}}).then(a=>{console.log(a.data),console.log("Widget coordinates updated successfully")}).catch(a=>{console.error("Error updating widget coordinates:",a)})},S=o=>{o.preventDefault(),!n.value.mouseResizeEnter&&(p.value=!p.value,p.value||(i.value=!1),console.log("Activating painel editor teleport for Widget:",$.widgetSelected),b.emit("painelset:editorarea:close",m.value.id))},d=(o,a)=>{if(n.value.mouseResizeEnter=!0,o.preventDefault(),!p.value)return;const V=m.value,N=V.getBoundingClientRect(),v=V.parentElement.getBoundingClientRect(),c={...n.value};console.log("Mouse move detected:",o.clientX,o.clientY,N);const ae=z=>{let T=0,B=0;if(a==="top-left"){const L=z.clientX-N.left,R=z.clientY-N.top;T=Math.round(L/v.width*100),B=Math.round(R/v.height*100),c.w=l.value.config.coords.w-T,c.h=l.value.config.coords.h-B,c.x=l.value.config.coords.x+T,c.y=l.value.config.coords.y+B}else if(a==="top-right"){const L=z.clientX-N.right,R=z.clientY-N.top;T=Math.round(L/v.width*100),B=Math.round(R/v.height*100),c.w=l.value.config.coords.w+T,c.h=l.value.config.coords.h-B,c.x=l.value.config.coords.x,c.y=l.value.config.coords.y+B}else if(a==="bottom-right"){const L=z.clientX-N.right,R=z.clientY-N.bottom;T=Math.round(L/v.width*100),B=Math.round(R/v.height*100),c.w=l.value.config.coords.w+T,c.h=l.value.config.coords.h+B,c.x=l.value.config.coords.x,c.y=l.value.config.coords.y}else if(a==="bottom-left"){const L=z.clientX-N.left,R=z.clientY-N.bottom;T=Math.round(L/v.width*100),B=Math.round(R/v.height*100),c.w=l.value.config.coords.w-T,c.h=l.value.config.coords.h+B,c.x=l.value.config.coords.x+T,c.y=l.value.config.coords.y}else if(a==="center-center"){const L=z.clientX-N.left-N.width/2,R=z.clientY-N.top-N.height/2;T=Math.round(L/v.width*100),B=Math.round(R/v.height*100),console.debug("Resizing widget...",L,R,a,T,B,c),c.w=l.value.config.coords.w,c.h=l.value.config.coords.h,c.x=l.value.config.coords.x+T,c.y=l.value.config.coords.y+B}console.debug("Resizing widget...",z.clientX,z.clientY,a,T,B,c),t(c)?(n.value.w=c.w,n.value.h=c.h,n.value.x=c.x,n.value.y=c.y,V.style.right=`${100-(c.w+c.x)}%`,V.style.bottom=`${100-(c.h+c.y)}%`,V.style.left=`${c.x}%`,V.style.top=`${c.y}%`):console.warn("Invalid coordinates during resize, ignoring update")};console.log("Starting resize operation"),window.addEventListener("mousemove",ae),window.addEventListener("mouseup",z=>{window.removeEventListener("mouseup",this),window.removeEventListener("mousemove",ae),z.preventDefault(),n.value.mouseResizeEnter&&(n.value.mouseResizeEnter=!1,r({x:n.value.x,y:n.value.y,w:n.value.w,h:n.value.h}),console.log("Resize operation ended"))})};return(o,a)=>{const V=Q("Widget",!0),N=Q("FontAwesomeIcon");return f(),x("div",{id:`id-painelset-widget-${l.value?.id}`,ref_key:"painelsetWidget",ref:m,key:`painelset-widget-${l.value?.id}`,class:re(["painelset-widget",p.value?"editmode":""]),style:X({...l.value?.styles.component||{},...u.value}),onMousedown:a[9]||(a[9]=w(v=>S(v),["stop","prevent"])),onClick:w(v=>!1,["stop","prevent"])},[l.value?.config?.displayTitle?(f(),x("div",{key:0,class:"widget-titulo",style:X(l.value?.styles.title||{})},H(l.value?.name),5)):D("",!0),l.value?.vue_component?(f(),x("div",{key:1,class:"inner-widget",style:X(l.value?.styles.inner||{})},[(f(),Y(ce(l.value?.vue_component),{"painel-id":k.painelId,"widget-selected":l.value?.id},null,8,["painel-id","widget-selected"]))],4)):D("",!0),l.value?.vue_component?D("",!0):(f(),x("div",De,[(f(!0),x(ee,null,te(y.value,(v,c)=>(f(),Y(V,{key:`widget-${v.id}-${c}`,"painel-id":k.painelId,"widget-selected":v.id},null,8,["painel-id","widget-selected"]))),128))])),p.value?(f(),x("div",Ue,[e("div",Ae,H(l.value?.position),1),e("div",Fe,[e("div",Le,[e("button",{class:"btn btn-sm btn-danger",onMousedown:w(v=>!1,["stop","prevent"]),onClick:a[0]||(a[0]=w(v=>O(),["stop","prevent"]))},[I(N,{icon:"fa-solid fa-trash-can"})],32),e("button",{class:"btn btn-sm btn-secondary",onMousedown:w(v=>!1,["stop","prevent"]),onClick:a[1]||(a[1]=w(v=>_(),["stop","prevent"]))},[I(N,{icon:"fa-solid fa-clone"})],32),e("button",{class:"btn btn-sm btn-primary",onMousedown:w(v=>!1,["stop","prevent"]),onClick:a[2]||(a[2]=w(v=>s(),["stop","prevent"]))},[I(N,{icon:"fa-solid fa-plus"})],32)]),e("div",Re,[e("button",{class:"btn btn-sm btn-dark",onMousedown:w(v=>!1,["stop","prevent"]),onClick:a[3]||(a[3]=w(v=>C(),["stop","prevent"]))},[I(N,{icon:"fa-solid fa-pen-to-square"})],32)])]),e("div",{class:"resize-handle top-left",onMousedown:a[4]||(a[4]=v=>d(v,"top-left"))},null,32),e("div",{class:"resize-handle top-right",onMousedown:a[5]||(a[5]=v=>d(v,"top-right"))},null,32),e("div",{class:"resize-handle bottom-left",onMousedown:a[6]||(a[6]=v=>d(v,"bottom-left"))},null,32),e("div",{class:"resize-handle bottom-right",onMousedown:a[7]||(a[7]=v=>d(v,"bottom-right"))},null,32),e("div",{class:"resize-handle center-center",onMousedown:a[8]||(a[8]=v=>d(v,"center-center"))},null,32)])):D("",!0),i.value&&E.value?(f(),Y(ie,{key:4,to:"#painelset-editorarea",disabled:!E.value},[I(Be,{"painel-id":k.painelId,"widget-selected":l.value?.id},null,8,["painel-id","widget-selected"])],8,["disabled"])):D("",!0)],46,Ie)}}},Xe=G(je,[["__scopeId","data-v-0c62d3fe"]]),Ye={class:"container"},He={class:"row py-2"},qe={class:"col-3 py-2"},Ge={class:"form-group"},Ke={id:"div_id_display_title",class:"custom-control custom-checkbox"},Qe={class:"col-6"},Ze={class:"row py-2"},et={class:"col-6"},tt={id:"div_id_config",class:"form-group"},lt={class:"col-6"},ot={id:"div_id_styles",class:"form-group"},it={class:"container"},st={class:"row"},at={class:"col-12"},nt={id:"div_id_description",class:"form-group"},dt={class:"container actions pt-3"},rt={class:"row"},ut={class:"col-12 d-flex gap-2"},ct={class:"btn-group"},vt={class:"btn-group"},pt={__name:"VisaoEditor",props:{painelId:{type:Number,default:0},visaoSelected:{type:Number,default:0}},setup(k){const g=q("EventBus"),b=M(null),$=K(),p=se(),m=k,i=P(()=>$.data_cache.painelset_visaodepainel?.[m.visaoSelected]||null),n=P(()=>!i.value||!i.value.config?"":JSON.stringify(i.value.config,null,2)),E=P(()=>!i.value||!i.value.styles?"":JSON.stringify({component:i.value.styles.component||{},title:i.value.styles.title||{},inner:i.value.styles.inner||{}},null,2)),l=M({config:n.value,styles:E.value}),u=()=>{if(i.value)try{const s=JSON.parse(l.value.config),t=JSON.parse(l.value.styles);i.value.styles=t,i.value.config=s,l.value.config=JSON.stringify(s,null,2),l.value.styles=JSON.stringify(t,null,2),h({config:s,styles:t})}catch(s){p.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${s.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",s),l.value.config=n.value,l.value.styles=E.value}},y=s=>{console.log("VisaoEditor.vue: changeForm event:",s);const t={...i.value};delete t.id,["styles","config"].includes(s.target.name)||h(t)},h=async s=>{try{await F.Utils.patchModel({app:"painelset",model:"visaodepainel",id:i.value.id,form:s}),p.addMessage({type:"info",text:"Visão do Painel atualizado.",timeout:2e3}),console.log("VisaoEditor.vue: patchModel updated successfully.")}catch(t){p.addMessage({type:"danger",text:"Erro ao salvar as alterações do Visão do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Visão do Painel:",t)}};j(()=>i.value,s=>{s&&(l.value.config=n.value,l.value.styles=E.value)});const C=s=>{g.emit("painelset:editorarea:close"),g.emit("painelset:editorarea:resize",0)},O=()=>{i.value&&confirm(`Confirma a exclusão da Visão do Painel: ${i.value.name} ?`)&&F.Utils.deleteModel({app:"painelset",model:"visaodepainel",id:i.value.id}).then(()=>{p.addMessage({type:"info",text:"Visão do Painel excluído com sucesso.",timeout:5e3}),g.emit("painelset:editorarea:close","force")}).catch(s=>{p.addMessage({type:"danger",text:"Erro ao excluir a Visão do Painel.",timeout:5e3}),console.error("Error deleting visaodepainel:",s)})},_=()=>{if(!i.value)return;const s={name:"Novo Widget",parent:null,visao:i.value.id,position:$.data_cache.painelset_widget?Object.values($.data_cache.painelset_widget).filter(t=>t.visao===i.value.id).length+1:1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30},displayTitle:!0},styles:{component:{},title:{},inner:{}}};F.Utils.createModel({app:"painelset",model:"widget",form:s}).then(t=>{console.log("Default child widget created successfully:",t.data)}).catch(t=>{console.error("Error creating default child widget:",t)})};return(s,t)=>{const r=Q("FontAwesomeIcon");return f(),x("div",{ref_key:"painelsetVisaoEditor",ref:b,key:`painelset-visaodepainel-editor-${i.value?.id}`,class:"painelset-visaodepainel-editor"},[e("form",{action:"",onChange:t[8]||(t[8]=S=>y(S))},[e("fieldset",null,[t[17]||(t[17]=e("legend",null,"Configurações da Visão do Painel",-1)),e("div",Ye,[e("div",He,[e("div",qe,[e("div",Ge,[e("div",Ke,[J(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":t[0]||(t[0]=S=>i.value.config.displayTitle=S),id:"id_display_title"},null,512),[[oe,i.value.config.displayTitle]]),t[9]||(t[9]=le("  ",-1)),t[10]||(t[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do painel? ",-1)),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),e("div",Qe,[t[13]||(t[13]=e("label",{for:"painel-name",class:"form-label"},"Título da Visão do Painel",-1)),J(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=S=>i.value.name=S),placeholder:"Título da Visão do Painel"},null,512),[[U,i.value.name]])])]),e("div",Ze,[e("div",et,[e("div",tt,[t[14]||(t[14]=e("label",{for:"painel-config",class:"form-label"},"Configurações da Visão do Painel (JSON)",-1)),e("div",null,[J(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=S=>l.value.config=S),placeholder:"Configurações da Visão do Painel em JSON",rows:"15",onBlur:u},null,544),[[U,l.value.config]])])])]),e("div",lt,[e("div",ot,[t[15]||(t[15]=e("label",{for:"painel-styles",class:"form-label"},"Estilos da Visão do Painel (JSON)",-1)),e("div",null,[J(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=S=>l.value.styles=S),rows:"15",placeholder:"Estilos da Visão do Painel em JSON",onBlur:u},null,544),[[U,l.value.styles]])])])])])]),e("div",it,[e("div",st,[e("div",at,[e("div",nt,[t[16]||(t[16]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[J(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=S=>i.value.description=S),placeholder:"Descrição do Painel",rows:"5"},null,512),[[U,i.value.description]])])])])])]),e("div",dt,[e("div",rt,[e("div",ut,[e("div",ct,[e("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=w(S=>C(),["stop","prevent"])),title:"Fechar Editor da Visão do Painel"},[I(r,{icon:["fas","times"]})]),e("button",{class:"btn btn-danger",onMousedown:w(S=>!1,["stop","prevent"]),onClick:t[6]||(t[6]=w(S=>O(),["stop","prevent"])),title:"Excluir Visão do Painel"},[I(r,{icon:"fa-solid fa-trash-can"})],32)]),e("div",vt,[e("button",{class:"btn btn-primary",onMousedown:w(S=>!1,["stop","prevent"]),onClick:t[7]||(t[7]=w(S=>_(),["stop","prevent"])),title:"Adicionar Widget à Visão do Painel"},[I(r,{icon:"fa-solid fa-plus"})],32)])])])])])],32)])}}},ft=G(pt,[["__scopeId","data-v-4cabdb3f"]]),gt=["id"],mt={key:1,class:"visao-empty"},yt={__name:"VisaoDePainel",props:{painelId:{type:Number,default:0},visaodepainelSelected:{type:Number,default:0}},setup(k){const g=K(),b=k,$=q("EventBus"),p=M(!1),m=M(null),i=P(()=>W.value===m.value.id);$.on("painelset:editorarea:close",(u=null)=>{if(u&&u==="force"){p.value=!1,W.value=null;return}u&&m.value&&u===m.value.id||(W.value=null,p.value=!1)}),j(()=>p.value,u=>{u?($.emit("painelset:editorarea:close",m.value.id),Z(()=>{W.value=m.value.id})):W.value=null});const n=P(()=>g.data_cache.painelset_visaodepainel?.[b.visaodepainelSelected]||null),E=P(()=>A.orderBy(A.filter(g.data_cache.painelset_widget,{visao:b.visaodepainelSelected,parent:null})||[],["position"],["asc"]));return(async()=>{g.fetchSync({app:"painelset",model:"widget",filters:{visaodepainel:b.visaodepainelSelected}}).then(u=>{u&&u.data.results.length>0})})(),(u,y)=>(f(),x("div",{id:`id-painelset-visaodepainel${k.visaodepainelSelected}`,ref_key:"painelsetVisaodepainel",ref:m,key:`painelset-visaodepainel${k.visaodepainelSelected}`,class:"painelset-visaodepainel",style:X(n.value?.styles.component||{}),onClick:y[0]||(y[0]=w(h=>p.value=!p.value,["stop"]))},[n.value?.config?.displayTitle?(f(),x("div",{key:0,class:"visaodepainel-titulo",style:X(n.value?.styles.title||{})},H(n.value?.name),5)):D("",!0),e("div",{class:"inner-visaodepainel",style:X(n.value?.styles.inner||{})},[(f(!0),x(ee,null,te(E.value,(h,C)=>(f(),Y(Xe,{key:`widget-${h.id}-${C}`,"painel-id":k.painelId,"widget-selected":h.id},null,8,["painel-id","widget-selected"]))),128))],4),E.value.length===0?(f(),x("div",mt,[...y[1]||(y[1]=[e("p",null,"Não há widgets configurados para esta visão.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar o primeiro widget à visão.",-1)])])):D("",!0),p.value&&i.value?(f(),Y(ie,{key:2,to:"#painelset-editorarea",disabled:!i.value},[I(ft,{"painel-id":k.painelId,"visao-selected":k.visaodepainelSelected},null,8,["painel-id","visao-selected"])],8,["disabled"])):D("",!0)],12,gt))}},ht=G(yt,[["__scopeId","data-v-e98dbd71"]]),_t={class:"container"},wt={class:"row py-2"},bt={class:"col-3 py-2"},$t={class:"form-group"},St={id:"div_id_display_title",class:"custom-control custom-checkbox"},xt={class:"col-6"},Et={class:"row py-2"},Mt={class:"col-6"},Pt={id:"div_id_config",class:"form-group"},kt={class:"col-6"},Nt={id:"div_id_styles",class:"form-group"},Vt={class:"container"},Wt={class:"row"},Ct={class:"col-12"},Jt={id:"div_id_description",class:"form-group"},Ot={class:"container actions pt-3"},zt={class:"row"},Tt={class:"col-12"},Bt={class:"btn-group"},It={__name:"PainelEditor",props:{painelId:{type:Number,default:0},painelSelected:{type:Number,default:0}},setup(k){const g=M(null),b=K(),$=se(),p=q("EventBus"),m=k,i=P(()=>b.data_cache.painelset_painel?.[m.painelSelected]||null),n=P(()=>!i.value||!i.value.config?"":JSON.stringify(i.value.config,null,2)),E=P(()=>!i.value||!i.value.styles?"":JSON.stringify({component:i.value.styles.component||{},title:i.value.styles.title||{},inner:i.value.styles.inner||{}},null,2)),l=M({config:n.value,styles:E.value}),u=()=>{if(i.value)try{const _=JSON.parse(l.value.config),s=JSON.parse(l.value.styles);i.value.styles=s,i.value.config=_,l.value.config=JSON.stringify(_,null,2),l.value.styles=JSON.stringify(s,null,2),h({config:_,styles:s})}catch(_){$.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${_.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",_),l.value.config=n.value,l.value.styles=E.value}},y=_=>{console.log("PainelEditor.vue: changeForm event:",_);const s={...i.value};delete s.id,["styles","config"].includes(_.target.name)||h(s)},h=async _=>{try{await F.Utils.patchModel({app:"painelset",model:"painel",id:i.value.id,form:_}),$.addMessage({type:"info",text:"Painel atualizado.",timeout:2e3}),console.log("PainelEditor.vue: patchModel updated successfully.")}catch(s){$.addMessage({type:"danger",text:"Erro ao salvar as alterações do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Painel:",s)}};j(()=>i.value,_=>{_&&(l.value.config=n.value,l.value.styles=E.value)});const C=_=>{p.emit("painelset:editorarea:close"),p.emit("painelset:editorarea:resize",0)},O=_=>{if(!i.value)return;const s={painel:i.value.id,name:"Nova Visão do Painel",description:"",position:b.data_cache.painelset_visaodepainel?Object.values(b.data_cache.painelset_visaodepainel).filter(t=>t.painel===i.value.id).length+1:1,active:!0,config:{displayTitle:!0},styles:{}};F.Utils.createModel({app:"painelset",model:"visaodepainel",form:s}).then(t=>{$.addMessage({type:"info",text:"Visão do Painel criada com sucesso.",timeout:2e3}),b.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:i.value.id}})}).catch(t=>{$.addMessage({type:"danger",text:"Erro ao criar a Visão do Painel.",timeout:5e3}),console.error("Erro ao criar a Visão do Painel:",t)})};return(_,s)=>(f(),x("div",{ref_key:"painelsetPainelEditor",ref:g,key:`painelset-painel-editor-${i.value?.id}`,class:"painelset-painel-editor"},[e("form",{action:"",onChange:s[7]||(s[7]=t=>y(t))},[e("fieldset",null,[s[16]||(s[16]=e("legend",null,"Configurações do Painel",-1)),e("div",_t,[e("div",wt,[e("div",bt,[e("div",$t,[e("div",St,[J(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":s[0]||(s[0]=t=>i.value.config.displayTitle=t),id:"id_display_title"},null,512),[[oe,i.value.config.displayTitle]]),s[8]||(s[8]=le("  ",-1)),s[9]||(s[9]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do painel? ",-1)),s[10]||(s[10]=e("br",null,null,-1)),s[11]||(s[11]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),e("div",xt,[s[12]||(s[12]=e("label",{for:"painel-name",class:"form-label"},"Título do Painel",-1)),J(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=t=>i.value.name=t),placeholder:"Título do Painel"},null,512),[[U,i.value.name]])])]),e("div",Et,[e("div",Mt,[e("div",Pt,[s[13]||(s[13]=e("label",{for:"painel-config",class:"form-label"},"Configurações do Painel (JSON)",-1)),e("div",null,[J(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=t=>l.value.config=t),placeholder:"Configurações do Painel em JSON",rows:"15",onBlur:u},null,544),[[U,l.value.config]])])])]),e("div",kt,[e("div",Nt,[s[14]||(s[14]=e("label",{for:"painel-styles",class:"form-label"},"Estilos do Painel (JSON)",-1)),e("div",null,[J(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=t=>l.value.styles=t),rows:"15",placeholder:"Estilos do Painel em JSON",onBlur:u},null,544),[[U,l.value.styles]])])])])])]),e("div",Vt,[e("div",Wt,[e("div",Ct,[e("div",Jt,[s[15]||(s[15]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[J(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=t=>i.value.description=t),placeholder:"Descrição do Painel",rows:"5"},null,512),[[U,i.value.description]])])])])])]),e("div",Ot,[e("div",zt,[e("div",Tt,[e("div",Bt,[e("button",{class:"btn btn-secondary",onClick:s[5]||(s[5]=w(t=>C(),["stop","prevent"])),title:"Fechar Editor do Painel"},[I(ne(de),{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-primary",onMousedown:w(t=>!1,["stop","prevent"]),onClick:s[6]||(s[6]=w(t=>O(),["stop","prevent"])),title:"Adicionar Visão do Painel"},[I(ne(de),{icon:"fa-solid fa-plus"})],32)])])])])])],32)]))}},Dt=G(It,[["__scopeId","data-v-1791769d"]]),Ut=["id"],At={key:2,class:"painel-empty"},Ft={class:"btn-group btn-group-sm",role:"group","aria-label":"Visões do Painel"},Lt=["onClick"],Rt={__name:"Painel",props:{painelId:{type:String,default:"0"}},setup(k){const g=K(),b=fe(),$=ve();g.registerModels("painelset",["painel","visaodepainel","widget","evento","individuo","cronometro"]),g.registerModels("sessao",["sessaoplenaria"]),g.registerModels("materia",["materialegislativa"]);const p=k,m=q("EventBus"),i=M(!1),n=M(null),E=M(!1),l=M(null),u=M(null),y=M(Number($.params.painelId)||0),h=M(Number(p.painelId)||y.value||0),C=P(()=>g.data_cache.painelset_painel?.[h.value]||null),O=P(()=>A.orderBy(A.filter(g.data_cache.painelset_visaodepainel,{painel:h.value})||[],["position"],["asc"])),_=P(()=>W.value===n.value.id||O.value.length===0);m.on("painelset:editorarea:close",(d=null)=>{if(O.value.length>0){W.value=null,i.value=!0;return}if(d&&d==="force"){i.value=!1,W.value=null;return}d&&n.value&&d===n.value.id||(W.value=null,i.value=!1)}),j(()=>i.value,d=>{if(d&&(m.emit("painelset:editorarea:close",n.value.id),Z(()=>{W.value=n.value.id})),O.value.length===0){W.value=n.value.id,i.value=!0;return}}),j(()=>p.painelId,d=>{d!==h.value&&(h.value=d,r())}),j(()=>h.value,d=>{d&&t(d)}),j(()=>O.value,d=>{if(d.length>0){if(!u.value||!d.find(o=>o.id===u.value)){const o=d.find(a=>a.active===!0);o?u.value=o.id:u.value=d[0].id}}else u.value=null});const s=d=>{E.value===!1?(E.value=!0,A.each(n.value.getElementsByClassName("painelset-widget"),o=>{o.classList.add("localize")}),l.value&&clearTimeout(l.value),l.value=setTimeout(()=>{E.value=!1,A.each(n.value.getElementsByClassName("painelset-widget"),o=>{o.classList.remove("localize")})},2e3)):(clearTimeout(l.value),l.value=setTimeout(()=>{E.value=!1,A.each(n.value.getElementsByClassName("painelset-widget"),o=>{o.classList.remove("localize")})},2e3))},t=async d=>{g.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:d}}).then(o=>{if(o&&o.data.results.length>0){const a=o.data.results.find(V=>V.active===!0);a?u.value=a.id:u.value=o.data.results[0].id}})},r=async()=>{h.value?g.fetchSync({app:"painelset",model:"painel",id:h.value}).then(d=>{d.data.sessao&&g.fetchSync({app:"sessao",model:"sessaoplenaria",id:d.data.sessao}),d.data.evento&&g.fetchSync({app:"painelset",model:"evento",id:d.data.evento}),t(h.value)}).catch(d=>{console.error("Error fetching painel:",d),b.push({name:"painelset_error_404",params:{pathMatch:"error"}})}):g.fetchSync({app:"painelset",model:"evento",params:{end_real__isnull:!0,start_real__isnull:!1}}).then(d=>{if(d&&d.data.results.length>0){const o=d.data.results[0];g.fetchSync({app:"painelset",model:"painel",params:{evento:o.id}}).then(a=>{if(a&&a.data.results.length>0){const V=a.data.results[0];h.value=V.id}else b.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(a=>{console.error("Error fetching painel for evento:",a),b.push({name:"painelset_error_404",params:{pathMatch:"error"}})})}else b.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(d=>{console.error("Error fetching evento:",d),b.push({name:"painelset_error_404",params:{pathMatch:"error"}})})},S=d=>{m.emit("painelset:editorarea:close"),Z(()=>{u.value=d})};return pe(()=>{r(),setTimeout(()=>{O.value.length===0&&(i.value=!0,W.value=n.value.id)},1e3)}),(d,o)=>(f(),x("div",{id:`id-painelset-painel-${h.value}`,ref_key:"painelsetPainel",ref:n,key:`painelset-painel-${h.value}`,class:"painelset-painel",style:X(C.value?.styles.component||{}),onMousemove:o[2]||(o[2]=a=>s())},[C.value?.config?.displayTitle?(f(),x("div",{key:0,class:"painel-titulo",style:X(C.value?.styles.title||{})},H(C.value?.name),5)):D("",!0),u.value?(f(),x("div",{key:1,class:"inner-painelset-painel",style:X(C.value?.styles.inner||{})},[(f(),Y(ht,{key:`visaodepainel-${u.value.id}`,"painel-id":h.value,"visaodepainel-selected":u.value},null,8,["painel-id","visaodepainel-selected"]))],4)):(f(),x("div",At,[...o[3]||(o[3]=[e("p",null,"Não há visões de painel configuradas para este painel.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar a primeira visão do painel.",-1)])])),e("div",{class:"actions",onClick:o[0]||(o[0]=w(a=>i.value=!i.value,["stop"]))},[e("div",Ft,[(f(!0),x(ee,null,te(O.value,(a,V)=>(f(),x("button",{key:`${a.id}_${V}`,class:re([{active:a.id===u.value},"btn btn-primary"]),onClick:w(N=>S(a.id),["stop","prevent"])},H(a.position),11,Lt))),128))])]),i.value&&_.value?(f(),Y(ie,{key:3,to:"#painelset-editorarea",disabled:!_.value},[I(Dt,{"painel-id":h.value,"painel-selected":h.value},null,8,["painel-id","painel-selected"])],8,["disabled"])):D("",!0),D("",!0)],44,Ut))}},qt=G(Rt,[["__scopeId","data-v-c88c2f9f"]]);export{qt as default};
