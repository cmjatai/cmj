import{C as F,z as L,c as k,w as P,A as D,f as r,g as i,k as e,l as T,i as x,t as S,j as E,F as j,r as w,q as O,n as A,B as z,T as G,u as I,o as N,G as q,J as Y,K as J,L as K,M as Q,N as W}from"./vendor-Dq9xiLvp.js";import{b as V,u as B,a as U,R as M,_ as X}from"./main-DBRHJ7rR.js";import{_ as Z}from"./NormaSimpleModalView-BDw390zC.js";import"./vendor_fortawesome-D0qyeiI4.js";const ee=["id"],te={class:"inner-materia"},ae={class:"epigrafe"},oe=["href"],se={class:"protocolo-data-autoria"},ie={class:"protocolo-data"},ne={class:"protocolo"},le={class:"data"},re={class:"autoria"},de={class:"link-file"},ce=["href"],ue=["innerHTML"],me={class:"tramitacao"},ve={class:"status"},_e={class:"ultima-acao"},pe=["innerHTML"],be={key:1,class:"documentos-acessorios pt-2"},ge={class:"inner-docacess"},ye=["href"],fe={key:2,class:"legislacao-citada pt-2"},$e={class:"inner-legcitada"},he=["onClick"],ke={__name:"MateriaEmPauta",props:{materiaId:{type:Number,required:!0},item:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const p=V(),$=F("EventBus"),n=g,d=t,v=L(null),u=L(!1);$.on("rito-toggle",()=>{u.value=!u.value});const _=()=>{$.emit("rito-toggle"),setTimeout(()=>{const a=document.getElementById(`is-${d.item.__label__}-${d.item.id}`);let o=0,b=a;do o+=b.offsetTop,b=b.offsetParent;while(b&&b.tagName!=="BODY");window.scrollTo({top:o-100,behavior:"instant"})},100)},c=k(()=>(d.item.observacao||"").replace(/\n/g,"<br/>")),l=k(()=>p.data_cache?.materia_materialegislativa?.[d.materiaId]||{__str__:"Buscando Matéria Legislativa..."}),h=k(()=>{const a=p.data_cache?.materia_tramitacao?.[d.sessao.finalizada?l.value.ultima_tramitacao:d.item.tramitacao||l.value.ultima_tramitacao]||null,o=a&&p.data_cache?.materia_statustramitacao?.[a.status]||null;return{...a,status:o?o.__str__:"Status não disponível"}}),y=k(()=>{const a=p.data_cache?.base_autor||{};return!l.value.autores||l.value.autores.length===0?[]:l.value.autores.map(o=>a[o]).filter(o=>o!==void 0)}),R=k(()=>l.value.data_apresentacao?new Date(l.value.data_apresentacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):""),f=k(()=>{const a=p.data_cache?.materia_documentoacessorio||{};return Object.values(a).filter(o=>o.materia===d.item.materia)}),s=k(()=>{const a=p.data_cache?.norma_legislacaocitada||{};return Object.values(a).filter(o=>o.materia===d.item.materia)});return P(()=>h.value,a=>{a?.id||(d.sessao.finalizada?p.fetchSync({app:"materia",model:"materialegislativa",id:l.value.id}):d.item.tramitacao&&p.fetchSync({app:"materia",model:"tramitacao",id:d.item.tramitacao}))},{immediate:!0}),P(v,a=>{a!==null&&p.fetchSync({app:"norma",model:"normajuridica",id:a.norma,params:{exclude:"metadata"}})}),P(l,a=>{a?.id||n("resync")},{immediate:!0}),(a,o)=>{const b=D("FontAwesomeIcon");return i(),r("div",{id:`mp-${t.item.__label__}-${t.item.id}`,class:"materia-em-pauta"},[e("div",te,[e("div",ae,[e("a",{href:l.value.link_detail_backend,target:"_blank",rel:"noopener noreferrer"},S(l.value.__str__),9,oe)]),e("div",se,[e("div",ie,[e("div",ne,[o[2]||(o[2]=E(" Protocolo: ",-1)),e("strong",null,S(l.value.numero_protocolo),1)]),e("div",le,S(R.value),1)]),e("div",re,[(i(!0),r(j,null,w(y.value,(m,C)=>(i(),r("span",{key:`au${C}`},S(m.nome),1))),128))])]),e("div",de,[l.value.texto_original?(i(),r("a",{key:0,href:l.value.texto_original,target:"_blank",rel:"noopener noreferrer"},[O(b,{icon:"file-lines"})],8,ce)):x("",!0)]),e("div",{class:"ementa",innerHTML:l.value.ementa},null,8,ue),e("div",me,[e("div",ve,[o[3]||(o[3]=e("strong",null,"Situação:",-1)),o[4]||(o[4]=E("  ",-1)),e("span",null,S(h.value.status),1)]),e("div",_e,[o[5]||(o[5]=e("strong",null,"Última Ação:",-1)),E("  "+S(h.value.texto),1)])]),t.item&&t.item.observacao?(i(),r("div",{key:0,onClick:o[0]||(o[0]=m=>_()),class:A(["rito-text",u.value?"open":"closed"]),innerHTML:u.value?c.value:"Visualizar o Roteiro..."},null,10,pe)):x("",!0),f.value.length>0?(i(),r("div",be,[o[6]||(o[6]=e("div",{class:"title"},[e("strong",null,"Documentos Acessórios")],-1)),e("ul",ge,[(i(!0),r(j,null,w(f.value,m=>(i(),r("li",{key:`docacessorio-${m.id}`,class:"doc-acessorio-item"},[e("a",{href:m.arquivo,target:"_blank",rel:"noopener noreferrer"},S(m.__str__),9,ye)]))),128))])])):x("",!0),s.value.length>0?(i(),r("div",fe,[o[7]||(o[7]=e("div",{class:"title"},[e("strong",null,"Legislação Citada")],-1)),e("ul",$e,[(i(!0),r(j,null,w(s.value,m=>(i(),r("li",{key:`legcitada-${m.id}`,class:"leg-citada-item"},[(i(),r("a",{href:"#",onClick:z(C=>v.value=m,["prevent"]),key:`legiscit${m.id}`},S(m.__str__),9,he))]))),128))])])):x("",!0)]),v.value?(i(),T(G,{key:0,to:"#modalCmj"},[O(Z,{"html-id":`modal-legis-citada-${v.value.id}`,"norma-id":v.value.norma,onClose:o[1]||(o[1]=m=>v.value=null)},null,8,["html-id","norma-id"])])):x("",!0)],8,ee)}}},xe=["id"],Ae={key:0,class:"display-controls"},Se=["id"],Oe={class:"display-content"},Re={key:0,class:"votos"},Ce={key:0,class:"voto-abs"},Te={class:"valor"},Me={class:"voto-nao"},je={class:"valor"},we={class:"voto-sim"},Ve={class:"valor"},Ee={key:1,class:"status-votacao"},Le={key:0},Pe={key:1},Ie={key:2},De={key:0},Be={key:1},qe={key:2},ze={__name:"ProcessoVotacaoDisplay",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const p=V(),$=B(),n=g,d=F("EventBus"),v=t,u=L(!0),_=()=>{c.value||(u.value=!u.value,d.emit("toggle-auto-rolagem",{isState:u.value}))};d.on("toggle-auto-rolagem",o=>{u.value=o.isState,l()}),d.on("disable-auto-rolagem",()=>{u.value=!1});const c=k(()=>$.hasPermission("sessao.add_sessaoplenaria")),l=()=>{c.value||!u.value||!s.value||setTimeout(()=>{const o=document.getElementById(`is-${v.item.__label__}-${v.item.id}`);let b=0,m=o;do b+=m.offsetTop,m=m.offsetParent;while(m&&m.tagName!=="BODY");window.scrollTo({top:b-100,behavior:"smooth"})},100)},h=k(()=>{const o=p.data_cache?.sessao_registrovotacao||{},b=Object.values(o).filter(m=>m.ordem===v.item.id);return b.sort((m,C)=>m.id-C.id),b}),y=k(()=>v.item.votacao_aberta&&v.item.tipo_votacao<=2),R=k(()=>v.item.discussao_aberta&&v.item.tipo_votacao<=2),f=k(()=>v.item.votacao_aberta_pedido_prazo&&v.item.tipo_votacao<=2),s=k(()=>v.item.discussao_aberta||v.item.votacao_aberta||v.item.votacao_aberta_pedido_prazo);P(y,(o,b)=>{!o&&b&&n("resync"),o&&l()},{immediate:!0}),P(s,o=>{o&&l()},{immediate:!0});const a=o=>{let b="tramitando",m=null;return o?m=p.data_cache?.sessao_tiporesultadovotacao?.[o.tipo_resultado_votacao]?.nome:v.item.resultado&&(m=v.item.resultado),R.value?b="result discussao-aberta":y.value?b="result votacao-aberta":m==="Aprovado"?b="result result-aprovado":m==="Rejeitado"?b="result result-rejeitado":m==="Pedido de Vista"?b="result result-vista":m==="Prazo Regimental"?b="result result-prazo":m==="Matéria lida"&&(b="result result-lida"),b};return(o,b)=>{const m=D("font-awesome-icon");return i(),r("div",{id:`pvd-${t.item.__label__}-${t.item.id}`,class:A(["processo-votacao-display",t.item.__label__])},[c.value?x("",!0):(i(),r("div",Ae,[e("button",{id:`auto-rolagem-${t.item.__label__}-${t.item.id}`,type:"button",class:A(["btn-auto-rolagem",u.value?"active":""]),onClick:_},[b[0]||(b[0]=E(" Autorolagem? ",-1)),O(m,{icon:"fa-solid fa-up-down"})],10,Se)])),e("div",Oe,[!y.value&&!f.value?(i(!0),r(j,{key:0},w(h.value,C=>(i(),r("div",{class:"status-votacao",key:`rv-${C.id}`},[a(C)!=="result-vista"?(i(),r("div",Re,[C.numero_abstencoes?(i(),r("div",Ce,[e("span",Te,S(C.numero_abstencoes),1),b[1]||(b[1]=e("span",{class:"titulo"},"ABS",-1))])):x("",!0),e("div",Me,[e("span",je,S(C.numero_votos_nao),1),b[2]||(b[2]=e("span",{class:"titulo"},"NÃO",-1))]),e("div",we,[e("span",Ve,S(C.numero_votos_sim),1),b[3]||(b[3]=e("span",{class:"titulo"},"SIM",-1))])])):x("",!0),e("div",{class:A(a(C))},[e("span",null,S(I(p).data_cache?.sessao_tiporesultadovotacao?.[C.tipo_resultado_votacao]?.nome),1)],2)]))),128)):x("",!0),y.value||R.value||f.value||h.value.length===0?(i(),r("div",Ee,[y.value||R.value||f.value?(i(),r("div",{key:0,class:A(a(null))},[f.value?(i(),r("span",Le,"VOTAÇÃO ABERTA PARA PEDIDO DE ADIAMENTO")):y.value?(i(),r("span",Pe,"VOTAÇÃO ABERTA")):R.value?(i(),r("span",Ie,"DISCUSSÃO ABERTA")):x("",!0)],2)):(i(),r("div",{key:1,class:A(a(null))},[t.item.resultado?(i(),r("span",De,S(t.item.resultado),1)):t.item.tipo_votacao===4&&t.item.votacao_aberta?(i(),r("span",Be,"Leitura em Andamento")):h.value.length===0?(i(),r("span",qe,"Tramitando")):x("",!0)],2))])):x("",!0)])],10,xe)}}},Fe=["id"],Ne={class:"inner-title text-light m-4"},Ue={class:"inner-voto"},He={key:0,class:"voto-result"},Ye={class:"avatar"},Ge=["src","alt","title"],Je={class:"voto-computado"},Ke={key:1,class:"voto-result"},Qe={__name:"VotoParlamentar",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const g=V(),p=B(),$=U(),n=t,d=k(()=>{const _=Object.values(g.data_cache?.materia_materialegislativa||{}).filter(c=>c.id===n.item.materia);return _.length>0?_[0]:null}),v=k(()=>{const _=n.item.__label__==="sessao_ordemdia"?"ordem":"expediente",c=Object.values(g.data_cache?.sessao_votoparlamentar||{}).filter(l=>l.parlamentar===p.data_connect.user.votante.parlamentar_id&&l[_]===n.item.id);return c.length>0?c[0]:null});function u(_){const c=n.item.__label__==="sessao_ordemdia"?"ordem":"expediente",l={parlamentar:p.data_connect.user.votante.parlamentar_id,[c]:n.item.id,voto:_};v.value?(l.id=v.value.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:v.value.id,form:l}).then(()=>{$.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{$.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:l}).then(()=>{$.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{$.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})}return N(()=>{setTimeout(()=>{const _=document.getElementById(`is-${n.item.__label__}-${n.item.id}`);let c=0,l=_;do c+=l.offsetTop,l=l.offsetParent;while(l&&l.tagName!=="BODY");window.scrollTo({top:c-100,behavior:"smooth"})},100)}),(_,c)=>(i(),r("div",{id:`vp-${t.item.__label__}-${t.item.id}`,class:A(["voto-parlamentar"])},[e("div",Ne,[e("span",null,S(d.value?.__str__),1)]),e("div",Ue,[e("button",{type:"button",class:"btn btn-lg btn-success",onClick:c[0]||(c[0]=l=>u("Sim"))}," SIM "),e("button",{type:"button",class:"btn btn-lg btn-danger",onClick:c[1]||(c[1]=l=>u("Não"))}," NÃO "),e("button",{type:"button",class:"btn btn-lg btn-warning",onClick:c[2]||(c[2]=l=>u("Abstenção"))}," Abstenção ")]),v.value?(i(),r("div",He,[e("div",Ye,[e("img",{src:`/api/parlamentares/parlamentar/${I(p).data_connect.user.votante.parlamentar_id}/fotografia.c256.png`,alt:I(p).data_connect.user.votante.nome_parlamentar,title:I(p).data_connect.user.votante.nome_parlamentar},null,8,Ge)]),e("div",Je,[c[3]||(c[3]=E(" Voto Computado: ",-1)),e("strong",null,S(v.value.voto),1)])])):(i(),r("div",Ke," Voto não Computado "))],8,Fe))}},We=["id"],Xe={__name:"ControleDeVotacao",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const p=B(),$=g,n=t,d=k(()=>n.item.votacao_aberta&&n.item.tipo_votacao!==4);return(v,u)=>(i(),r("div",{id:`cv-${t.item.__label__}-${t.item.id}`,class:A(["controle-de-votacao",t.item.__label__,d.value?"votacao-aberta":"votacao-fechada",d.value&&I(p).isVotante&&t.item.tipo_votacao===2?"votante":"observador"])},[d.value&&I(p).isVotante&&t.item.tipo_votacao===2?(i(),T(Qe,{key:`vp-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:u[0]||(u[0]=_=>$("resync"))},null,8,["item","sessao"])):x("",!0),(i(),T(ze,{key:`pvd-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:u[1]||(u[1]=_=>$("resync"))},null,8,["item","sessao"]))],10,We))}},Ze={key:0,class:"message"},et={__name:"Loading",props:{message:{type:String,default:""},position:{type:String,default:"fixed"}},setup(t){return(g,p)=>(i(),r("div",{class:"loading",style:q({position:t.position})},[p[0]||(p[0]=e("div",{class:"loader"},null,-1)),t.message?(i(),r("div",Ze,S(t.message),1)):x("",!0)],4))}},tt=X(et,[["__scopeId","data-v-98eced51"]]),at=["id"],ot={class:"modal-dialog modal-xl"},st={class:"modal-content"},it={class:"modal-header"},nt={class:"modal-title"},lt={class:"d-inline-block ps-3"},rt={class:"modal-body"},dt={class:"row"},ct={class:"col-md-6"},ut={class:"votos-parlamentares-list"},mt={class:"voto-parlamentar-header voto-parlamentar-item font-weight-bold"},vt={class:"voto-parlamentar-options"},_t=["id"],pt={class:"nome-parlamentar"},bt={key:0,class:"voto-parlamentar-options"},gt=["onClick"],yt=["onClick"],ft=["onClick"],$t={class:"col-md-6"},ht={class:"form-group"},kt=["value"],xt={class:"modal-footer"},At={__name:"VotoParlamentarAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["close","register","cancel"],setup(t,{emit:g}){const p=g,$=V(),n=U(),d=t,v=k(()=>{const f=Object.values($.data_cache?.materia_materialegislativa||{}).filter(s=>s.id===d.item.materia);return f.length>0?f[0]:null}),u=k(()=>{const f=d.item.__label__==="sesso_ordemdia"?"sessao_presencaordemdia":"sessao_sessaoplenariapresenca";return Object.values($.data_cache?.[f]||{}).filter(a=>a.sessao_plenaria===d.sessao.id).map(a=>{const o=$.data_cache?.parlamentares_parlamentar?.[a.parlamentar];return o||null})}),_=k(()=>{const f=$.data_cache?.sessao_votoparlamentar||{},s=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente";return Object.values(f).filter(o=>o[s]===d.item.id&&o.votacao===null).reduce((o,b)=>(o[b.parlamentar]=b,o),{})}),c=L({tipo_resultado_votacao:null,observacao:""}),l=k(()=>Object.values($.data_cache?.sessao_tiporesultadovotacao||{}).filter(f=>f.natureza==="P"&&d.item.votacao_aberta_pedido_prazo===!0||f.id>0&&d.item.votacao_aberta_pedido_prazo===!1)),h=()=>{Object.values(_.value).forEach(f=>{console.log("deletando voto",f),M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:f.id})}),p("close")},y=(f,s)=>{if(!f){Object.values(u.value).forEach(m=>{y(m.id,s)});return}const a=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente",o={votacao:null,parlamentar:f,[a]:d.item.id,voto:s},b=_.value[f];if(b&&b.voto===s){M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:b.id}).then(()=>{n.addMessage({type:"info",text:"Voto Removido!",timeout:5e3})}).catch(()=>{n.addMessage({type:"danger",text:"Erro ao remover voto. Tente novamente.",timeout:5e3})});return}b?(o.id=b.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:b.id,form:o}).then(()=>{n.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{n.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:o}).then(()=>{n.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{n.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})},R=()=>{p("register",{action:"action_registrovotacao",form:{...c.value,unanime:!1,com_presidente:!1}}),p("close")};return(f,s)=>(i(),r("div",{id:`vpa-${t.item.__label__}-${t.item.id}`,class:"modal voto-parlamentar-admin-modal-view fade show",tabindex:"-1"},[e("div",ot,[e("div",st,[e("div",it,[e("h5",nt,[s[8]||(s[8]=E(" Registro de Votação dos Parlamentares ",-1)),e("small",lt,S(v.value?v.value.__str__:""),1)]),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=a=>p("close"))})]),e("div",rt,[e("div",dt,[e("div",ct,[e("div",ut,[e("div",mt,[s[9]||(s[9]=e("div",{class:"nome-parlamentar"},[e("h5",null,"Votos dos Parlamentares")],-1)),e("div",vt,[e("button",{type:"button",class:A(["btn btn-sm","btn-outline-success"]),onClick:s[1]||(s[1]=a=>y(0,"Sim"))}," SIM "),e("button",{type:"button",class:A(["btn btn-sm","btn-outline-danger"]),onClick:s[2]||(s[2]=a=>y(0,"Não"))}," NÃO "),e("button",{type:"button",class:A(["btn btn-sm","btn-outline-warning"]),onClick:s[3]||(s[3]=a=>y(0,"Abstenção"))}," Abstenção ")])]),(i(!0),r(j,null,w(u.value,a=>(i(),r("div",{id:`voto-parlamentar-${a.id}`,class:"voto-parlamentar-item",key:`voto-parlamentar-${a.id}`},[e("div",pt,S(a.nome_parlamentar),1),_.value?(i(),r("div",bt,[e("button",{type:"button",class:A(["btn btn-sm",`btn${_.value[a.id]?.voto==="Sim"?"-success":"-outline-success"}`]),onClick:o=>y(a.id,"Sim")}," SIM ",10,gt),e("button",{type:"button",class:A(["btn btn-sm",`btn${_.value[a.id]?.voto==="Não"?"-danger":"-outline-danger"}`]),onClick:o=>y(a.id,"Não")}," NÃO ",10,yt),e("button",{type:"button",class:A(["btn btn-sm",`btn${_.value[a.id]?.voto==="Abstenção"?"-warning":"-outline-warning"}`]),onClick:o=>y(a.id,"Abstenção")}," Abstenção ",10,ft)])):x("",!0)],8,_t))),128))])]),e("div",$t,[e("div",ht,[e("div",null,[s[10]||(s[10]=e("strong",{class:"p-2 d-inline-block"}," Tipo de Resultado da Votação: * ",-1)),Y(e("select",{id:"tipo-resultado-votacao",class:"form-select","onUpdate:modelValue":s[4]||(s[4]=a=>c.value.tipo_resultado_votacao=a)},[(i(!0),r(j,null,w(l.value,a=>(i(),r("option",{key:`tipo-resultado-votacao-${a.id}`,value:a.id},S(a.__str__),9,kt))),128))],512),[[J,c.value.tipo_resultado_votacao]])]),e("div",null,[s[11]||(s[11]=e("strong",{class:"pt-4 pb-2 d-inline-block"}," Observações: ",-1)),Y(e("textarea",{class:"form-control",rows:"5","onUpdate:modelValue":s[5]||(s[5]=a=>c.value.observacao=a)},null,512),[[K,c.value.observacao]])])])]),e("div",xt,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=a=>h())}," Cancelar Registro de Votação "),e("button",{type:"button",class:"btn btn-success",onClick:s[7]||(s[7]=a=>R())}," Registrar e Fechar Votação ")])])])])])],8,at))}},St=["id"],Ot={class:"inner-is-admin"},Rt={class:"btn-group",role:"group","aria-label":"Edição"},Ct=["href"],Tt={key:0,class:"registro-leitura"},Mt={class:"btn-group",role:"group","aria-label":"State Leitura da matéria em Plenário"},jt={class:"btn-group",role:"group","aria-label":"Registro de Leitura"},wt=["disabled"],Vt=["disabled"],Et={key:1,class:"registro-votacao"},Lt=["disabled"],Pt=["disabled"],It=["disabled"],Dt=["disabled"],Bt={__name:"ItemDeSessaoAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const g=B();V();const p=U(),$=t,n=L(!1),d=L(!1),v=k(()=>g.hasPermission("sessao.add_sessaoplenaria")),u=async f=>{const[s,a]=$.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,form:{field:f},action:"toggle_state",id:$.item.id}).then(o=>{console.log("Discussão alterada com sucesso",o)}).catch(o=>{console.error("Erro ao alterar discussão",o)})},_=async f=>{l({action:"action_registrovotacao",form:{unanime:!0,resultado:f,com_presidente:!1}})},c=async()=>{l({action:"action_registroleitura",form:{}})},l=async f=>{n.value=!0;const[s,a]=$.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,id:$.item.id,action:f.action,form:f.form}).then(o=>{console.log("Votação registrada com sucesso",o),n.value=!1}).catch(o=>{n.value=!1,p.addMessage({type:o.response.data.type||"danger",text:o.response.data.detail||"Erro ao registrar votação!",timeout:5e3})})},h=async()=>{n.value=!0;const[f,s]=$.item.__label__.split("_");M.Utils.patchModel({app:f,model:s,action:"action_cancelar_registroleitura",id:$.item.id}).then(a=>{n.value=!1,console.log("Registro de leitura cancelado com sucesso",a)}).catch(a=>{n.value=!1,p.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de leitura!",timeout:5e3})})},y=async()=>{n.value=!0,d.value=!1;const[f,s]=$.item.__label__.split("_");M.Utils.patchModel({app:f,model:s,action:"action_cancelar_registrovotacao",id:$.item.id}).then(a=>{n.value=!1,console.log("Registro de votação cancelado com sucesso",a)}).catch(a=>{n.value=!1,p.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de votação!",timeout:5e3})})};N(()=>{R(2e3)}),P(()=>$.item,()=>{R(500)});const R=f=>{setTimeout(()=>{document.querySelectorAll(".tooltip.bs-tooltip-auto").forEach(o=>{o.remove()}),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(o=>new Q(o,{trigger:"hover"}))},f)};return(f,s)=>{const a=D("FontAwesomeIcon");return v.value?(i(),r("div",{key:0,id:`is-admin-${t.item.__label__}-${t.item.id}`,class:A(["item-de-sessao-admin",n.value?"actions-running":""])},[e("div",Ot,[e("div",Rt,[e("a",{href:t.item.__label__==="sessao_ordemdia"?`/sessao/${t.item.sessao_plenaria}/ordemdia#id${t.item.materia}`:`/sessao/${t.item.sessao_plenaria}/expedientemateria#id${t.item.materia}`,target:"_blank",class:A(["btn","btn-outline-secondary"])},[O(a,{icon:"edit"})],8,Ct)]),t.item.tipo_votacao===4?(i(),r("div",Tt,[e("div",Mt,[e("button",{type:"button",class:A(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[0]||(s[0]=o=>u("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Leitura da matéria em Plenário"},[O(a,{icon:`${t.item.votacao_aberta?"book-open-reader":"book"}`},null,8,["icon"])],2)]),e("div",jt,[t.item.resultado?(i(),r("button",{key:0,type:"button",class:"btn btn-outline-warning",onClick:s[1]||(s[1]=o=>h()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Leitura.",disabled:n.value},[O(a,{icon:"ban"})],8,wt)):x("",!0),t.item.votacao_aberta?(i(),r("button",{key:1,type:"button",class:"btn btn-outline-primary",onClick:s[2]||(s[2]=o=>c()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Leitura da Matéria em Plenário.",disabled:n.value},[O(a,{icon:"book-open"})],8,Vt)):x("",!0)])])):(i(),r("div",Et,[e("div",{class:"btn-group",role:"group",style:q({opacity:n.value?0:1}),"aria-label":"Registros de Votação Simbólica"},[e("button",{type:"button",class:"btn btn-outline-warning",onClick:s[3]||(s[3]=o=>y()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Votação.",disabled:n.value},[O(a,{icon:"ban"})],8,Lt),e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[4]||(s[4]=o=>_("R")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Rejeição Unânime sem voto do Presidente.",disabled:n.value},[O(a,{icon:"thumbs-down"})],8,Pt),e("button",{type:"button",class:"btn btn-outline-primary",onClick:s[5]||(s[5]=o=>_("A")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Aprovação Unânime sem voto do Presidente.",disabled:n.value},[O(a,{icon:"thumbs-up"})],8,It)],4),e("div",{class:"btn-group",role:"group",style:q({opacity:n.value?0:1}),"aria-label":"Botões de controle de abertura de discussão, votação e pedido de adiamento"},[e("button",{type:"button",class:A(["btn",`btn-outline-${t.item.discussao_aberta?"success":"danger"}`]),onClick:s[6]||(s[6]=o=>u("discussao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Discussão em Plenário"},[O(a,{icon:"comments"}),s[11]||(s[11]=E("  ",-1))],2),e("button",{type:"button",class:A(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[7]||(s[7]=o=>u("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação em Plenário"},[O(a,{icon:t.item.votacao_aberta?"book-open-reader":"book"},null,8,["icon"]),s[12]||(s[12]=E("  ",-1))],2),e("button",{type:"button",class:A(["btn",`btn-outline-${t.item.votacao_aberta_pedido_prazo?"success":"danger"}`]),onClick:s[8]||(s[8]=o=>u("votacao_aberta_pedido_prazo")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação de Pedido de Adiamento de Votação"},[...s[13]||(s[13]=[e("i",{class:"bi bi-hourglass-top"},null,-1)])],2)],4),t.item.votacao_aberta||t.item.votacao_aberta_pedido_prazo?(i(),r("div",{key:0,class:"btn-group",role:"group",style:q({opacity:n.value?0:1}),"aria-label":"Registro de Votação Simbólica sem unanimidade"},[e("button",{type:"button",class:"btn btn-outline-success",onClick:s[9]||(s[9]=o=>d.value=!0),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Votação",disabled:n.value},[O(a,{icon:"check-to-slot"})],8,Dt)],4)):x("",!0)]))]),n.value?(i(),T(tt,{key:0,message:"Registrando...",position:"absolute"})):x("",!0),d.value?(i(),T(G,{key:1,to:"#modalCmj"},[(i(),T(At,{key:`vpa-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onClose:s[10]||(s[10]=o=>d.value=!1),onRegister:l},null,8,["item","sessao"]))])):x("",!0)],10,St)):x("",!0)}}},qt=["id"],zt=["id"],Ft={class:"childs"},Nt={key:0,class:"title"},H={__name:"ItemDeSessao",props:{item:{type:Object,required:!0},parent:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const p=V(),$=B(),n=g,d=t,v=k(()=>$.hasPermission("sessao.add_sessaoplenaria")),u=k(()=>{const l=p.data_cache?.[d.item.__label__]||{},h=Object.values(l).filter(y=>y.parent===d.item.id);return h.sort((y,R)=>y.numero_ordem-R.numero_ordem),h}),_=()=>{const l=document.getElementById(`item-content-${d.item.__label__}-${d.item.id}`);l&&l.scrollIntoView({behavior:"smooth",block:"center"})},c=k(()=>{const l=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente";return Object.values(p.data_cache?.sessao_registrovotacao||{}).filter(h=>h[l]===d.item.id)});return(l,h)=>(i(),r("div",{id:`is-${t.item.__label__}-${t.item.id}`,class:A(["item-de-sessao",t.item.__label__,t.parent?"child-item":"parent-item"])},[e("div",{onClick:z(_,["self"]),id:`item-content-${t.item.__label__}-${t.item.id}`,class:A(["item-content",t.item.votacao_aberta&&t.item.tipo_votacao===2?"votacao-nominal":"",v.value?"item-admin":"",v.value&&c.value.length>0?`possui-registro-votacao-${c.value.length}`:""])},[(i(),T(Bt,{key:`is-admin-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:h[0]||(h[0]=y=>n("resync"))},null,8,["item","sessao"])),(i(),T(Xe,{key:`cv-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:h[1]||(h[1]=y=>n("resync"))},null,8,["item","sessao"])),(i(),T(ke,{onClick:z(_,["self"]),key:`mp-${t.item.__label__}-${t.item.id}`,"materia-id":t.item.materia,item:t.item,sessao:t.sessao,onResync:h[2]||(h[2]=y=>n("resync"))},null,8,["materia-id","item","sessao"]))],10,zt),e("div",Ft,[!t.item.parent&&u.value.length>0?(i(),r("div",Nt,[...h[4]||(h[4]=[e("strong",null,"Matérias Anexadas",-1)])])):x("",!0),(i(!0),r(j,null,w(u.value,y=>(i(),T(H,{key:`is-${y.__label__}-${y.id}`,item:y,parent:t.item,sessao:t.sessao,onResync:h[3]||(h[3]=R=>n("resync"))},null,8,["item","parent","sessao"]))),128))])],10,qt))}},Ut={class:"expediente-materia-list"},Ht={class:"title"},Yt={class:"expediente-materia-content"},Gt={__name:"ExpedienteMateriaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const p=g,$=V(),n=t,d=k(()=>{const u=$.data_cache?.sessao_expedientemateria||{},_=Object.values(u).filter(c=>c.sessao_plenaria===n.sessao?.id&&c.parent===null);return _.sort((c,l)=>c.numero_ordem-l.numero_ordem),_}),v=()=>{p("resync");const u=document.querySelector(".resync-icon-expmateria");u&&(u.classList.add("rotate"),setTimeout(()=>{u.classList.remove("rotate")},1e3))};return(u,_)=>{const c=D("FontAwesomeIcon");return i(),r("div",Ut,[e("div",Ht,[_[1]||(_[1]=e("strong",null,"Matérias do Grande Expediente",-1)),O(c,{icon:"arrows-rotate",class:"resync-icon-expmateria cursor-pointer ms-2",title:"Recarregar matéria",onClick:v})]),e("div",Yt,[(i(!0),r(j,null,w(d.value,l=>(i(),T(H,{key:`is-${l.__label__}-${l.id}`,item:l,sessao:t.sessao,onResync:_[0]||(_[0]=h=>p("resync"))},null,8,["item","sessao"]))),128))])])}}},Jt={class:"ordemdia-list"},Kt={class:"title"},Qt={class:"ordemdia-content"},Wt={__name:"OrdemDiaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const p=g,$=V(),n=t,d=k(()=>{const u=$.data_cache?.sessao_ordemdia||{},_=Object.values(u).filter(c=>c.sessao_plenaria===n.sessao?.id&&c.parent===null);return _.sort((c,l)=>c.numero_ordem-l.numero_ordem),_}),v=()=>{p("resync");const u=document.querySelector(".resync-icon-ordemdia");u&&(u.classList.add("rotate"),setTimeout(()=>{u.classList.remove("rotate")},1e3))};return(u,_)=>{const c=D("FontAwesomeIcon");return i(),r("div",Jt,[e("div",Kt,[_[1]||(_[1]=e("strong",null,"Matérias da Ordem do Dia",-1)),O(c,{icon:"arrows-rotate",class:"resync-icon-ordemdia cursor-pointer ms-2",title:"Recarregar matéria",onClick:v})]),e("div",Qt,[(i(!0),r(j,null,w(d.value,l=>(i(),T(H,{key:`is-${l.__label__}-${l.id}`,item:l,sessao:t.sessao,onResync:_[0]||(_[0]=h=>p("resync"))},null,8,["item","sessao"]))),128))])])}}},Xt=["href"],Zt={key:1,class:"sessao-plenaria-content"},ea=["innerHTML"],ta=["innerHTML"],aa=["innerHTML"],la={__name:"SessaoPlenariaView",setup(t){const g=V(),p=W(),$=F("EventBus"),n=L(Number(p.params.id)||0),d=L(!1),v=k(()=>g.data_cache?.sessao_sessaoplenaria?.[n.value]);N(()=>{g.fetchSync({app:"sessao",model:"sessaoplenaria",id:n.value,params:{},force_fetch:!0}).then(()=>{h(!1)})});const u=k(()=>Object.values(g.data_cache?.sessao_expedientesessao||{}).filter(y=>y.sessao_plenaria===n.value&&y.tipo===1)),_=k(()=>Object.values(g.data_cache?.sessao_expedientesessao||{}).filter(y=>y.sessao_plenaria===n.value&&y.tipo===3)),c=k(()=>Object.values(g.data_cache?.sessao_expedientesessao||{}).filter(y=>y.sessao_plenaria===n.value&&y.tipo===4));$.on("rito-toggle",()=>{d.value=!d.value});const l=()=>{$.emit("rito-toggle")},h=(y=!0)=>{g.invalidateDataCache(["sessao"],["expedientemateria","ordemdia"]),g.fetchSync({app:"sessao",model:"expedientesessao",params:{sessao_plenaria:n.value,get_all:"True"}}),(async()=>await Promise.all([g.fetchSync({app:"sessao",model:"ordemdia",params:{sessao_plenaria:n.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}}),g.fetchSync({app:"sessao",model:"expedientemateria",params:{sessao_plenaria:n.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}})]))().then(()=>{const f=Object.values(g.data_cache?.sessao_ordemdia||{}).filter(m=>m.sessao_plenaria===n.value).map(m=>m.id),s=Object.values(g.data_cache?.sessao_expedientemateria||{}).filter(m=>m.sessao_plenaria===n.value).map(m=>m.id),a=new Set,o=g.data_cache?.sessao_expedientemateria||{};Object.values(o).forEach(m=>{m.sessao_plenaria===n.value&&a.add(m.materia)});const b=g.data_cache?.sessao_ordemdia||{};Object.values(b).forEach(m=>{m.sessao_plenaria===n.value&&a.add(m.materia)}),a.size>0&&(g.fetchSync({app:"materia",model:"materialegislativa",params:{id__in:Array.from(a),exclude:"metadata",get_all:"True"},force_fetch:y}),g.fetchSync({app:"sessao",model:"registroleitura",params:{materia__in:Array.from(a),get_all:"True"}}),g.fetchSync({app:"sessao",model:"registrovotacao",params:{materia__in:Array.from(a),get_all:"True",expand:"tipo_resultado_votacao"}}),g.fetchSync({app:"sessao",model:"votoparlamentar",params:{ordem__in:Array.from(f),get_all:"True"}}),g.fetchSync({app:"sessao",model:"votoparlamentar",params:{expediente__in:Array.from(s),get_all:"True"}}),g.fetchSync({app:"materia",model:"documentoacessorio",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),g.fetchSync({app:"norma",model:"legislacaocitada",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),g.fetchSync({app:"sessao",model:"tiporesultadovotacao",params:{get_all:"True"}}),g.fetchSync({app:"sessao",model:"sessaoplenariapresenca",params:{get_all:"True",sessao_plenaria:n.value,expand:"parlamentar"}}),g.fetchSync({app:"sessao",model:"presencaordemdia",params:{get_all:"True",sessao_plenaria:n.value,expand:"parlamentar"}}))})};return(y,R)=>(i(),r("div",{key:`sessao-plenaria-view-${n.value}`,class:"sessao-plenaria-view"},[v.value?(i(),r("a",{key:0,class:"sessao_link_manage",href:v.value.link_detail_backend,target:"_blank"},S(v.value.__str__),9,Xt)):x("",!0),v.value?(i(),r("div",Zt,[u.value.length>0?(i(),r("div",{key:0,onClick:l,class:A(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?u.value[0].conteudo:"Visualizar o Roteiro..."},null,8,ea)],2)):x("",!0),O(Gt,{sessao:v.value,onResync:h},null,8,["sessao"]),_.value.length>0?(i(),r("div",{key:1,onClick:l,class:A(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?_.value[0].conteudo:"Visualizar o Roteiro..."},null,8,ta)],2)):x("",!0),O(Wt,{sessao:v.value,onResync:h},null,8,["sessao"]),c.value.length>0?(i(),r("div",{key:2,onClick:l,class:A(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?c.value[0].conteudo:"Visualizar o Roteiro..."},null,8,aa)],2)):x("",!0)])):x("",!0)]))}};export{la as default};
