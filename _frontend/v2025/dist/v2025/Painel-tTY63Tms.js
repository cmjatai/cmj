import{_ as P,u as N,i as F,d as W,e as k,f as z,c as v,o,g as S,n as b,t as L,h as B,j as q,F as X,k as Y,r as A,a as _,w as H,l as j,R as O,m as U,p as T,q as G}from"./main-DxdtGib7.js";const J={key:2,class:"inner-widget inner-children"},K={key:3,class:"manager"},Q={class:"toolbar"},Z={__name:"Widget",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(M){const d=N(),h=F("EventBus"),g=M,$=W(null),l=W({x:0,y:0,w:100,h:100,mouseResizeEnter:!1,editmode:!1});h.on("closeEditMode",t=>{t!==g.widgetSelected&&(l.value.editmode=!1)});const n=k(()=>d.data_cache.painelset_widget?.[g.widgetSelected]||null),x=k(()=>{if(!n.value||!n.value.config?.coords)return{};const t={},e=n.value.config.coords;return e.x!==void 0&&(t.left=`${e.x}%`),e.y!==void 0&&(t.top=`${e.y}%`),e.w!==void 0&&(t.right=`${e.w+e.x>100?0:100-(e.w+e.x)}%`),e.h!==void 0&&(t.bottom=`${e.h+e.y>100?0:100-(e.h+e.y)}%`),t}),E=k(()=>z.orderBy(z.filter(d.data_cache.painelset_widget,{parent:g.widgetSelected})||[],["position"],["asc"]));(async()=>{d.fetchSync({app:"painelset",model:"widget",filters:{parent:g.widgetSelected}}).then(t=>{t&&t.data.results.length>0})})();const R=t=>!t||t.x===void 0||t.y===void 0||t.w===void 0||t.h===void 0||t.x===null||t.y===null||t.w===null||t.h===null?!1:t.w>5&&t.w<=100&&t.h>5&&t.h<=100&&t.x>=0&&t.x<=100&&t.y>=0&&t.y<=100&&t.x+t.w<=100&&t.y+t.h<=100,I=t=>{if(!R(t)){console.error("Invalid widget coordinates, aborting update");return}O.Utils.patchModel({app:"painelset",model:"widget",id:n.value.id,form:{config:{...n.value.config,coords:{...n.value.config.coords,x:t.x,y:t.y,w:t.w,h:t.h}}}}).then(e=>{console.debug(e.data),console.debug("Widget coordinates updated successfully")}).catch(e=>{console.error("Error updating widget coordinates:",e)})},D=t=>{t.preventDefault(),!l.value.mouseResizeEnter&&(l.value.editmode=!l.value.editmode,h.emit("closeEditMode",g.widgetSelected))},a=(t,e)=>{if(l.value.mouseResizeEnter=!0,t.preventDefault(),!l.value.editmode)return;const r=$.value,s=r.getBoundingClientRect(),f=r.parentElement.getBoundingClientRect(),i={...l.value};console.debug("Mouse move detected:",t.clientX,t.clientY,s);const V=u=>{let c=0,p=0;if(e==="top-left"){const m=u.clientX-s.left,w=u.clientY-s.top;c=Math.round(m/f.width*100),p=Math.round(w/f.height*100),i.w=n.value.config.coords.w-c,i.h=n.value.config.coords.h-p,i.x=n.value.config.coords.x+c,i.y=n.value.config.coords.y+p}else if(e==="top-right"){const m=u.clientX-s.right,w=u.clientY-s.top;c=Math.round(m/f.width*100),p=Math.round(w/f.height*100),i.w=n.value.config.coords.w+c,i.h=n.value.config.coords.h-p,i.x=n.value.config.coords.x,i.y=n.value.config.coords.y+p}else if(e==="bottom-right"){const m=u.clientX-s.right,w=u.clientY-s.bottom;c=Math.round(m/f.width*100),p=Math.round(w/f.height*100),i.w=n.value.config.coords.w+c,i.h=n.value.config.coords.h+p,i.x=n.value.config.coords.x,i.y=n.value.config.coords.y}else if(e==="bottom-left"){const m=u.clientX-s.left,w=u.clientY-s.bottom;c=Math.round(m/f.width*100),p=Math.round(w/f.height*100),i.w=n.value.config.coords.w-c,i.h=n.value.config.coords.h+p,i.x=n.value.config.coords.x+c,i.y=n.value.config.coords.y}else if(e==="center-center"){const m=u.clientX-s.left-s.width/2,w=u.clientY-s.top-s.height/2;c=Math.round(m/f.width*100),p=Math.round(w/f.height*100),console.debug("Resizing widget...",m,w,e,c,p,i),i.w=n.value.config.coords.w,i.h=n.value.config.coords.h,i.x=n.value.config.coords.x+c,i.y=n.value.config.coords.y+p}console.debug("Resizing widget...",u.clientX,u.clientY,e,c,p,i),R(i)?(l.value.w=i.w,l.value.h=i.h,l.value.x=i.x,l.value.y=i.y,r.style.right=`${100-(i.w+i.x)}%`,r.style.bottom=`${100-(i.h+i.y)}%`,r.style.left=`${i.x}%`,r.style.top=`${i.y}%`):console.warn("Invalid coordinates during resize, ignoring update")};console.debug("Starting resize operation"),window.addEventListener("mousemove",V),window.addEventListener("mouseup",u=>{window.removeEventListener("mouseup",this),window.removeEventListener("mousemove",V),u.preventDefault(),l.value.mouseResizeEnter&&(l.value.mouseResizeEnter=!1,I({x:l.value.x,y:l.value.y,w:l.value.w,h:l.value.h}),console.debug("Resize operation ended"))})};return(t,e)=>{const r=A("Widget",!0);return o(),v("div",{ref_key:"painelsetWidget",ref:$,key:`painelset-widget-${n.value?.id}`,class:j(["painelset-widget",l.value.editmode?"editmode":""]),style:b({...n.value?.styles.component||{},...x.value}),onMousedown:e[6]||(e[6]=H(s=>D(s),["stop"]))},[n.value?.config?.displayTitle?(o(),v("div",{key:0,class:"widget-titulo",style:b(n.value?.styles.title||{})},L(n.value?.name),5)):S("",!0),n.value?.vue_component?(o(),v("div",{key:1,class:"inner-widget",style:b(n.value?.styles.inner||{})},[(o(),B(q(n.value?.vue_component),{"painel-id":M.painelId,"widget-selected":n.value?.id},null,8,["painel-id","widget-selected"]))],4)):S("",!0),n.value?.vue_component?S("",!0):(o(),v("div",J,[(o(!0),v(X,null,Y(E.value,(s,f)=>(o(),B(r,{key:`widget-${s.id}-${f}`,"painel-id":M.painelId,"widget-selected":s.id},null,8,["painel-id","widget-selected"]))),128))])),l.value.editmode?(o(),v("div",K,[_("div",Q,[_("button",{class:"btn btn-sm btn-dark",onClick:e[0]||(e[0]=H(s=>t.modalEditorOpened=!0,["stop"]))})]),_("div",{class:"resize-handle top-left",onMousedown:e[1]||(e[1]=s=>a(s,"top-left"))},null,32),_("div",{class:"resize-handle top-right",onMousedown:e[2]||(e[2]=s=>a(s,"top-right"))},null,32),_("div",{class:"resize-handle bottom-left",onMousedown:e[3]||(e[3]=s=>a(s,"bottom-left"))},null,32),_("div",{class:"resize-handle bottom-right",onMousedown:e[4]||(e[4]=s=>a(s,"bottom-right"))},null,32),_("div",{class:"resize-handle center-center",onMousedown:e[5]||(e[5]=s=>a(s,"center-center"))},null,32)])):S("",!0)],38)}}},C=P(Z,[["__scopeId","data-v-92aed311"]]),ee={__name:"VisaoDePainel",props:{painelId:{type:Number,default:0},visaodepainelSelected:{type:Number,default:0}},setup(M){const d=N(),h=M,g=k(()=>d.data_cache.painelset_visaodepainel?.[h.visaodepainelSelected]||null),$=k(()=>z.orderBy(z.filter(d.data_cache.painelset_widget,{visao:h.visaodepainelSelected,parent:null})||[],["position"],["asc"]));return(async()=>{d.fetchSync({app:"painelset",model:"widget",filters:{visaodepainel:h.visaodepainelSelected}}).then(n=>{n&&n.data.results.length>0})})(),(n,x)=>(o(),v("div",{class:"painelset-visaodepainel",style:b(g.value?.styles.component||{})},[g.value?.config?.displayTitle?(o(),v("div",{key:0,class:"visaodepainel-titulo",style:b(g.value?.styles.title||{})},L(g.value?.name),5)):S("",!0),_("div",{class:"inner-visaodepainel",style:b(g.value?.styles.inner||{})},[(o(!0),v(X,null,Y($.value,(E,y)=>(o(),B(C,{key:`widget-${E.id}-${y}`,"painel-id":M.painelId,"widget-selected":E.id},null,8,["painel-id","widget-selected"]))),128))],4)],4))}},te=P(ee,[["__scopeId","data-v-4952547c"]]),ne={class:"actions"},ie={class:"btn-group btn-group-sm",role:"group","aria-label":"VisÃµes do Painel"},se=["onClick"],ae={__name:"Painel",props:{painelId:{type:String,default:"0"}},setup(M){const d=N(),h=G(),g=U();d.registerModels("painelset",["painel","visaodepainel","widget","evento"]),d.registerModels("sessao",["sessaoplenaria"]),d.registerModels("materia",["materialegislativa"]);const $=M,l=W(Number(g.params.painelId)||0),n=W(Number($.painelId)||l.value||0),x=k(()=>d.data_cache.painelset_painel?.[n.value]||null),E=k(()=>z.orderBy(z.filter(d.data_cache.painelset_visaodepainel,{painel:n.value})||[],["position"],["asc"])),y=W(null);T(()=>$.painelId,a=>{a!==n.value&&(n.value=a,I())}),T(()=>n.value,a=>{a&&R(a)});const R=async a=>{d.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:a}}).then(t=>{if(t&&t.data.results.length>0){const e=t.data.results.find(r=>r.active===!0);e?y.value=e.id:y.value=t.data.results[0].id}})},I=async()=>{n.value?d.fetchSync({app:"painelset",model:"painel",id:n.value}).then(()=>{R(n.value)}).catch(a=>{console.error("Error fetching painel:",a),h.push({name:"painelset_error_404",params:{pathMatch:"error"}})}):d.fetchSync({app:"painelset",model:"evento",params:{end_real__isnull:!0,start_real__isnull:!1}}).then(a=>{if(a&&a.data.results.length>0){const t=a.data.results[0];d.fetchSync({app:"painelset",model:"painel",params:{evento:t.id}}).then(e=>{if(e&&e.data.results.length>0){const r=e.data.results[0];n.value=r.id}else h.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(e=>{console.error("Error fetching painel for evento:",e),h.push({name:"painelset_error_404",params:{pathMatch:"error"}})})}else h.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(a=>{console.error("Error fetching evento:",a),h.push({name:"painelset_error_404",params:{pathMatch:"error"}})})},D=a=>{y.value=a};return I(),(a,t)=>(o(),v("div",{class:"painelset-painel",style:b(x.value?.styles.component||{})},[x.value?.config?.displayTitle?(o(),v("div",{key:0,class:"painel-titulo",style:b(x.value?.styles.title||{})},L(x.value?.name),5)):S("",!0),y.value?(o(),v("div",{key:1,class:"inner-painelset-painel",style:b(x.value?.styles.inner||{})},[(o(),B(te,{key:`visaodepainel-${y.value.id}`,"painel-id":n.value,"visaodepainel-selected":y.value},null,8,["painel-id","visaodepainel-selected"])),_("div",ne,[_("div",ie,[(o(!0),v(X,null,Y(E.value,(e,r)=>(o(),v("button",{key:`${e.id}_${r}`,class:j([{active:e.id===y.value},"btn btn-primary"]),onClick:s=>D(e.id)},L(e.position),11,se))),128))])])],4)):S("",!0),S("",!0)],4))}},oe=P(ae,[["__scopeId","data-v-3c4622e3"]]);export{oe as default};
