import{y as q,v as R,c as k,_ as z,f as g,g as o,i as S,D as M,t as L,l as B,E as j,F as P,r as N,C as H,k as _,G as F,q as G,n as A,H as O,w as T,I as U}from"./vendor-BmiiKGVm.js";import{_ as V,u as X,R as J}from"./main-C2HhTtQq.js";import"./vendor_fortawesome-Dp93uEGA.js";const K={key:2,class:"inner-widget inner-children"},Q={key:3,class:"manager"},Z={class:"toolbar"},C={__name:"Widget",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(x){const d=X(),f=q("EventBus"),h=x,$=R(null),l=R({x:0,y:0,w:100,h:100,mouseResizeEnter:!1,editmode:!1});f.on("closeEditMode",t=>{t!==h.widgetSelected&&(l.value.editmode=!1)});const n=k(()=>d.data_cache.painelset_widget?.[h.widgetSelected]||null),b=k(()=>{if(!n.value||!n.value.config?.coords)return{};const t={},e=n.value.config.coords;return e.x!==void 0&&(t.left=`${e.x}%`),e.y!==void 0&&(t.top=`${e.y}%`),e.w!==void 0&&(t.right=`${e.w+e.x>100?0:100-(e.w+e.x)}%`),e.h!==void 0&&(t.bottom=`${e.h+e.y>100?0:100-(e.h+e.y)}%`),t}),E=k(()=>z.orderBy(z.filter(d.data_cache.painelset_widget,{parent:h.widgetSelected})||[],["position"],["asc"]));(async()=>{d.fetchSync({app:"painelset",model:"widget",filters:{parent:h.widgetSelected}}).then(t=>{t&&t.data.results.length>0})})();const I=t=>!t||t.x===void 0||t.y===void 0||t.w===void 0||t.h===void 0||t.x===null||t.y===null||t.w===null||t.h===null?!1:t.w>5&&t.w<=100&&t.h>5&&t.h<=100&&t.x>=0&&t.x<=100&&t.y>=0&&t.y<=100&&t.x+t.w<=100&&t.y+t.h<=100,W=t=>{if(!I(t)){console.error("Invalid widget coordinates, aborting update");return}J.Utils.patchModel({app:"painelset",model:"widget",id:n.value.id,form:{config:{...n.value.config,coords:{...n.value.config.coords,x:t.x,y:t.y,w:t.w,h:t.h}}}}).then(e=>{console.log(e.data),console.log("Widget coordinates updated successfully")}).catch(e=>{console.error("Error updating widget coordinates:",e)})},D=t=>{t.preventDefault(),!l.value.mouseResizeEnter&&(l.value.editmode=!l.value.editmode,f.emit("closeEditMode",h.widgetSelected))},a=(t,e)=>{if(l.value.mouseResizeEnter=!0,t.preventDefault(),!l.value.editmode)return;const c=$.value,r=c.getBoundingClientRect(),s=c.parentElement.getBoundingClientRect(),i={...l.value};console.log("Mouse move detected:",t.clientX,t.clientY,r);const Y=u=>{let p=0,v=0;if(e==="top-left"){const y=u.clientX-r.left,w=u.clientY-r.top;p=Math.round(y/s.width*100),v=Math.round(w/s.height*100),i.w=n.value.config.coords.w-p,i.h=n.value.config.coords.h-v,i.x=n.value.config.coords.x+p,i.y=n.value.config.coords.y+v}else if(e==="top-right"){const y=u.clientX-r.right,w=u.clientY-r.top;p=Math.round(y/s.width*100),v=Math.round(w/s.height*100),i.w=n.value.config.coords.w+p,i.h=n.value.config.coords.h-v,i.x=n.value.config.coords.x,i.y=n.value.config.coords.y+v}else if(e==="bottom-right"){const y=u.clientX-r.right,w=u.clientY-r.bottom;p=Math.round(y/s.width*100),v=Math.round(w/s.height*100),i.w=n.value.config.coords.w+p,i.h=n.value.config.coords.h+v,i.x=n.value.config.coords.x,i.y=n.value.config.coords.y}else if(e==="bottom-left"){const y=u.clientX-r.left,w=u.clientY-r.bottom;p=Math.round(y/s.width*100),v=Math.round(w/s.height*100),i.w=n.value.config.coords.w-p,i.h=n.value.config.coords.h+v,i.x=n.value.config.coords.x+p,i.y=n.value.config.coords.y}else if(e==="center-center"){const y=u.clientX-r.left-r.width/2,w=u.clientY-r.top-r.height/2;p=Math.round(y/s.width*100),v=Math.round(w/s.height*100),console.debug("Resizing widget...",y,w,e,p,v,i),i.w=n.value.config.coords.w,i.h=n.value.config.coords.h,i.x=n.value.config.coords.x+p,i.y=n.value.config.coords.y+v}console.debug("Resizing widget...",u.clientX,u.clientY,e,p,v,i),I(i)?(l.value.w=i.w,l.value.h=i.h,l.value.x=i.x,l.value.y=i.y,c.style.right=`${100-(i.w+i.x)}%`,c.style.bottom=`${100-(i.h+i.y)}%`,c.style.left=`${i.x}%`,c.style.top=`${i.y}%`):console.warn("Invalid coordinates during resize, ignoring update")};console.log("Starting resize operation"),window.addEventListener("mousemove",Y),window.addEventListener("mouseup",u=>{window.removeEventListener("mouseup",this),window.removeEventListener("mousemove",Y),u.preventDefault(),l.value.mouseResizeEnter&&(l.value.mouseResizeEnter=!1,W({x:l.value.x,y:l.value.y,w:l.value.w,h:l.value.h}),console.log("Resize operation ended"))})};return(t,e)=>{const c=H("Widget",!0),r=H("FontAwesomeIcon");return o(),g("div",{ref_key:"painelsetWidget",ref:$,key:`painelset-widget-${n.value?.id}`,class:A(["painelset-widget",l.value.editmode?"editmode":""]),style:M({...n.value?.styles.component||{},...b.value}),onMousedown:e[6]||(e[6]=F(s=>D(s),["stop"]))},[n.value?.config?.displayTitle?(o(),g("div",{key:0,class:"widget-titulo",style:M(n.value?.styles.title||{})},L(n.value?.name),5)):S("",!0),n.value?.vue_component?(o(),g("div",{key:1,class:"inner-widget",style:M(n.value?.styles.inner||{})},[(o(),B(j(n.value?.vue_component),{"painel-id":x.painelId,"widget-selected":n.value?.id},null,8,["painel-id","widget-selected"]))],4)):S("",!0),n.value?.vue_component?S("",!0):(o(),g("div",K,[(o(!0),g(P,null,N(E.value,(s,i)=>(o(),B(c,{key:`widget-${s.id}-${i}`,"painel-id":x.painelId,"widget-selected":s.id},null,8,["painel-id","widget-selected"]))),128))])),l.value.editmode?(o(),g("div",Q,[_("div",Z,[_("button",{class:"btn btn-sm btn-dark",onClick:e[0]||(e[0]=F(s=>t.modalEditorOpened=!0,["stop"]))},[G(r,{icon:"fa-solid fa-pen-to-square"})])]),_("div",{class:"resize-handle top-left",onMousedown:e[1]||(e[1]=s=>a(s,"top-left"))},null,32),_("div",{class:"resize-handle top-right",onMousedown:e[2]||(e[2]=s=>a(s,"top-right"))},null,32),_("div",{class:"resize-handle bottom-left",onMousedown:e[3]||(e[3]=s=>a(s,"bottom-left"))},null,32),_("div",{class:"resize-handle bottom-right",onMousedown:e[4]||(e[4]=s=>a(s,"bottom-right"))},null,32),_("div",{class:"resize-handle center-center",onMousedown:e[5]||(e[5]=s=>a(s,"center-center"))},null,32)])):S("",!0)],38)}}},ee=V(C,[["__scopeId","data-v-4a759db8"]]),te={__name:"VisaoDePainel",props:{painelId:{type:Number,default:0},visaodepainelSelected:{type:Number,default:0}},setup(x){const d=X(),f=x,h=k(()=>d.data_cache.painelset_visaodepainel?.[f.visaodepainelSelected]||null),$=k(()=>z.orderBy(z.filter(d.data_cache.painelset_widget,{visao:f.visaodepainelSelected,parent:null})||[],["position"],["asc"]));return(async()=>{d.fetchSync({app:"painelset",model:"widget",filters:{visaodepainel:f.visaodepainelSelected}}).then(n=>{n&&n.data.results.length>0})})(),(n,b)=>(o(),g("div",{class:"painelset-visaodepainel",style:M(h.value?.styles.component||{})},[h.value?.config?.displayTitle?(o(),g("div",{key:0,class:"visaodepainel-titulo",style:M(h.value?.styles.title||{})},L(h.value?.name),5)):S("",!0),_("div",{class:"inner-visaodepainel",style:M(h.value?.styles.inner||{})},[(o(!0),g(P,null,N($.value,(E,m)=>(o(),B(ee,{key:`widget-${E.id}-${m}`,"painel-id":x.painelId,"widget-selected":E.id},null,8,["painel-id","widget-selected"]))),128))],4)],4))}},ne=V(te,[["__scopeId","data-v-4952547c"]]),ie={class:"actions"},se={class:"btn-group btn-group-sm",role:"group","aria-label":"VisÃµes do Painel"},ae=["onClick"],le={__name:"Painel",props:{painelId:{type:String,default:"0"}},setup(x){const d=X(),f=U(),h=O();d.registerModels("painelset",["painel","visaodepainel","widget","evento"]),d.registerModels("sessao",["sessaoplenaria"]),d.registerModels("materia",["materialegislativa"]);const $=x,l=R(Number(h.params.painelId)||0),n=R(Number($.painelId)||l.value||0),b=k(()=>d.data_cache.painelset_painel?.[n.value]||null),E=k(()=>z.orderBy(z.filter(d.data_cache.painelset_visaodepainel,{painel:n.value})||[],["position"],["asc"])),m=R(null);T(()=>$.painelId,a=>{a!==n.value&&(n.value=a,W())}),T(()=>n.value,a=>{a&&I(a)});const I=async a=>{d.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:a}}).then(t=>{if(t&&t.data.results.length>0){const e=t.data.results.find(c=>c.active===!0);e?m.value=e.id:m.value=t.data.results[0].id}})},W=async()=>{n.value?d.fetchSync({app:"painelset",model:"painel",id:n.value}).then(()=>{I(n.value)}).catch(a=>{console.error("Error fetching painel:",a),f.push({name:"painelset_error_404",params:{pathMatch:"error"}})}):d.fetchSync({app:"painelset",model:"evento",params:{end_real__isnull:!0,start_real__isnull:!1}}).then(a=>{if(a&&a.data.results.length>0){const t=a.data.results[0];d.fetchSync({app:"painelset",model:"painel",params:{evento:t.id}}).then(e=>{if(e&&e.data.results.length>0){const c=e.data.results[0];n.value=c.id}else f.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(e=>{console.error("Error fetching painel for evento:",e),f.push({name:"painelset_error_404",params:{pathMatch:"error"}})})}else f.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(a=>{console.error("Error fetching evento:",a),f.push({name:"painelset_error_404",params:{pathMatch:"error"}})})},D=a=>{m.value=a};return W(),(a,t)=>(o(),g("div",{class:"painelset-painel",style:M(b.value?.styles.component||{})},[b.value?.config?.displayTitle?(o(),g("div",{key:0,class:"painel-titulo",style:M(b.value?.styles.title||{})},L(b.value?.name),5)):S("",!0),m.value?(o(),g("div",{key:1,class:"inner-painelset-painel",style:M(b.value?.styles.inner||{})},[(o(),B(ne,{key:`visaodepainel-${m.value.id}`,"painel-id":n.value,"visaodepainel-selected":m.value},null,8,["painel-id","visaodepainel-selected"])),_("div",ie,[_("div",se,[(o(!0),g(P,null,N(E.value,(e,c)=>(o(),g("button",{key:`${e.id}_${c}`,class:A([{active:e.id===m.value},"btn btn-primary"]),onClick:r=>D(e.id)},L(e.position),11,ae))),128))])])],4)):S("",!0),S("",!0)],4))}},ce=V(le,[["__scopeId","data-v-4967246c"]]);export{ce as default};
