import{v as E,y as te,c as z,_ as I,D as C,w as Z,f as x,g as y,k as e,i as N,E as D,G as ce,F as ne,r as le,t as H,H as F,I as g,q as S,C as ee,l as G,J as X,K as pe,T as de,n as ie,o as ve,L as fe,M as ge,N as me}from"./vendor-BruB_2AI.js";import{_ as oe,u as se,a as re,R as U,b as ue}from"./main-BGbnn2ui.js";import{a as Q}from"./TeleportStore-B5KgZ3nF.js";import"./vendor_fortawesome-CBP6yMhR.js";const ye={class:"container"},he={class:"row py-2"},we={key:0,class:"col-6"},be=["value"],_e={class:"col-6"},$e={class:"row py-2"},Me={class:"col-6"},Ee={id:"div_id_config",class:"form-group"},xe={class:"col-6"},Pe={id:"div_id_styles",class:"form-group"},Se={class:"container"},ke={class:"row"},We={class:"col-12"},Ve={id:"div_id_description",class:"form-group"},Ce={class:"container actions pt-3"},ze={class:"row"},Ae={class:"col-12"},Ie={class:"btn-group"},Le={__name:"WidgetEditor",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(W){const V=E(null),m=se(),b=re(),$=te("EventBus"),k=W,n=E({"":"Nenhum componente selecionado",WidgetSessaoPlenariaStatus:"WidgetSessaoPlenariaStatus - Título da Sessão Plenária vinculada ao Painel",WidgetSessaoRegistroPresenca:"WidgetSessaoRegistroPresenca - Registro de Presença da Sessão Plenária vinculada ao Painel",WidgetCronometroEvento:"WidgetCronometroEvento - Cronômetro do Evento vinculado ao Painel",WidgetCronometroPalavra:"WidgetCronometroPalavra - Cronômetro da Palavra vinculada ao Painel",WidgetStatusEventoSessao:"WidgetStatusEventoSessao - Status da Sessão e do Evento vinculados ao Painel",WidgetHtmlCode:"WidgetHtmlCode - Código HTML personalizado",WidgetYoutubeEmbed:"WidgetYoutubeEmbed - Iframe do YouTube personalizado"}),r=z(()=>m.data_cache.painelset_widget?.[k.widgetSelected]||null),_=z(()=>I.orderBy(I.filter(m.data_cache.painelset_widget,{parent:k.widgetSelected})||[],["position"],["asc"])),a=z(()=>!r.value||!r.value.config?"":C.dump(r.value.config)),s=z(()=>!r.value||!r.value.styles?"":C.dump({component:r.value.styles.component||{},title:r.value.styles.title||{display:"flex"},inner:r.value.styles.inner||{}})),h=E({config:a.value,styles:s.value}),M=t=>{$.emit("painelset:editorarea:close")},A=()=>{if(r.value)try{const t=h.value.config?C.load(h.value.config):{},d=h.value.styles?C.load(h.value.styles):{};r.value.styles=d,r.value.config=t,h.value.config=C.dump(t),h.value.styles=C.dump(d),w({config:t,styles:d})}catch(t){b.addMessage({type:"danger",text:`Erro ao atualizar os campos YAML: ${t.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos YAML:",t),h.value.config=a.value,h.value.styles=s.value}},O=t=>{console.log("WidgetEditor.vue: changeForm event:",t);const d={...r.value};delete d.id,n.value[d.vue_component]===void 0&&(d.vue_component=""),["styles","config"].includes(t.target.name)||w(d)},w=async t=>{try{await U.Utils.patchModel({app:"painelset",model:"widget",id:r.value.id,form:t}),b.addMessage({type:"info",text:"Widget atualizado.",timeout:2e3}),console.log("WidgetEditor.vue: patchModel updated successfully.")}catch(d){b.addMessage({type:"danger",text:"Erro ao salvar as alterações do Widget.",timeout:5e3}),console.error("Erro ao salvar as alterações do Widget:",d)}};Z(()=>r.value,t=>{t&&(h.value.config=a.value,h.value.styles=s.value)});const u=t=>{r.value&&confirm(`Confirma a exclusão do Widget: ${r.value.name} ?`)&&U.Utils.deleteModel({app:"painelset",model:"widget",id:r.value.id}).then(()=>{console.log("Widget deleted successfully")}).catch(d=>{console.error("Error deleting widget:",d)})};return(t,d)=>{const v=ee("FontAwesomeIcon");return y(),x("div",{ref_key:"painelsetWidgetEditor",ref:V,key:`painelset-widget-editor-${r.value?.id}`,class:"painelset-widget-editor"},[e("form",{action:"",onChange:d[7]||(d[7]=P=>O(P))},[e("fieldset",null,[d[13]||(d[13]=e("legend",null,"Configurações do Widget",-1)),e("div",ye,[e("div",he,[_.value.length===0?(y(),x("div",we,[d[8]||(d[8]=e("label",{for:"widget-vue-component",class:"form-label"},"Componente Vue",-1)),D(e("select",{class:"form-select","onUpdate:modelValue":d[0]||(d[0]=P=>r.value.vue_component=P),id:"widget-vue-component"},[(y(!0),x(ne,null,le(n.value,(P,j)=>(y(),x("option",{key:`widget-vue-component-option-${j}`,value:j},H(P),9,be))),128))],512),[[ce,r.value.vue_component]])])):N("",!0),e("div",_e,[d[9]||(d[9]=e("label",{for:"widget-name",class:"form-label"},"Título do Widget",-1)),D(e("input",{type:"text",class:"form-control","onUpdate:modelValue":d[1]||(d[1]=P=>r.value.name=P),placeholder:"Título do Widget"},null,512),[[F,r.value.name]])])]),e("div",$e,[e("div",Me,[e("div",Ee,[d[10]||(d[10]=e("label",{for:"widget-config",class:"form-label"},"Configurações do Widget (YAML)",-1)),e("div",null,[D(e("textarea",{id:"widget-config",name:"config",class:"form-control","onUpdate:modelValue":d[2]||(d[2]=P=>h.value.config=P),placeholder:"Configurações do Widget em YAML",rows:"15",onBlur:A},null,544),[[F,h.value.config]])])])]),e("div",xe,[e("div",Pe,[d[11]||(d[11]=e("label",{for:"widget-styles",class:"form-label"},"Estilos do Widget (YAML)",-1)),e("div",null,[D(e("textarea",{name:"styles",id:"widget-styles",class:"form-control","onUpdate:modelValue":d[3]||(d[3]=P=>h.value.styles=P),rows:"15",placeholder:"Estilos do Widget em YAML",onBlur:A},null,544),[[F,h.value.styles]])])])])])]),e("div",Se,[e("div",ke,[e("div",We,[e("div",Ve,[d[12]||(d[12]=e("label",{for:"id_description",class:"form-label"},"Descrição do Widget",-1)),e("div",null,[D(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":d[4]||(d[4]=P=>r.value.description=P),placeholder:"Descrição do Widget",rows:"5"},null,512),[[F,r.value.description]])])])])])]),e("div",Ce,[e("div",ze,[e("div",Ae,[e("div",Ie,[e("button",{class:"btn btn-secondary",onClick:d[5]||(d[5]=g(P=>M(),["stop","prevent"])),title:"Fechar Editor de Widget"},[S(v,{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-danger",onMousedown:g(P=>!1,["stop","prevent"]),onClick:d[6]||(d[6]=g(P=>u(),["stop","prevent"]))},[S(v,{icon:"fa-solid fa-trash-can"})],32)])])])])])],32)])}}},Be=oe(Le,[["__scopeId","data-v-8749e089"]]),Ye=["id"],De={key:1,class:"inner-widget inner-children"},Ue={key:2,class:"manager"},Fe={class:"position"},Ne={class:"toolbar"},Te={class:"btn-group"},Re={class:"btn-group"},He={class:"btn-group right"},Oe={__name:"Widget",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(W){const V=se(),m=ue(),b=te("EventBus"),$=W,k=E(!1),n=E(null),r=E(!1),_=E({}),a=E({x:0,y:0,w:100,h:100,mouseResizeEnter:!1}),s=z(()=>V.data_cache.painelset_widget?.[$.widgetSelected]||null),h=z(()=>{if(!s.value||!s.value.config?.coords)return{};const i={},o=s.value.config.coords;return o.x!==void 0&&(i.left=`${o.x}%`),o.y!==void 0&&(i.top=`${o.y}%`),o.w!==void 0&&(i.right=`${o.w+o.x>100?0:100-(o.w+o.x)}%`),o.h!==void 0&&(i.bottom=`${o.h+o.y>100?0:100-(o.h+o.y)}%`),i}),M=z(()=>I.orderBy(I.filter(V.data_cache.painelset_widget,{parent:$.widgetSelected})||[],["position"],["asc"]));(async()=>{V.fetchSync({app:"painelset",model:"widget",filters:{parent:$.widgetSelected}}).then(()=>{})})(),b.on("painelset:editorarea:close",()=>{r.value=!1,Q.value=null});const O=()=>{console.debug("Opening widget editor modal for widget:",s.value),b.emit("painelset:editorarea:close"),r.value=!0,Q.value=s.value.id},w=()=>m.isAuthenticated?m.hasPermission("painelset.change_widget"):!1,u=(i=>{if(console.debug("Received oncomponent event:"),!i||!i.type){console.warn("Invalid oncomponent event received, missing type");return}if(i.type==="extra_styles"){if(!i.extra_styles){console.warn("Invalid extra_styles event, missing extra_styles data");return}const o={...i.extra_styles};_.value=o}}),t=()=>{s.value&&confirm(`Confirma a exclusão do Widget: ${s.value.name} e todos seus SubWidgets?`)&&U.Utils.deleteModel({app:"painelset",model:"widget",id:s.value.id}).then(()=>{console.log("Widget deleted successfully")}).catch(i=>{console.error("Error deleting widget:",i)})},d=()=>{if(!s.value)return;const i={...s.value.config,coords:{...s.value.config.coords,x:10,y:10}},o={...s.value,id:void 0,name:`${s.value.name} (Cópia)`,position:M.value.length+1,config:i};U.Utils.createModel({app:"painelset",model:"widget",form:o}).then(p=>{console.log("Widget duplicated successfully:",p.data)}).catch(p=>{console.error("Error duplicating widget:",p)})},v=()=>{if(!s.value)return;const i={name:"Novo Widget",parent:s.value.id,visao:s.value.visao,position:M.value.length+1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30},displayTitle:!0},styles:{component:{},title:{},inner:{}}};U.Utils.createModel({app:"painelset",model:"widget",form:i}).then(o=>{console.log("Default child widget created successfully:",o.data)}).catch(o=>{console.error("Error creating default child widget:",o)})},P=i=>!i||i.x===void 0||i.y===void 0||i.w===void 0||i.h===void 0||i.x===null||i.y===null||i.w===null||i.h===null?!1:i.w>5&&i.w<=100&&i.h>5&&i.h<=100&&i.x>=0&&i.x<=100&&i.y>=0&&i.y<=100&&i.x+i.w<=100&&i.y+i.h<=100,j=(i,o)=>{if(!s.value)return;const p=s.value.position+o;p<1||U.Utils.patchModel({app:"painelset",model:"widget",id:s.value.id,form:{position:p}}).then(c=>{console.log("Widget position updated successfully:",c.data)}).catch(c=>{console.error("Error updating widget position:",c)})},J=i=>{if(!P(i)){console.error("Invalid widget coordinates, aborting update");return}U.Utils.patchModel({app:"painelset",model:"widget",id:s.value.id,form:{config:{...s.value.config,coords:{...s.value.config.coords,x:i.x,y:i.y,w:i.w,h:i.h}}}}).then(o=>{console.log(o.data),console.log("Widget coordinates updated successfully")}).catch(o=>{console.error("Error updating widget coordinates:",o)})},ae=i=>{i.preventDefault(),!a.value.mouseResizeEnter&&w()&&(k.value=!k.value,k.value||(r.value=!1,b.emit("painelset:editorarea:close")),console.log("Activating painel editor teleport for Widget:",$.widgetSelected))},q=(i,o)=>{if(a.value.mouseResizeEnter=!0,i.preventDefault(),!k.value)return;const p=n.value,c=p.getBoundingClientRect(),l=p.parentElement.getBoundingClientRect(),f={...a.value};console.log("Mouse move detected:",i.clientX,i.clientY,c);const K=L=>{let B=0,Y=0;if(o==="top-left"){const T=L.clientX-c.left,R=L.clientY-c.top;B=Math.round(T/l.width*100),Y=Math.round(R/l.height*100),f.w=s.value.config.coords.w-B,f.h=s.value.config.coords.h-Y,f.x=s.value.config.coords.x+B,f.y=s.value.config.coords.y+Y}else if(o==="top-right"){const T=L.clientX-c.right,R=L.clientY-c.top;B=Math.round(T/l.width*100),Y=Math.round(R/l.height*100),f.w=s.value.config.coords.w+B,f.h=s.value.config.coords.h-Y,f.x=s.value.config.coords.x,f.y=s.value.config.coords.y+Y}else if(o==="bottom-right"){const T=L.clientX-c.right,R=L.clientY-c.bottom;B=Math.round(T/l.width*100),Y=Math.round(R/l.height*100),f.w=s.value.config.coords.w+B,f.h=s.value.config.coords.h+Y,f.x=s.value.config.coords.x,f.y=s.value.config.coords.y}else if(o==="bottom-left"){const T=L.clientX-c.left,R=L.clientY-c.bottom;B=Math.round(T/l.width*100),Y=Math.round(R/l.height*100),f.w=s.value.config.coords.w-B,f.h=s.value.config.coords.h+Y,f.x=s.value.config.coords.x+B,f.y=s.value.config.coords.y}else if(o==="center-center"){const T=L.clientX-c.left-c.width/2,R=L.clientY-c.top-c.height/2;B=Math.round(T/l.width*100),Y=Math.round(R/l.height*100),console.debug("Resizing widget...",T,R,o,B,Y,f),f.w=s.value.config.coords.w,f.h=s.value.config.coords.h,f.x=s.value.config.coords.x+B,f.y=s.value.config.coords.y+Y}console.debug("Resizing widget...",L.clientX,L.clientY,o,B,Y,f),P(f)?(a.value.w=f.w,a.value.h=f.h,a.value.x=f.x,a.value.y=f.y,p.style.right=`${100-(f.w+f.x)}%`,p.style.bottom=`${100-(f.h+f.y)}%`,p.style.left=`${f.x}%`,p.style.top=`${f.y}%`):console.warn("Invalid coordinates during resize, ignoring update")};console.log("Starting resize operation"),window.addEventListener("mousemove",K),window.addEventListener("mouseup",L=>{window.removeEventListener("mouseup",this),window.removeEventListener("mousemove",K),L.preventDefault(),a.value.mouseResizeEnter&&(a.value.mouseResizeEnter=!1,J({x:a.value.x,y:a.value.y,w:a.value.w,h:a.value.h}),console.log("Resize operation ended"))})};return(i,o)=>{const p=ee("Widget",!0),c=ee("FontAwesomeIcon");return y(),x("div",{id:`id-painelset-widget-${s.value?.id}`,ref_key:"painelsetWidget",ref:n,key:`painelset-widget-${s.value?.id}`,class:ie(["painelset-widget",k.value?"editmode":""]),style:X({...s.value?.styles.component||{},...h.value,..._.value}),onMousedown:o[11]||(o[11]=g(l=>ae(l),["stop","prevent"])),onClick:g(l=>!1,["stop","prevent"])},[e("div",{class:"widget-titulo",style:X(s.value?.styles.title||{})},H(s.value?.name),5),s.value?.vue_component?(y(),x("div",{key:0,class:"inner-widget",style:X(s.value?.styles.inner||{})},[(y(),G(pe(s.value?.vue_component),{"painel-id":W.painelId,"widget-selected":s.value?.id,"coords-change":a.value,onOncomponent:u},null,40,["painel-id","widget-selected","coords-change"]))],4)):N("",!0),s.value?.vue_component?N("",!0):(y(),x("div",De,[(y(!0),x(ne,null,le(M.value,(l,f)=>(y(),G(p,{key:`widget-${l.id}-${f}`,"painel-id":W.painelId,"widget-selected":l.id},null,8,["painel-id","widget-selected"]))),128))])),k.value?(y(),x("div",Ue,[e("div",Fe,H(s.value?.position),1),e("div",Ne,[e("div",Te,[e("button",{class:"btn btn-secondary btn-move-backward",onMousedown:g(l=>!1,["stop","prevent"]),onClick:o[0]||(o[0]=g(l=>j(l,-1),["stop","prevent"])),title:"Mover uma camada para trás"},[S(c,{icon:"fa-solid fa-arrow-down-1-9"})],32),e("button",{class:"btn btn-secondary btn-move-forward",onMousedown:g(l=>!1,["stop","prevent"]),onClick:o[1]||(o[1]=g(l=>j(l,1),["stop","prevent"])),title:"Mover uma camada para frente"},[S(c,{icon:"fa-solid fa-arrow-up-1-9"})],32)]),e("div",Re,[e("button",{class:"btn btn-sm btn-danger",onMousedown:g(l=>!1,["stop","prevent"]),onClick:o[2]||(o[2]=g(l=>t(),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-trash-can"})],32),e("button",{class:"btn btn-sm btn-secondary",onMousedown:g(l=>!1,["stop","prevent"]),onClick:o[3]||(o[3]=g(l=>d(),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-clone"})],32),e("button",{class:"btn btn-sm btn-primary",onMousedown:g(l=>!1,["stop","prevent"]),onClick:o[4]||(o[4]=g(l=>v(),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-plus"})],32)]),e("div",He,[e("button",{class:"btn btn-sm btn-dark",onMousedown:g(l=>!1,["stop","prevent"]),onClick:o[5]||(o[5]=g(l=>O(),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-pen-to-square"})],32)])]),e("div",{class:"resize-handle top-left",onMousedown:o[6]||(o[6]=l=>q(l,"top-left"))},null,32),e("div",{class:"resize-handle top-right",onMousedown:o[7]||(o[7]=l=>q(l,"top-right"))},null,32),e("div",{class:"resize-handle bottom-left",onMousedown:o[8]||(o[8]=l=>q(l,"bottom-left"))},null,32),e("div",{class:"resize-handle bottom-right",onMousedown:o[9]||(o[9]=l=>q(l,"bottom-right"))},null,32),e("div",{class:"resize-handle center-center",onMousedown:o[10]||(o[10]=l=>q(l,"center-center"))},null,32)])):N("",!0),r.value?(y(),G(de,{key:3,to:"#painelset-editorarea",disabled:!r.value},[S(Be,{"painel-id":W.painelId,"widget-selected":s.value?.id},null,8,["painel-id","widget-selected"])],8,["disabled"])):N("",!0),N("",!0)],46,Ye)}}},Xe=oe(Oe,[["__scopeId","data-v-7f857f7b"]]),je={class:"container"},qe={class:"row py-2"},Ze={class:"col-6"},Ge={class:"row py-2"},Je={class:"col-6"},Ke={id:"div_id_config",class:"form-group"},Qe={class:"col-6"},et={id:"div_id_styles",class:"form-group"},tt={class:"container"},ot={class:"row"},st={class:"col-12"},nt={id:"div_id_description",class:"form-group"},lt={class:"container actions pt-3"},at={class:"row"},it={class:"col-12 d-flex gap-2"},dt={class:"btn-group"},rt={class:"btn-group"},ut={__name:"VisaoEditor",props:{painelId:{type:Number,default:0},visaoSelected:{type:Number,default:0}},setup(W){const V=te("EventBus"),m=E(null),b=se(),$=re(),k=W,n=z(()=>b.data_cache.painelset_visaodepainel?.[k.visaoSelected]||null),r=z(()=>!n.value||!n.value.config?"":C.dump(n.value.config)),_=z(()=>!n.value||!n.value.styles?"":C.dump({component:n.value.styles.component||{},title:n.value.styles.title||{display:"flex"},inner:n.value.styles.inner||{}})),a=E({config:r.value,styles:_.value}),s=()=>{if(n.value)try{const u=a.value.config?C.load(a.value.config):{},t=a.value.styles?C.load(a.value.styles):{};n.value.styles=t,n.value.config=u,a.value.config=C.dump(u),a.value.styles=C.dump(t),M({config:u,styles:t})}catch(u){$.addMessage({type:"danger",text:`Erro ao atualizar os campos YAML: ${u.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos YAML:",u),a.value.config=r.value,a.value.styles=_.value}},h=u=>{console.log("VisaoEditor.vue: changeForm event:",u);const t={...n.value};delete t.id,["styles","config"].includes(u.target.name)||M(t)},M=async u=>{try{await U.Utils.patchModel({app:"painelset",model:"visaodepainel",id:n.value.id,form:u}),$.addMessage({type:"info",text:"Visão do Painel atualizado.",timeout:2e3}),console.log("VisaoEditor.vue: patchModel updated successfully.")}catch(t){$.addMessage({type:"danger",text:"Erro ao salvar as alterações do Visão do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Visão do Painel:",t)}};Z(()=>n.value,u=>{u&&(a.value.config=r.value,a.value.styles=_.value)});const A=u=>{V.emit("painelset:editorarea:close",n.value.id)},O=()=>{n.value&&confirm(`Confirma a exclusão da Visão do Painel: ${n.value.name} ?`)&&U.Utils.deleteModel({app:"painelset",model:"visaodepainel",id:n.value.id}).then(()=>{$.addMessage({type:"info",text:"Visão do Painel excluído com sucesso.",timeout:5e3}),V.emit("painelset:editorarea:close")}).catch(u=>{$.addMessage({type:"danger",text:"Erro ao excluir a Visão do Painel.",timeout:5e3}),console.error("Error deleting visaodepainel:",u)})},w=()=>{if(!n.value)return;const u={name:"Novo Widget",parent:null,visao:n.value.id,position:b.data_cache.painelset_widget?Object.values(b.data_cache.painelset_widget).filter(t=>t.visao===n.value.id).length+1:1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30}},styles:{component:{},title:{display:"flex"},inner:{}}};U.Utils.createModel({app:"painelset",model:"widget",form:u}).then(t=>{console.log("Default child widget created successfully:",t.data)}).catch(t=>{console.error("Error creating default child widget:",t)})};return(u,t)=>{const d=ee("FontAwesomeIcon");return y(),x("div",{ref_key:"painelsetVisaoEditor",ref:m,key:`painelset-visaodepainel-editor-${n.value?.id}`,class:"painelset-visaodepainel-editor"},[e("form",{action:"",onChange:t[7]||(t[7]=v=>h(v))},[e("fieldset",null,[t[12]||(t[12]=e("legend",null,"Configurações da Visão do Painel",-1)),e("div",je,[e("div",qe,[e("div",Ze,[t[8]||(t[8]=e("label",{for:"painel-name",class:"form-label"},"Título da Visão do Painel",-1)),D(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=v=>n.value.name=v),placeholder:"Título da Visão do Painel"},null,512),[[F,n.value.name]])])]),e("div",Ge,[e("div",Je,[e("div",Ke,[t[9]||(t[9]=e("label",{for:"painel-config",class:"form-label"},"Configurações da Visão do Painel (YAML)",-1)),e("div",null,[D(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=v=>a.value.config=v),placeholder:"Configurações da Visão do Painel em YAML",rows:"15",onBlur:s},null,544),[[F,a.value.config]])])])]),e("div",Qe,[e("div",et,[t[10]||(t[10]=e("label",{for:"painel-styles",class:"form-label"},"Estilos da Visão do Painel (YAML)",-1)),e("div",null,[D(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=v=>a.value.styles=v),rows:"15",placeholder:"Estilos da Visão do Painel em YAML",onBlur:s},null,544),[[F,a.value.styles]])])])])])]),e("div",tt,[e("div",ot,[e("div",st,[e("div",nt,[t[11]||(t[11]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[D(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=v=>n.value.description=v),placeholder:"Descrição do Painel",rows:"5"},null,512),[[F,n.value.description]])])])])])]),e("div",lt,[e("div",at,[e("div",it,[e("div",dt,[e("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=g(v=>A(),["stop","prevent"])),title:"Fechar Editor da Visão do Painel"},[S(d,{icon:["fas","times"]})]),e("button",{class:"btn btn-danger",onMousedown:g(v=>!1,["stop","prevent"]),onClick:t[5]||(t[5]=g(v=>O(),["stop","prevent"])),title:"Excluir Visão do Painel"},[S(d,{icon:"fa-solid fa-trash-can"})],32)]),e("div",rt,[e("button",{class:"btn btn-primary",onMousedown:g(v=>!1,["stop","prevent"]),onClick:t[6]||(t[6]=g(v=>w(),["stop","prevent"])),title:"Adicionar Widget à Visão do Painel"},[S(d,{icon:"fa-solid fa-plus"})],32)])])])])])],32)])}}},ct=oe(ut,[["__scopeId","data-v-4e009faf"]]),vt=["id"],pt={key:0,class:"visao-empty"},ft={__name:"VisaoDePainel",props:{painelId:{type:Number,default:0},visaodepainelSelected:{type:Number,default:0},editmodeVisao:{type:Boolean,default:!1}},setup(W){const V=se();ue();const m=W;te("EventBus");const b=E(m.editmodeVisao),$=E(null),k=z(()=>V.data_cache.painelset_visaodepainel?.[m.visaodepainelSelected]||null),n=z(()=>I.orderBy(I.filter(V.data_cache.painelset_widget,{visao:m.visaodepainelSelected,parent:null})||[],["position"],["asc"]));return Z(()=>m.editmodeVisao,_=>{b.value=_,_&&(Q.value=$.value.id)}),(async()=>{V.fetchSync({app:"painelset",model:"widget",filters:{visaodepainel:m.visaodepainelSelected}}).then(_=>{})})(),(_,a)=>(y(),x("div",{id:`id-painelset-visaodepainel${W.visaodepainelSelected}`,ref_key:"painelsetVisaodepainel",ref:$,key:`painelset-visaodepainel${W.visaodepainelSelected}`,class:"painelset-visaodepainel",style:X(k.value?.styles.component||{})},[e("div",{class:"visaodepainel-titulo",style:X(k.value?.styles.title||{})},H(k.value?.name),5),e("div",{class:"inner-visaodepainel",style:X(k.value?.styles.inner||{})},[(y(!0),x(ne,null,le(n.value,(s,h)=>(y(),G(Xe,{key:`widget-${s.id}-${h}`,"painel-id":W.painelId,"widget-selected":s.id},null,8,["painel-id","widget-selected"]))),128))],4),n.value.length===0?(y(),x("div",pt,[...a[0]||(a[0]=[e("p",null,"Não há widgets configurados para esta visão.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar o primeiro widget à visão.",-1)])])):N("",!0),b.value?(y(),G(de,{key:1,to:"#painelset-editorarea",disabled:!b.value},[S(ct,{"painel-id":W.painelId,"visao-selected":W.visaodepainelSelected},null,8,["painel-id","visao-selected"])],8,["disabled"])):N("",!0)],12,vt))}},gt=oe(ft,[["__scopeId","data-v-5dcca744"]]),mt={class:"container"},yt={class:"row py-2"},ht={class:"col-6"},wt={class:"col-6"},bt=["value"],_t={class:"row py-2"},$t={class:"col-6"},Mt={id:"div_id_config",class:"form-group"},Et={class:"col-6"},xt={id:"div_id_styles",class:"form-group"},Pt={class:"container"},St={class:"row"},kt={class:"col-12"},Wt={id:"div_id_description",class:"form-group"},Vt={class:"container actions pt-3"},Ct={class:"row"},zt={class:"col-12"},At={class:"btn-group"},It={__name:"PainelEditor",props:{painelId:{type:Number,default:0},painelSelected:{type:Number,default:0}},setup(W){const V=E(null),m=se(),b=re(),$=te("EventBus"),k=W,n=z(()=>m.data_cache.painelset_painel?.[k.painelSelected]||null),r=z(()=>!n.value||!n.value.config?"":C.dump(n.value.config)),_=z(()=>!n.value||!n.value.styles?"":C.dump({component:n.value.styles.component||{},title:n.value.styles.title||{display:"flex"},inner:n.value.styles.inner||{}})),a=E({config:r.value,styles:_.value}),s=z(()=>I.orderBy(m.data_cache?.sessao_sessaoplenaria||[],["data_inicio"],["desc"]));ve(()=>{m.fetchSync({app:"sessao",model:"sessaoplenaria",params:{o:"-data_inicio"},only_first_page:!0})});const h=()=>{if(n.value)try{const u=a.value.config?C.load(a.value.config):{},t=a.value.styles?C.load(a.value.styles):{};n.value.styles=t,n.value.config=u,a.value.config=C.dump(u),a.value.styles=C.dump(t),A({config:u,styles:t})}catch(u){b.addMessage({type:"danger",text:`Erro ao atualizar os campos YAML: ${u.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos YAML:",u),a.value.config=r.value,a.value.styles=_.value}},M=u=>{console.log("PainelEditor.vue: changeForm event:",u);const t={...n.value};delete t.id,["styles","config"].includes(u.target.name)||A(t)},A=async u=>{try{await U.Utils.patchModel({app:"painelset",model:"painel",id:n.value.id,form:u}),b.addMessage({type:"info",text:"Painel atualizado.",timeout:2e3}),console.log("PainelEditor.vue: patchModel updated successfully.")}catch(t){b.addMessage({type:"danger",text:"Erro ao salvar as alterações do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Painel:",t)}};Z(()=>n.value,u=>{u&&(a.value.config=r.value,a.value.styles=_.value)});const O=()=>{$.emit("painelset:editorarea:close")},w=()=>{if(!n.value)return;const u={painel:n.value.id,name:"Nova Visão do Painel",description:"",position:m.data_cache.painelset_visaodepainel?Object.values(m.data_cache.painelset_visaodepainel).filter(t=>t.painel===n.value.id).length+1:1,active:!0,config:{},styles:{component:{},title:{display:"flex"},inner:{}}};U.Utils.createModel({app:"painelset",model:"visaodepainel",form:u}).then(t=>{b.addMessage({type:"info",text:"Visão do Painel criada com sucesso.",timeout:2e3}),m.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:n.value.id}})}).catch(t=>{b.addMessage({type:"danger",text:"Erro ao criar a Visão do Painel.",timeout:5e3}),console.error("Erro ao criar a Visão do Painel:",t)})};return(u,t)=>{const d=ee("FontAwesomeIcon");return y(),x("div",{ref_key:"painelsetPainelEditor",ref:V,key:`painelset-painel-editor-${n.value?.id}`,class:"painelset-painel-editor"},[e("form",{action:"",onChange:t[7]||(t[7]=v=>M(v))},[e("fieldset",null,[t[14]||(t[14]=e("legend",null,"Configurações do Painel",-1)),e("div",mt,[e("div",yt,[e("div",ht,[t[8]||(t[8]=e("label",{for:"painel-name",class:"form-label"},"Título do Painel",-1)),D(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=v=>n.value.name=v),placeholder:"Título do Painel"},null,512),[[F,n.value.name]])]),e("div",wt,[t[10]||(t[10]=e("label",{for:"painel-sessao",class:"form-label"},"Sessão Plenária Associada",-1)),D(e("select",{id:"painel-sessao",name:"sessao_plenaria",class:"form-select","onUpdate:modelValue":t[1]||(t[1]=v=>n.value.sessao=v)},[t[9]||(t[9]=e("option",{value:null},"-- Nenhuma --",-1)),(y(!0),x(ne,null,le(s.value,v=>(y(),x("option",{key:`sessao-option-${v.id}`,value:v.id},H(v.__str__)+" ("+H(v.data_inicio)+" - "+H(v.data_fim||"")+") ",9,bt))),128))],512),[[ce,n.value.sessao]])])]),e("div",_t,[e("div",$t,[e("div",Mt,[t[11]||(t[11]=e("label",{for:"painel-config",class:"form-label"},"Configurações do Painel (YAML)",-1)),e("div",null,[D(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=v=>a.value.config=v),placeholder:"Configurações do Painel em YAML",rows:"15",onBlur:h},null,544),[[F,a.value.config]])])])]),e("div",Et,[e("div",xt,[t[12]||(t[12]=e("label",{for:"painel-styles",class:"form-label"},"Estilos do Painel (YAML)",-1)),e("div",null,[D(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=v=>a.value.styles=v),rows:"15",placeholder:"Estilos do Painel em YAML",onBlur:h},null,544),[[F,a.value.styles]])])])])])]),e("div",Pt,[e("div",St,[e("div",kt,[e("div",Wt,[t[13]||(t[13]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[D(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=v=>n.value.description=v),placeholder:"Descrição do Painel",rows:"5"},null,512),[[F,n.value.description]])])])])])]),e("div",Vt,[e("div",Ct,[e("div",zt,[e("div",At,[e("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=g(v=>O(),["stop","prevent"])),title:"Fechar Editor do Painel"},[S(d,{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-primary",onMousedown:g(v=>!1,["stop","prevent"]),onClick:t[6]||(t[6]=g(v=>w(),["stop","prevent"])),title:"Adicionar Visão do Painel"},[S(d,{icon:"fa-solid fa-plus"})],32)])])])])])],32)])}}},Lt=oe(It,[["__scopeId","data-v-f1b8df41"]]),Bt=["id"],Yt={key:1,class:"painel-empty"},Dt={class:"actions"},Ut=["title"],Ft={class:"btn btn-link"},Nt={key:0,class:"btn-group",role:"group","aria-label":"Visões do Painel"},Tt=["title"],Rt={class:"toolbar"},Ht={class:"btn-group",role:"group","aria-label":"Visões do Painel"},Ot={key:0,class:"btn-group",role:"group","aria-label":"Visões do Painel"},Xt=["title"],jt=["onClick"],qt={__name:"Painel",props:{painelId:{type:String,default:"0"},zoomFontProp:{type:Number,default:1}},setup(W){const V=te("EventBus"),m=se(),b=ue(),$=ge(),k=fe();m.registerModels("painelset",["painel","visaodepainel","widget","evento","individuo","cronometro"]),m.registerModels("sessao",["sessaoplenaria"]);const n=W,r=E(!1),_=E(!1),a=E(null),s=E(!1),h=E(null),M=E(null),A=E(n.zoomFontProp),O=E(Number(k.params.painelId)||0),w=E(Number(n.painelId)||O.value||0),u=z(()=>m.data_cache.painelset_painel?.[w.value]||null),t=z(()=>I.orderBy(I.filter(m.data_cache.painelset_visaodepainel,{painel:w.value})||[],["position"],["asc"]));Z(()=>n.painelId,o=>{o!==w.value&&(w.value=o,P())}),Z(()=>w.value,o=>{o&&i(o)}),Z(()=>t.value,o=>{if(o.length>0){if(Q.value!==null){o.find(c=>c.id===M.value?.id)||(M.value=o[0].id);return}const p=o.find(c=>c.active===!0);p?M.value=p.id:M.value=o[0].id}else M.value=null},{immediate:!0,deep:!0});const d=o=>{o>0?A.value=Math.min(3,A.value+o):A.value=Math.max(.1,A.value+o)},v=()=>{b.isAuthenticated&&(s.value===!1?(s.value=!0,I.each(a.value.getElementsByClassName("painelset-widget"),o=>{o.classList.add("localize")}),h.value&&clearTimeout(h.value),h.value=setTimeout(()=>{s.value=!1,I.each(a.value.getElementsByClassName("painelset-widget"),o=>{o.classList.remove("localize")})},2e3)):(clearTimeout(h.value),h.value=setTimeout(()=>{s.value=!1,I.each(a.value.getElementsByClassName("painelset-widget"),o=>{o.classList.remove("localize")})},2e3)))},P=async()=>{w.value?m.fetchSync({app:"painelset",model:"painel",id:w.value}).then(o=>{o[w.value].sessao&&m.fetchSync({app:"sessao",model:"sessaoplenaria",id:o[w.value].sessao}),o[w.value].evento&&m.fetchSync({app:"painelset",model:"evento",id:o[w.value].evento}),i(w.value)}).catch(o=>{console.error("Error fetching painel:",o),$.push({name:"painelset_error_404",params:{pathMatch:"error"}})}):m.fetchSync({app:"painelset",model:"evento",params:{end_real__isnull:!0,start_real__isnull:!1}}).then(o=>{const p=I.orderBy(Object.values(o||{}),["start_real"],["asc"]).filter(c=>c.end_real===null);if(p&&p.length>0){const c=p[0];m.fetchSync({app:"painelset",model:"painel",params:{evento:c.id}}).then(l=>{const f=I.orderBy(Object.values(l||{}),["position"],["asc"]);if(f&&f.length>0){const K=f[0];w.value=K.id}else $.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(l=>{console.error("Error fetching painel for evento:",l),$.push({name:"painelset_error_404",params:{pathMatch:"error"}})})}else $.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(o=>{console.error("Error fetching evento:",o),$.push({name:"painelset_error_404",params:{pathMatch:"error"}})})},j=o=>{me(()=>{M.value=o})},J=()=>b.isAuthenticated?b.hasPermission("painelset.change_painel"):!1;ve(()=>{P(),setTimeout(()=>{t.value.length===0&&ae()},1500)}),V.on("painelset:editorarea:close",()=>{r.value=!1,_.value=!1,Q.value=null});const ae=()=>{J()&&(V.emit("painelset:editorarea:close"),r.value=!0,_.value=!1,Q.value=a.value.id)},q=()=>{J()&&(V.emit("painelset:editorarea:close"),r.value=!1,_.value=!0)},i=async o=>{m.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:o}}).then(p=>{const c=I.orderBy(Object.values(p||{}),["position"],["asc"]).find(l=>l.active===!0);if(c&&c.length>0){const l=c;l?M.value=l.id:M.value=c[0].id}})};return(o,p)=>{const c=ee("FontAwesomeIcon");return y(),x("div",{id:`id-painelset-painel-${w.value}`,ref_key:"painelsetPainel",ref:a,key:`painelset-painel-${w.value}`,class:"painelset-painel",style:X({...u.value?.styles.component||{},fontSize:`${A.value}em`}),onMousemove:p[6]||(p[6]=l=>v())},[e("div",{class:"painel-titulo",style:X(u.value?.styles.title||{})},H(u.value?.name),5),M.value?(y(),x("div",{key:0,class:"inner-painelset-painel",style:X(u.value?.styles.inner||{})},[(y(),G(gt,{key:`visaodepainel-${M.value.id}`,"painel-id":w.value,"visaodepainel-selected":M.value,"editmode-visao":_.value},null,8,["painel-id","visaodepainel-selected","editmode-visao"]))],4)):(y(),x("div",Yt,[...p[7]||(p[7]=[e("p",null,"Não há visões de painel configuradas para este painel.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar a primeira visão do painel.",-1)])])),e("div",Dt,[e("div",{class:"btn-group btn-group-sm",role:"group","aria-label":"Zoom da fonte",title:`Zoom aplicado aos elementos textuais: ${(A.value*100).toFixed(0)}%`},[e("button",Ft,H((A.value*100).toFixed(0))+"%",1),e("button",{class:"btn btn-link btn-zoom-out",onClick:p[0]||(p[0]=g(l=>d(-.1),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-angles-down"})]),e("button",{class:"btn btn-link btn-zoom-out",onClick:p[1]||(p[1]=g(l=>d(-.01),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-angle-down"})]),e("button",{class:"btn btn-link btn-zoom-in",onClick:p[2]||(p[2]=g(l=>d(.01),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-angle-up"})]),e("button",{class:"btn btn-link btn-zoom-in",onClick:p[3]||(p[3]=g(l=>d(.1),["stop","prevent"]))},[S(c,{icon:"fa-solid fa-angles-up"})]),J()?(y(),x("div",Nt,[e("button",{class:ie(["btn btn-link btn-editmode",{active:r.value}]),onClick:p[4]||(p[4]=g(l=>ae(),["stop","prevent"])),title:r.value?"Sair do modo de edição":"Entrar no modo de edição"},[S(c,{icon:"fa-solid fa-pen-to-square",size:"1x"})],10,Tt)])):N("",!0)],8,Ut),e("div",Rt,[e("div",Ht,[J()?(y(),x("div",Ot,[e("button",{class:ie(["btn btn-link btn-editmode",{active:_.value}]),onClick:p[5]||(p[5]=g(l=>q(),["stop","prevent"])),title:_.value?"Sair do modo de edição":"Entrar no modo de edição"},[S(c,{icon:"fa-solid fa-pen-to-square",size:"1x"})],10,Xt)])):N("",!0),(y(!0),x(ne,null,le(t.value,(l,f)=>(y(),x("button",{key:`${l.id}_${f}`,class:ie([{active:l.id===M.value},"btn btn-primary"]),onMousedown:g(K=>!1,["stop","prevent"]),onClick:g(K=>j(l.id),["stop","prevent"])},H(l.position),43,jt))),128))])])]),r.value?(y(),G(de,{key:2,to:"#painelset-editorarea",disabled:!r.value},[S(Lt,{"painel-id":w.value,"painel-selected":w.value},null,8,["painel-id","painel-selected"])],8,["disabled"])):N("",!0)],44,Bt)}}},Qt=oe(qt,[["__scopeId","data-v-3d73435a"]]);export{Qt as default};
