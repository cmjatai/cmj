import{z as T,c as h,o as E,m as F,H,f as l,g as n,k as e,I as N,w as q,A as w,i as g,l as S,t as y,q as k,j as L,F as b,r as $,n as D,B as z,T as V,J as P,K as G}from"./vendor-BM1kb-tK.js";import{b as x,u as j}from"./main-BJk_VMv-.js";import"./vendor_fortawesome-BzL3JmuE.js";const J=["id"],K={class:"modal-dialog modal-xl"},Y={class:"modal-content"},Q={class:"modal-header"},U=["innerHTML"],W=["innerHTML"],X={key:1,class:"modal-body"},Z={class:"modal-footer"},ee={__name:"NormaSimpleModalView",props:{htmlId:{type:String,required:!0},normaId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(i,{emit:u}){const c=u,d=x(),r=i,m=T(null),_=h(()=>d.data_cache?.norma_normajuridica?.[r.normaId]||null);return E(()=>{d.fetchSync({app:"norma",model:"normajuridica",id:r.normaId,params:{},force_fetch:!1}).then(()=>{F.get(`/norma/${r.normaId}/ta?embedded`).then(a=>{m.value=a.data,H(()=>{document.querySelectorAll('.cp a:not([target="_blank"])').forEach(t=>{t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer")})})})})}),(a,s)=>(n(),l("div",{id:i.htmlId,class:"modal norma-simple-modal-view fade show",tabindex:"-1"},[e("div",K,[e("div",Y,[e("div",Q,[e("h5",{class:"modal-title",innerHTML:_.value?(_.value.apelido!==""?`${_.value.apelido}<br>`:"")+_.value.__str__:"Carregando..."},null,8,U),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=t=>c("close"))})]),m.value?(n(),l("div",{key:0,class:"modal-body",innerHTML:m.value},null,8,W)):(n(),l("div",X," Carregando texto... ")),e("div",Z,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[1]||(s[1]=t=>c("close"))}," Fechar ")])])])],8,J))}},te=["id"],ae={class:"materia-epigrafe"},se=["href"],oe={class:"materia-conteudo"},ne={class:"link-file"},re=["href"],ie={class:"data-header"},le={class:"detail-header"},ce={class:"protocolo-data"},de={class:"protocolo"},me={class:"data"},ue={class:"autoria"},_e=["innerHTML"],pe={class:"tramitacao"},ve={class:"status"},fe={class:"ultima-acao"},he=["innerHTML"],ye={key:1,class:"documentos-acessorios pt-2"},ge={class:"inner-docacess"},be=["href"],$e={key:2,class:"legislacao-citada pt-2"},ke={class:"inner-legcitada"},xe=["onClick"],Se={__name:"MateriaEmPauta",props:{materiaId:{type:Number,required:!0},item:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(i,{emit:u}){const c=x();j();const d=N("EventBus"),r=i,m=T(null),_=T(!1);d.on("rito-toggle",()=>{_.value=!_.value});const a=()=>{d.emit("rito-toggle"),setTimeout(()=>{const v=document.getElementById(`mp-${r.item.__label__}-${r.item.id}`),o=document.getElementsByClassName("main")[0];let O=0,f=v;do O+=f.offsetTop,f=f.offsetParent;while(f&&f.tagName!=="BODY");o.scrollTo({top:O-120,behavior:"smooth"})},100)},s=h(()=>(r.item.observacao||"").replace(/\n/g,"<br/>")),t=h(()=>c.data_cache?.materia_materialegislativa?.[r.materiaId]||{__str__:"Matéria não encontrada"}),p=h(()=>{const v=c.data_cache?.materia_tramitacao?.[r.sessao.finalizada?t.value.ultima_tramitacao:r.item.tramitacao||t.value.ultima_tramitacao]||null,o=v&&c.data_cache?.materia_statustramitacao?.[v.status]||null;return{...v,status:o?o.__str__:"Status não disponível"}}),A=h(()=>{const v=c.data_cache?.base_autor||{};return!t.value.autores||t.value.autores.length===0?[]:t.value.autores.map(o=>v[o]).filter(o=>o!==void 0)}),B=h(()=>t.value.data_apresentacao?new Date(t.value.data_apresentacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):""),C=h(()=>{const v=c.data_cache?.materia_documentoacessorio||{};return Object.values(v).filter(o=>o.materia===r.item.materia)}),M=h(()=>{const v=c.data_cache?.norma_legislacaocitada||{};return Object.values(v).filter(o=>o.materia===r.item.materia)});return q(()=>p.value,v=>{v?.id||(r.sessao.finalizada?c.fetchSync({app:"materia",model:"materialegislativa",id:t.value.id}):r.item.tramitacao&&c.fetchSync({app:"materia",model:"tramitacao",id:r.item.tramitacao}))},{immediate:!0}),q(m,v=>{v!==null&&c.fetchSync({app:"norma",model:"normajuridica",id:v.norma,params:{exclude:"metadata"}})}),(v,o)=>{const O=w("FontAwesomeIcon");return n(),l("div",{class:"materia-em-pauta",id:`mp-${i.item.__label__}-${i.item.id}`},[e("div",ae,[e("a",{href:t.value.link_detail_backend,target:"_blank",rel:"noopener noreferrer"},y(t.value.__str__),9,se)]),e("div",oe,[e("div",ne,[t.value.texto_original?(n(),l("a",{key:0,href:t.value.texto_original,target:"_blank",rel:"noopener noreferrer"},[k(O,{icon:"file-lines"})],8,re)):g("",!0)]),e("div",ie,[e("div",le,[e("div",ce,[e("span",de,[o[2]||(o[2]=L(" Protocolo: ",-1)),e("strong",null,y(t.value.numero_protocolo),1)]),e("span",me,y(B.value),1)]),e("div",ue,[(n(!0),l(b,null,$(A.value,(f,R)=>(n(),l("span",{key:`au${R}`},y(f.nome),1))),128))])]),e("div",{class:"ementa",innerHTML:t.value.ementa},null,8,_e)])]),e("div",pe,[e("div",ve,[o[3]||(o[3]=e("strong",null,"Situação:",-1)),o[4]||(o[4]=L("  ",-1)),e("span",null,y(p.value.status),1)]),e("div",fe,[o[5]||(o[5]=e("strong",null,"Última Ação:",-1)),L("  "+y(p.value.texto),1)])]),i.item&&i.item.observacao?(n(),l("div",{key:0,onClick:o[0]||(o[0]=f=>a()),class:D(["rito-text",_.value?"open":"closed"]),innerHTML:_.value?s.value:"Visualizar o Rito..."},null,10,he)):g("",!0),C.value.length>0?(n(),l("div",ye,[o[6]||(o[6]=e("div",{class:"title"},[e("strong",null,"Documentos Acessórios")],-1)),e("ul",ge,[(n(!0),l(b,null,$(C.value,f=>(n(),l("li",{key:`docacessorio-${f.id}`,class:"doc-acessorio-item"},[e("a",{href:f.arquivo,target:"_blank",rel:"noopener noreferrer"},y(f.__str__),9,be)]))),128))])])):g("",!0),M.value.length>0?(n(),l("div",$e,[o[7]||(o[7]=e("div",{class:"title"},[e("strong",null,"Legislação Citada")],-1)),e("ul",ke,[(n(!0),l(b,null,$(M.value,f=>(n(),l("li",{key:`legcitada-${f.id}`,class:"leg-citada-item"},[(n(),l("a",{href:"#",onClick:z(R=>m.value=f,["prevent"]),key:`legiscit${f.id}`},y(f.__str__),9,xe))]))),128))])])):g("",!0),m.value?(n(),S(V,{key:3,to:"#modalCmj"},[k(ee,{"html-id":`modal-legis-citada-${m.value.id}`,"norma-id":m.value.norma,onClose:o[1]||(o[1]=f=>m.value=null)},null,8,["html-id","norma-id"])])):g("",!0)],8,te)}}},je={class:"item-content"},Oe={class:"childs"},Te={key:0,class:"title"},I={__name:"ItemDeSessao",props:{item:{type:Object,required:!0},parent:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(i,{emit:u}){const c=x();j();const d=u,r=i,m=h(()=>{const _=c.data_cache?.[r.item.__label__]||{},a=Object.values(_).filter(s=>s.parent===r.item.id);return a.sort((s,t)=>s.numero_ordem-t.numero_ordem),a});return(_,a)=>(n(),l("div",{class:D(["item-de-sessao",i.item.__label__,i.parent?"child-item":"parent-item"])},[e("div",je,[(n(),S(Se,{key:`materia-em-pauta-${i.item.materia}`,"materia-id":i.item.materia,item:i.item,sessao:i.sessao,onResync:a[0]||(a[0]=s=>d("resync"))},null,8,["materia-id","item","sessao"]))]),e("div",Oe,[!i.item.parent&&m.value.length>0?(n(),l("div",Te,[...a[2]||(a[2]=[e("strong",null,"Matérias Anexadas",-1)])])):g("",!0),(n(!0),l(b,null,$(m.value,s=>(n(),S(I,{key:`child-${s.id}`,item:s,parent:i.item,sessao:i.sessao,onResync:a[1]||(a[1]=t=>d("resync"))},null,8,["item","parent","sessao"]))),128))])],2))}},Ae={class:"expediente-materia-list"},Le={class:"title"},we={class:"expediente-materia-content"},Ie={__name:"ExpedienteMateriaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(i,{emit:u}){const c=u,d=x();j();const r=i,m=h(()=>{const a=d.data_cache?.sessao_expedientemateria||{},s=Object.values(a).filter(t=>t.sessao_plenaria===r.sessao?.id&&t.parent===null);return s.sort((t,p)=>t.numero_ordem-p.numero_ordem),s}),_=()=>{c("resync");const a=document.querySelector(".resync-icon-expmateria");a&&(a.classList.add("rotate"),setTimeout(()=>{a.classList.remove("rotate")},1e3))};return(a,s)=>{const t=w("FontAwesomeIcon");return n(),l("div",Ae,[e("div",Le,[s[1]||(s[1]=e("strong",null,"Matérias do Grande Expediente",-1)),k(t,{icon:"arrows-rotate",class:"resync-icon-expmateria cursor-pointer ms-2",title:"Recarregar matéria",onClick:_})]),e("div",we,[(n(!0),l(b,null,$(m.value,p=>(n(),S(I,{key:`expmat-${p.id}`,item:p,sessao:i.sessao,onResync:s[0]||(s[0]=A=>c("resync"))},null,8,["item","sessao"]))),128))])])}}},Ce={class:"ordemdia-list"},Me={class:"title"},Re={class:"ordemdia-content"},qe={__name:"OrdemDiaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(i,{emit:u}){const c=u,d=x();j();const r=i,m=h(()=>{const a=d.data_cache?.sessao_ordemdia||{},s=Object.values(a).filter(t=>t.sessao_plenaria===r.sessao?.id&&t.parent===null);return s.sort((t,p)=>t.numero_ordem-p.numero_ordem),s}),_=()=>{c("resync");const a=document.querySelector(".resync-icon-ordemdia");a&&(a.classList.add("rotate"),setTimeout(()=>{a.classList.remove("rotate")},1e3))};return(a,s)=>{const t=w("FontAwesomeIcon");return n(),l("div",Ce,[e("div",Me,[s[1]||(s[1]=e("strong",null,"Matérias da Ordem do Dia",-1)),k(t,{icon:"arrows-rotate",class:"resync-icon-ordemdia cursor-pointer ms-2",title:"Recarregar matéria",onClick:_})]),e("div",Re,[(n(!0),l(b,null,$(m.value,p=>(n(),S(I,{key:`ordemdia-${p.id}`,item:p,sessao:i.sessao,onResync:s[0]||(s[0]=A=>c("resync"))},null,8,["item","sessao"]))),128))])])}}},Ee={key:0},De={class:"sessao-plenaria-content"},Ne={__name:"SessaoPlenariaView",setup(i){const u=x();j(),G();const c=P(),d=T(Number(c.params.id)||0),r=h(()=>u.data_cache?.sessao_sessaoplenaria?.[d.value]);E(()=>{u.fetchSync({app:"sessao",model:"sessaoplenaria",id:d.value,params:{},force_fetch:!0}).then(()=>{m({force_fetch_materias:!1})})});const m=({force_fetch_materias:_=!0})=>{u.invalidateDataCache(["sessao"],["expedientemateria","ordemdia"]),u.fetchSync({app:"sessao",model:"expedientesessao",params:{sessao_plenaria:d.value,get_all:"True"}}),u.fetchSync({app:"sessao",model:"expedientemateria",params:{sessao_plenaria:d.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}}).then(()=>u.fetchSync({app:"sessao",model:"ordemdia",params:{sessao_plenaria:d.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}})).then(()=>{const a=new Set,s=u.data_cache?.sessao_expedientemateria||{};Object.values(s).forEach(p=>{p.sessao_plenaria===d.value&&a.add(p.materia)});const t=u.data_cache?.sessao_ordemdia||{};Object.values(t).forEach(p=>{p.sessao_plenaria===d.value&&a.add(p.materia)}),a.size>0&&u.fetchSync({app:"materia",model:"materialegislativa",params:{id__in:Array.from(a),exclude:"metadata",get_all:"True"},force_fetch:_}).then(()=>u.fetchSync({app:"materia",model:"documentoacessorio",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}})).then(()=>u.fetchSync({app:"norma",model:"legislacaocitada",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}))})};return(_,a)=>(n(),l("div",{key:`sessao-plenaria-view-${d.value}`,class:"sessao-plenaria-view"},[r.value?(n(),l("small",Ee,y(r.value.__str__),1)):g("",!0),e("div",De,[k(Ie,{sessao:r.value,onResync:m},null,8,["sessao"]),k(qe,{sessao:r.value,onResync:m},null,8,["sessao"])])]))}};export{Ne as default};
