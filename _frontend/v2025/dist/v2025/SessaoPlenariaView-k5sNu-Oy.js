import{z as E,c as k,o as z,m as J,I as K,f as r,g as i,k as e,J as F,w as I,A as D,i as x,l as T,t as A,q as O,j as L,F as w,r as V,n as S,B as N,T as G,u as P,E as B,K as Y,L as Q,M as W,N as X,Q as Z}from"./vendor-DS7HDf1G.js";import{b as j,u as q,a as U,R as M,_ as ee}from"./main-CRV0YJDP.js";import"./vendor_fortawesome-DURsxqHa.js";const te=["id"],ae={class:"modal-dialog modal-xl"},oe={class:"modal-content"},se={class:"modal-header"},ne=["innerHTML"],ie=["innerHTML"],le={key:1,class:"modal-body"},re={class:"modal-footer"},de={__name:"NormaSimpleModalView",props:{htmlId:{type:String,required:!0},normaId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(t,{emit:b}){const p=b,f=j(),l=t,c=E(null),u=k(()=>f.data_cache?.norma_normajuridica?.[l.normaId]||null);return z(()=>{f.fetchSync({app:"norma",model:"normajuridica",id:l.normaId,params:{},force_fetch:!1}).then(()=>{J.get(`/norma/${l.normaId}/ta?embedded`).then(v=>{c.value=v.data,K(()=>{document.querySelectorAll('.cp a:not([target="_blank"])').forEach(d=>{d.setAttribute("target","_blank"),d.setAttribute("rel","noopener noreferrer")})})})})}),(v,m)=>(i(),r("div",{id:t.htmlId,class:"modal norma-simple-modal-view fade show",tabindex:"-1"},[e("div",ae,[e("div",oe,[e("div",se,[e("h5",{class:"modal-title",innerHTML:u.value?(u.value.apelido!==""?`${u.value.apelido}<br>`:"")+u.value.__str__:"Carregando..."},null,8,ne),e("button",{type:"button",class:"btn-close",onClick:m[0]||(m[0]=d=>p("close"))})]),c.value?(i(),r("div",{key:0,class:"modal-body",innerHTML:c.value},null,8,ie)):(i(),r("div",le," Carregando texto... ")),e("div",re,[e("button",{type:"button",class:"btn btn-secondary",onClick:m[1]||(m[1]=d=>p("close"))}," Fechar ")])])])],8,te))}},ce=["id"],ue={class:"materia-epigrafe"},me=["href"],ve={class:"materia-conteudo"},_e={class:"link-file"},pe=["href"],be={class:"data-header"},ge={class:"detail-header"},ye={class:"protocolo-data"},fe={class:"protocolo"},$e={class:"data"},he={class:"autoria"},ke=["innerHTML"],xe={class:"tramitacao"},Se={class:"status"},Ae={class:"ultima-acao"},Oe=["innerHTML"],Ce={key:1,class:"documentos-acessorios pt-2"},Re={class:"inner-docacess"},Te=["href"],Me={key:2,class:"legislacao-citada pt-2"},je={class:"inner-legcitada"},we=["onClick"],Ve={__name:"MateriaEmPauta",props:{materiaId:{type:Number,required:!0},item:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const p=j(),f=F("EventBus"),l=b,c=t,u=E(null),v=E(!1);f.on("rito-toggle",()=>{v.value=!v.value});const m=()=>{f.emit("rito-toggle"),setTimeout(()=>{const a=document.getElementById(`is-${c.item.__label__}-${c.item.id}`);let o=0,g=a;do o+=g.offsetTop,g=g.offsetParent;while(g&&g.tagName!=="BODY");window.scrollTo({top:o-100,behavior:"instant"})},100)},d=k(()=>(c.item.observacao||"").replace(/\n/g,"<br/>")),n=k(()=>p.data_cache?.materia_materialegislativa?.[c.materiaId]||{__str__:"Buscando Matéria Legislativa..."}),h=k(()=>{const a=p.data_cache?.materia_tramitacao?.[c.sessao.finalizada?n.value.ultima_tramitacao:c.item.tramitacao||n.value.ultima_tramitacao]||null,o=a&&p.data_cache?.materia_statustramitacao?.[a.status]||null;return{...a,status:o?o.__str__:"Status não disponível"}}),$=k(()=>{const a=p.data_cache?.base_autor||{};return!n.value.autores||n.value.autores.length===0?[]:n.value.autores.map(o=>a[o]).filter(o=>o!==void 0)}),C=k(()=>n.value.data_apresentacao?new Date(n.value.data_apresentacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):""),y=k(()=>{const a=p.data_cache?.materia_documentoacessorio||{};return Object.values(a).filter(o=>o.materia===c.item.materia)}),s=k(()=>{const a=p.data_cache?.norma_legislacaocitada||{};return Object.values(a).filter(o=>o.materia===c.item.materia)});return I(()=>h.value,a=>{a?.id||(c.sessao.finalizada?p.fetchSync({app:"materia",model:"materialegislativa",id:n.value.id}):c.item.tramitacao&&p.fetchSync({app:"materia",model:"tramitacao",id:c.item.tramitacao}))},{immediate:!0}),I(u,a=>{a!==null&&p.fetchSync({app:"norma",model:"normajuridica",id:a.norma,params:{exclude:"metadata"}})}),I(n,a=>{a?.id||l("resync")},{immediate:!0}),(a,o)=>{const g=D("FontAwesomeIcon");return i(),r("div",{id:`mp-${t.item.__label__}-${t.item.id}`,class:"materia-em-pauta"},[e("div",ue,[e("a",{href:n.value.link_detail_backend,target:"_blank",rel:"noopener noreferrer"},A(n.value.__str__),9,me)]),e("div",ve,[e("div",_e,[n.value.texto_original?(i(),r("a",{key:0,href:n.value.texto_original,target:"_blank",rel:"noopener noreferrer"},[O(g,{icon:"file-lines"})],8,pe)):x("",!0)]),e("div",be,[e("div",ge,[e("div",ye,[e("span",fe,[o[2]||(o[2]=L(" Protocolo: ",-1)),e("strong",null,A(n.value.numero_protocolo),1)]),e("span",$e,A(C.value),1)]),e("div",he,[(i(!0),r(w,null,V($.value,(_,R)=>(i(),r("span",{key:`au${R}`},A(_.nome),1))),128))])]),e("div",{class:"ementa",innerHTML:n.value.ementa},null,8,ke)])]),e("div",xe,[e("div",Se,[o[3]||(o[3]=e("strong",null,"Situação:",-1)),o[4]||(o[4]=L("  ",-1)),e("span",null,A(h.value.status),1)]),e("div",Ae,[o[5]||(o[5]=e("strong",null,"Última Ação:",-1)),L("  "+A(h.value.texto),1)])]),t.item&&t.item.observacao?(i(),r("div",{key:0,onClick:o[0]||(o[0]=_=>m()),class:S(["rito-text",v.value?"open":"closed"]),innerHTML:v.value?d.value:"Visualizar o Roteiro..."},null,10,Oe)):x("",!0),y.value.length>0?(i(),r("div",Ce,[o[6]||(o[6]=e("div",{class:"title"},[e("strong",null,"Documentos Acessórios")],-1)),e("ul",Re,[(i(!0),r(w,null,V(y.value,_=>(i(),r("li",{key:`docacessorio-${_.id}`,class:"doc-acessorio-item"},[e("a",{href:_.arquivo,target:"_blank",rel:"noopener noreferrer"},A(_.__str__),9,Te)]))),128))])])):x("",!0),s.value.length>0?(i(),r("div",Me,[o[7]||(o[7]=e("div",{class:"title"},[e("strong",null,"Legislação Citada")],-1)),e("ul",je,[(i(!0),r(w,null,V(s.value,_=>(i(),r("li",{key:`legcitada-${_.id}`,class:"leg-citada-item"},[(i(),r("a",{href:"#",onClick:N(R=>u.value=_,["prevent"]),key:`legiscit${_.id}`},A(_.__str__),9,we))]))),128))])])):x("",!0),u.value?(i(),T(G,{key:3,to:"#modalCmj"},[O(de,{"html-id":`modal-legis-citada-${u.value.id}`,"norma-id":u.value.norma,onClose:o[1]||(o[1]=_=>u.value=null)},null,8,["html-id","norma-id"])])):x("",!0)],8,ce)}}},Ee=["id"],Le={key:0,class:"display-controls"},Ie=["id"],Pe={class:"display-content"},De={key:0,class:"votos"},qe={key:0,class:"voto-abs"},Be={class:"valor"},ze={class:"voto-nao"},Ne={class:"valor"},Fe={class:"voto-sim"},Ue={class:"valor"},He={key:1,class:"status-votacao"},Ye={key:0},Ge={key:1},Je={key:2},Ke={key:0},Qe={key:1},We={key:2},Xe={__name:"ProcessoVotacaoDisplay",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const p=j(),f=q(),l=b,c=F("EventBus"),u=t,v=E(!0),m=()=>{d.value||(v.value=!v.value,c.emit("toggle-auto-rolagem",{isState:v.value}))};c.on("toggle-auto-rolagem",o=>{v.value=o.isState,n()});const d=k(()=>f.hasPermission("sessao.add_sessaoplenaria")),n=()=>{d.value||!v.value||!s.value||(console.log("Executando auto rolagem para o item de sessão",u.item.__label__,u.item.id),setTimeout(()=>{const o=document.getElementById(`is-${u.item.__label__}-${u.item.id}`);let g=0,_=o;do g+=_.offsetTop,_=_.offsetParent;while(_&&_.tagName!=="BODY");window.scrollTo({top:g-100,behavior:"smooth"})},100))},h=k(()=>{const o=p.data_cache?.sessao_registrovotacao||{},g=Object.values(o).filter(_=>_.ordem===u.item.id);return g.sort((_,R)=>_.id-R.id),g}),$=k(()=>u.item.votacao_aberta&&u.item.tipo_votacao<=2),C=k(()=>u.item.discussao_aberta&&u.item.tipo_votacao<=2),y=k(()=>u.item.votacao_aberta_pedido_prazo&&u.item.tipo_votacao<=2),s=k(()=>u.item.discussao_aberta||u.item.votacao_aberta||u.item.votacao_aberta_pedido_prazo);I($,(o,g)=>{!o&&g&&l("resync"),o&&n()},{immediate:!0}),I(s,o=>{o&&n()},{immediate:!0});const a=o=>{let g="tramitando",_=null;return o?_=p.data_cache?.sessao_tiporesultadovotacao?.[o.tipo_resultado_votacao]?.nome:u.item.resultado&&(_=u.item.resultado),C.value?g="result discussao-aberta":$.value?g="result votacao-aberta":_==="Aprovado"?g="result result-aprovado":_==="Rejeitado"?g="result result-rejeitado":_==="Pedido de Vista"?g="result result-vista":_==="Prazo Regimental"?g="result result-prazo":_==="Matéria lida"&&(g="result result-lida"),g};return(o,g)=>{const _=D("font-awesome-icon");return i(),r("div",{id:`pvd-${t.item.__label__}-${t.item.id}`,class:S(["processo-votacao-display",t.item.__label__])},[d.value?x("",!0):(i(),r("div",Le,[e("button",{id:`auto-rolagem-${t.item.__label__}-${t.item.id}`,type:"button",class:S(["btn-auto-rolagem",v.value?"active":""]),onClick:m},[g[0]||(g[0]=L(" Autorolagem? ",-1)),O(_,{icon:"fa-solid fa-up-down"})],10,Ie)])),e("div",Pe,[!$.value&&!y.value?(i(!0),r(w,{key:0},V(h.value,R=>(i(),r("div",{class:"status-votacao",key:`rv-${R.id}`},[a(R)!=="result-vista"?(i(),r("div",De,[R.numero_abstencoes?(i(),r("div",qe,[e("span",Be,A(R.numero_abstencoes),1),g[1]||(g[1]=e("span",{class:"titulo"},"ABS",-1))])):x("",!0),e("div",ze,[e("span",Ne,A(R.numero_votos_nao),1),g[2]||(g[2]=e("span",{class:"titulo"},"NÃO",-1))]),e("div",Fe,[e("span",Ue,A(R.numero_votos_sim),1),g[3]||(g[3]=e("span",{class:"titulo"},"SIM",-1))])])):x("",!0),e("div",{class:S(a(R))},[e("span",null,A(P(p).data_cache?.sessao_tiporesultadovotacao?.[R.tipo_resultado_votacao]?.nome),1)],2)]))),128)):x("",!0),$.value||C.value||y.value||h.value.length===0?(i(),r("div",He,[$.value||C.value||y.value?(i(),r("div",{key:0,class:S(a(null))},[y.value?(i(),r("span",Ye,"VOTAÇÃO ABERTA PARA PEDIDO DE ADIAMENTO")):$.value?(i(),r("span",Ge,"VOTAÇÃO ABERTA")):C.value?(i(),r("span",Je,"DISCUSSÃO ABERTA")):x("",!0)],2)):(i(),r("div",{key:1,class:S(a(null))},[t.item.resultado?(i(),r("span",Ke,A(t.item.resultado),1)):t.item.tipo_votacao===4&&t.item.votacao_aberta?(i(),r("span",Qe,"Leitura em Andamento")):h.value.length===0?(i(),r("span",We,"Tramitando")):x("",!0)],2))])):x("",!0)])],10,Ee)}}},Ze=["id"],et={class:"inner-title text-light m-4"},tt={class:"inner-voto"},at={key:0,class:"voto-result"},ot={class:"avatar"},st=["src","alt","title"],nt={class:"voto-computado"},it={key:1,class:"voto-result"},lt={__name:"VotoParlamentar",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const b=j(),p=q(),f=U(),l=t,c=k(()=>{const m=Object.values(b.data_cache?.materia_materialegislativa||{}).filter(d=>d.id===l.item.materia);return m.length>0?m[0]:null}),u=k(()=>{const m=l.item.__label__==="sessao_ordemdia"?"ordem":"expediente",d=Object.values(b.data_cache?.sessao_votoparlamentar||{}).filter(n=>n.parlamentar===p.data_connect.user.votante.parlamentar_id&&n[m]===l.item.id);return d.length>0?d[0]:null});function v(m){const d=l.item.__label__==="sessao_ordemdia"?"ordem":"expediente",n={parlamentar:p.data_connect.user.votante.parlamentar_id,[d]:l.item.id,voto:m};u.value?(n.id=u.value.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:u.value.id,form:n}).then(()=>{f.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{f.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:n}).then(()=>{f.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{f.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})}return z(()=>{setTimeout(()=>{const m=document.getElementById(`is-${l.item.__label__}-${l.item.id}`);let d=0,n=m;do d+=n.offsetTop,n=n.offsetParent;while(n&&n.tagName!=="BODY");window.scrollTo({top:d-100,behavior:"smooth"})},100)}),(m,d)=>(i(),r("div",{id:`vp-${t.item.__label__}-${t.item.id}`,class:S(["voto-parlamentar"])},[e("div",et,[e("span",null,A(c.value?.__str__),1)]),e("div",tt,[e("button",{type:"button",class:"btn btn-lg btn-success",onClick:d[0]||(d[0]=n=>v("Sim"))}," SIM "),e("button",{type:"button",class:"btn btn-lg btn-danger",onClick:d[1]||(d[1]=n=>v("Não"))}," NÃO "),e("button",{type:"button",class:"btn btn-lg btn-warning",onClick:d[2]||(d[2]=n=>v("Abstenção"))}," Abstenção ")]),u.value?(i(),r("div",at,[e("div",ot,[e("img",{src:`/api/parlamentares/parlamentar/${P(p).data_connect.user.votante.parlamentar_id}/fotografia.c256.png`,alt:P(p).data_connect.user.votante.nome_parlamentar,title:P(p).data_connect.user.votante.nome_parlamentar},null,8,st)]),e("div",nt,[d[3]||(d[3]=L(" Voto Computado: ",-1)),e("strong",null,A(u.value.voto),1)])])):(i(),r("div",it," Voto não Computado "))],8,Ze))}},rt=["id"],dt={__name:"ControleDeVotacao",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const p=q(),f=b,l=t,c=k(()=>l.item.votacao_aberta&&l.item.tipo_votacao!==4);return(u,v)=>(i(),r("div",{id:`cv-${t.item.__label__}-${t.item.id}`,class:S(["controle-de-votacao",t.item.__label__,c.value?"votacao-aberta":"votacao-fechada",c.value&&P(p).isVotante&&t.item.tipo_votacao===2?"votante":"observador"])},[c.value&&P(p).isVotante&&t.item.tipo_votacao===2?(i(),T(lt,{key:`vp-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:v[0]||(v[0]=m=>f("resync"))},null,8,["item","sessao"])):x("",!0),(i(),T(Xe,{key:`pvd-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:v[1]||(v[1]=m=>f("resync"))},null,8,["item","sessao"]))],10,rt))}},ct={key:0,class:"message"},ut={__name:"Loading",props:{message:{type:String,default:""},position:{type:String,default:"fixed"}},setup(t){return(b,p)=>(i(),r("div",{class:"loading",style:B({position:t.position})},[p[0]||(p[0]=e("div",{class:"loader"},null,-1)),t.message?(i(),r("div",ct,A(t.message),1)):x("",!0)],4))}},mt=ee(ut,[["__scopeId","data-v-98eced51"]]),vt=["id"],_t={class:"modal-dialog modal-xl"},pt={class:"modal-content"},bt={class:"modal-header"},gt={class:"modal-title"},yt={class:"d-inline-block ps-3"},ft={class:"modal-body"},$t={class:"row"},ht={class:"col-md-6"},kt={class:"votos-parlamentares-list"},xt={class:"voto-parlamentar-header voto-parlamentar-item font-weight-bold"},St={class:"voto-parlamentar-options"},At=["id"],Ot={class:"nome-parlamentar"},Ct={key:0,class:"voto-parlamentar-options"},Rt=["onClick"],Tt=["onClick"],Mt=["onClick"],jt={class:"col-md-6"},wt={class:"form-group"},Vt=["value"],Et={class:"modal-footer"},Lt={__name:"VotoParlamentarAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["close","register","cancel"],setup(t,{emit:b}){const p=b,f=j(),l=U(),c=t,u=k(()=>{const y=Object.values(f.data_cache?.materia_materialegislativa||{}).filter(s=>s.id===c.item.materia);return y.length>0?y[0]:null}),v=k(()=>{const y=c.item.__label__==="sesso_ordemdia"?"sessao_presencaordemdia":"sessao_sessaoplenariapresenca";return Object.values(f.data_cache?.[y]||{}).filter(a=>a.sessao_plenaria===c.sessao.id).map(a=>{const o=f.data_cache?.parlamentares_parlamentar?.[a.parlamentar];return o||null})}),m=k(()=>{const y=f.data_cache?.sessao_votoparlamentar||{},s=c.item.__label__==="sessao_ordemdia"?"ordem":"expediente";return Object.values(y).filter(o=>o[s]===c.item.id&&o.votacao===null).reduce((o,g)=>(o[g.parlamentar]=g,o),{})}),d=E({tipo_resultado_votacao:null,observacao:""}),n=k(()=>Object.values(f.data_cache?.sessao_tiporesultadovotacao||{}).filter(y=>y.natureza==="P"&&c.item.votacao_aberta_pedido_prazo===!0||y.id>0&&c.item.votacao_aberta_pedido_prazo===!1)),h=()=>{Object.values(m.value).forEach(y=>{console.log("deletando voto",y),M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:y.id})}),p("close")},$=(y,s)=>{if(!y){Object.values(v.value).forEach(_=>{$(_.id,s)});return}const a=c.item.__label__==="sessao_ordemdia"?"ordem":"expediente",o={votacao:null,parlamentar:y,[a]:c.item.id,voto:s},g=m.value[y];if(g&&g.voto===s){M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:g.id}).then(()=>{l.addMessage({type:"info",text:"Voto Removido!",timeout:5e3})}).catch(()=>{l.addMessage({type:"danger",text:"Erro ao remover voto. Tente novamente.",timeout:5e3})});return}g?(o.id=g.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:g.id,form:o}).then(()=>{l.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{l.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:o}).then(()=>{l.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{l.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})},C=()=>{p("register",{action:"action_registrovotacao",form:{...d.value,unanime:!1,com_presidente:!1}}),p("close")};return(y,s)=>(i(),r("div",{id:`vpa-${t.item.__label__}-${t.item.id}`,class:"modal voto-parlamentar-admin-modal-view fade show",tabindex:"-1"},[e("div",_t,[e("div",pt,[e("div",bt,[e("h5",gt,[s[8]||(s[8]=L(" Registro de Votação dos Parlamentares ",-1)),e("small",yt,A(u.value?u.value.__str__:""),1)]),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=a=>p("close"))})]),e("div",ft,[e("div",$t,[e("div",ht,[e("div",kt,[e("div",xt,[s[9]||(s[9]=e("div",{class:"nome-parlamentar"},[e("h5",null,"Votos dos Parlamentares")],-1)),e("div",St,[e("button",{type:"button",class:S(["btn btn-sm","btn-outline-success"]),onClick:s[1]||(s[1]=a=>$(0,"Sim"))}," SIM "),e("button",{type:"button",class:S(["btn btn-sm","btn-outline-danger"]),onClick:s[2]||(s[2]=a=>$(0,"Não"))}," NÃO "),e("button",{type:"button",class:S(["btn btn-sm","btn-outline-warning"]),onClick:s[3]||(s[3]=a=>$(0,"Abstenção"))}," Abstenção ")])]),(i(!0),r(w,null,V(v.value,a=>(i(),r("div",{id:`voto-parlamentar-${a.id}`,class:"voto-parlamentar-item",key:`voto-parlamentar-${a.id}`},[e("div",Ot,A(a.nome_parlamentar),1),m.value?(i(),r("div",Ct,[e("button",{type:"button",class:S(["btn btn-sm",`btn${m.value[a.id]?.voto==="Sim"?"-success":"-outline-success"}`]),onClick:o=>$(a.id,"Sim")}," SIM ",10,Rt),e("button",{type:"button",class:S(["btn btn-sm",`btn${m.value[a.id]?.voto==="Não"?"-danger":"-outline-danger"}`]),onClick:o=>$(a.id,"Não")}," NÃO ",10,Tt),e("button",{type:"button",class:S(["btn btn-sm",`btn${m.value[a.id]?.voto==="Abstenção"?"-warning":"-outline-warning"}`]),onClick:o=>$(a.id,"Abstenção")}," Abstenção ",10,Mt)])):x("",!0)],8,At))),128))])]),e("div",jt,[e("div",wt,[e("div",null,[s[10]||(s[10]=e("strong",{class:"p-2 d-inline-block"}," Tipo de Resultado da Votação: * ",-1)),Y(e("select",{id:"tipo-resultado-votacao",class:"form-select","onUpdate:modelValue":s[4]||(s[4]=a=>d.value.tipo_resultado_votacao=a)},[(i(!0),r(w,null,V(n.value,a=>(i(),r("option",{key:`tipo-resultado-votacao-${a.id}`,value:a.id},A(a.__str__),9,Vt))),128))],512),[[Q,d.value.tipo_resultado_votacao]])]),e("div",null,[s[11]||(s[11]=e("strong",{class:"pt-4 pb-2 d-inline-block"}," Observações: ",-1)),Y(e("textarea",{class:"form-control",rows:"5","onUpdate:modelValue":s[5]||(s[5]=a=>d.value.observacao=a)},null,512),[[W,d.value.observacao]])])])]),e("div",Et,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=a=>h())}," Cancelar Registro de Votação "),e("button",{type:"button",class:"btn btn-success",onClick:s[7]||(s[7]=a=>C())}," Registrar e Fechar Votação ")])])])])])],8,vt))}},It=["id"],Pt={class:"inner-is-admin"},Dt={class:"btn-group",role:"group","aria-label":"Edição"},qt=["href"],Bt={key:0,class:"registro-leitura"},zt={class:"btn-group",role:"group","aria-label":"State Leitura da matéria em Plenário"},Nt={class:"btn-group",role:"group","aria-label":"Registro de Leitura"},Ft=["disabled"],Ut=["disabled"],Ht={key:1,class:"registro-votacao"},Yt=["disabled"],Gt=["disabled"],Jt=["disabled"],Kt=["disabled"],Qt={__name:"ItemDeSessaoAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const b=q();j();const p=U(),f=t,l=E(!1),c=E(!1),u=k(()=>b.hasPermission("sessao.add_sessaoplenaria")),v=async y=>{const[s,a]=f.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,form:{field:y},action:"toggle_state",id:f.item.id}).then(o=>{console.log("Discussão alterada com sucesso",o)}).catch(o=>{console.error("Erro ao alterar discussão",o)})},m=async y=>{n({action:"action_registrovotacao",form:{unanime:!0,resultado:y,com_presidente:!1}})},d=async()=>{n({action:"action_registroleitura",form:{}})},n=async y=>{l.value=!0;const[s,a]=f.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,id:f.item.id,action:y.action,form:y.form}).then(o=>{console.log("Votação registrada com sucesso",o),l.value=!1}).catch(o=>{l.value=!1,p.addMessage({type:o.response.data.type||"danger",text:o.response.data.detail||"Erro ao registrar votação!",timeout:5e3})})},h=async()=>{l.value=!0;const[y,s]=f.item.__label__.split("_");M.Utils.patchModel({app:y,model:s,action:"action_cancelar_registroleitura",id:f.item.id}).then(a=>{l.value=!1,console.log("Registro de leitura cancelado com sucesso",a)}).catch(a=>{l.value=!1,p.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de leitura!",timeout:5e3})})},$=async()=>{l.value=!0,c.value=!1;const[y,s]=f.item.__label__.split("_");M.Utils.patchModel({app:y,model:s,action:"action_cancelar_registrovotacao",id:f.item.id}).then(a=>{l.value=!1,console.log("Registro de votação cancelado com sucesso",a)}).catch(a=>{l.value=!1,p.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de votação!",timeout:5e3})})};z(()=>{C(2e3)}),I(()=>f.item,()=>{C(500)});const C=y=>{setTimeout(()=>{document.querySelectorAll(".tooltip.bs-tooltip-auto").forEach(o=>{o.remove()}),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(o=>new X(o,{trigger:"hover"}))},y)};return(y,s)=>{const a=D("FontAwesomeIcon");return u.value?(i(),r("div",{key:0,id:`is-admin-${t.item.__label__}-${t.item.id}`,class:S(["item-de-sessao-admin",l.value?"actions-running":""])},[e("div",Pt,[e("div",Dt,[e("a",{href:t.item.link_detail_backend,target:"_blank",class:S(["btn","btn-outline-secondary"])},[O(a,{icon:"edit"})],8,qt)]),t.item.tipo_votacao===4?(i(),r("div",Bt,[e("div",zt,[e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[0]||(s[0]=o=>v("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Leitura da matéria em Plenário"},[O(a,{icon:`${t.item.votacao_aberta?"book-open-reader":"book"}`},null,8,["icon"])],2)]),e("div",Nt,[t.item.resultado?(i(),r("button",{key:0,type:"button",class:"btn btn-outline-warning",onClick:s[1]||(s[1]=o=>h()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Leitura.",disabled:l.value},[O(a,{icon:"ban"})],8,Ft)):x("",!0),t.item.votacao_aberta?(i(),r("button",{key:1,type:"button",class:"btn btn-outline-primary",onClick:s[2]||(s[2]=o=>d()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Leitura da Matéria em Plenário.",disabled:l.value},[O(a,{icon:"book-open"})],8,Ut)):x("",!0)])])):(i(),r("div",Ht,[e("div",{class:"btn-group",role:"group",style:B({opacity:l.value?0:1}),"aria-label":"Registros de Votação Simbólica"},[e("button",{type:"button",class:"btn btn-outline-warning",onClick:s[3]||(s[3]=o=>$()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Votação.",disabled:l.value},[O(a,{icon:"ban"})],8,Yt),e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[4]||(s[4]=o=>m("R")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Rejeição Unânime sem voto do Presidente.",disabled:l.value},[O(a,{icon:"thumbs-down"})],8,Gt),e("button",{type:"button",class:"btn btn-outline-primary",onClick:s[5]||(s[5]=o=>m("A")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Aprovação Unânime sem voto do Presidente.",disabled:l.value},[O(a,{icon:"thumbs-up"})],8,Jt)],4),e("div",{class:"btn-group",role:"group",style:B({opacity:l.value?0:1}),"aria-label":"Botões de controle de abertura de discussão, votação e pedido de adiamento"},[e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.discussao_aberta?"success":"danger"}`]),onClick:s[6]||(s[6]=o=>v("discussao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Discussão em Plenário"},[O(a,{icon:"comments"}),s[11]||(s[11]=L("  ",-1))],2),e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[7]||(s[7]=o=>v("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação em Plenário"},[O(a,{icon:t.item.votacao_aberta?"book-open-reader":"book"},null,8,["icon"]),s[12]||(s[12]=L("  ",-1))],2),e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta_pedido_prazo?"success":"danger"}`]),onClick:s[8]||(s[8]=o=>v("votacao_aberta_pedido_prazo")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação de Pedido de Adiamento de Votação"},[...s[13]||(s[13]=[e("i",{class:"bi bi-hourglass-top"},null,-1)])],2)],4),t.item.votacao_aberta||t.item.votacao_aberta_pedido_prazo?(i(),r("div",{key:0,class:"btn-group",role:"group",style:B({opacity:l.value?0:1}),"aria-label":"Registro de Votação Simbólica sem unanimidade"},[e("button",{type:"button",class:"btn btn-outline-success",onClick:s[9]||(s[9]=o=>c.value=!0),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Votação",disabled:l.value},[O(a,{icon:"check-to-slot"})],8,Kt)],4)):x("",!0)]))]),l.value?(i(),T(mt,{key:0,message:"Registrando...",position:"absolute"})):x("",!0),c.value?(i(),T(G,{key:1,to:"#modalCmj"},[(i(),T(Lt,{key:`vpa-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onClose:s[10]||(s[10]=o=>c.value=!1),onRegister:n},null,8,["item","sessao"]))])):x("",!0)],10,It)):x("",!0)}}},Wt=["id"],Xt=["id"],Zt={class:"childs"},ea={key:0,class:"title"},H={__name:"ItemDeSessao",props:{item:{type:Object,required:!0},parent:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const p=j(),f=q(),l=b,c=t,u=k(()=>f.hasPermission("sessao.add_sessaoplenaria")),v=k(()=>{const d=p.data_cache?.[c.item.__label__]||{},n=Object.values(d).filter(h=>h.parent===c.item.id);return n.sort((h,$)=>h.numero_ordem-$.numero_ordem),n}),m=()=>{const d=document.getElementById(`item-content-${c.item.__label__}-${c.item.id}`);d&&d.scrollIntoView({behavior:"smooth",block:"center"})};return(d,n)=>(i(),r("div",{id:`is-${t.item.__label__}-${t.item.id}`,class:S(["item-de-sessao",t.item.__label__,t.parent?"child-item":"parent-item"])},[e("div",{onClick:n[4]||(n[4]=N(h=>u.value?m():null,["self"])),id:`item-content-${t.item.__label__}-${t.item.id}`,class:S(["item-content",t.item.votacao_aberta&&t.item.tipo_votacao===2?"votacao-nominal":"",u.value?"item-admin":""])},[(i(),T(Qt,{key:`is-admin-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:n[0]||(n[0]=h=>l("resync"))},null,8,["item","sessao"])),(i(),T(dt,{key:`cv-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:n[1]||(n[1]=h=>l("resync"))},null,8,["item","sessao"])),(i(),T(Ve,{onClick:n[2]||(n[2]=N(h=>u.value?m():null,["self"])),key:`mp-${t.item.__label__}-${t.item.id}`,"materia-id":t.item.materia,item:t.item,sessao:t.sessao,onResync:n[3]||(n[3]=h=>l("resync"))},null,8,["materia-id","item","sessao"]))],10,Xt),e("div",Zt,[!t.item.parent&&v.value.length>0?(i(),r("div",ea,[...n[6]||(n[6]=[e("strong",null,"Matérias Anexadas",-1)])])):x("",!0),(i(!0),r(w,null,V(v.value,h=>(i(),T(H,{key:`is-${h.__label__}-${h.id}`,item:h,parent:t.item,sessao:t.sessao,onResync:n[5]||(n[5]=$=>l("resync"))},null,8,["item","parent","sessao"]))),128))])],10,Wt))}},ta={class:"expediente-materia-list"},aa={class:"title"},oa={class:"expediente-materia-content"},sa={__name:"ExpedienteMateriaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const p=b,f=j(),l=t,c=k(()=>{const v=f.data_cache?.sessao_expedientemateria||{},m=Object.values(v).filter(d=>d.sessao_plenaria===l.sessao?.id&&d.parent===null);return m.sort((d,n)=>d.numero_ordem-n.numero_ordem),m}),u=()=>{p("resync");const v=document.querySelector(".resync-icon-expmateria");v&&(v.classList.add("rotate"),setTimeout(()=>{v.classList.remove("rotate")},1e3))};return(v,m)=>{const d=D("FontAwesomeIcon");return i(),r("div",ta,[e("div",aa,[m[1]||(m[1]=e("strong",null,"Matérias do Grande Expediente",-1)),O(d,{icon:"arrows-rotate",class:"resync-icon-expmateria cursor-pointer ms-2",title:"Recarregar matéria",onClick:u})]),e("div",oa,[(i(!0),r(w,null,V(c.value,n=>(i(),T(H,{key:`is-${n.__label__}-${n.id}`,item:n,sessao:t.sessao,onResync:m[0]||(m[0]=h=>p("resync"))},null,8,["item","sessao"]))),128))])])}}},na={class:"ordemdia-list"},ia={class:"title"},la={class:"ordemdia-content"},ra={__name:"OrdemDiaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const p=b,f=j(),l=t,c=k(()=>{const v=f.data_cache?.sessao_ordemdia||{},m=Object.values(v).filter(d=>d.sessao_plenaria===l.sessao?.id&&d.parent===null);return m.sort((d,n)=>d.numero_ordem-n.numero_ordem),m}),u=()=>{p("resync");const v=document.querySelector(".resync-icon-ordemdia");v&&(v.classList.add("rotate"),setTimeout(()=>{v.classList.remove("rotate")},1e3))};return(v,m)=>{const d=D("FontAwesomeIcon");return i(),r("div",na,[e("div",ia,[m[1]||(m[1]=e("strong",null,"Matérias da Ordem do Dia",-1)),O(d,{icon:"arrows-rotate",class:"resync-icon-ordemdia cursor-pointer ms-2",title:"Recarregar matéria",onClick:u})]),e("div",la,[(i(!0),r(w,null,V(c.value,n=>(i(),T(H,{key:`is-${n.__label__}-${n.id}`,item:n,sessao:t.sessao,onResync:m[0]||(m[0]=h=>p("resync"))},null,8,["item","sessao"]))),128))])])}}},da=["href"],ca={key:1,class:"sessao-plenaria-content"},ua=["innerHTML"],ma=["innerHTML"],va=["innerHTML"],ga={__name:"SessaoPlenariaView",setup(t){const b=j(),p=Z(),f=F("EventBus"),l=E(Number(p.params.id)||0),c=E(!1),u=k(()=>b.data_cache?.sessao_sessaoplenaria?.[l.value]);z(()=>{b.fetchSync({app:"sessao",model:"sessaoplenaria",id:l.value,params:{},force_fetch:!0}).then(()=>{h(!1)})});const v=k(()=>Object.values(b.data_cache?.sessao_expedientesessao||{}).filter($=>$.sessao_plenaria===l.value&&$.tipo===1)),m=k(()=>Object.values(b.data_cache?.sessao_expedientesessao||{}).filter($=>$.sessao_plenaria===l.value&&$.tipo===3)),d=k(()=>Object.values(b.data_cache?.sessao_expedientesessao||{}).filter($=>$.sessao_plenaria===l.value&&$.tipo===4));f.on("rito-toggle",()=>{c.value=!c.value});const n=()=>{f.emit("rito-toggle")},h=($=!0)=>{b.invalidateDataCache(["sessao"],["expedientemateria","ordemdia"]),b.fetchSync({app:"sessao",model:"expedientesessao",params:{sessao_plenaria:l.value,get_all:"True"}}),(async()=>await Promise.all([b.fetchSync({app:"sessao",model:"ordemdia",params:{sessao_plenaria:l.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}}),b.fetchSync({app:"sessao",model:"expedientemateria",params:{sessao_plenaria:l.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}})]))().then(()=>{const y=Object.values(b.data_cache?.sessao_ordemdia||{}).filter(_=>_.sessao_plenaria===l.value).map(_=>_.id),s=Object.values(b.data_cache?.sessao_expedientemateria||{}).filter(_=>_.sessao_plenaria===l.value).map(_=>_.id),a=new Set,o=b.data_cache?.sessao_expedientemateria||{};Object.values(o).forEach(_=>{_.sessao_plenaria===l.value&&a.add(_.materia)});const g=b.data_cache?.sessao_ordemdia||{};Object.values(g).forEach(_=>{_.sessao_plenaria===l.value&&a.add(_.materia)}),a.size>0&&(b.fetchSync({app:"materia",model:"materialegislativa",params:{id__in:Array.from(a),exclude:"metadata",get_all:"True"},force_fetch:$}),b.fetchSync({app:"sessao",model:"registroleitura",params:{materia__in:Array.from(a),get_all:"True"}}),b.fetchSync({app:"sessao",model:"registrovotacao",params:{materia__in:Array.from(a),get_all:"True",expand:"tipo_resultado_votacao"}}),b.fetchSync({app:"sessao",model:"votoparlamentar",params:{ordem__in:Array.from(y),get_all:"True"}}),b.fetchSync({app:"sessao",model:"votoparlamentar",params:{expediente__in:Array.from(s),get_all:"True"}}),b.fetchSync({app:"materia",model:"documentoacessorio",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),b.fetchSync({app:"norma",model:"legislacaocitada",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),b.fetchSync({app:"sessao",model:"tiporesultadovotacao",params:{get_all:"True"}}),b.fetchSync({app:"sessao",model:"sessaoplenariapresenca",params:{get_all:"True",sessao_plenaria:l.value,expand:"parlamentar"}}),b.fetchSync({app:"sessao",model:"presencaordemdia",params:{get_all:"True",sessao_plenaria:l.value,expand:"parlamentar"}}))})};return($,C)=>(i(),r("div",{key:`sessao-plenaria-view-${l.value}`,class:"sessao-plenaria-view"},[u.value?(i(),r("a",{key:0,class:"sessao_link_manage",href:u.value.link_detail_backend,target:"_blank"},A(u.value.__str__),9,da)):x("",!0),u.value?(i(),r("div",ca,[v.value.length>0?(i(),r("div",{key:0,onClick:n,class:S(["sessao-plenaria-textos",c.value?"open":"closed"])},[e("div",{innerHTML:c.value?v.value[0].conteudo:"Visualizar o Roteiro..."},null,8,ua)],2)):x("",!0),O(sa,{sessao:u.value,onResync:h},null,8,["sessao"]),m.value.length>0?(i(),r("div",{key:1,onClick:n,class:S(["sessao-plenaria-textos",c.value?"open":"closed"])},[e("div",{innerHTML:c.value?m.value[0].conteudo:"Visualizar o Roteiro..."},null,8,ma)],2)):x("",!0),O(ra,{sessao:u.value,onResync:h},null,8,["sessao"]),d.value.length>0?(i(),r("div",{key:2,onClick:n,class:S(["sessao-plenaria-textos",c.value?"open":"closed"])},[e("div",{innerHTML:c.value?d.value[0].conteudo:"Visualizar o Roteiro..."},null,8,va)],2)):x("",!0)])):x("",!0)]))}};export{ga as default};
