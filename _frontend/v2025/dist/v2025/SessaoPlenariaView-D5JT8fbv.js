import{z as L,c as k,o as z,m as J,J as K,f as r,g as n,k as e,C as F,w as I,A as D,l as T,i as x,t as A,q as O,j as E,F as w,r as V,n as S,B as N,T as G,u as P,G as B,K as Y,L as Q,M as W,N as X,Q as Z}from"./vendor-DWetvXX_.js";import{b as j,u as q,a as U,R as M,_ as ee}from"./main-BZVEVWY6.js";import"./vendor_fortawesome-C45cIu9k.js";const te=["id"],ae={class:"modal-dialog modal-xl"},oe={class:"modal-content"},se={class:"modal-header"},ne=["innerHTML"],ie=["innerHTML"],le={key:1,class:"modal-body"},re={class:"modal-footer"},de={__name:"NormaSimpleModalView",props:{htmlId:{type:String,required:!0},normaId:{type:[Number,null],required:!1,default:null}},emits:["close"],setup(t,{emit:b}){const _=b,$=j(),i=t,d=L(null),m=k(()=>$.data_cache?.norma_normajuridica?.[i.normaId]||null);return z(()=>{$.fetchSync({app:"norma",model:"normajuridica",id:i.normaId,params:{},force_fetch:!1}).then(()=>{J.get(`/norma/${i.normaId}/ta?embedded`).then(v=>{d.value=v.data,K(()=>{document.querySelectorAll('.cp a:not([target="_blank"])').forEach(c=>{c.setAttribute("target","_blank"),c.setAttribute("rel","noopener noreferrer")})})})})}),(v,u)=>(n(),r("div",{id:t.htmlId,class:"modal norma-simple-modal-view fade show",tabindex:"-1"},[e("div",ae,[e("div",oe,[e("div",se,[e("h5",{class:"modal-title",innerHTML:m.value?(m.value.apelido!==""?`${m.value.apelido}<br>`:"")+m.value.__str__:"Carregando..."},null,8,ne),e("button",{type:"button",class:"btn-close",onClick:u[0]||(u[0]=c=>_("close"))})]),d.value?(n(),r("div",{key:0,class:"modal-body",innerHTML:d.value},null,8,ie)):(n(),r("div",le," Carregando texto... ")),e("div",re,[e("button",{type:"button",class:"btn btn-secondary",onClick:u[1]||(u[1]=c=>_("close"))}," Fechar ")])])])],8,te))}},ce=["id"],ue={class:"materia-epigrafe"},me=["href"],ve={class:"inner-materia"},_e={class:"materia-conteudo"},pe={class:"link-file"},be=["href"],ge={class:"data-header"},ye={class:"detail-header"},fe={class:"protocolo-data"},$e={class:"protocolo"},he={class:"data"},ke={class:"autoria"},xe=["innerHTML"],Se={class:"tramitacao"},Ae={class:"status"},Oe={class:"ultima-acao"},Ce=["innerHTML"],Re={key:1,class:"documentos-acessorios pt-2"},Te={class:"inner-docacess"},Me=["href"],je={key:2,class:"legislacao-citada pt-2"},we={class:"inner-legcitada"},Ve=["onClick"],Le={__name:"MateriaEmPauta",props:{materiaId:{type:Number,required:!0},item:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const _=j(),$=F("EventBus"),i=b,d=t,m=L(null),v=L(!1);$.on("rito-toggle",()=>{v.value=!v.value});const u=()=>{$.emit("rito-toggle"),setTimeout(()=>{const a=document.getElementById(`is-${d.item.__label__}-${d.item.id}`);let o=0,g=a;do o+=g.offsetTop,g=g.offsetParent;while(g&&g.tagName!=="BODY");window.scrollTo({top:o-100,behavior:"instant"})},100)},c=k(()=>(d.item.observacao||"").replace(/\n/g,"<br/>")),l=k(()=>_.data_cache?.materia_materialegislativa?.[d.materiaId]||{__str__:"Buscando Matéria Legislativa..."}),h=k(()=>{const a=_.data_cache?.materia_tramitacao?.[d.sessao.finalizada?l.value.ultima_tramitacao:d.item.tramitacao||l.value.ultima_tramitacao]||null,o=a&&_.data_cache?.materia_statustramitacao?.[a.status]||null;return{...a,status:o?o.__str__:"Status não disponível"}}),y=k(()=>{const a=_.data_cache?.base_autor||{};return!l.value.autores||l.value.autores.length===0?[]:l.value.autores.map(o=>a[o]).filter(o=>o!==void 0)}),C=k(()=>l.value.data_apresentacao?new Date(l.value.data_apresentacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):""),f=k(()=>{const a=_.data_cache?.materia_documentoacessorio||{};return Object.values(a).filter(o=>o.materia===d.item.materia)}),s=k(()=>{const a=_.data_cache?.norma_legislacaocitada||{};return Object.values(a).filter(o=>o.materia===d.item.materia)});return I(()=>h.value,a=>{a?.id||(d.sessao.finalizada?_.fetchSync({app:"materia",model:"materialegislativa",id:l.value.id}):d.item.tramitacao&&_.fetchSync({app:"materia",model:"tramitacao",id:d.item.tramitacao}))},{immediate:!0}),I(m,a=>{a!==null&&_.fetchSync({app:"norma",model:"normajuridica",id:a.norma,params:{exclude:"metadata"}})}),I(l,a=>{a?.id||i("resync")},{immediate:!0}),(a,o)=>{const g=D("FontAwesomeIcon");return n(),r("div",{id:`mp-${t.item.__label__}-${t.item.id}`,class:"materia-em-pauta"},[e("div",ue,[e("a",{href:l.value.link_detail_backend,target:"_blank",rel:"noopener noreferrer"},A(l.value.__str__),9,me)]),e("div",ve,[e("div",_e,[e("div",pe,[l.value.texto_original?(n(),r("a",{key:0,href:l.value.texto_original,target:"_blank",rel:"noopener noreferrer"},[O(g,{icon:"file-lines"})],8,be)):x("",!0)]),e("div",ge,[e("div",ye,[e("div",fe,[e("span",$e,[o[2]||(o[2]=E(" Protocolo: ",-1)),e("strong",null,A(l.value.numero_protocolo),1)]),e("span",he,A(C.value),1)]),e("div",ke,[(n(!0),r(w,null,V(y.value,(p,R)=>(n(),r("span",{key:`au${R}`},A(p.nome),1))),128))])]),e("div",{class:"ementa",innerHTML:l.value.ementa},null,8,xe)])]),e("div",Se,[e("div",Ae,[o[3]||(o[3]=e("strong",null,"Situação:",-1)),o[4]||(o[4]=E("  ",-1)),e("span",null,A(h.value.status),1)]),e("div",Oe,[o[5]||(o[5]=e("strong",null,"Última Ação:",-1)),E("  "+A(h.value.texto),1)])]),t.item&&t.item.observacao?(n(),r("div",{key:0,onClick:o[0]||(o[0]=p=>u()),class:S(["rito-text",v.value?"open":"closed"]),innerHTML:v.value?c.value:"Visualizar o Roteiro..."},null,10,Ce)):x("",!0),f.value.length>0?(n(),r("div",Re,[o[6]||(o[6]=e("div",{class:"title"},[e("strong",null,"Documentos Acessórios")],-1)),e("ul",Te,[(n(!0),r(w,null,V(f.value,p=>(n(),r("li",{key:`docacessorio-${p.id}`,class:"doc-acessorio-item"},[e("a",{href:p.arquivo,target:"_blank",rel:"noopener noreferrer"},A(p.__str__),9,Me)]))),128))])])):x("",!0),s.value.length>0?(n(),r("div",je,[o[7]||(o[7]=e("div",{class:"title"},[e("strong",null,"Legislação Citada")],-1)),e("ul",we,[(n(!0),r(w,null,V(s.value,p=>(n(),r("li",{key:`legcitada-${p.id}`,class:"leg-citada-item"},[(n(),r("a",{href:"#",onClick:N(R=>m.value=p,["prevent"]),key:`legiscit${p.id}`},A(p.__str__),9,Ve))]))),128))])])):x("",!0)]),m.value?(n(),T(G,{key:0,to:"#modalCmj"},[O(de,{"html-id":`modal-legis-citada-${m.value.id}`,"norma-id":m.value.norma,onClose:o[1]||(o[1]=p=>m.value=null)},null,8,["html-id","norma-id"])])):x("",!0)],8,ce)}}},Ee=["id"],Ie={key:0,class:"display-controls"},Pe=["id"],De={class:"display-content"},qe={key:0,class:"votos"},Be={key:0,class:"voto-abs"},ze={class:"valor"},Ne={class:"voto-nao"},Fe={class:"valor"},Ue={class:"voto-sim"},He={class:"valor"},Ye={key:1,class:"status-votacao"},Ge={key:0},Je={key:1},Ke={key:2},Qe={key:0},We={key:1},Xe={key:2},Ze={__name:"ProcessoVotacaoDisplay",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const _=j(),$=q(),i=b,d=F("EventBus"),m=t,v=L(!0),u=()=>{c.value||(v.value=!v.value,d.emit("toggle-auto-rolagem",{isState:v.value}))};d.on("toggle-auto-rolagem",o=>{v.value=o.isState,l()}),d.on("disable-auto-rolagem",()=>{v.value=!1});const c=k(()=>$.hasPermission("sessao.add_sessaoplenaria")),l=()=>{c.value||!v.value||!s.value||setTimeout(()=>{const o=document.getElementById(`is-${m.item.__label__}-${m.item.id}`);let g=0,p=o;do g+=p.offsetTop,p=p.offsetParent;while(p&&p.tagName!=="BODY");window.scrollTo({top:g-100,behavior:"smooth"})},100)},h=k(()=>{const o=_.data_cache?.sessao_registrovotacao||{},g=Object.values(o).filter(p=>p.ordem===m.item.id);return g.sort((p,R)=>p.id-R.id),g}),y=k(()=>m.item.votacao_aberta&&m.item.tipo_votacao<=2),C=k(()=>m.item.discussao_aberta&&m.item.tipo_votacao<=2),f=k(()=>m.item.votacao_aberta_pedido_prazo&&m.item.tipo_votacao<=2),s=k(()=>m.item.discussao_aberta||m.item.votacao_aberta||m.item.votacao_aberta_pedido_prazo);I(y,(o,g)=>{!o&&g&&i("resync"),o&&l()},{immediate:!0}),I(s,o=>{o&&l()},{immediate:!0});const a=o=>{let g="tramitando",p=null;return o?p=_.data_cache?.sessao_tiporesultadovotacao?.[o.tipo_resultado_votacao]?.nome:m.item.resultado&&(p=m.item.resultado),C.value?g="result discussao-aberta":y.value?g="result votacao-aberta":p==="Aprovado"?g="result result-aprovado":p==="Rejeitado"?g="result result-rejeitado":p==="Pedido de Vista"?g="result result-vista":p==="Prazo Regimental"?g="result result-prazo":p==="Matéria lida"&&(g="result result-lida"),g};return(o,g)=>{const p=D("font-awesome-icon");return n(),r("div",{id:`pvd-${t.item.__label__}-${t.item.id}`,class:S(["processo-votacao-display",t.item.__label__])},[c.value?x("",!0):(n(),r("div",Ie,[e("button",{id:`auto-rolagem-${t.item.__label__}-${t.item.id}`,type:"button",class:S(["btn-auto-rolagem",v.value?"active":""]),onClick:u},[g[0]||(g[0]=E(" Autorolagem? ",-1)),O(p,{icon:"fa-solid fa-up-down"})],10,Pe)])),e("div",De,[!y.value&&!f.value?(n(!0),r(w,{key:0},V(h.value,R=>(n(),r("div",{class:"status-votacao",key:`rv-${R.id}`},[a(R)!=="result-vista"?(n(),r("div",qe,[R.numero_abstencoes?(n(),r("div",Be,[e("span",ze,A(R.numero_abstencoes),1),g[1]||(g[1]=e("span",{class:"titulo"},"ABS",-1))])):x("",!0),e("div",Ne,[e("span",Fe,A(R.numero_votos_nao),1),g[2]||(g[2]=e("span",{class:"titulo"},"NÃO",-1))]),e("div",Ue,[e("span",He,A(R.numero_votos_sim),1),g[3]||(g[3]=e("span",{class:"titulo"},"SIM",-1))])])):x("",!0),e("div",{class:S(a(R))},[e("span",null,A(P(_).data_cache?.sessao_tiporesultadovotacao?.[R.tipo_resultado_votacao]?.nome),1)],2)]))),128)):x("",!0),y.value||C.value||f.value||h.value.length===0?(n(),r("div",Ye,[y.value||C.value||f.value?(n(),r("div",{key:0,class:S(a(null))},[f.value?(n(),r("span",Ge,"VOTAÇÃO ABERTA PARA PEDIDO DE ADIAMENTO")):y.value?(n(),r("span",Je,"VOTAÇÃO ABERTA")):C.value?(n(),r("span",Ke,"DISCUSSÃO ABERTA")):x("",!0)],2)):(n(),r("div",{key:1,class:S(a(null))},[t.item.resultado?(n(),r("span",Qe,A(t.item.resultado),1)):t.item.tipo_votacao===4&&t.item.votacao_aberta?(n(),r("span",We,"Leitura em Andamento")):h.value.length===0?(n(),r("span",Xe,"Tramitando")):x("",!0)],2))])):x("",!0)])],10,Ee)}}},et=["id"],tt={class:"inner-title text-light m-4"},at={class:"inner-voto"},ot={key:0,class:"voto-result"},st={class:"avatar"},nt=["src","alt","title"],it={class:"voto-computado"},lt={key:1,class:"voto-result"},rt={__name:"VotoParlamentar",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const b=j(),_=q(),$=U(),i=t,d=k(()=>{const u=Object.values(b.data_cache?.materia_materialegislativa||{}).filter(c=>c.id===i.item.materia);return u.length>0?u[0]:null}),m=k(()=>{const u=i.item.__label__==="sessao_ordemdia"?"ordem":"expediente",c=Object.values(b.data_cache?.sessao_votoparlamentar||{}).filter(l=>l.parlamentar===_.data_connect.user.votante.parlamentar_id&&l[u]===i.item.id);return c.length>0?c[0]:null});function v(u){const c=i.item.__label__==="sessao_ordemdia"?"ordem":"expediente",l={parlamentar:_.data_connect.user.votante.parlamentar_id,[c]:i.item.id,voto:u};m.value?(l.id=m.value.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:m.value.id,form:l}).then(()=>{$.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{$.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:l}).then(()=>{$.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{$.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})}return z(()=>{setTimeout(()=>{const u=document.getElementById(`is-${i.item.__label__}-${i.item.id}`);let c=0,l=u;do c+=l.offsetTop,l=l.offsetParent;while(l&&l.tagName!=="BODY");window.scrollTo({top:c-100,behavior:"smooth"})},100)}),(u,c)=>(n(),r("div",{id:`vp-${t.item.__label__}-${t.item.id}`,class:S(["voto-parlamentar"])},[e("div",tt,[e("span",null,A(d.value?.__str__),1)]),e("div",at,[e("button",{type:"button",class:"btn btn-lg btn-success",onClick:c[0]||(c[0]=l=>v("Sim"))}," SIM "),e("button",{type:"button",class:"btn btn-lg btn-danger",onClick:c[1]||(c[1]=l=>v("Não"))}," NÃO "),e("button",{type:"button",class:"btn btn-lg btn-warning",onClick:c[2]||(c[2]=l=>v("Abstenção"))}," Abstenção ")]),m.value?(n(),r("div",ot,[e("div",st,[e("img",{src:`/api/parlamentares/parlamentar/${P(_).data_connect.user.votante.parlamentar_id}/fotografia.c256.png`,alt:P(_).data_connect.user.votante.nome_parlamentar,title:P(_).data_connect.user.votante.nome_parlamentar},null,8,nt)]),e("div",it,[c[3]||(c[3]=E(" Voto Computado: ",-1)),e("strong",null,A(m.value.voto),1)])])):(n(),r("div",lt," Voto não Computado "))],8,et))}},dt=["id"],ct={__name:"ControleDeVotacao",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const _=q(),$=b,i=t,d=k(()=>i.item.votacao_aberta&&i.item.tipo_votacao!==4);return(m,v)=>(n(),r("div",{id:`cv-${t.item.__label__}-${t.item.id}`,class:S(["controle-de-votacao",t.item.__label__,d.value?"votacao-aberta":"votacao-fechada",d.value&&P(_).isVotante&&t.item.tipo_votacao===2?"votante":"observador"])},[d.value&&P(_).isVotante&&t.item.tipo_votacao===2?(n(),T(rt,{key:`vp-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:v[0]||(v[0]=u=>$("resync"))},null,8,["item","sessao"])):x("",!0),(n(),T(Ze,{key:`pvd-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:v[1]||(v[1]=u=>$("resync"))},null,8,["item","sessao"]))],10,dt))}},ut={key:0,class:"message"},mt={__name:"Loading",props:{message:{type:String,default:""},position:{type:String,default:"fixed"}},setup(t){return(b,_)=>(n(),r("div",{class:"loading",style:B({position:t.position})},[_[0]||(_[0]=e("div",{class:"loader"},null,-1)),t.message?(n(),r("div",ut,A(t.message),1)):x("",!0)],4))}},vt=ee(mt,[["__scopeId","data-v-98eced51"]]),_t=["id"],pt={class:"modal-dialog modal-xl"},bt={class:"modal-content"},gt={class:"modal-header"},yt={class:"modal-title"},ft={class:"d-inline-block ps-3"},$t={class:"modal-body"},ht={class:"row"},kt={class:"col-md-6"},xt={class:"votos-parlamentares-list"},St={class:"voto-parlamentar-header voto-parlamentar-item font-weight-bold"},At={class:"voto-parlamentar-options"},Ot=["id"],Ct={class:"nome-parlamentar"},Rt={key:0,class:"voto-parlamentar-options"},Tt=["onClick"],Mt=["onClick"],jt=["onClick"],wt={class:"col-md-6"},Vt={class:"form-group"},Lt=["value"],Et={class:"modal-footer"},It={__name:"VotoParlamentarAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["close","register","cancel"],setup(t,{emit:b}){const _=b,$=j(),i=U(),d=t,m=k(()=>{const f=Object.values($.data_cache?.materia_materialegislativa||{}).filter(s=>s.id===d.item.materia);return f.length>0?f[0]:null}),v=k(()=>{const f=d.item.__label__==="sesso_ordemdia"?"sessao_presencaordemdia":"sessao_sessaoplenariapresenca";return Object.values($.data_cache?.[f]||{}).filter(a=>a.sessao_plenaria===d.sessao.id).map(a=>{const o=$.data_cache?.parlamentares_parlamentar?.[a.parlamentar];return o||null})}),u=k(()=>{const f=$.data_cache?.sessao_votoparlamentar||{},s=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente";return Object.values(f).filter(o=>o[s]===d.item.id&&o.votacao===null).reduce((o,g)=>(o[g.parlamentar]=g,o),{})}),c=L({tipo_resultado_votacao:null,observacao:""}),l=k(()=>Object.values($.data_cache?.sessao_tiporesultadovotacao||{}).filter(f=>f.natureza==="P"&&d.item.votacao_aberta_pedido_prazo===!0||f.id>0&&d.item.votacao_aberta_pedido_prazo===!1)),h=()=>{Object.values(u.value).forEach(f=>{console.log("deletando voto",f),M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:f.id})}),_("close")},y=(f,s)=>{if(!f){Object.values(v.value).forEach(p=>{y(p.id,s)});return}const a=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente",o={votacao:null,parlamentar:f,[a]:d.item.id,voto:s},g=u.value[f];if(g&&g.voto===s){M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:g.id}).then(()=>{i.addMessage({type:"info",text:"Voto Removido!",timeout:5e3})}).catch(()=>{i.addMessage({type:"danger",text:"Erro ao remover voto. Tente novamente.",timeout:5e3})});return}g?(o.id=g.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:g.id,form:o}).then(()=>{i.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{i.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:o}).then(()=>{i.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{i.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})},C=()=>{_("register",{action:"action_registrovotacao",form:{...c.value,unanime:!1,com_presidente:!1}}),_("close")};return(f,s)=>(n(),r("div",{id:`vpa-${t.item.__label__}-${t.item.id}`,class:"modal voto-parlamentar-admin-modal-view fade show",tabindex:"-1"},[e("div",pt,[e("div",bt,[e("div",gt,[e("h5",yt,[s[8]||(s[8]=E(" Registro de Votação dos Parlamentares ",-1)),e("small",ft,A(m.value?m.value.__str__:""),1)]),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=a=>_("close"))})]),e("div",$t,[e("div",ht,[e("div",kt,[e("div",xt,[e("div",St,[s[9]||(s[9]=e("div",{class:"nome-parlamentar"},[e("h5",null,"Votos dos Parlamentares")],-1)),e("div",At,[e("button",{type:"button",class:S(["btn btn-sm","btn-outline-success"]),onClick:s[1]||(s[1]=a=>y(0,"Sim"))}," SIM "),e("button",{type:"button",class:S(["btn btn-sm","btn-outline-danger"]),onClick:s[2]||(s[2]=a=>y(0,"Não"))}," NÃO "),e("button",{type:"button",class:S(["btn btn-sm","btn-outline-warning"]),onClick:s[3]||(s[3]=a=>y(0,"Abstenção"))}," Abstenção ")])]),(n(!0),r(w,null,V(v.value,a=>(n(),r("div",{id:`voto-parlamentar-${a.id}`,class:"voto-parlamentar-item",key:`voto-parlamentar-${a.id}`},[e("div",Ct,A(a.nome_parlamentar),1),u.value?(n(),r("div",Rt,[e("button",{type:"button",class:S(["btn btn-sm",`btn${u.value[a.id]?.voto==="Sim"?"-success":"-outline-success"}`]),onClick:o=>y(a.id,"Sim")}," SIM ",10,Tt),e("button",{type:"button",class:S(["btn btn-sm",`btn${u.value[a.id]?.voto==="Não"?"-danger":"-outline-danger"}`]),onClick:o=>y(a.id,"Não")}," NÃO ",10,Mt),e("button",{type:"button",class:S(["btn btn-sm",`btn${u.value[a.id]?.voto==="Abstenção"?"-warning":"-outline-warning"}`]),onClick:o=>y(a.id,"Abstenção")}," Abstenção ",10,jt)])):x("",!0)],8,Ot))),128))])]),e("div",wt,[e("div",Vt,[e("div",null,[s[10]||(s[10]=e("strong",{class:"p-2 d-inline-block"}," Tipo de Resultado da Votação: * ",-1)),Y(e("select",{id:"tipo-resultado-votacao",class:"form-select","onUpdate:modelValue":s[4]||(s[4]=a=>c.value.tipo_resultado_votacao=a)},[(n(!0),r(w,null,V(l.value,a=>(n(),r("option",{key:`tipo-resultado-votacao-${a.id}`,value:a.id},A(a.__str__),9,Lt))),128))],512),[[Q,c.value.tipo_resultado_votacao]])]),e("div",null,[s[11]||(s[11]=e("strong",{class:"pt-4 pb-2 d-inline-block"}," Observações: ",-1)),Y(e("textarea",{class:"form-control",rows:"5","onUpdate:modelValue":s[5]||(s[5]=a=>c.value.observacao=a)},null,512),[[W,c.value.observacao]])])])]),e("div",Et,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=a=>h())}," Cancelar Registro de Votação "),e("button",{type:"button",class:"btn btn-success",onClick:s[7]||(s[7]=a=>C())}," Registrar e Fechar Votação ")])])])])])],8,_t))}},Pt=["id"],Dt={class:"inner-is-admin"},qt={class:"btn-group",role:"group","aria-label":"Edição"},Bt=["href"],zt={key:0,class:"registro-leitura"},Nt={class:"btn-group",role:"group","aria-label":"State Leitura da matéria em Plenário"},Ft={class:"btn-group",role:"group","aria-label":"Registro de Leitura"},Ut=["disabled"],Ht=["disabled"],Yt={key:1,class:"registro-votacao"},Gt=["disabled"],Jt=["disabled"],Kt=["disabled"],Qt=["disabled"],Wt={__name:"ItemDeSessaoAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const b=q();j();const _=U(),$=t,i=L(!1),d=L(!1),m=k(()=>b.hasPermission("sessao.add_sessaoplenaria")),v=async f=>{const[s,a]=$.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,form:{field:f},action:"toggle_state",id:$.item.id}).then(o=>{console.log("Discussão alterada com sucesso",o)}).catch(o=>{console.error("Erro ao alterar discussão",o)})},u=async f=>{l({action:"action_registrovotacao",form:{unanime:!0,resultado:f,com_presidente:!1}})},c=async()=>{l({action:"action_registroleitura",form:{}})},l=async f=>{i.value=!0;const[s,a]=$.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,id:$.item.id,action:f.action,form:f.form}).then(o=>{console.log("Votação registrada com sucesso",o),i.value=!1}).catch(o=>{i.value=!1,_.addMessage({type:o.response.data.type||"danger",text:o.response.data.detail||"Erro ao registrar votação!",timeout:5e3})})},h=async()=>{i.value=!0;const[f,s]=$.item.__label__.split("_");M.Utils.patchModel({app:f,model:s,action:"action_cancelar_registroleitura",id:$.item.id}).then(a=>{i.value=!1,console.log("Registro de leitura cancelado com sucesso",a)}).catch(a=>{i.value=!1,_.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de leitura!",timeout:5e3})})},y=async()=>{i.value=!0,d.value=!1;const[f,s]=$.item.__label__.split("_");M.Utils.patchModel({app:f,model:s,action:"action_cancelar_registrovotacao",id:$.item.id}).then(a=>{i.value=!1,console.log("Registro de votação cancelado com sucesso",a)}).catch(a=>{i.value=!1,_.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de votação!",timeout:5e3})})};z(()=>{C(2e3)}),I(()=>$.item,()=>{C(500)});const C=f=>{setTimeout(()=>{document.querySelectorAll(".tooltip.bs-tooltip-auto").forEach(o=>{o.remove()}),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(o=>new X(o,{trigger:"hover"}))},f)};return(f,s)=>{const a=D("FontAwesomeIcon");return m.value?(n(),r("div",{key:0,id:`is-admin-${t.item.__label__}-${t.item.id}`,class:S(["item-de-sessao-admin",i.value?"actions-running":""])},[e("div",Dt,[e("div",qt,[e("a",{href:t.item.__label__==="sessao_ordemdia"?`/sessao/${t.item.sessao_plenaria}/ordemdia#id${t.item.materia}`:`/sessao/${t.item.sessao_plenaria}/expedientemateria#id${t.item.materia}`,target:"_blank",class:S(["btn","btn-outline-secondary"])},[O(a,{icon:"edit"})],8,Bt)]),t.item.tipo_votacao===4?(n(),r("div",zt,[e("div",Nt,[e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[0]||(s[0]=o=>v("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Leitura da matéria em Plenário"},[O(a,{icon:`${t.item.votacao_aberta?"book-open-reader":"book"}`},null,8,["icon"])],2)]),e("div",Ft,[t.item.resultado?(n(),r("button",{key:0,type:"button",class:"btn btn-outline-warning",onClick:s[1]||(s[1]=o=>h()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Leitura.",disabled:i.value},[O(a,{icon:"ban"})],8,Ut)):x("",!0),t.item.votacao_aberta?(n(),r("button",{key:1,type:"button",class:"btn btn-outline-primary",onClick:s[2]||(s[2]=o=>c()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Leitura da Matéria em Plenário.",disabled:i.value},[O(a,{icon:"book-open"})],8,Ht)):x("",!0)])])):(n(),r("div",Yt,[e("div",{class:"btn-group",role:"group",style:B({opacity:i.value?0:1}),"aria-label":"Registros de Votação Simbólica"},[e("button",{type:"button",class:"btn btn-outline-warning",onClick:s[3]||(s[3]=o=>y()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Votação.",disabled:i.value},[O(a,{icon:"ban"})],8,Gt),e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[4]||(s[4]=o=>u("R")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Rejeição Unânime sem voto do Presidente.",disabled:i.value},[O(a,{icon:"thumbs-down"})],8,Jt),e("button",{type:"button",class:"btn btn-outline-primary",onClick:s[5]||(s[5]=o=>u("A")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Aprovação Unânime sem voto do Presidente.",disabled:i.value},[O(a,{icon:"thumbs-up"})],8,Kt)],4),e("div",{class:"btn-group",role:"group",style:B({opacity:i.value?0:1}),"aria-label":"Botões de controle de abertura de discussão, votação e pedido de adiamento"},[e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.discussao_aberta?"success":"danger"}`]),onClick:s[6]||(s[6]=o=>v("discussao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Discussão em Plenário"},[O(a,{icon:"comments"}),s[11]||(s[11]=E("  ",-1))],2),e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[7]||(s[7]=o=>v("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação em Plenário"},[O(a,{icon:t.item.votacao_aberta?"book-open-reader":"book"},null,8,["icon"]),s[12]||(s[12]=E("  ",-1))],2),e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta_pedido_prazo?"success":"danger"}`]),onClick:s[8]||(s[8]=o=>v("votacao_aberta_pedido_prazo")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação de Pedido de Adiamento de Votação"},[...s[13]||(s[13]=[e("i",{class:"bi bi-hourglass-top"},null,-1)])],2)],4),t.item.votacao_aberta||t.item.votacao_aberta_pedido_prazo?(n(),r("div",{key:0,class:"btn-group",role:"group",style:B({opacity:i.value?0:1}),"aria-label":"Registro de Votação Simbólica sem unanimidade"},[e("button",{type:"button",class:"btn btn-outline-success",onClick:s[9]||(s[9]=o=>d.value=!0),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Votação",disabled:i.value},[O(a,{icon:"check-to-slot"})],8,Qt)],4)):x("",!0)]))]),i.value?(n(),T(vt,{key:0,message:"Registrando...",position:"absolute"})):x("",!0),d.value?(n(),T(G,{key:1,to:"#modalCmj"},[(n(),T(It,{key:`vpa-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onClose:s[10]||(s[10]=o=>d.value=!1),onRegister:l},null,8,["item","sessao"]))])):x("",!0)],10,Pt)):x("",!0)}}},Xt=["id"],Zt=["id"],ea={class:"childs"},ta={key:0,class:"title"},H={__name:"ItemDeSessao",props:{item:{type:Object,required:!0},parent:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const _=j(),$=q(),i=b,d=t,m=k(()=>$.hasPermission("sessao.add_sessaoplenaria")),v=k(()=>{const l=_.data_cache?.[d.item.__label__]||{},h=Object.values(l).filter(y=>y.parent===d.item.id);return h.sort((y,C)=>y.numero_ordem-C.numero_ordem),h}),u=()=>{const l=document.getElementById(`item-content-${d.item.__label__}-${d.item.id}`);l&&l.scrollIntoView({behavior:"smooth",block:"center"})},c=k(()=>{const l=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente";return Object.values(_.data_cache?.sessao_registrovotacao||{}).filter(h=>h[l]===d.item.id)});return(l,h)=>(n(),r("div",{id:`is-${t.item.__label__}-${t.item.id}`,class:S(["item-de-sessao",t.item.__label__,t.parent?"child-item":"parent-item"])},[e("div",{onClick:N(u,["self"]),id:`item-content-${t.item.__label__}-${t.item.id}`,class:S(["item-content",t.item.votacao_aberta&&t.item.tipo_votacao===2?"votacao-nominal":"",m.value?"item-admin":"",m.value&&c.value.length>0?`possui-registro-votacao-${c.value.length}`:""])},[(n(),T(Wt,{key:`is-admin-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:h[0]||(h[0]=y=>i("resync"))},null,8,["item","sessao"])),(n(),T(ct,{key:`cv-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:h[1]||(h[1]=y=>i("resync"))},null,8,["item","sessao"])),(n(),T(Le,{onClick:N(u,["self"]),key:`mp-${t.item.__label__}-${t.item.id}`,"materia-id":t.item.materia,item:t.item,sessao:t.sessao,onResync:h[2]||(h[2]=y=>i("resync"))},null,8,["materia-id","item","sessao"]))],10,Zt),e("div",ea,[!t.item.parent&&v.value.length>0?(n(),r("div",ta,[...h[4]||(h[4]=[e("strong",null,"Matérias Anexadas",-1)])])):x("",!0),(n(!0),r(w,null,V(v.value,y=>(n(),T(H,{key:`is-${y.__label__}-${y.id}`,item:y,parent:t.item,sessao:t.sessao,onResync:h[3]||(h[3]=C=>i("resync"))},null,8,["item","parent","sessao"]))),128))])],10,Xt))}},aa={class:"expediente-materia-list"},oa={class:"title"},sa={class:"expediente-materia-content"},na={__name:"ExpedienteMateriaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const _=b,$=j(),i=t,d=k(()=>{const v=$.data_cache?.sessao_expedientemateria||{},u=Object.values(v).filter(c=>c.sessao_plenaria===i.sessao?.id&&c.parent===null);return u.sort((c,l)=>c.numero_ordem-l.numero_ordem),u}),m=()=>{_("resync");const v=document.querySelector(".resync-icon-expmateria");v&&(v.classList.add("rotate"),setTimeout(()=>{v.classList.remove("rotate")},1e3))};return(v,u)=>{const c=D("FontAwesomeIcon");return n(),r("div",aa,[e("div",oa,[u[1]||(u[1]=e("strong",null,"Matérias do Grande Expediente",-1)),O(c,{icon:"arrows-rotate",class:"resync-icon-expmateria cursor-pointer ms-2",title:"Recarregar matéria",onClick:m})]),e("div",sa,[(n(!0),r(w,null,V(d.value,l=>(n(),T(H,{key:`is-${l.__label__}-${l.id}`,item:l,sessao:t.sessao,onResync:u[0]||(u[0]=h=>_("resync"))},null,8,["item","sessao"]))),128))])])}}},ia={class:"ordemdia-list"},la={class:"title"},ra={class:"ordemdia-content"},da={__name:"OrdemDiaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:b}){const _=b,$=j(),i=t,d=k(()=>{const v=$.data_cache?.sessao_ordemdia||{},u=Object.values(v).filter(c=>c.sessao_plenaria===i.sessao?.id&&c.parent===null);return u.sort((c,l)=>c.numero_ordem-l.numero_ordem),u}),m=()=>{_("resync");const v=document.querySelector(".resync-icon-ordemdia");v&&(v.classList.add("rotate"),setTimeout(()=>{v.classList.remove("rotate")},1e3))};return(v,u)=>{const c=D("FontAwesomeIcon");return n(),r("div",ia,[e("div",la,[u[1]||(u[1]=e("strong",null,"Matérias da Ordem do Dia",-1)),O(c,{icon:"arrows-rotate",class:"resync-icon-ordemdia cursor-pointer ms-2",title:"Recarregar matéria",onClick:m})]),e("div",ra,[(n(!0),r(w,null,V(d.value,l=>(n(),T(H,{key:`is-${l.__label__}-${l.id}`,item:l,sessao:t.sessao,onResync:u[0]||(u[0]=h=>_("resync"))},null,8,["item","sessao"]))),128))])])}}},ca=["href"],ua={key:1,class:"sessao-plenaria-content"},ma=["innerHTML"],va=["innerHTML"],_a=["innerHTML"],ya={__name:"SessaoPlenariaView",setup(t){const b=j(),_=Z(),$=F("EventBus"),i=L(Number(_.params.id)||0),d=L(!1),m=k(()=>b.data_cache?.sessao_sessaoplenaria?.[i.value]);z(()=>{b.fetchSync({app:"sessao",model:"sessaoplenaria",id:i.value,params:{},force_fetch:!0}).then(()=>{h(!1)})});const v=k(()=>Object.values(b.data_cache?.sessao_expedientesessao||{}).filter(y=>y.sessao_plenaria===i.value&&y.tipo===1)),u=k(()=>Object.values(b.data_cache?.sessao_expedientesessao||{}).filter(y=>y.sessao_plenaria===i.value&&y.tipo===3)),c=k(()=>Object.values(b.data_cache?.sessao_expedientesessao||{}).filter(y=>y.sessao_plenaria===i.value&&y.tipo===4));$.on("rito-toggle",()=>{d.value=!d.value});const l=()=>{$.emit("rito-toggle")},h=(y=!0)=>{b.invalidateDataCache(["sessao"],["expedientemateria","ordemdia"]),b.fetchSync({app:"sessao",model:"expedientesessao",params:{sessao_plenaria:i.value,get_all:"True"}}),(async()=>await Promise.all([b.fetchSync({app:"sessao",model:"ordemdia",params:{sessao_plenaria:i.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}}),b.fetchSync({app:"sessao",model:"expedientemateria",params:{sessao_plenaria:i.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}})]))().then(()=>{const f=Object.values(b.data_cache?.sessao_ordemdia||{}).filter(p=>p.sessao_plenaria===i.value).map(p=>p.id),s=Object.values(b.data_cache?.sessao_expedientemateria||{}).filter(p=>p.sessao_plenaria===i.value).map(p=>p.id),a=new Set,o=b.data_cache?.sessao_expedientemateria||{};Object.values(o).forEach(p=>{p.sessao_plenaria===i.value&&a.add(p.materia)});const g=b.data_cache?.sessao_ordemdia||{};Object.values(g).forEach(p=>{p.sessao_plenaria===i.value&&a.add(p.materia)}),a.size>0&&(b.fetchSync({app:"materia",model:"materialegislativa",params:{id__in:Array.from(a),exclude:"metadata",get_all:"True"},force_fetch:y}),b.fetchSync({app:"sessao",model:"registroleitura",params:{materia__in:Array.from(a),get_all:"True"}}),b.fetchSync({app:"sessao",model:"registrovotacao",params:{materia__in:Array.from(a),get_all:"True",expand:"tipo_resultado_votacao"}}),b.fetchSync({app:"sessao",model:"votoparlamentar",params:{ordem__in:Array.from(f),get_all:"True"}}),b.fetchSync({app:"sessao",model:"votoparlamentar",params:{expediente__in:Array.from(s),get_all:"True"}}),b.fetchSync({app:"materia",model:"documentoacessorio",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),b.fetchSync({app:"norma",model:"legislacaocitada",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),b.fetchSync({app:"sessao",model:"tiporesultadovotacao",params:{get_all:"True"}}),b.fetchSync({app:"sessao",model:"sessaoplenariapresenca",params:{get_all:"True",sessao_plenaria:i.value,expand:"parlamentar"}}),b.fetchSync({app:"sessao",model:"presencaordemdia",params:{get_all:"True",sessao_plenaria:i.value,expand:"parlamentar"}}))})};return(y,C)=>(n(),r("div",{key:`sessao-plenaria-view-${i.value}`,class:"sessao-plenaria-view"},[m.value?(n(),r("a",{key:0,class:"sessao_link_manage",href:m.value.link_detail_backend,target:"_blank"},A(m.value.__str__),9,ca)):x("",!0),m.value?(n(),r("div",ua,[v.value.length>0?(n(),r("div",{key:0,onClick:l,class:S(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?v.value[0].conteudo:"Visualizar o Roteiro..."},null,8,ma)],2)):x("",!0),O(na,{sessao:m.value,onResync:h},null,8,["sessao"]),u.value.length>0?(n(),r("div",{key:1,onClick:l,class:S(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?u.value[0].conteudo:"Visualizar o Roteiro..."},null,8,va)],2)):x("",!0),O(da,{sessao:m.value,onResync:h},null,8,["sessao"]),c.value.length>0?(n(),r("div",{key:2,onClick:l,class:S(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?c.value[0].conteudo:"Visualizar o Roteiro..."},null,8,_a)],2)):x("",!0)])):x("",!0)]))}};export{ya as default};
