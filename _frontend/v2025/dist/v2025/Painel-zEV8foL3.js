import{v as P,y as K,c as k,_ as U,w as Y,f as x,g,k as e,i as A,D as C,j as se,E as ie,G as ce,F as ee,r as te,t as H,H as F,I as S,q as B,C as le,l as G,J as q,K as fe,T as ae,n as ve,L as oe,o as pe,u as re,M as ge,N as me}from"./vendor-Dip3oSWq.js";import{_ as Q,u as Z,a as ne,R}from"./main-DpOHiXMo.js";import{a as W}from"./teleportStore-BGjNhIeB.js";import{F as ue}from"./vendor_fortawesome-C15cwA3p.js";const ye={class:"container"},_e={class:"row py-2"},he={class:"col-3 py-2"},we={class:"form-group"},be={id:"div_id_display_title",class:"custom-control custom-checkbox"},$e={key:0,class:"col-3"},Se=["value"],xe={class:"col-6"},Ee={class:"row py-2"},Me={class:"col-6"},Pe={id:"div_id_config",class:"form-group"},ke={class:"col-6"},Ne={id:"div_id_styles",class:"form-group"},Ve={class:"container"},We={class:"row"},Ce={class:"col-12"},Oe={id:"div_id_description",class:"form-group"},Je={class:"container actions pt-3"},ze={class:"row"},Te={class:"col-12"},Ie={class:"btn-group"},Be={__name:"WidgetEditor",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(N){const _=P(null),b=Z(),E=ne(),p=K("EventBus"),h=N,s=P({"":"Nenhum componente selecionado",WidgetSessaoPlenariaTitulo:"WidgetSessaoPlenariaTitulo - Título da Sessão Plenária vinculada ao Painel",WidgetCronometroEvento:"WidgetCronometroEvento - Cronômetro do Evento vinculado ao Painel",WidgetCronometroPalavra:"WidgetCronometroPalavra - Cronômetro da Palavra vinculada ao Painel"}),d=k(()=>b.data_cache.painelset_widget?.[h.widgetSelected]||null),f=k(()=>U.orderBy(U.filter(b.data_cache.painelset_widget,{parent:h.widgetSelected})||[],["position"],["asc"])),u=k(()=>!d.value||!d.value.config?"":JSON.stringify(d.value.config,null,2)),o=k(()=>!d.value||!d.value.styles?"":JSON.stringify({component:d.value.styles.component||{},title:d.value.styles.title||{},inner:d.value.styles.inner||{}},null,2)),w=P({config:u.value,styles:o.value}),m=t=>{p.emit("painelset:editorarea:close"),p.emit("painelset:editorarea:resize",0)},O=()=>{if(d.value)try{const t=JSON.parse(w.value.config),l=JSON.parse(w.value.styles);d.value.styles=l,d.value.config=t,w.value.config=JSON.stringify(t,null,2),w.value.styles=JSON.stringify(l,null,2),L({config:t,styles:l})}catch(t){E.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${t.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",t),w.value.config=u.value,w.value.styles=o.value}},J=t=>{console.log("WidgetEditor.vue: changeForm event:",t);const l={...d.value};delete l.id,s.value[l.vue_component]===void 0&&(l.vue_component=""),["styles","config"].includes(t.target.name)||L(l)},L=async t=>{try{await R.Utils.patchModel({app:"painelset",model:"widget",id:d.value.id,form:t}),E.addMessage({type:"info",text:"Widget atualizado.",timeout:2e3}),console.log("WidgetEditor.vue: patchModel updated successfully.")}catch(l){E.addMessage({type:"danger",text:"Erro ao salvar as alterações do Widget.",timeout:5e3}),console.error("Erro ao salvar as alterações do Widget:",l)}};Y(()=>d.value,t=>{t&&(w.value.config=u.value,w.value.styles=o.value)});const r=t=>{d.value&&confirm(`Confirma a exclusão do Widget: ${d.value.name} ?`)&&R.Utils.deleteModel({app:"painelset",model:"widget",id:d.value.id}).then(()=>{console.log("Widget deleted successfully"),p.emit("painelset:editorarea:close","force")}).catch(l=>{console.error("Error deleting widget:",l)})};return(t,l)=>{const $=le("FontAwesomeIcon");return g(),x("div",{ref_key:"painelsetWidgetEditor",ref:_,key:`painelset-widget-editor-${d.value?.id}`,class:"painelset-widget-editor"},[e("form",{action:"",onChange:l[8]||(l[8]=a=>J(a))},[e("fieldset",null,[l[18]||(l[18]=e("legend",null,"Configurações do Widget",-1)),e("div",ye,[e("div",_e,[e("div",he,[e("div",we,[e("div",be,[C(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":l[0]||(l[0]=a=>d.value.config.displayTitle=a),id:"id_display_title"},null,512),[[ie,d.value.config.displayTitle]]),l[9]||(l[9]=se("  ",-1)),l[10]||(l[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do widget? ",-1)),l[11]||(l[11]=e("br",null,null,-1)),l[12]||(l[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),f.value.length===0?(g(),x("div",$e,[l[13]||(l[13]=e("label",{for:"widget-vue-component",class:"form-label"},"Componente Vue",-1)),C(e("select",{class:"form-select","onUpdate:modelValue":l[1]||(l[1]=a=>d.value.vue_component=a),id:"widget-vue-component"},[(g(!0),x(ee,null,te(s.value,(a,y)=>(g(),x("option",{key:`widget-vue-component-option-${y}`,value:y},H(a),9,Se))),128))],512),[[ce,d.value.vue_component]])])):A("",!0),e("div",xe,[l[14]||(l[14]=e("label",{for:"widget-name",class:"form-label"},"Título do Widget",-1)),C(e("input",{type:"text",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=a=>d.value.name=a),placeholder:"Título do Widget"},null,512),[[F,d.value.name]])])]),e("div",Ee,[e("div",Me,[e("div",Pe,[l[15]||(l[15]=e("label",{for:"widget-config",class:"form-label"},"Configurações do Widget (JSON)",-1)),e("div",null,[C(e("textarea",{id:"widget-config",name:"config",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=a=>w.value.config=a),placeholder:"Configurações do Widget em JSON",rows:"15",onBlur:O},null,544),[[F,w.value.config]])])])]),e("div",ke,[e("div",Ne,[l[16]||(l[16]=e("label",{for:"widget-styles",class:"form-label"},"Estilos do Widget (JSON)",-1)),e("div",null,[C(e("textarea",{name:"styles",id:"widget-styles",class:"form-control","onUpdate:modelValue":l[4]||(l[4]=a=>w.value.styles=a),rows:"15",placeholder:"Estilos do Widget em JSON",onBlur:O},null,544),[[F,w.value.styles]])])])])])]),e("div",Ve,[e("div",We,[e("div",Ce,[e("div",Oe,[l[17]||(l[17]=e("label",{for:"id_description",class:"form-label"},"Descrição do Widget",-1)),e("div",null,[C(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":l[5]||(l[5]=a=>d.value.description=a),placeholder:"Descrição do Widget",rows:"5"},null,512),[[F,d.value.description]])])])])])]),e("div",Je,[e("div",ze,[e("div",Te,[e("div",Ie,[e("button",{class:"btn btn-secondary",onClick:l[6]||(l[6]=S(a=>m(),["stop","prevent"])),title:"Fechar Editor de Widget"},[B($,{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-danger",onMousedown:S(a=>!1,["stop","prevent"]),onClick:l[7]||(l[7]=S(a=>r(),["stop","prevent"]))},[B($,{icon:"fa-solid fa-trash-can"})],32)])])])])])],32)])}}},De=Q(Be,[["__scopeId","data-v-0afee643"]]),Ue=["id"],Ae={key:2,class:"inner-widget inner-children"},Fe={key:3,class:"manager"},Le={class:"position"},Re={class:"toolbar"},je={class:"btn-group"},Xe={class:"btn-group right"},Ye={__name:"Widget",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(N){const _=Z(),b=K("EventBus"),E=N,p=P(!1),h=P(null),s=P(!1),d=P({}),f=P({x:0,y:0,w:100,h:100,mouseResizeEnter:!1}),u=k(()=>h.value&&W.value===h.value.id),o=k(()=>_.data_cache.painelset_widget?.[E.widgetSelected]||null),w=k(()=>{if(!o.value||!o.value.config?.coords)return{};const i={},n=o.value.config.coords;return n.x!==void 0&&(i.left=`${n.x}%`),n.y!==void 0&&(i.top=`${n.y}%`),n.w!==void 0&&(i.right=`${n.w+n.x>100?0:100-(n.w+n.x)}%`),n.h!==void 0&&(i.bottom=`${n.h+n.y>100?0:100-(n.h+n.y)}%`),i}),m=k(()=>U.orderBy(U.filter(_.data_cache.painelset_widget,{parent:E.widgetSelected})||[],["position"],["asc"]));(async()=>{_.fetchSync({app:"painelset",model:"widget",filters:{parent:E.widgetSelected}}).then(i=>{i&&i.data.results.length>0})})(),b.on("painelset:editorarea:close",(i=null)=>{if(i&&i==="force"){p.value=!1,s.value=!1,W.value=null;return}i&&h.value&&i===h.value.id||p.value||(p.value=!1,s.value=!1,W.value=null)}),Y(()=>s.value,i=>{i?(b.emit("painelset:editorarea:close",h.value.id),oe(()=>{W.value=h.value.id})):W.value=null});const J=(i=>{if(console.debug("Received oncomponent event:"),!i||!i.type){console.warn("Invalid oncomponent event received, missing type");return}if(i.type==="extra_styles"){if(!i.extra_styles){console.warn("Invalid extra_styles event, missing extra_styles data");return}const n={...i.extra_styles};d.value=n}}),L=()=>{console.debug("Opening widget editor modal for widget:",o.value),s.value=!s.value},r=()=>{o.value&&confirm(`Confirma a exclusão do Widget: ${o.value.name} e todos seus SubWidgets?`)&&R.Utils.deleteModel({app:"painelset",model:"widget",id:o.value.id}).then(()=>{console.log("Widget deleted successfully")}).catch(i=>{console.error("Error deleting widget:",i)})},t=()=>{if(!o.value)return;const i={...o.value.config,coords:{...o.value.config.coords,x:10,y:10}},n={...o.value,id:void 0,name:`${o.value.name} (Cópia)`,position:m.value.length+1,config:i};R.Utils.createModel({app:"painelset",model:"widget",form:n}).then(D=>{console.log("Widget duplicated successfully:",D.data)}).catch(D=>{console.error("Error duplicating widget:",D)})},l=()=>{if(!o.value)return;const i={name:"Novo Widget",parent:o.value.id,visao:o.value.visao,position:m.value.length+1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30},displayTitle:!0},styles:{component:{},title:{},inner:{}}};R.Utils.createModel({app:"painelset",model:"widget",form:i}).then(n=>{console.log("Default child widget created successfully:",n.data)}).catch(n=>{console.error("Error creating default child widget:",n)})},$=i=>!i||i.x===void 0||i.y===void 0||i.w===void 0||i.h===void 0||i.x===null||i.y===null||i.w===null||i.h===null?!1:i.w>5&&i.w<=100&&i.h>5&&i.h<=100&&i.x>=0&&i.x<=100&&i.y>=0&&i.y<=100&&i.x+i.w<=100&&i.y+i.h<=100,a=i=>{if(!$(i)){console.error("Invalid widget coordinates, aborting update");return}R.Utils.patchModel({app:"painelset",model:"widget",id:o.value.id,form:{config:{...o.value.config,coords:{...o.value.config.coords,x:i.x,y:i.y,w:i.w,h:i.h}}}}).then(n=>{console.log(n.data),console.log("Widget coordinates updated successfully")}).catch(n=>{console.error("Error updating widget coordinates:",n)})},y=i=>{i.preventDefault(),!f.value.mouseResizeEnter&&(p.value=!p.value,p.value||(s.value=!1),console.log("Activating painel editor teleport for Widget:",E.widgetSelected),b.emit("painelset:editorarea:close",h.value.id))},M=(i,n)=>{if(f.value.mouseResizeEnter=!0,i.preventDefault(),!p.value)return;const D=h.value,V=D.getBoundingClientRect(),v=D.parentElement.getBoundingClientRect(),c={...f.value};console.log("Mouse move detected:",i.clientX,i.clientY,V);const de=z=>{let T=0,I=0;if(n==="top-left"){const j=z.clientX-V.left,X=z.clientY-V.top;T=Math.round(j/v.width*100),I=Math.round(X/v.height*100),c.w=o.value.config.coords.w-T,c.h=o.value.config.coords.h-I,c.x=o.value.config.coords.x+T,c.y=o.value.config.coords.y+I}else if(n==="top-right"){const j=z.clientX-V.right,X=z.clientY-V.top;T=Math.round(j/v.width*100),I=Math.round(X/v.height*100),c.w=o.value.config.coords.w+T,c.h=o.value.config.coords.h-I,c.x=o.value.config.coords.x,c.y=o.value.config.coords.y+I}else if(n==="bottom-right"){const j=z.clientX-V.right,X=z.clientY-V.bottom;T=Math.round(j/v.width*100),I=Math.round(X/v.height*100),c.w=o.value.config.coords.w+T,c.h=o.value.config.coords.h+I,c.x=o.value.config.coords.x,c.y=o.value.config.coords.y}else if(n==="bottom-left"){const j=z.clientX-V.left,X=z.clientY-V.bottom;T=Math.round(j/v.width*100),I=Math.round(X/v.height*100),c.w=o.value.config.coords.w-T,c.h=o.value.config.coords.h+I,c.x=o.value.config.coords.x+T,c.y=o.value.config.coords.y}else if(n==="center-center"){const j=z.clientX-V.left-V.width/2,X=z.clientY-V.top-V.height/2;T=Math.round(j/v.width*100),I=Math.round(X/v.height*100),console.debug("Resizing widget...",j,X,n,T,I,c),c.w=o.value.config.coords.w,c.h=o.value.config.coords.h,c.x=o.value.config.coords.x+T,c.y=o.value.config.coords.y+I}console.debug("Resizing widget...",z.clientX,z.clientY,n,T,I,c),$(c)?(f.value.w=c.w,f.value.h=c.h,f.value.x=c.x,f.value.y=c.y,D.style.right=`${100-(c.w+c.x)}%`,D.style.bottom=`${100-(c.h+c.y)}%`,D.style.left=`${c.x}%`,D.style.top=`${c.y}%`):console.warn("Invalid coordinates during resize, ignoring update")};console.log("Starting resize operation"),window.addEventListener("mousemove",de),window.addEventListener("mouseup",z=>{window.removeEventListener("mouseup",this),window.removeEventListener("mousemove",de),z.preventDefault(),f.value.mouseResizeEnter&&(f.value.mouseResizeEnter=!1,a({x:f.value.x,y:f.value.y,w:f.value.w,h:f.value.h}),console.log("Resize operation ended"))})};return(i,n)=>{const D=le("Widget",!0),V=le("FontAwesomeIcon");return g(),x("div",{id:`id-painelset-widget-${o.value?.id}`,ref_key:"painelsetWidget",ref:h,key:`painelset-widget-${o.value?.id}`,class:ve(["painelset-widget",p.value?"editmode":""]),style:q({...o.value?.styles.component||{},...w.value,...d.value}),onMousedown:n[9]||(n[9]=S(v=>y(v),["stop","prevent"])),onClick:S(v=>!1,["stop","prevent"])},[o.value?.config?.displayTitle?(g(),x("div",{key:0,class:"widget-titulo",style:q(o.value?.styles.title||{})},H(o.value?.name),5)):A("",!0),o.value?.vue_component?(g(),x("div",{key:1,class:"inner-widget",style:q(o.value?.styles.inner||{})},[(g(),G(fe(o.value?.vue_component),{"painel-id":N.painelId,"widget-selected":o.value?.id,onOncomponent:J},null,40,["painel-id","widget-selected"]))],4)):A("",!0),o.value?.vue_component?A("",!0):(g(),x("div",Ae,[(g(!0),x(ee,null,te(m.value,(v,c)=>(g(),G(D,{key:`widget-${v.id}-${c}`,"painel-id":N.painelId,"widget-selected":v.id},null,8,["painel-id","widget-selected"]))),128))])),p.value?(g(),x("div",Fe,[e("div",Le,H(o.value?.position),1),e("div",Re,[e("div",je,[e("button",{class:"btn btn-sm btn-danger",onMousedown:S(v=>!1,["stop","prevent"]),onClick:n[0]||(n[0]=S(v=>r(),["stop","prevent"]))},[B(V,{icon:"fa-solid fa-trash-can"})],32),e("button",{class:"btn btn-sm btn-secondary",onMousedown:S(v=>!1,["stop","prevent"]),onClick:n[1]||(n[1]=S(v=>t(),["stop","prevent"]))},[B(V,{icon:"fa-solid fa-clone"})],32),e("button",{class:"btn btn-sm btn-primary",onMousedown:S(v=>!1,["stop","prevent"]),onClick:n[2]||(n[2]=S(v=>l(),["stop","prevent"]))},[B(V,{icon:"fa-solid fa-plus"})],32)]),e("div",Xe,[e("button",{class:"btn btn-sm btn-dark",onMousedown:S(v=>!1,["stop","prevent"]),onClick:n[3]||(n[3]=S(v=>L(),["stop","prevent"]))},[B(V,{icon:"fa-solid fa-pen-to-square"})],32)])]),e("div",{class:"resize-handle top-left",onMousedown:n[4]||(n[4]=v=>M(v,"top-left"))},null,32),e("div",{class:"resize-handle top-right",onMousedown:n[5]||(n[5]=v=>M(v,"top-right"))},null,32),e("div",{class:"resize-handle bottom-left",onMousedown:n[6]||(n[6]=v=>M(v,"bottom-left"))},null,32),e("div",{class:"resize-handle bottom-right",onMousedown:n[7]||(n[7]=v=>M(v,"bottom-right"))},null,32),e("div",{class:"resize-handle center-center",onMousedown:n[8]||(n[8]=v=>M(v,"center-center"))},null,32)])):A("",!0),s.value&&u.value?(g(),G(ae,{key:4,to:"#painelset-editorarea",disabled:!u.value},[B(De,{"painel-id":N.painelId,"widget-selected":o.value?.id},null,8,["painel-id","widget-selected"])],8,["disabled"])):A("",!0)],46,Ue)}}},He=Q(Ye,[["__scopeId","data-v-4334ce8e"]]),qe={class:"container"},Ge={class:"row py-2"},Ke={class:"col-3 py-2"},Qe={class:"form-group"},Ze={id:"div_id_display_title",class:"custom-control custom-checkbox"},et={class:"col-6"},tt={class:"row py-2"},lt={class:"col-6"},ot={id:"div_id_config",class:"form-group"},st={class:"col-6"},it={id:"div_id_styles",class:"form-group"},at={class:"container"},nt={class:"row"},dt={class:"col-12"},rt={id:"div_id_description",class:"form-group"},ut={class:"container actions pt-3"},ct={class:"row"},vt={class:"col-12 d-flex gap-2"},pt={class:"btn-group"},ft={class:"btn-group"},gt={__name:"VisaoEditor",props:{painelId:{type:Number,default:0},visaoSelected:{type:Number,default:0}},setup(N){const _=K("EventBus"),b=P(null),E=Z(),p=ne(),h=N,s=k(()=>E.data_cache.painelset_visaodepainel?.[h.visaoSelected]||null),d=k(()=>!s.value||!s.value.config?"":JSON.stringify(s.value.config,null,2)),f=k(()=>!s.value||!s.value.styles?"":JSON.stringify({component:s.value.styles.component||{},title:s.value.styles.title||{},inner:s.value.styles.inner||{}},null,2)),u=P({config:d.value,styles:f.value}),o=()=>{if(s.value)try{const r=JSON.parse(u.value.config),t=JSON.parse(u.value.styles);s.value.styles=t,s.value.config=r,u.value.config=JSON.stringify(r,null,2),u.value.styles=JSON.stringify(t,null,2),m({config:r,styles:t})}catch(r){p.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${r.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",r),u.value.config=d.value,u.value.styles=f.value}},w=r=>{console.log("VisaoEditor.vue: changeForm event:",r);const t={...s.value};delete t.id,["styles","config"].includes(r.target.name)||m(t)},m=async r=>{try{await R.Utils.patchModel({app:"painelset",model:"visaodepainel",id:s.value.id,form:r}),p.addMessage({type:"info",text:"Visão do Painel atualizado.",timeout:2e3}),console.log("VisaoEditor.vue: patchModel updated successfully.")}catch(t){p.addMessage({type:"danger",text:"Erro ao salvar as alterações do Visão do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Visão do Painel:",t)}};Y(()=>s.value,r=>{r&&(u.value.config=d.value,u.value.styles=f.value)});const O=r=>{_.emit("painelset:editorarea:close"),_.emit("painelset:editorarea:resize",0)},J=()=>{s.value&&confirm(`Confirma a exclusão da Visão do Painel: ${s.value.name} ?`)&&R.Utils.deleteModel({app:"painelset",model:"visaodepainel",id:s.value.id}).then(()=>{p.addMessage({type:"info",text:"Visão do Painel excluído com sucesso.",timeout:5e3}),_.emit("painelset:editorarea:close","force")}).catch(r=>{p.addMessage({type:"danger",text:"Erro ao excluir a Visão do Painel.",timeout:5e3}),console.error("Error deleting visaodepainel:",r)})},L=()=>{if(!s.value)return;const r={name:"Novo Widget",parent:null,visao:s.value.id,position:E.data_cache.painelset_widget?Object.values(E.data_cache.painelset_widget).filter(t=>t.visao===s.value.id).length+1:1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30},displayTitle:!0},styles:{component:{},title:{},inner:{}}};R.Utils.createModel({app:"painelset",model:"widget",form:r}).then(t=>{console.log("Default child widget created successfully:",t.data)}).catch(t=>{console.error("Error creating default child widget:",t)})};return(r,t)=>{const l=le("FontAwesomeIcon");return g(),x("div",{ref_key:"painelsetVisaoEditor",ref:b,key:`painelset-visaodepainel-editor-${s.value?.id}`,class:"painelset-visaodepainel-editor"},[e("form",{action:"",onChange:t[8]||(t[8]=$=>w($))},[e("fieldset",null,[t[17]||(t[17]=e("legend",null,"Configurações da Visão do Painel",-1)),e("div",qe,[e("div",Ge,[e("div",Ke,[e("div",Qe,[e("div",Ze,[C(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":t[0]||(t[0]=$=>s.value.config.displayTitle=$),id:"id_display_title"},null,512),[[ie,s.value.config.displayTitle]]),t[9]||(t[9]=se("  ",-1)),t[10]||(t[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do painel? ",-1)),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),e("div",et,[t[13]||(t[13]=e("label",{for:"painel-name",class:"form-label"},"Título da Visão do Painel",-1)),C(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=$=>s.value.name=$),placeholder:"Título da Visão do Painel"},null,512),[[F,s.value.name]])])]),e("div",tt,[e("div",lt,[e("div",ot,[t[14]||(t[14]=e("label",{for:"painel-config",class:"form-label"},"Configurações da Visão do Painel (JSON)",-1)),e("div",null,[C(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=$=>u.value.config=$),placeholder:"Configurações da Visão do Painel em JSON",rows:"15",onBlur:o},null,544),[[F,u.value.config]])])])]),e("div",st,[e("div",it,[t[15]||(t[15]=e("label",{for:"painel-styles",class:"form-label"},"Estilos da Visão do Painel (JSON)",-1)),e("div",null,[C(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=$=>u.value.styles=$),rows:"15",placeholder:"Estilos da Visão do Painel em JSON",onBlur:o},null,544),[[F,u.value.styles]])])])])])]),e("div",at,[e("div",nt,[e("div",dt,[e("div",rt,[t[16]||(t[16]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[C(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=$=>s.value.description=$),placeholder:"Descrição do Painel",rows:"5"},null,512),[[F,s.value.description]])])])])])]),e("div",ut,[e("div",ct,[e("div",vt,[e("div",pt,[e("button",{class:"btn btn-secondary",onClick:t[5]||(t[5]=S($=>O(),["stop","prevent"])),title:"Fechar Editor da Visão do Painel"},[B(l,{icon:["fas","times"]})]),e("button",{class:"btn btn-danger",onMousedown:S($=>!1,["stop","prevent"]),onClick:t[6]||(t[6]=S($=>J(),["stop","prevent"])),title:"Excluir Visão do Painel"},[B(l,{icon:"fa-solid fa-trash-can"})],32)]),e("div",ft,[e("button",{class:"btn btn-primary",onMousedown:S($=>!1,["stop","prevent"]),onClick:t[7]||(t[7]=S($=>L(),["stop","prevent"])),title:"Adicionar Widget à Visão do Painel"},[B(l,{icon:"fa-solid fa-plus"})],32)])])])])])],32)])}}},mt=Q(gt,[["__scopeId","data-v-4cabdb3f"]]),yt=["id"],_t={key:1,class:"visao-empty"},ht={__name:"VisaoDePainel",props:{painelId:{type:Number,default:0},visaodepainelSelected:{type:Number,default:0}},setup(N){const _=Z(),b=N,E=K("EventBus"),p=P(!1),h=P(null),s=k(()=>W.value===h.value.id);E.on("painelset:editorarea:close",(o=null)=>{if(o&&o==="force"){p.value=!1,W.value=null;return}o&&h.value&&o===h.value.id||(W.value=null,p.value=!1)}),Y(()=>p.value,o=>{o?(E.emit("painelset:editorarea:close",h.value.id),oe(()=>{W.value=h.value.id})):W.value=null});const d=k(()=>_.data_cache.painelset_visaodepainel?.[b.visaodepainelSelected]||null),f=k(()=>U.orderBy(U.filter(_.data_cache.painelset_widget,{visao:b.visaodepainelSelected,parent:null})||[],["position"],["asc"]));return(async()=>{_.fetchSync({app:"painelset",model:"widget",filters:{visaodepainel:b.visaodepainelSelected}}).then(o=>{o&&o.data.results.length>0})})(),(o,w)=>(g(),x("div",{id:`id-painelset-visaodepainel${N.visaodepainelSelected}`,ref_key:"painelsetVisaodepainel",ref:h,key:`painelset-visaodepainel${N.visaodepainelSelected}`,class:"painelset-visaodepainel",style:q(d.value?.styles.component||{}),onClick:w[0]||(w[0]=S(m=>p.value=!p.value,["stop"]))},[d.value?.config?.displayTitle?(g(),x("div",{key:0,class:"visaodepainel-titulo",style:q(d.value?.styles.title||{})},H(d.value?.name),5)):A("",!0),e("div",{class:"inner-visaodepainel",style:q(d.value?.styles.inner||{})},[(g(!0),x(ee,null,te(f.value,(m,O)=>(g(),G(He,{key:`widget-${m.id}-${O}`,"painel-id":N.painelId,"widget-selected":m.id},null,8,["painel-id","widget-selected"]))),128))],4),f.value.length===0?(g(),x("div",_t,[...w[1]||(w[1]=[e("p",null,"Não há widgets configurados para esta visão.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar o primeiro widget à visão.",-1)])])):A("",!0),p.value&&s.value?(g(),G(ae,{key:2,to:"#painelset-editorarea",disabled:!s.value},[B(mt,{"painel-id":N.painelId,"visao-selected":N.visaodepainelSelected},null,8,["painel-id","visao-selected"])],8,["disabled"])):A("",!0)],12,yt))}},wt=Q(ht,[["__scopeId","data-v-e98dbd71"]]),bt={class:"container"},$t={class:"row py-2"},St={class:"col-3 py-2"},xt={class:"form-group"},Et={id:"div_id_display_title",class:"custom-control custom-checkbox"},Mt={class:"col-6"},Pt={class:"col-6"},kt=["value"],Nt={class:"row py-2"},Vt={class:"col-6"},Wt={id:"div_id_config",class:"form-group"},Ct={class:"col-6"},Ot={id:"div_id_styles",class:"form-group"},Jt={class:"container"},zt={class:"row"},Tt={class:"col-12"},It={id:"div_id_description",class:"form-group"},Bt={class:"container actions pt-3"},Dt={class:"row"},Ut={class:"col-12"},At={class:"btn-group"},Ft={__name:"PainelEditor",props:{painelId:{type:Number,default:0},painelSelected:{type:Number,default:0}},setup(N){const _=P(null),b=Z(),E=ne(),p=K("EventBus"),h=N,s=k(()=>b.data_cache.painelset_painel?.[h.painelSelected]||null),d=k(()=>!s.value||!s.value.config?"":JSON.stringify(s.value.config,null,2)),f=k(()=>!s.value||!s.value.styles?"":JSON.stringify({component:s.value.styles.component||{},title:s.value.styles.title||{},inner:s.value.styles.inner||{}},null,2)),u=P({config:d.value,styles:f.value}),o=k(()=>U.orderBy(b.data_cache.sessao_sessaoplenaria||[],["data_inicio"],["desc"]));pe(()=>{b.fetchSync({app:"sessao",model:"sessaoplenaria",params:{o:"-data_inicio"},only_first_page:!0})});const w=()=>{if(s.value)try{const r=JSON.parse(u.value.config),t=JSON.parse(u.value.styles);s.value.styles=t,s.value.config=r,u.value.config=JSON.stringify(r,null,2),u.value.styles=JSON.stringify(t,null,2),O({config:r,styles:t})}catch(r){E.addMessage({type:"danger",text:`Erro ao atualizar os campos JSON: ${r.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos JSON:",r),u.value.config=d.value,u.value.styles=f.value}},m=r=>{console.log("PainelEditor.vue: changeForm event:",r);const t={...s.value};delete t.id,["styles","config"].includes(r.target.name)||O(t)},O=async r=>{try{await R.Utils.patchModel({app:"painelset",model:"painel",id:s.value.id,form:r}),E.addMessage({type:"info",text:"Painel atualizado.",timeout:2e3}),console.log("PainelEditor.vue: patchModel updated successfully.")}catch(t){E.addMessage({type:"danger",text:"Erro ao salvar as alterações do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Painel:",t)}};Y(()=>s.value,r=>{r&&(u.value.config=d.value,u.value.styles=f.value)});const J=r=>{p.emit("painelset:editorarea:close"),p.emit("painelset:editorarea:resize",0)},L=r=>{if(!s.value)return;const t={painel:s.value.id,name:"Nova Visão do Painel",description:"",position:b.data_cache.painelset_visaodepainel?Object.values(b.data_cache.painelset_visaodepainel).filter(l=>l.painel===s.value.id).length+1:1,active:!0,config:{displayTitle:!0},styles:{}};R.Utils.createModel({app:"painelset",model:"visaodepainel",form:t}).then(l=>{E.addMessage({type:"info",text:"Visão do Painel criada com sucesso.",timeout:2e3}),b.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:s.value.id}})}).catch(l=>{E.addMessage({type:"danger",text:"Erro ao criar a Visão do Painel.",timeout:5e3}),console.error("Erro ao criar a Visão do Painel:",l)})};return(r,t)=>(g(),x("div",{ref_key:"painelsetPainelEditor",ref:_,key:`painelset-painel-editor-${s.value?.id}`,class:"painelset-painel-editor"},[e("form",{action:"",onChange:t[8]||(t[8]=l=>m(l))},[e("fieldset",null,[t[19]||(t[19]=e("legend",null,"Configurações do Painel",-1)),e("div",bt,[e("div",$t,[e("div",St,[e("div",xt,[e("div",Et,[C(e("input",{type:"checkbox",name:"display_title",class:"checkboxinput custom-control-input","aria-describedby":"id_display_title_helptext","onUpdate:modelValue":t[0]||(t[0]=l=>s.value.config.displayTitle=l),id:"id_display_title"},null,512),[[ie,s.value.config.displayTitle]]),t[9]||(t[9]=se("  ",-1)),t[10]||(t[10]=e("label",{for:"id_display_title",class:"custom-control-label"}," Mostrar título do painel? ",-1)),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=e("small",{id:"hint_id_display_title",class:"form-text text-muted"}," Ativa/Desativa exibição do título ",-1))])])]),e("div",Mt,[t[13]||(t[13]=e("label",{for:"painel-name",class:"form-label"},"Título do Painel",-1)),C(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=l=>s.value.name=l),placeholder:"Título do Painel"},null,512),[[F,s.value.name]])]),e("div",Pt,[t[15]||(t[15]=e("label",{for:"painel-sessao",class:"form-label"},"Sessão Plenária Associada",-1)),C(e("select",{id:"painel-sessao",name:"sessao_plenaria",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=l=>s.value.sessao=l)},[t[14]||(t[14]=e("option",{value:null},"-- Nenhuma --",-1)),(g(!0),x(ee,null,te(o.value,l=>(g(),x("option",{key:`sessao-option-${l.id}`,value:l.id},H(l.__str__)+" ("+H(l.data_inicio)+" - "+H(l.data_fim||"")+") ",9,kt))),128))],512),[[ce,s.value.sessao]])])]),e("div",Nt,[e("div",Vt,[e("div",Wt,[t[16]||(t[16]=e("label",{for:"painel-config",class:"form-label"},"Configurações do Painel (JSON)",-1)),e("div",null,[C(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=l=>u.value.config=l),placeholder:"Configurações do Painel em JSON",rows:"15",onBlur:w},null,544),[[F,u.value.config]])])])]),e("div",Ct,[e("div",Ot,[t[17]||(t[17]=e("label",{for:"painel-styles",class:"form-label"},"Estilos do Painel (JSON)",-1)),e("div",null,[C(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=l=>u.value.styles=l),rows:"15",placeholder:"Estilos do Painel em JSON",onBlur:w},null,544),[[F,u.value.styles]])])])])])]),e("div",Jt,[e("div",zt,[e("div",Tt,[e("div",It,[t[18]||(t[18]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[C(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.description=l),placeholder:"Descrição do Painel",rows:"5"},null,512),[[F,s.value.description]])])])])])]),e("div",Bt,[e("div",Dt,[e("div",Ut,[e("div",At,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=S(l=>J(),["stop","prevent"])),title:"Fechar Editor do Painel"},[B(re(ue),{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-primary",onMousedown:S(l=>!1,["stop","prevent"]),onClick:t[7]||(t[7]=S(l=>L(),["stop","prevent"])),title:"Adicionar Visão do Painel"},[B(re(ue),{icon:"fa-solid fa-plus"})],32)])])])])])],32)]))}},Lt=Q(Ft,[["__scopeId","data-v-4f12ebbd"]]),Rt=["id"],jt={key:2,class:"painel-empty"},Xt={class:"btn-group btn-group-sm",role:"group","aria-label":"Visões do Painel"},Yt=["onClick"],Ht={__name:"Painel",props:{painelId:{type:String,default:"0"}},setup(N){const _=Z(),b=me(),E=ge();_.registerModels("painelset",["painel","visaodepainel","widget","evento","individuo","cronometro"]),_.registerModels("sessao",["sessaoplenaria"]),_.registerModels("materia",["materialegislativa"]);const p=N,h=K("EventBus"),s=P(!1),d=P(null),f=P(!1),u=P(null),o=P(null),w=P(Number(E.params.painelId)||0),m=P(Number(p.painelId)||w.value||0),O=k(()=>_.data_cache.painelset_painel?.[m.value]||null),J=k(()=>U.orderBy(U.filter(_.data_cache.painelset_visaodepainel,{painel:m.value})||[],["position"],["asc"])),L=k(()=>W.value===d.value.id||J.value.length===0);h.on("painelset:editorarea:close",(a=null)=>{if(J.value.length>0){W.value=null,s.value=!0;return}if(a&&a==="force"){s.value=!1,W.value=null;return}a&&d.value&&a===d.value.id||(W.value=null,s.value=!1)}),Y(()=>s.value,a=>{if(a&&(h.emit("painelset:editorarea:close",d.value.id),oe(()=>{W.value=d.value.id})),J.value.length===0){W.value=d.value.id,s.value=!0;return}}),Y(()=>p.painelId,a=>{a!==m.value&&(m.value=a,l())}),Y(()=>m.value,a=>{a&&t(a)}),Y(()=>J.value,a=>{if(a.length>0){if(!o.value||!a.find(y=>y.id===o.value)){const y=a.find(M=>M.active===!0);y?o.value=y.id:o.value=a[0].id}}else o.value=null});const r=a=>{f.value===!1?(f.value=!0,U.each(d.value.getElementsByClassName("painelset-widget"),y=>{y.classList.add("localize")}),u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{f.value=!1,U.each(d.value.getElementsByClassName("painelset-widget"),y=>{y.classList.remove("localize")})},2e3)):(clearTimeout(u.value),u.value=setTimeout(()=>{f.value=!1,U.each(d.value.getElementsByClassName("painelset-widget"),y=>{y.classList.remove("localize")})},2e3))},t=async a=>{_.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:a}}).then(y=>{if(y&&y.data.results.length>0){const M=y.data.results.find(i=>i.active===!0);M?o.value=M.id:o.value=y.data.results[0].id}})},l=async()=>{m.value?_.fetchSync({app:"painelset",model:"painel",id:m.value}).then(a=>{a.data.sessao&&_.fetchSync({app:"sessao",model:"sessaoplenaria",id:a.data.sessao}),a.data.evento&&_.fetchSync({app:"painelset",model:"evento",id:a.data.evento}),t(m.value)}).catch(a=>{console.error("Error fetching painel:",a),b.push({name:"painelset_error_404",params:{pathMatch:"error"}})}):_.fetchSync({app:"painelset",model:"evento",params:{end_real__isnull:!0,start_real__isnull:!1}}).then(a=>{if(a&&a.data.results.length>0){const y=a.data.results[0];_.fetchSync({app:"painelset",model:"painel",params:{evento:y.id}}).then(M=>{if(M&&M.data.results.length>0){const i=M.data.results[0];m.value=i.id}else b.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(M=>{console.error("Error fetching painel for evento:",M),b.push({name:"painelset_error_404",params:{pathMatch:"error"}})})}else b.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(a=>{console.error("Error fetching evento:",a),b.push({name:"painelset_error_404",params:{pathMatch:"error"}})})},$=a=>{h.emit("painelset:editorarea:close"),oe(()=>{o.value=a})};return pe(()=>{l(),setTimeout(()=>{J.value.length===0&&(s.value=!0,W.value=d.value.id)},1e3)}),(a,y)=>(g(),x("div",{id:`id-painelset-painel-${m.value}`,ref_key:"painelsetPainel",ref:d,key:`painelset-painel-${m.value}`,class:"painelset-painel",style:q(O.value?.styles.component||{}),onMousemove:y[2]||(y[2]=M=>r())},[O.value?.config?.displayTitle?(g(),x("div",{key:0,class:"painel-titulo",style:q(O.value?.styles.title||{})},H(O.value?.name),5)):A("",!0),o.value?(g(),x("div",{key:1,class:"inner-painelset-painel",style:q(O.value?.styles.inner||{})},[(g(),G(wt,{key:`visaodepainel-${o.value.id}`,"painel-id":m.value,"visaodepainel-selected":o.value},null,8,["painel-id","visaodepainel-selected"]))],4)):(g(),x("div",jt,[...y[3]||(y[3]=[e("p",null,"Não há visões de painel configuradas para este painel.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar a primeira visão do painel.",-1)])])),e("div",{class:"actions",onClick:y[0]||(y[0]=S(M=>s.value=!s.value,["stop"]))},[e("div",Xt,[(g(!0),x(ee,null,te(J.value,(M,i)=>(g(),x("button",{key:`${M.id}_${i}`,class:ve([{active:M.id===o.value},"btn btn-primary"]),onClick:S(n=>$(M.id),["stop","prevent"])},H(M.position),11,Yt))),128))])]),s.value&&L.value?(g(),G(ae,{key:3,to:"#painelset-editorarea",disabled:!L.value},[B(Lt,{"painel-id":m.value,"painel-selected":m.value},null,8,["painel-id","painel-selected"])],8,["disabled"])):A("",!0),A("",!0)],44,Rt))}},Zt=Q(Ht,[["__scopeId","data-v-c88c2f9f"]]);export{Zt as default};
