import{z as M,C as te,c as z,_ as I,R as C,w as j,A as ee,f as x,g as h,k as e,i as R,J as L,K as ce,F as ne,r as le,t as H,L as F,B as m,q as P,l as G,G as X,S as ve,T as de,n as ie,o as pe,U as fe,N as me,V as ge,Q as ye}from"./vendor-Dq9xiLvp.js";import{_ as oe,b as se,a as re,R as D,u as ue}from"./main-BP6ptUgO.js";import{a as Q}from"./TeleportStore-teuZbd37.js";import"./vendor_fortawesome-D0qyeiI4.js";const he={class:"container"},we={class:"row py-2"},be={key:0,class:"col-6"},_e=["value"],$e={class:"col-6"},Me={class:"row py-2"},Ee={class:"col-6"},xe={id:"div_id_config",class:"form-group"},Pe={class:"col-6"},Se={id:"div_id_styles",class:"form-group"},ke={class:"container"},Ve={class:"row"},We={class:"col-12"},Ce={id:"div_id_description",class:"form-group"},ze={class:"container actions pt-3"},Ae={class:"row"},Ie={class:"col-12"},Le={class:"btn-group"},Be={__name:"WidgetEditor",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(V){const W=M(null),g=se(),b=re(),$=te("EventBus"),S=V,n=M({"":"Nenhum componente selecionado",WidgetSessaoPlenariaStatus:"WidgetSessaoPlenariaStatus - Título da Sessão Plenária vinculada ao Painel",WidgetSessaoRegistroPresenca:"WidgetSessaoRegistroPresenca - Registro de Presença da Sessão Plenária vinculada ao Painel",WidgetSessaoItemEmPauta:"WidgetSessaoItemEmPauta - Item em Pauta da Sessão Plenária vinculada ao Painel",WidgetCronometroEvento:"WidgetCronometroEvento - Cronômetro do Evento vinculado ao Painel",WidgetCronometroPalavra:"WidgetCronometroPalavra - Cronômetro da Palavra vinculada ao Painel",WidgetStatusEventoSessao:"WidgetStatusEventoSessao - Status da Sessão e do Evento vinculados ao Painel",WidgetHtmlCode:"WidgetHtmlCode - Código HTML personalizado",WidgetYoutubeEmbed:"WidgetYoutubeEmbed - Iframe do YouTube personalizado"}),r=z(()=>g.data_cache.painelset_widget?.[S.widgetSelected]||null),_=z(()=>I.orderBy(I.filter(g.data_cache.painelset_widget,{parent:S.widgetSelected})||[],["position"],["asc"])),a=z(()=>!r.value||!r.value.config?"":C.dump(r.value.config)),s=z(()=>!r.value||!r.value.styles?"":C.dump({component:r.value.styles.component||{},title:r.value.styles.title||{display:"flex"},inner:r.value.styles.inner||{}})),y=M({config:a.value,styles:s.value}),k=t=>{$.emit("painelset:editorarea:close")},A=()=>{if(r.value)try{const t=y.value.config?C.load(y.value.config):{},d=y.value.styles?C.load(y.value.styles):{};r.value.styles=d,r.value.config=t,y.value.config=C.dump(t),y.value.styles=C.dump(d),w({config:t,styles:d})}catch(t){b.addMessage({type:"danger",text:`Erro ao atualizar os campos YAML: ${t.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos YAML:",t),y.value.config=a.value,y.value.styles=s.value}},O=t=>{console.log("WidgetEditor.vue: changeForm event:",t);const d={...r.value};delete d.id,n.value[d.vue_component]===void 0&&(d.vue_component=""),["styles","config"].includes(t.target.name)||w(d)},w=async t=>{try{await D.Utils.patchModel({app:"painelset",model:"widget",id:r.value.id,form:t}),b.addMessage({type:"info",text:"Widget atualizado.",timeout:2e3}),console.log("WidgetEditor.vue: patchModel updated successfully.")}catch(d){b.addMessage({type:"danger",text:"Erro ao salvar as alterações do Widget.",timeout:5e3}),console.error("Erro ao salvar as alterações do Widget:",d)}};j(()=>r.value,t=>{t&&(y.value.config=a.value,y.value.styles=s.value)});const u=t=>{r.value&&confirm(`Confirma a exclusão do Widget: ${r.value.name} ?`)&&D.Utils.deleteModel({app:"painelset",model:"widget",id:r.value.id}).then(()=>{console.log("Widget deleted successfully")}).catch(d=>{console.error("Error deleting widget:",d)})};return(t,d)=>{const c=ee("FontAwesomeIcon");return h(),x("div",{ref_key:"painelsetWidgetEditor",ref:W,key:`painelset-widget-editor-${r.value?.id}`,class:"painelset-widget-editor"},[e("form",{action:"",onChange:d[7]||(d[7]=E=>O(E))},[e("fieldset",null,[d[13]||(d[13]=e("legend",null,"Configurações do Widget",-1)),e("div",he,[e("div",we,[_.value.length===0?(h(),x("div",be,[d[8]||(d[8]=e("label",{for:"widget-vue-component",class:"form-label"},"Componente Vue",-1)),L(e("select",{class:"form-select","onUpdate:modelValue":d[0]||(d[0]=E=>r.value.vue_component=E),id:"widget-vue-component"},[(h(!0),x(ne,null,le(n.value,(E,q)=>(h(),x("option",{key:`widget-vue-component-option-${q}`,value:q},H(E),9,_e))),128))],512),[[ce,r.value.vue_component]])])):R("",!0),e("div",$e,[d[9]||(d[9]=e("label",{for:"widget-name",class:"form-label"},"Título do Widget",-1)),L(e("input",{type:"text",class:"form-control","onUpdate:modelValue":d[1]||(d[1]=E=>r.value.name=E),placeholder:"Título do Widget"},null,512),[[F,r.value.name]])])]),e("div",Me,[e("div",Ee,[e("div",xe,[d[10]||(d[10]=e("label",{for:"widget-config",class:"form-label"},"Configurações do Widget (YAML)",-1)),e("div",null,[L(e("textarea",{id:"widget-config",name:"config",class:"form-control","onUpdate:modelValue":d[2]||(d[2]=E=>y.value.config=E),placeholder:"Configurações do Widget em YAML",rows:"15",onBlur:A},null,544),[[F,y.value.config]])])])]),e("div",Pe,[e("div",Se,[d[11]||(d[11]=e("label",{for:"widget-styles",class:"form-label"},"Estilos do Widget (YAML)",-1)),e("div",null,[L(e("textarea",{name:"styles",id:"widget-styles",class:"form-control","onUpdate:modelValue":d[3]||(d[3]=E=>y.value.styles=E),rows:"15",placeholder:"Estilos do Widget em YAML",onBlur:A},null,544),[[F,y.value.styles]])])])])])]),e("div",ke,[e("div",Ve,[e("div",We,[e("div",Ce,[d[12]||(d[12]=e("label",{for:"id_description",class:"form-label"},"Descrição do Widget",-1)),e("div",null,[L(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":d[4]||(d[4]=E=>r.value.description=E),placeholder:"Descrição do Widget",rows:"5"},null,512),[[F,r.value.description]])])])])])]),e("div",ze,[e("div",Ae,[e("div",Ie,[e("div",Le,[e("button",{class:"btn btn-secondary",onClick:d[5]||(d[5]=m(E=>k(),["stop","prevent"])),title:"Fechar Editor de Widget"},[P(c,{icon:["fas","times"]})]),e("button",{class:"btn btn-sm btn-danger",onMousedown:m(E=>!1,["stop","prevent"]),onClick:d[6]||(d[6]=m(E=>u(),["stop","prevent"]))},[P(c,{icon:"fa-solid fa-trash-can"})],32)])])])])])],32)])}}},Ye=oe(Be,[["__scopeId","data-v-ab112599"]]),Ue=["id"],De={class:"inner-widget inner-children"},Fe={key:1,class:"manager"},Ne={class:"position"},Te={class:"toolbar"},Re={class:"btn-group"},He={class:"btn-group"},Oe={class:"btn-group right"},Xe={__name:"Widget",props:{painelId:{type:Number,default:0},widgetSelected:{type:Number,default:0}},setup(V){const W=se(),g=ue(),b=te("EventBus"),$=V,S=M(!1),n=M(null),r=M(!1),_=M({}),a=M({x:0,y:0,w:100,h:100,mouseResizeEnter:!1}),s=z(()=>W.data_cache.painelset_widget?.[$.widgetSelected]||null),y=z(()=>{if(!s.value||!s.value.config?.coords)return{};const i={},o=s.value.config.coords;return o.x!==void 0&&(i.left=`${o.x}%`),o.y!==void 0&&(i.top=`${o.y}%`),o.w!==void 0&&(i.right=`${o.w+o.x>100?0:100-(o.w+o.x)}%`),o.h!==void 0&&(i.bottom=`${o.h+o.y>100?0:100-(o.h+o.y)}%`),i}),k=z(()=>I.orderBy(I.filter(W.data_cache.painelset_widget,{parent:$.widgetSelected})||[],["position"],["asc"]));(async()=>{W.fetchSync({app:"painelset",model:"widget",params:{parent:$.widgetSelected,get_all:"True"}}).then(()=>{})})(),b.on("painelset:editorarea:close",()=>{r.value=!1,Q.value=null});const O=()=>{console.debug("Opening widget editor modal for widget:",s.value),b.emit("painelset:editorarea:close"),r.value=!0,Q.value=s.value.id},w=()=>g.isAuthenticated?g.hasPermission("painelset.change_widget"):!1,u=(i=>{if(console.debug("Received oncomponent event:"),!i||!i.type){console.warn("Invalid oncomponent event received, missing type");return}if(i.type==="extra_styles"){if(!i.extra_styles){console.warn("Invalid extra_styles event, missing extra_styles data");return}const o={...i.extra_styles};_.value=o}}),t=()=>{s.value&&confirm(`Confirma a exclusão do Widget: ${s.value.name} e todos seus SubWidgets?`)&&D.Utils.deleteModel({app:"painelset",model:"widget",id:s.value.id}).then(()=>{console.log("Widget deleted successfully")}).catch(i=>{console.error("Error deleting widget:",i)})},d=()=>{if(!s.value)return;const i={...s.value.config,coords:{...s.value.config.coords,x:10,y:10}},o={...s.value,id:void 0,name:`${s.value.name} (Cópia)`,position:k.value.length+1,config:i};D.Utils.postModel({app:"painelset",model:"widget",form:o}).then(v=>{console.log("Widget duplicated successfully:",v.data)}).catch(v=>{console.error("Error duplicating widget:",v)})},c=()=>{if(!s.value)return;const i={name:"Novo Widget",parent:s.value.id,visao:s.value.visao,position:k.value.length+1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30}},styles:{component:{},title:{},inner:{}}};D.Utils.postModel({app:"painelset",model:"widget",form:i}).then(o=>{console.log("Default child widget created successfully:",o.data)}).catch(o=>{console.error("Error creating default child widget:",o)})},E=i=>!i||i.x===void 0||i.y===void 0||i.w===void 0||i.h===void 0||i.x===null||i.y===null||i.w===null||i.h===null?!1:i.w>5&&i.w<=100&&i.h>5&&i.h<=100&&i.x>=0&&i.x<=100&&i.y>=0&&i.y<=100&&i.x+i.w<=100&&i.y+i.h<=100,q=(i,o)=>{if(!s.value)return;const v=s.value.position+o;v<1||D.Utils.patchModel({app:"painelset",model:"widget",id:s.value.id,form:{position:v}}).then(p=>{console.log("Widget position updated successfully:",p.data)}).catch(p=>{console.error("Error updating widget position:",p)})},J=i=>{if(!E(i)){console.error("Invalid widget coordinates, aborting update");return}D.Utils.patchModel({app:"painelset",model:"widget",id:s.value.id,form:{config:{...s.value.config,coords:{...s.value.config.coords,x:i.x,y:i.y,w:i.w,h:i.h}}}}).then(o=>{console.log(o.data),console.log("Widget coordinates updated successfully")}).catch(o=>{console.error("Error updating widget coordinates:",o)})},ae=i=>{i.preventDefault(),!a.value.mouseResizeEnter&&w()&&(S.value=!S.value,S.value||(r.value=!1,b.emit("painelset:editorarea:close")),console.log("Activating painel editor teleport for Widget:",$.widgetSelected))},Z=(i,o)=>{if(a.value.mouseResizeEnter=!0,i.preventDefault(),!S.value)return;const v=n.value,p=v.getBoundingClientRect(),l=v.parentElement.getBoundingClientRect(),f={...a.value};console.log("Mouse move detected:",i.clientX,i.clientY,p);const K=B=>{let Y=0,U=0;if(o==="top-left"){const N=B.clientX-p.left,T=B.clientY-p.top;Y=Math.round(N/l.width*100),U=Math.round(T/l.height*100),f.w=s.value.config.coords.w-Y,f.h=s.value.config.coords.h-U,f.x=s.value.config.coords.x+Y,f.y=s.value.config.coords.y+U}else if(o==="top-right"){const N=B.clientX-p.right,T=B.clientY-p.top;Y=Math.round(N/l.width*100),U=Math.round(T/l.height*100),f.w=s.value.config.coords.w+Y,f.h=s.value.config.coords.h-U,f.x=s.value.config.coords.x,f.y=s.value.config.coords.y+U}else if(o==="bottom-right"){const N=B.clientX-p.right,T=B.clientY-p.bottom;Y=Math.round(N/l.width*100),U=Math.round(T/l.height*100),f.w=s.value.config.coords.w+Y,f.h=s.value.config.coords.h+U,f.x=s.value.config.coords.x,f.y=s.value.config.coords.y}else if(o==="bottom-left"){const N=B.clientX-p.left,T=B.clientY-p.bottom;Y=Math.round(N/l.width*100),U=Math.round(T/l.height*100),f.w=s.value.config.coords.w-Y,f.h=s.value.config.coords.h+U,f.x=s.value.config.coords.x+Y,f.y=s.value.config.coords.y}else if(o==="center-center"){const N=B.clientX-p.left-p.width/2,T=B.clientY-p.top-p.height/2;Y=Math.round(N/l.width*100),U=Math.round(T/l.height*100),console.debug("Resizing widget...",N,T,o,Y,U,f),f.w=s.value.config.coords.w,f.h=s.value.config.coords.h,f.x=s.value.config.coords.x+Y,f.y=s.value.config.coords.y+U}console.debug("Resizing widget...",B.clientX,B.clientY,o,Y,U,f),E(f)?(a.value.w=f.w,a.value.h=f.h,a.value.x=f.x,a.value.y=f.y,v.style.right=`${100-(f.w+f.x)}%`,v.style.bottom=`${100-(f.h+f.y)}%`,v.style.left=`${f.x}%`,v.style.top=`${f.y}%`):console.warn("Invalid coordinates during resize, ignoring update")};console.log("Starting resize operation"),window.addEventListener("mousemove",K),window.addEventListener("mouseup",B=>{window.removeEventListener("mouseup",this),window.removeEventListener("mousemove",K),B.preventDefault(),a.value.mouseResizeEnter&&(a.value.mouseResizeEnter=!1,J({x:a.value.x,y:a.value.y,w:a.value.w,h:a.value.h}),console.log("Resize operation ended"))})};return(i,o)=>{const v=ee("Widget",!0),p=ee("FontAwesomeIcon");return h(),x("div",{id:`id-painelset-widget-${s.value?.id}`,ref_key:"painelsetWidget",ref:n,key:`painelset-widget-${s.value?.id}`,class:ie(["painelset-widget",S.value?"editmode":""]),style:X({...s.value?.styles.component||{},...y.value,..._.value}),onMousedown:o[11]||(o[11]=m(l=>ae(l),["stop","prevent"])),onClick:m(l=>!1,["stop","prevent"])},[e("div",{class:"widget-titulo",style:X(s.value?.styles.title||{})},H(s.value?.name),5),s.value?.vue_component?(h(),x("div",{key:0,class:"inner-widget",style:X(s.value?.styles.inner||{})},[(h(),G(ve(s.value?.vue_component),{"painel-id":V.painelId,"widget-selected":s.value?.id,onOncomponent:u},null,40,["painel-id","widget-selected"]))],4)):R("",!0),e("div",De,[(h(!0),x(ne,null,le(k.value,(l,f)=>(h(),G(v,{key:`widget-${l.id}-${f}`,"painel-id":V.painelId,"widget-selected":l.id},null,8,["painel-id","widget-selected"]))),128))]),S.value?(h(),x("div",Fe,[e("div",Ne,H(s.value?.position),1),e("div",Te,[e("div",Re,[e("button",{class:"btn btn-secondary btn-move-backward",onMousedown:m(l=>!1,["stop","prevent"]),onClick:o[0]||(o[0]=m(l=>q(l,-1),["stop","prevent"])),title:"Mover uma camada para trás"},[P(p,{icon:"fa-solid fa-arrow-down-1-9"})],32),e("button",{class:"btn btn-secondary btn-move-forward",onMousedown:m(l=>!1,["stop","prevent"]),onClick:o[1]||(o[1]=m(l=>q(l,1),["stop","prevent"])),title:"Mover uma camada para frente"},[P(p,{icon:"fa-solid fa-arrow-up-1-9"})],32)]),e("div",He,[e("button",{class:"btn btn-sm btn-danger",onMousedown:m(l=>!1,["stop","prevent"]),onClick:o[2]||(o[2]=m(l=>t(),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-trash-can"})],32),e("button",{class:"btn btn-sm btn-secondary",onMousedown:m(l=>!1,["stop","prevent"]),onClick:o[3]||(o[3]=m(l=>d(),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-clone"})],32),e("button",{class:"btn btn-sm btn-primary",onMousedown:m(l=>!1,["stop","prevent"]),onClick:o[4]||(o[4]=m(l=>c(),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-plus"})],32)]),e("div",Oe,[e("button",{class:"btn btn-sm btn-dark",onMousedown:m(l=>!1,["stop","prevent"]),onClick:o[5]||(o[5]=m(l=>O(),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-pen-to-square"})],32)])]),e("div",{class:"resize-handle top-left",onMousedown:o[6]||(o[6]=l=>Z(l,"top-left"))},null,32),e("div",{class:"resize-handle top-right",onMousedown:o[7]||(o[7]=l=>Z(l,"top-right"))},null,32),e("div",{class:"resize-handle bottom-left",onMousedown:o[8]||(o[8]=l=>Z(l,"bottom-left"))},null,32),e("div",{class:"resize-handle bottom-right",onMousedown:o[9]||(o[9]=l=>Z(l,"bottom-right"))},null,32),e("div",{class:"resize-handle center-center",onMousedown:o[10]||(o[10]=l=>Z(l,"center-center"))},null,32)])):R("",!0),r.value?(h(),G(de,{key:2,to:"#painelset-editorarea",disabled:!r.value},[P(Ye,{"painel-id":V.painelId,"widget-selected":s.value?.id},null,8,["painel-id","widget-selected"])],8,["disabled"])):R("",!0),R("",!0)],46,Ue)}}},je=oe(Xe,[["__scopeId","data-v-65d238fc"]]),qe={class:"container"},Ze={class:"row py-2"},Ge={class:"col-6"},Je={class:"row py-2"},Ke={class:"col-6"},Qe={id:"div_id_config",class:"form-group"},et={class:"col-6"},tt={id:"div_id_styles",class:"form-group"},ot={class:"container"},st={class:"row"},nt={class:"col-12"},lt={id:"div_id_description",class:"form-group"},at={class:"container actions pt-3"},it={class:"row"},dt={class:"col-12 d-flex gap-2"},rt={class:"btn-group"},ut={class:"btn-group"},ct={__name:"VisaoEditor",props:{painelId:{type:Number,default:0},visaoSelected:{type:Number,default:0}},setup(V){const W=te("EventBus"),g=M(null),b=se(),$=re(),S=V,n=z(()=>b.data_cache.painelset_visaodepainel?.[S.visaoSelected]||null),r=z(()=>!n.value||!n.value.config?"":C.dump(n.value.config)),_=z(()=>!n.value||!n.value.styles?"":C.dump({component:n.value.styles.component||{},title:n.value.styles.title||{display:"flex"},inner:n.value.styles.inner||{}})),a=M({config:r.value,styles:_.value}),s=()=>{if(n.value)try{const u=a.value.config?C.load(a.value.config):{},t=a.value.styles?C.load(a.value.styles):{};n.value.styles=t,n.value.config=u,a.value.config=C.dump(u),a.value.styles=C.dump(t),k({config:u,styles:t})}catch(u){$.addMessage({type:"danger",text:`Erro ao atualizar os campos YAML: ${u.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos YAML:",u),a.value.config=r.value,a.value.styles=_.value}},y=u=>{console.log("VisaoEditor.vue: changeForm event:",u);const t={...n.value};delete t.id,["styles","config"].includes(u.target.name)||k(t)},k=async u=>{try{await D.Utils.patchModel({app:"painelset",model:"visaodepainel",id:n.value.id,form:u}),$.addMessage({type:"info",text:"Visão do Painel atualizado.",timeout:2e3}),console.log("VisaoEditor.vue: patchModel updated successfully.")}catch(t){$.addMessage({type:"danger",text:"Erro ao salvar as alterações do Visão do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Visão do Painel:",t)}};j(()=>n.value,u=>{u&&(a.value.config=r.value,a.value.styles=_.value)});const A=u=>{W.emit("painelset:editorarea:close",n.value.id)},O=()=>{n.value&&confirm(`Confirma a exclusão da Visão do Painel: ${n.value.name} ?`)&&D.Utils.deleteModel({app:"painelset",model:"visaodepainel",id:n.value.id}).then(()=>{$.addMessage({type:"info",text:"Visão do Painel excluído com sucesso.",timeout:5e3}),W.emit("painelset:editorarea:close")}).catch(u=>{$.addMessage({type:"danger",text:"Erro ao excluir a Visão do Painel.",timeout:5e3}),console.error("Error deleting visaodepainel:",u)})},w=()=>{if(!n.value)return;const u={name:"Novo Widget",parent:null,visao:n.value.id,position:b.data_cache.painelset_widget?Object.values(b.data_cache.painelset_widget).filter(t=>t.visao===n.value.id).length+1:1,vue_component:"",config:{coords:{x:10,y:10,w:30,h:30}},styles:{component:{},title:{display:"flex"},inner:{}}};D.Utils.postModel({app:"painelset",model:"widget",form:u}).then(t=>{console.log("Default child widget created successfully:",t.data)}).catch(t=>{console.error("Error creating default child widget:",t)})};return(u,t)=>{const d=ee("FontAwesomeIcon");return h(),x("div",{ref_key:"painelsetVisaoEditor",ref:g,key:`painelset-visaodepainel-editor-${n.value?.id}`,class:"painelset-visaodepainel-editor"},[e("form",{action:"",onChange:t[7]||(t[7]=c=>y(c))},[e("fieldset",null,[t[12]||(t[12]=e("legend",null,"Configurações da Visão do Painel",-1)),e("div",qe,[e("div",Ze,[e("div",Ge,[t[8]||(t[8]=e("label",{for:"painel-name",class:"form-label"},"Título da Visão do Painel",-1)),L(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=c=>n.value.name=c),placeholder:"Título da Visão do Painel"},null,512),[[F,n.value.name]])])]),e("div",Je,[e("div",Ke,[e("div",Qe,[t[9]||(t[9]=e("label",{for:"painel-config",class:"form-label"},"Configurações da Visão do Painel (YAML)",-1)),e("div",null,[L(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=c=>a.value.config=c),placeholder:"Configurações da Visão do Painel em YAML",rows:"15",onBlur:s},null,544),[[F,a.value.config]])])])]),e("div",et,[e("div",tt,[t[10]||(t[10]=e("label",{for:"painel-styles",class:"form-label"},"Estilos da Visão do Painel (YAML)",-1)),e("div",null,[L(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=c=>a.value.styles=c),rows:"15",placeholder:"Estilos da Visão do Painel em YAML",onBlur:s},null,544),[[F,a.value.styles]])])])])])]),e("div",ot,[e("div",st,[e("div",nt,[e("div",lt,[t[11]||(t[11]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[L(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=c=>n.value.description=c),placeholder:"Descrição do Painel",rows:"5"},null,512),[[F,n.value.description]])])])])])]),e("div",at,[e("div",it,[e("div",dt,[e("div",rt,[e("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=m(c=>A(),["stop","prevent"])),title:"Fechar Editor da Visão do Painel"},[P(d,{icon:["fas","times"]})]),e("button",{class:"btn btn-danger",onMousedown:m(c=>!1,["stop","prevent"]),onClick:t[5]||(t[5]=m(c=>O(),["stop","prevent"])),title:"Excluir Visão do Painel"},[P(d,{icon:"fa-solid fa-trash-can"})],32)]),e("div",ut,[e("button",{class:"btn btn-primary",onMousedown:m(c=>!1,["stop","prevent"]),onClick:t[6]||(t[6]=m(c=>w(),["stop","prevent"])),title:"Adicionar Widget à Visão do Painel"},[P(d,{icon:"fa-solid fa-plus"})],32)])])])])])],32)])}}},pt=oe(ct,[["__scopeId","data-v-632c1531"]]),vt=["id"],ft={key:0,class:"visao-empty"},mt={__name:"VisaoDePainel",props:{painelId:{type:Number,default:0},visaodepainelSelected:{type:Number,default:0},editmodeVisao:{type:Boolean,default:!1}},setup(V){const W=se();ue();const g=V;te("EventBus");const b=M(g.editmodeVisao),$=M(null),S=z(()=>W.data_cache.painelset_visaodepainel?.[g.visaodepainelSelected]||null),n=z(()=>I.orderBy(I.filter(W.data_cache.painelset_widget,{visao:g.visaodepainelSelected,parent:null})||[],["position"],["asc"]));return j(()=>g.editmodeVisao,_=>{b.value=_,_&&(Q.value=$.value.id)}),(async()=>{W.fetchSync({app:"painelset",model:"widget",params:{visao:g.visaodepainelSelected,get_all:"True"}}).then(_=>{})})(),(_,a)=>(h(),x("div",{id:`id-painelset-visaodepainel${V.visaodepainelSelected}`,ref_key:"painelsetVisaodepainel",ref:$,key:`painelset-visaodepainel${V.visaodepainelSelected}`,class:"painelset-visaodepainel",style:X(S.value?.styles.component||{})},[e("div",{class:"visaodepainel-titulo",style:X(S.value?.styles.title||{})},H(S.value?.name),5),e("div",{class:"inner-visaodepainel",style:X(S.value?.styles.inner||{})},[(h(!0),x(ne,null,le(n.value,(s,y)=>(h(),G(je,{key:`widget-${s.id}-${y}`,"painel-id":V.painelId,"widget-selected":s.id},null,8,["painel-id","widget-selected"]))),128))],4),n.value.length===0?(h(),x("div",ft,[...a[0]||(a[0]=[e("p",null,"Não há widgets configurados para esta visão.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar o primeiro widget à visão.",-1)])])):R("",!0),b.value?(h(),G(de,{key:1,to:"#painelset-editorarea",disabled:!b.value},[P(pt,{"painel-id":V.painelId,"visao-selected":V.visaodepainelSelected},null,8,["painel-id","visao-selected"])],8,["disabled"])):R("",!0)],12,vt))}},gt=oe(mt,[["__scopeId","data-v-4ca7eb43"]]),yt={class:"container"},ht={class:"row py-2"},wt={class:"col-3"},bt={class:"col-4"},_t={class:"col-5"},$t=["value"],Mt={class:"row py-2"},Et={class:"col-6"},xt={id:"div_id_config",class:"form-group"},Pt={class:"col-6"},St={id:"div_id_styles",class:"form-group"},kt={class:"container"},Vt={class:"row"},Wt={class:"col-12"},Ct={id:"div_id_description",class:"form-group"},zt={class:"container actions pt-3"},At={class:"row"},It={class:"col-12"},Lt={class:"btn-group"},Bt={class:"btn-group ms-2"},Yt={__name:"PainelEditor",props:{painelId:{type:Number,default:0},painelSelected:{type:Number,default:0}},setup(V){const W=M(null),g=se(),b=re(),$=te("EventBus"),S=V,n=z(()=>g.data_cache.painelset_painel?.[S.painelSelected]||null),r=z(()=>!n.value||!n.value.config?"":C.dump(n.value.config)),_=z(()=>!n.value||!n.value.styles?"":C.dump({component:n.value.styles.component||{},title:n.value.styles.title||{display:"flex"},inner:n.value.styles.inner||{}})),a=M({config:r.value,styles:_.value}),s=z(()=>I.orderBy(g.data_cache?.sessao_sessaoplenaria||[],["data_inicio"],["desc"]));pe(()=>{g.fetchSync({app:"sessao",model:"sessaoplenaria",params:{o:"-data_inicio"},only_first_page:!0})});const y=()=>{if(n.value)try{const u=a.value.config?C.load(a.value.config):{},t=a.value.styles?C.load(a.value.styles):{};n.value.styles=t,n.value.config=u,a.value.config=C.dump(u),a.value.styles=C.dump(t),A({config:u,styles:t})}catch(u){b.addMessage({type:"danger",text:`Erro ao atualizar os campos YAML: ${u.message}`,timeout:1e4}),console.error("Erro ao atualizar os campos YAML:",u),a.value.config=r.value,a.value.styles=_.value}},k=u=>{console.log("PainelEditor.vue: changeForm event:",u);const t={...n.value};delete t.id,["styles","config"].includes(u.target.name)||A(t)},A=async u=>{try{await D.Utils.patchModel({app:"painelset",model:"painel",id:n.value.id,form:u}),b.addMessage({type:"info",text:"Painel atualizado.",timeout:2e3}),console.log("PainelEditor.vue: patchModel updated successfully.")}catch(t){b.addMessage({type:"danger",text:"Erro ao salvar as alterações do Painel.",timeout:5e3}),console.error("Erro ao salvar as alterações do Painel:",t)}};j(()=>n.value,u=>{u&&(a.value.config=r.value,a.value.styles=_.value)});const O=()=>{$.emit("painelset:editorarea:close")},w=()=>{if(!n.value)return;const u={painel:n.value.id,name:"Nova Visão do Painel",description:"",position:g.data_cache.painelset_visaodepainel?Object.values(g.data_cache.painelset_visaodepainel).filter(t=>t.painel===n.value.id).length+1:1,active:!0,config:{},styles:{component:{},title:{display:"flex"},inner:{}}};D.Utils.postModel({app:"painelset",model:"visaodepainel",form:u}).then(t=>{b.addMessage({type:"info",text:"Visão do Painel criada com sucesso.",timeout:2e3}),g.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:n.value.id}})}).catch(t=>{b.addMessage({type:"danger",text:"Erro ao criar a Visão do Painel.",timeout:5e3}),console.error("Erro ao criar a Visão do Painel:",t)})};return(u,t)=>{const d=ee("FontAwesomeIcon");return h(),x("div",{ref_key:"painelsetPainelEditor",ref:W,key:`painelset-painel-editor-${n.value?.id}`,class:"painelset-painel-editor"},[e("form",{action:"",onChange:t[8]||(t[8]=c=>k(c))},[e("fieldset",null,[t[17]||(t[17]=e("legend",null,"Configurações do Painel",-1)),e("div",yt,[e("div",ht,[e("div",wt,[t[9]||(t[9]=e("label",{for:"principal",class:"form-check-label"},"Painel Principal",-1)),t[10]||(t[10]=e("br",null,null,-1)),L(e("input",{type:"checkbox",class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=c=>n.value.principal=c),name:"principal",id:"principal"},null,512),[[fe,n.value.principal]])]),e("div",bt,[t[11]||(t[11]=e("label",{for:"painel-name",class:"form-label"},"Título do Painel",-1)),L(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=c=>n.value.name=c),placeholder:"Título do Painel"},null,512),[[F,n.value.name]])]),e("div",_t,[t[13]||(t[13]=e("label",{for:"painel-sessao",class:"form-label"},"Sessão Plenária Associada",-1)),L(e("select",{id:"painel-sessao",name:"sessao_plenaria",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=c=>n.value.sessao=c)},[t[12]||(t[12]=e("option",{value:null},"-- Nenhuma --",-1)),(h(!0),x(ne,null,le(s.value,c=>(h(),x("option",{key:`sessao-option-${c.id}`,value:c.id},H(c.__str__)+" ("+H(c.data_inicio)+" - "+H(c.data_fim||"")+") ",9,$t))),128))],512),[[ce,n.value.sessao]])])]),e("div",Mt,[e("div",Et,[e("div",xt,[t[14]||(t[14]=e("label",{for:"painel-config",class:"form-label"},"Configurações do Painel (YAML)",-1)),e("div",null,[L(e("textarea",{id:"painel-config",name:"config",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=c=>a.value.config=c),placeholder:"Configurações do Painel em YAML",rows:"15",onBlur:y},null,544),[[F,a.value.config]])])])]),e("div",Pt,[e("div",St,[t[15]||(t[15]=e("label",{for:"painel-styles",class:"form-label"},"Estilos do Painel (YAML)",-1)),e("div",null,[L(e("textarea",{name:"styles",id:"painel-styles",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=c=>a.value.styles=c),rows:"15",placeholder:"Estilos do Painel em YAML",onBlur:y},null,544),[[F,a.value.styles]])])])])])]),e("div",kt,[e("div",Vt,[e("div",Wt,[e("div",Ct,[t[16]||(t[16]=e("label",{for:"id_description",class:"form-label"},"Descrição do Painel",-1)),e("div",null,[L(e("textarea",{id:"id_description",name:"description",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=c=>n.value.description=c),placeholder:"Descrição do Painel",rows:"5"},null,512),[[F,n.value.description]])])])])])]),e("div",zt,[e("div",At,[e("div",It,[e("div",Lt,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=m(c=>O(),["stop","prevent"])),title:"Fechar Editor do Painel"},[P(d,{icon:["fas","times"]})])]),e("div",Bt,[e("button",{class:"btn btn-primary",onMousedown:m(c=>!1,["stop","prevent"]),onClick:t[7]||(t[7]=m(c=>w(),["stop","prevent"])),title:"Adicionar Visão do Painel"},[P(d,{icon:"fa-solid fa-plus"})],32)])])])])])],32)])}}},Ut=oe(Yt,[["__scopeId","data-v-a24df8b1"]]),Dt=["id"],Ft={key:1,class:"painel-empty"},Nt={class:"actions"},Tt=["title"],Rt={class:"btn btn-link"},Ht={key:0,class:"btn-group",role:"group","aria-label":"Visões do Painel"},Ot=["title"],Xt={class:"toolbar"},jt={class:"btn-group",role:"group","aria-label":"Visões do Painel"},qt={key:0,class:"btn-group",role:"group","aria-label":"Visões do Painel"},Zt=["title"],Gt=["onClick"],Jt={__name:"Painel",props:{painelId:{type:String,default:"0"},zoomFontProp:{type:Number,default:1}},setup(V){const W=te("EventBus"),g=se(),b=ue(),$=ge(),S=me(),n=V,r=M(!1),_=M(!1),a=M(null),s=M(!1),y=M(null),k=M(null),A=M(n.zoomFontProp),O=M(Number(S.params.painelId)||0),w=M(Number(n.painelId)||O.value||0),u=z(()=>g.data_cache.painelset_painel?.[w.value]||null),t=z(()=>I.orderBy(I.filter(g.data_cache.painelset_visaodepainel,{painel:w.value})||[],["position"],["asc"]));j(()=>n.painelId,o=>{o!==w.value&&(w.value=o,E())}),j(()=>u.value?.sessao,o=>{o&&g.fetchSync({app:"sessao",model:"sessaoplenaria",id:o})},{immediate:!0}),j(()=>w.value,o=>{o&&i(o)}),j(()=>t.value,o=>{if(o.length>0){if(Q.value!==null)return;const v=o.find(p=>p.active===!0);v&&(k.value=v.id)}else k.value=null},{immediate:!0,deep:!0});const d=o=>{o>0?A.value=Math.min(3,A.value+o):A.value=Math.max(.1,A.value+o)},c=()=>{b.isAuthenticated&&(s.value===!1?(s.value=!0,I.each(a.value.getElementsByClassName("painelset-widget"),o=>{o.classList.add("localize")}),y.value&&clearTimeout(y.value),y.value=setTimeout(()=>{s.value=!1,I.each(a.value.getElementsByClassName("painelset-widget"),o=>{o.classList.remove("localize")})},2e3)):(clearTimeout(y.value),y.value=setTimeout(()=>{s.value=!1,I.each(a.value.getElementsByClassName("painelset-widget"),o=>{o.classList.remove("localize")})},2e3)))},E=async()=>{w.value?g.fetchSync({app:"painelset",model:"painel",id:w.value}).then(o=>{o[w.value].sessao&&g.fetchSync({app:"sessao",model:"sessaoplenaria",id:o[w.value].sessao}),o[w.value].evento&&g.fetchSync({app:"painelset",model:"evento",id:o[w.value].evento}),i(w.value)}).catch(o=>{console.error("Error fetching painel:",o),$.push({name:"painelset_error_404",params:{pathMatch:"error"}})}):g.fetchSync({app:"painelset",model:"evento",params:{end_real__isnull:!0,start_real__isnull:!1}}).then(o=>{const v=I.orderBy(Object.values(o||{}),["start_real"],["asc"]).filter(p=>p.end_real===null);if(v&&v.length>0){const p=v[0];g.fetchSync({app:"painelset",model:"painel",params:{evento:p.id,principal:!0}}).then(l=>{const f=I.orderBy(Object.values(l||{}),["position"],["asc"]);if(f&&f.length>0){const K=f[0];w.value=K.id}else $.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(l=>{console.error("Error fetching painel for evento:",l),$.push({name:"painelset_error_404",params:{pathMatch:"error"}})})}else $.push({name:"painelset_error_404",params:{pathMatch:"error"}})}).catch(o=>{console.error("Error fetching evento:",o),$.push({name:"painelset_error_404",params:{pathMatch:"error"}})})},q=o=>{ye(()=>{k.value=o})},J=()=>b.isAuthenticated?b.hasPermission("painelset.change_painel"):!1;pe(()=>{E(),setTimeout(()=>{t.value.length===0&&ae()},1500)}),W.on("painelset:editorarea:close",()=>{r.value=!1,_.value=!1,Q.value=null});const ae=()=>{J()&&(W.emit("painelset:editorarea:close"),r.value=!0,_.value=!1,Q.value=a.value.id)},Z=()=>{J()&&(W.emit("painelset:editorarea:close"),r.value=!1,_.value=!0)},i=async o=>{g.fetchSync({app:"painelset",model:"visaodepainel",params:{painel:o}}).then(v=>{const p=I.orderBy(Object.values(v||{}),["position"],["asc"]).find(l=>l.active===!0);if(p&&p.length>0){const l=p;l?k.value=l.id:k.value=p[0].id}})};return(o,v)=>{const p=ee("FontAwesomeIcon");return h(),x("div",{id:`id-painelset-painel-${w.value}`,ref_key:"painelsetPainel",ref:a,key:`painelset-painel-${w.value}`,class:"painelset-painel",style:X({...u.value?.styles.component||{},fontSize:`${A.value}em`}),onMousemove:v[6]||(v[6]=l=>c())},[e("div",{class:"painel-titulo",style:X(u.value?.styles.title||{})},H(u.value?.name),5),k.value?(h(),x("div",{key:0,class:"inner-painelset-painel",style:X(u.value?.styles.inner||{})},[(h(),G(gt,{key:`visaodepainel-${k.value}`,"painel-id":w.value,"visaodepainel-selected":k.value,"editmode-visao":_.value},null,8,["painel-id","visaodepainel-selected","editmode-visao"]))],4)):(h(),x("div",Ft,[...v[7]||(v[7]=[e("p",null,"Não há visões de painel configuradas para este painel.",-1),e("p",null,"Utilize o botao de adição na tela de configurações para adicionar a primeira visão do painel.",-1)])])),e("div",Nt,[e("div",{class:"btn-group btn-group-sm",role:"group","aria-label":"Zoom da fonte",title:`Zoom aplicado aos elementos textuais: ${(A.value*100).toFixed(0)}%`},[e("button",Rt,H((A.value*100).toFixed(0))+"% ",1),e("button",{class:"btn btn-link btn-zoom-out",onClick:v[0]||(v[0]=m(l=>d(-.1),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-angles-down"})]),e("button",{class:"btn btn-link btn-zoom-out",onClick:v[1]||(v[1]=m(l=>d(-.01),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-angle-down"})]),e("button",{class:"btn btn-link btn-zoom-in",onClick:v[2]||(v[2]=m(l=>d(.01),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-angle-up"})]),e("button",{class:"btn btn-link btn-zoom-in",onClick:v[3]||(v[3]=m(l=>d(.1),["stop","prevent"]))},[P(p,{icon:"fa-solid fa-angles-up"})]),J()?(h(),x("div",Ht,[e("button",{class:ie(["btn btn-link btn-editmode",{active:r.value}]),onClick:v[4]||(v[4]=m(l=>ae(),["stop","prevent"])),title:r.value?"Sair do modo de edição":"Entrar no modo de edição"},[P(p,{icon:"fa-solid fa-pen-to-square",size:"1x"})],10,Ot)])):R("",!0)],8,Tt),e("div",Xt,[e("div",jt,[J()?(h(),x("div",qt,[e("button",{class:ie(["btn btn-link btn-editmode",{active:_.value}]),onClick:v[5]||(v[5]=m(l=>Z(),["stop","prevent"])),title:_.value?"Sair do modo de edição":"Entrar no modo de edição"},[P(p,{icon:"fa-solid fa-pen-to-square",size:"1x"})],10,Zt)])):R("",!0),(h(!0),x(ne,null,le(t.value,(l,f)=>(h(),x("button",{key:`${l.id}_${f}`,class:ie([{active:l.id===k.value},"btn btn-secondary"]),onMousedown:m(K=>!1,["stop","prevent"]),onClick:m(K=>q(l.id),["stop","prevent"])},H(l.position),43,Gt))),128))])])]),r.value?(h(),G(de,{key:2,to:"#painelset-editorarea",disabled:!r.value},[P(Ut,{"painel-id":w.value,"painel-selected":w.value},null,8,["painel-id","painel-selected"])],8,["disabled"])):R("",!0)],44,Dt)}}},oo=oe(Jt,[["__scopeId","data-v-bd7a9843"]]);export{oo as default};
