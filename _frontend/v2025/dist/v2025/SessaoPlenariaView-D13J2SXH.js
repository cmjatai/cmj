import{C as I,z as j,c as k,w as D,A as B,f as r,g as i,k as e,l as T,i as x,t as A,j as L,F as w,r as V,q as R,n as S,B as F,T as G,u as P,o as N,G as z,J as Y,K as J,L as K,M as Q,N as W}from"./vendor-Dq9xiLvp.js";import{b as E,u as q,a as U,R as M,_ as X}from"./main-FDe4IiI2.js";import{_ as Z}from"./NormaSimpleModalView-DdT2sJxC.js";import"./vendor_fortawesome-D0qyeiI4.js";const ee=["id"],te={class:"inner-materia"},ae={class:"epigrafe"},oe=["href"],se={class:"protocolo-data-autoria"},ie={class:"protocolo-data"},ne={class:"protocolo"},le={class:"data"},re={class:"autoria"},de={class:"link-file"},ce=["href"],ue=["innerHTML"],me={class:"tramitacao"},ve={class:"status"},_e={class:"ultima-acao"},pe=["innerHTML"],be={key:1,class:"documentos-acessorios pt-2"},ge={class:"inner-docacess"},ye=["href"],fe={key:2,class:"legislacao-citada pt-2"},$e={class:"inner-legcitada"},he=["onClick"],ke={__name:"MateriaEmPauta",props:{materiaId:{type:Number,required:!0},item:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const _=E(),$=I("EventBus"),l=g,d=t,m=j(null),y=j(!1);$.on("rito-toggle",()=>{y.value=!y.value});const h=()=>{$.emit("rito-toggle"),setTimeout(()=>{const a=document.getElementById(`is-${d.item.__label__}-${d.item.id}`);let o=0,b=a;do o+=b.offsetTop,b=b.offsetParent;while(b&&b.tagName!=="BODY");window.scrollTo({top:o-100,behavior:"instant"})},100)},u=k(()=>(d.item.observacao||"").replace(/\n/g,"<br/>")),n=k(()=>_.data_cache?.materia_materialegislativa?.[d.materiaId]||{__str__:"Buscando Matéria Legislativa..."}),p=k(()=>{const a=_.data_cache?.materia_tramitacao?.[d.sessao.finalizada?n.value.ultima_tramitacao:d.item.tramitacao||n.value.ultima_tramitacao]||null,o=a&&_.data_cache?.materia_statustramitacao?.[a.status]||null;return{...a,status:o?o.__str__:"Status não disponível"}}),c=k(()=>{const a=_.data_cache?.base_autor||{};return!n.value.autores||n.value.autores.length===0?[]:n.value.autores.map(o=>a[o]).filter(o=>o!==void 0)}),O=k(()=>n.value.data_apresentacao?new Date(n.value.data_apresentacao).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}):""),f=k(()=>{const a=_.data_cache?.materia_documentoacessorio||{};return Object.values(a).filter(o=>o.materia===d.item.materia)}),s=k(()=>{const a=_.data_cache?.norma_legislacaocitada||{};return Object.values(a).filter(o=>o.materia===d.item.materia)});return D(()=>p.value,a=>{a?.id||(d.sessao.finalizada?_.fetchSync({app:"materia",model:"materialegislativa",id:n.value.id}):d.item.tramitacao&&_.fetchSync({app:"materia",model:"tramitacao",id:d.item.tramitacao}))},{immediate:!0}),D(m,a=>{a!==null&&_.fetchSync({app:"norma",model:"normajuridica",id:a.norma,params:{exclude:"metadata"}})}),D(n,a=>{a?.id||l("resync")},{immediate:!0}),(a,o)=>{const b=B("FontAwesomeIcon");return i(),r("div",{id:`mp-${t.item.__label__}-${t.item.id}`,class:"materia-em-pauta"},[e("div",te,[e("div",ae,[e("a",{href:n.value.link_detail_backend,target:"_blank",rel:"noopener noreferrer"},A(n.value.__str__),9,oe)]),e("div",se,[e("div",ie,[e("div",ne,[o[2]||(o[2]=L(" Protocolo: ",-1)),e("strong",null,A(n.value.numero_protocolo),1)]),e("div",le,A(O.value),1)]),e("div",re,[(i(!0),r(w,null,V(c.value,(v,C)=>(i(),r("span",{key:`au${C}`},A(v.nome),1))),128))])]),e("div",de,[n.value.texto_original?(i(),r("a",{key:0,href:n.value.texto_original,target:"_blank",rel:"noopener noreferrer"},[R(b,{icon:"file-lines"})],8,ce)):x("",!0)]),e("div",{class:"ementa",innerHTML:n.value.ementa},null,8,ue),e("div",me,[e("div",ve,[o[3]||(o[3]=e("strong",null,"Situação:",-1)),o[4]||(o[4]=L("  ",-1)),e("span",null,A(p.value.status),1)]),e("div",_e,[o[5]||(o[5]=e("strong",null,"Última Ação:",-1)),L("  "+A(p.value.texto),1)])]),t.item&&t.item.observacao?(i(),r("div",{key:0,onClick:o[0]||(o[0]=v=>h()),class:S(["rito-text",y.value?"open":"closed"]),innerHTML:y.value?u.value:"Visualizar o Roteiro..."},null,10,pe)):x("",!0),f.value.length>0?(i(),r("div",be,[o[6]||(o[6]=e("div",{class:"title"},[e("strong",null,"Documentos Acessórios")],-1)),e("ul",ge,[(i(!0),r(w,null,V(f.value,v=>(i(),r("li",{key:`docacessorio-${v.id}`,class:"doc-acessorio-item"},[e("a",{href:v.arquivo,target:"_blank",rel:"noopener noreferrer"},A(v.__str__),9,ye)]))),128))])])):x("",!0),s.value.length>0?(i(),r("div",fe,[o[7]||(o[7]=e("div",{class:"title"},[e("strong",null,"Legislação Citada")],-1)),e("ul",$e,[(i(!0),r(w,null,V(s.value,v=>(i(),r("li",{key:`legcitada-${v.id}`,class:"leg-citada-item"},[(i(),r("a",{href:"#",onClick:F(C=>m.value=v,["prevent"]),key:`legiscit${v.id}`},A(v.__str__),9,he))]))),128))])])):x("",!0)]),m.value?(i(),T(G,{key:0,to:"#modalCmj"},[R(Z,{"html-id":`modal-legis-citada-${m.value.id}`,"norma-id":m.value.norma,onClose:o[1]||(o[1]=v=>m.value=null)},null,8,["html-id","norma-id"])])):x("",!0)],8,ee)}}},xe=["id"],Se={key:0,class:"display-controls"},Ae=["id"],Oe={class:"display-content"},Re={key:0,class:"votos"},Ce={key:0,class:"voto-abs"},Te={class:"valor"},Me={class:"voto-nao"},je={class:"valor"},we={class:"voto-sim"},Ve={class:"valor"},Ee={key:1,class:"status-votacao"},Le={key:0},De={key:1},Pe={key:2},Ie={key:0},Be={key:1},qe={key:2},ze={__name:"ProcessoVotacaoDisplay",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const _=E(),$=q(),l=g,d=I("EventBus"),m=t,y=j(!0),h=()=>{u.value||(y.value=!y.value,d.emit("toggle-auto-rolagem",{isState:y.value}))};d.on("toggle-auto-rolagem",o=>{y.value=o.isState,n()}),d.on("disable-auto-rolagem",()=>{y.value=!1});const u=k(()=>$.hasPermission("sessao.add_sessaoplenaria")),n=()=>{u.value||!y.value||!s.value||setTimeout(()=>{const o=document.getElementById(`is-${m.item.__label__}-${m.item.id}`);let b=0,v=o;do b+=v.offsetTop,v=v.offsetParent;while(v&&v.tagName!=="BODY");window.scrollTo({top:b-100,behavior:"smooth"})},100)},p=k(()=>{const o=_.data_cache?.sessao_registrovotacao||{},b=Object.values(o).filter(v=>v.ordem===m.item.id);return b.sort((v,C)=>v.id-C.id),b}),c=k(()=>m.item.votacao_aberta&&m.item.tipo_votacao<=2),O=k(()=>m.item.discussao_aberta&&m.item.tipo_votacao<=2),f=k(()=>m.item.votacao_aberta_pedido_prazo&&m.item.tipo_votacao<=2),s=k(()=>m.item.discussao_aberta||m.item.votacao_aberta||m.item.votacao_aberta_pedido_prazo);D(c,(o,b)=>{!o&&b&&l("resync"),o&&n()},{immediate:!0}),D(s,o=>{o&&n()},{immediate:!0});const a=o=>{let b="tramitando",v=null;return o?v=_.data_cache?.sessao_tiporesultadovotacao?.[o.tipo_resultado_votacao]?.nome:m.item.resultado&&(v=m.item.resultado),O.value?b="result discussao-aberta":c.value?b="result votacao-aberta":v==="Aprovado"?b="result result-aprovado":v==="Rejeitado"?b="result result-rejeitado":v==="Pedido de Vista"?b="result result-vista":v==="Prazo Regimental"?b="result result-prazo":v==="Matéria Lida"&&(b="result result-lida"),b};return(o,b)=>{const v=B("font-awesome-icon");return i(),r("div",{id:`pvd-${t.item.__label__}-${t.item.id}`,class:S(["processo-votacao-display",t.item.__label__])},[u.value?x("",!0):(i(),r("div",Se,[e("button",{id:`auto-rolagem-${t.item.__label__}-${t.item.id}`,type:"button",class:S(["btn-auto-rolagem",y.value?"active":""]),onClick:h},[b[0]||(b[0]=L(" Autorolagem? ",-1)),R(v,{icon:"fa-solid fa-up-down"})],10,Ae)])),e("div",Oe,[!c.value&&!f.value?(i(!0),r(w,{key:0},V(p.value,C=>(i(),r("div",{class:"status-votacao",key:`rv-${C.id}`},[a(C)!=="result-vista"?(i(),r("div",Re,[C.numero_abstencoes?(i(),r("div",Ce,[e("span",Te,A(C.numero_abstencoes),1),b[1]||(b[1]=e("span",{class:"titulo"},"ABS",-1))])):x("",!0),e("div",Me,[e("span",je,A(C.numero_votos_nao),1),b[2]||(b[2]=e("span",{class:"titulo"},"NÃO",-1))]),e("div",we,[e("span",Ve,A(C.numero_votos_sim),1),b[3]||(b[3]=e("span",{class:"titulo"},"SIM",-1))])])):x("",!0),e("div",{class:S(a(C))},[e("span",null,A(P(_).data_cache?.sessao_tiporesultadovotacao?.[C.tipo_resultado_votacao]?.nome),1)],2)]))),128)):x("",!0),c.value||O.value||f.value||p.value.length===0?(i(),r("div",Ee,[c.value||O.value||f.value?(i(),r("div",{key:0,class:S(a(null))},[f.value?(i(),r("span",Le,"VOTAÇÃO ABERTA PARA PEDIDO DE ADIAMENTO")):c.value?(i(),r("span",De,"VOTAÇÃO ABERTA")):O.value?(i(),r("span",Pe,"DISCUSSÃO ABERTA")):x("",!0)],2)):(i(),r("div",{key:1,class:S(a(null))},[t.item.resultado?(i(),r("span",Ie,A(t.item.resultado),1)):t.item.tipo_votacao===4&&t.item.votacao_aberta?(i(),r("span",Be,"Leitura em Andamento")):p.value.length===0?(i(),r("span",qe,"Tramitando")):x("",!0)],2))])):x("",!0)])],10,xe)}}},Fe=["id"],Ne={class:"inner-title text-light m-4"},Ue={class:"inner-voto"},He={key:0,class:"voto-result"},Ye={class:"avatar"},Ge=["src","alt","title"],Je={class:"voto-computado"},Ke={key:1,class:"voto-result"},Qe={__name:"VotoParlamentar",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const g=E(),_=q(),$=U(),l=t,d=k(()=>{const h=Object.values(g.data_cache?.materia_materialegislativa||{}).filter(u=>u.id===l.item.materia);return h.length>0?h[0]:null}),m=k(()=>{const h=l.item.__label__==="sessao_ordemdia"?"ordem":"expediente",u=Object.values(g.data_cache?.sessao_votoparlamentar||{}).filter(n=>n.parlamentar===_.data_connect.user.votante.parlamentar_id&&n[h]===l.item.id);return u.length>0?u[0]:null});function y(h){const u=l.item.__label__==="sessao_ordemdia"?"ordem":"expediente",n={parlamentar:_.data_connect.user.votante.parlamentar_id,[u]:l.item.id,voto:h};m.value?(n.id=m.value.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:m.value.id,form:n}).then(()=>{$.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{$.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:n}).then(()=>{$.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{$.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})}return N(()=>{setTimeout(()=>{const h=document.getElementById(`is-${l.item.__label__}-${l.item.id}`);let u=0,n=h;do u+=n.offsetTop,n=n.offsetParent;while(n&&n.tagName!=="BODY");window.scrollTo({top:u-100,behavior:"smooth"})},100)}),(h,u)=>(i(),r("div",{id:`vp-${t.item.__label__}-${t.item.id}`,class:S(["voto-parlamentar"])},[e("div",Ne,[e("span",null,A(d.value?.__str__),1)]),e("div",Ue,[e("button",{type:"button",class:"btn btn-lg btn-success",onClick:u[0]||(u[0]=n=>y("Sim"))}," SIM "),e("button",{type:"button",class:"btn btn-lg btn-danger",onClick:u[1]||(u[1]=n=>y("Não"))}," NÃO "),e("button",{type:"button",class:"btn btn-lg btn-warning",onClick:u[2]||(u[2]=n=>y("Abstenção"))}," Abstenção ")]),m.value?(i(),r("div",He,[e("div",Ye,[e("img",{src:`/api/parlamentares/parlamentar/${P(_).data_connect.user.votante.parlamentar_id}/fotografia.c256.png`,alt:P(_).data_connect.user.votante.nome_parlamentar,title:P(_).data_connect.user.votante.nome_parlamentar},null,8,Ge)]),e("div",Je,[u[3]||(u[3]=L(" Voto Computado: ",-1)),e("strong",null,A(m.value.voto),1)])])):(i(),r("div",Ke," Voto não Computado "))],8,Fe))}},We=["id"],Xe={__name:"ControleDeVotacao",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const _=q(),$=g,l=t,d=k(()=>l.item.votacao_aberta&&l.item.tipo_votacao!==4);return(m,y)=>(i(),r("div",{id:`cv-${t.item.__label__}-${t.item.id}`,class:S(["controle-de-votacao",t.item.__label__,d.value?"votacao-aberta":"votacao-fechada",d.value&&P(_).isVotante&&t.item.tipo_votacao===2?"votante":"observador"])},[d.value&&P(_).isVotante&&t.item.tipo_votacao===2?(i(),T(Qe,{key:`vp-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:y[0]||(y[0]=h=>$("resync"))},null,8,["item","sessao"])):x("",!0),(i(),T(ze,{key:`pvd-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:y[1]||(y[1]=h=>$("resync"))},null,8,["item","sessao"]))],10,We))}},Ze={key:0,class:"message"},et={__name:"Loading",props:{message:{type:String,default:""},position:{type:String,default:"fixed"}},setup(t){return(g,_)=>(i(),r("div",{class:"loading",style:z({position:t.position})},[_[0]||(_[0]=e("div",{class:"loader"},null,-1)),t.message?(i(),r("div",Ze,A(t.message),1)):x("",!0)],4))}},tt=X(et,[["__scopeId","data-v-98eced51"]]),at=["id"],ot={class:"modal-dialog modal-xl"},st={class:"modal-content"},it={class:"modal-header"},nt={class:"modal-title"},lt={class:"d-inline-block ps-3"},rt={class:"modal-body"},dt={class:"row"},ct={class:"col-md-6"},ut={class:"votos-parlamentares-list"},mt={class:"voto-parlamentar-header voto-parlamentar-item font-weight-bold"},vt={class:"voto-parlamentar-options"},_t=["id"],pt={class:"nome-parlamentar"},bt={key:0,class:"voto-parlamentar-options"},gt=["onClick"],yt=["onClick"],ft=["onClick"],$t={class:"col-md-6"},ht={class:"form-group"},kt=["value"],xt={class:"modal-footer"},St={__name:"VotoParlamentarAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},emits:["close","register","cancel"],setup(t,{emit:g}){const _=g,$=E(),l=U(),d=t,m=k(()=>{const f=Object.values($.data_cache?.materia_materialegislativa||{}).filter(s=>s.id===d.item.materia);return f.length>0?f[0]:null}),y=k(()=>{const f=d.item.__label__==="sesso_ordemdia"?"sessao_presencaordemdia":"sessao_sessaoplenariapresenca";return Object.values($.data_cache?.[f]||{}).filter(a=>a.sessao_plenaria===d.sessao.id).map(a=>{const o=$.data_cache?.parlamentares_parlamentar?.[a.parlamentar];return o||null})}),h=k(()=>{const f=$.data_cache?.sessao_votoparlamentar||{},s=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente";return Object.values(f).filter(o=>o[s]===d.item.id&&o.votacao===null).reduce((o,b)=>(o[b.parlamentar]=b,o),{})}),u=j({tipo_resultado_votacao:null,observacao:""}),n=k(()=>Object.values($.data_cache?.sessao_tiporesultadovotacao||{}).filter(f=>f.natureza==="P"&&d.item.votacao_aberta_pedido_prazo===!0||f.id>0&&d.item.votacao_aberta_pedido_prazo===!1)),p=()=>{Object.values(h.value).forEach(f=>{M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:f.id})}),_("close")},c=(f,s)=>{if(!f){Object.values(y.value).forEach(v=>{c(v.id,s)});return}const a=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente",o={votacao:null,parlamentar:f,[a]:d.item.id,voto:s},b=h.value[f];if(b&&b.voto===s){M.Utils.deleteModel({app:"sessao",model:"votoparlamentar",id:b.id}).then(()=>{l.addMessage({type:"info",text:"Voto Removido!",timeout:5e3})}).catch(()=>{l.addMessage({type:"danger",text:"Erro ao remover voto. Tente novamente.",timeout:5e3})});return}b?(o.id=b.id,M.Utils.patchModel({app:"sessao",model:"votoparlamentar",id:b.id,form:o}).then(()=>{l.addMessage({type:"info",text:"Voto Atualizado!",timeout:5e3})}).catch(()=>{l.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})):M.Utils.postModel({app:"sessao",model:"votoparlamentar",form:o}).then(()=>{l.addMessage({type:"info",text:"Voto Computado!",timeout:5e3})}).catch(()=>{l.addMessage({type:"danger",text:"Erro ao computar voto. Tente novamente.",timeout:5e3})})},O=()=>{_("register",{action:"action_registrovotacao",form:{...u.value,unanime:!1,com_presidente:!1}}),_("close")};return(f,s)=>(i(),r("div",{id:`vpa-${t.item.__label__}-${t.item.id}`,class:"modal voto-parlamentar-admin-modal-view fade show",tabindex:"-1"},[e("div",ot,[e("div",st,[e("div",it,[e("h5",nt,[s[8]||(s[8]=L(" Registro de Votação dos Parlamentares ",-1)),e("small",lt,A(m.value?m.value.__str__:""),1)]),e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=a=>_("close"))})]),e("div",rt,[e("div",dt,[e("div",ct,[e("div",ut,[e("div",mt,[s[9]||(s[9]=e("div",{class:"nome-parlamentar"},[e("h5",null,"Votos dos Parlamentares")],-1)),e("div",vt,[e("button",{type:"button",class:S(["btn btn-sm","btn-outline-success"]),onClick:s[1]||(s[1]=a=>c(0,"Sim"))}," SIM "),e("button",{type:"button",class:S(["btn btn-sm","btn-outline-danger"]),onClick:s[2]||(s[2]=a=>c(0,"Não"))}," NÃO "),e("button",{type:"button",class:S(["btn btn-sm","btn-outline-warning"]),onClick:s[3]||(s[3]=a=>c(0,"Abstenção"))}," Abstenção ")])]),(i(!0),r(w,null,V(y.value,a=>(i(),r("div",{id:`voto-parlamentar-${a.id}`,class:"voto-parlamentar-item",key:`voto-parlamentar-${a.id}`},[e("div",pt,A(a.nome_parlamentar),1),h.value?(i(),r("div",bt,[e("button",{type:"button",class:S(["btn btn-sm",`btn${h.value[a.id]?.voto==="Sim"?"-success":"-outline-success"}`]),onClick:o=>c(a.id,"Sim")}," SIM ",10,gt),e("button",{type:"button",class:S(["btn btn-sm",`btn${h.value[a.id]?.voto==="Não"?"-danger":"-outline-danger"}`]),onClick:o=>c(a.id,"Não")}," NÃO ",10,yt),e("button",{type:"button",class:S(["btn btn-sm",`btn${h.value[a.id]?.voto==="Abstenção"?"-warning":"-outline-warning"}`]),onClick:o=>c(a.id,"Abstenção")}," Abstenção ",10,ft)])):x("",!0)],8,_t))),128))])]),e("div",$t,[e("div",ht,[e("div",null,[s[10]||(s[10]=e("strong",{class:"p-2 d-inline-block"}," Tipo de Resultado da Votação: * ",-1)),Y(e("select",{id:"tipo-resultado-votacao",class:"form-select","onUpdate:modelValue":s[4]||(s[4]=a=>u.value.tipo_resultado_votacao=a)},[(i(!0),r(w,null,V(n.value,a=>(i(),r("option",{key:`tipo-resultado-votacao-${a.id}`,value:a.id},A(a.__str__),9,kt))),128))],512),[[J,u.value.tipo_resultado_votacao]])]),e("div",null,[s[11]||(s[11]=e("strong",{class:"pt-4 pb-2 d-inline-block"}," Observações: ",-1)),Y(e("textarea",{class:"form-control",rows:"5","onUpdate:modelValue":s[5]||(s[5]=a=>u.value.observacao=a)},null,512),[[K,u.value.observacao]])])])]),e("div",xt,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[6]||(s[6]=a=>p())}," Cancelar Registro de Votação "),e("button",{type:"button",class:"btn btn-success",onClick:s[7]||(s[7]=a=>O())}," Registrar e Fechar Votação ")])])])])])],8,at))}},At=["id"],Ot={class:"inner-is-admin"},Rt={class:"btn-group",role:"group","aria-label":"Edição"},Ct=["href"],Tt={key:0,class:"registro-leitura"},Mt={class:"btn-group",role:"group","aria-label":"State Leitura da matéria em Plenário"},jt={class:"btn-group",role:"group","aria-label":"Registro de Leitura"},wt=["disabled"],Vt=["disabled"],Et={key:1,class:"registro-votacao"},Lt=["disabled"],Dt=["disabled"],Pt=["disabled"],It=["disabled"],Bt={__name:"ItemDeSessaoAdmin",props:{item:{type:Object,required:!0},sessao:{type:Object,required:!0}},setup(t){const g=q();E();const _=U(),$=t,l=j(!1),d=j(!1),m=k(()=>g.hasPermission("sessao.add_sessaoplenaria")),y=async f=>{const[s,a]=$.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,form:{field:f},action:"toggle_state",id:$.item.id}).then(o=>{}).catch(o=>{console.error("Erro ao alterar discussão",o)})},h=async f=>{n({action:"action_registrovotacao",form:{unanime:!0,resultado:f,com_presidente:!1}})},u=async()=>{n({action:"action_registroleitura",form:{}})},n=async f=>{l.value=!0;const[s,a]=$.item.__label__.split("_");M.Utils.patchModel({app:s,model:a,id:$.item.id,action:f.action,form:f.form}).then(o=>{l.value=!1}).catch(o=>{l.value=!1,_.addMessage({type:o.response.data.type||"danger",text:o.response.data.detail||"Erro ao registrar votação!",timeout:5e3})})},p=async()=>{l.value=!0;const[f,s]=$.item.__label__.split("_");M.Utils.patchModel({app:f,model:s,action:"action_cancelar_registroleitura",id:$.item.id}).then(a=>{l.value=!1}).catch(a=>{l.value=!1,_.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de leitura!",timeout:5e3})})},c=async()=>{l.value=!0,d.value=!1;const[f,s]=$.item.__label__.split("_");M.Utils.patchModel({app:f,model:s,action:"action_cancelar_registrovotacao",id:$.item.id}).then(a=>{l.value=!1}).catch(a=>{l.value=!1,_.addMessage({type:"warning",text:a.response.data.detail||"Erro ao cancelar registro de votação!",timeout:5e3})})};N(()=>{O(2e3)}),D(()=>$.item,()=>{O(500)});const O=f=>{setTimeout(()=>{document.querySelectorAll(".tooltip.bs-tooltip-auto").forEach(o=>{o.remove()}),[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(o=>new Q(o,{trigger:"hover"}))},f)};return(f,s)=>{const a=B("FontAwesomeIcon");return m.value?(i(),r("div",{key:0,id:`is-admin-${t.item.__label__}-${t.item.id}`,class:S(["item-de-sessao-admin",l.value?"actions-running":""])},[e("div",Ot,[e("div",Rt,[e("a",{href:t.item.__label__==="sessao_ordemdia"?`/sessao/${t.item.sessao_plenaria}/ordemdia#id${t.item.materia}`:`/sessao/${t.item.sessao_plenaria}/expedientemateria#id${t.item.materia}`,target:"_blank",class:S(["btn","btn-outline-secondary"])},[R(a,{icon:"edit"})],8,Ct)]),t.item.tipo_votacao===4?(i(),r("div",Tt,[e("div",Mt,[e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[0]||(s[0]=o=>y("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Leitura da matéria em Plenário"},[R(a,{icon:`${t.item.votacao_aberta?"book-open-reader":"book"}`},null,8,["icon"])],2)]),e("div",jt,[t.item.resultado?(i(),r("button",{key:0,type:"button",class:"btn btn-outline-warning",onClick:s[1]||(s[1]=o=>p()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Leitura.",disabled:l.value},[R(a,{icon:"ban"})],8,wt)):x("",!0),t.item.votacao_aberta?(i(),r("button",{key:1,type:"button",class:"btn btn-outline-primary",onClick:s[2]||(s[2]=o=>u()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Leitura da Matéria em Plenário.",disabled:l.value},[R(a,{icon:"book-open"})],8,Vt)):x("",!0)])])):(i(),r("div",Et,[e("div",{class:"btn-group",role:"group",style:z({opacity:l.value?0:1}),"aria-label":"Registros de Votação Simbólica"},[e("button",{type:"button",class:"btn btn-outline-warning",onClick:s[3]||(s[3]=o=>c()),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Cancelar Registro de Votação.",disabled:l.value},[R(a,{icon:"ban"})],8,Lt),e("button",{type:"button",class:"btn btn-outline-danger",onClick:s[4]||(s[4]=o=>h("R")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Rejeição Unânime sem voto do Presidente.",disabled:l.value},[R(a,{icon:"thumbs-down"})],8,Dt),e("button",{type:"button",class:"btn btn-outline-primary",onClick:s[5]||(s[5]=o=>h("A")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Aprovação Unânime sem voto do Presidente.",disabled:l.value},[R(a,{icon:"thumbs-up"})],8,Pt)],4),e("div",{class:"btn-group",role:"group",style:z({opacity:l.value?0:1}),"aria-label":"Botões de controle de abertura de discussão, votação e pedido de adiamento"},[e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.discussao_aberta?"success":"danger"}`]),onClick:s[6]||(s[6]=o=>y("discussao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Discussão em Plenário"},[R(a,{icon:"comments"}),s[11]||(s[11]=L("  ",-1))],2),e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta?"success":"danger"}`]),onClick:s[7]||(s[7]=o=>y("votacao_aberta")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação em Plenário"},[R(a,{icon:t.item.votacao_aberta?"book-open-reader":"book"},null,8,["icon"]),s[12]||(s[12]=L("  ",-1))],2),e("button",{type:"button",class:S(["btn",`btn-outline-${t.item.votacao_aberta_pedido_prazo?"success":"danger"}`]),onClick:s[8]||(s[8]=o=>y("votacao_aberta_pedido_prazo")),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Abrir/Fechar para Votação de Pedido de Adiamento de Votação"},[...s[13]||(s[13]=[e("i",{class:"bi bi-hourglass-top"},null,-1)])],2)],4),t.item.votacao_aberta||t.item.votacao_aberta_pedido_prazo?(i(),r("div",{key:0,class:"btn-group",role:"group",style:z({opacity:l.value?0:1}),"aria-label":"Registro de Votação Simbólica sem unanimidade"},[e("button",{type:"button",class:"btn btn-outline-success",onClick:s[9]||(s[9]=o=>d.value=!0),"data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-title":"Registrar Votação",disabled:l.value},[R(a,{icon:"check-to-slot"})],8,It)],4)):x("",!0)]))]),l.value?(i(),T(tt,{key:0,message:"Registrando...",position:"absolute"})):x("",!0),d.value?(i(),T(G,{key:1,to:"#modalCmj"},[(i(),T(St,{key:`vpa-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onClose:s[10]||(s[10]=o=>d.value=!1),onRegister:n},null,8,["item","sessao"]))])):x("",!0)],10,At)):x("",!0)}}},qt=["id"],zt=["id"],Ft={class:"childs"},Nt={key:0,class:"title"},H={__name:"ItemDeSessao",props:{item:{type:Object,required:!0},parent:{type:Object,required:!1,default:null},sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const _=E(),$=q(),l=g,d=t,m=k(()=>$.hasPermission("sessao.add_sessaoplenaria")),y=k(()=>{const n=_.data_cache?.[d.item.__label__]||{},p=Object.values(n).filter(c=>c.parent===d.item.id);return p.sort((c,O)=>c.numero_ordem-O.numero_ordem),p}),h=()=>{const n=document.getElementById(`item-content-${d.item.__label__}-${d.item.id}`);n&&n.scrollIntoView({behavior:"smooth",block:"center"})},u=k(()=>{const n=d.item.__label__==="sessao_ordemdia"?"ordem":"expediente";return Object.values(_.data_cache?.sessao_registrovotacao||{}).filter(p=>p[n]===d.item.id)});return(n,p)=>(i(),r("div",{id:`is-${t.item.__label__}-${t.item.id}`,class:S(["item-de-sessao",t.item.__label__,t.parent?"child-item":"parent-item"])},[e("div",{onClick:F(h,["self"]),id:`item-content-${t.item.__label__}-${t.item.id}`,class:S(["item-content",t.item.votacao_aberta&&t.item.tipo_votacao===2?"votacao-nominal":"",m.value?"item-admin":"",m.value&&u.value.length>0?`possui-registro-votacao-${u.value.length}`:""])},[(i(),T(Bt,{key:`is-admin-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:p[0]||(p[0]=c=>l("resync"))},null,8,["item","sessao"])),(i(),T(Xe,{key:`cv-${t.item.__label__}-${t.item.id}`,item:t.item,sessao:t.sessao,onResync:p[1]||(p[1]=c=>l("resync"))},null,8,["item","sessao"])),(i(),T(ke,{onClick:F(h,["self"]),key:`mp-${t.item.__label__}-${t.item.id}`,"materia-id":t.item.materia,item:t.item,sessao:t.sessao,onResync:p[2]||(p[2]=c=>l("resync"))},null,8,["materia-id","item","sessao"]))],10,zt),e("div",Ft,[!t.item.parent&&y.value.length>0?(i(),r("div",Nt,[...p[4]||(p[4]=[e("strong",null,"Matérias Anexadas",-1)])])):x("",!0),(i(!0),r(w,null,V(y.value,c=>(i(),T(H,{key:`is-${c.__label__}-${c.id}`,item:c,parent:t.item,sessao:t.sessao,onResync:p[3]||(p[3]=O=>l("resync"))},null,8,["item","parent","sessao"]))),128))])],10,qt))}},Ut={class:"expediente-materia-list"},Ht={class:"title"},Yt={class:"expediente-materia-content"},Gt={key:0,class:"expedientemateria empty alert alert-info"},Jt={key:1,class:"expedientemateria empty alert alert-info"},Kt={__name:"ExpedienteMateriaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const _=g,$=E(),l=I("EventBus"),d=t,m=j(!0);l.on("expMatOnLoad",()=>{m.value=!1});const y=k(()=>{const u=$.data_cache?.sessao_expedientemateria||{},n=Object.values(u).filter(p=>p.sessao_plenaria===d.sessao?.id&&p.parent===null);return n.sort((p,c)=>p.numero_ordem-c.numero_ordem),n}),h=()=>{_("resync");const u=document.querySelector(".resync-icon-expmateria");u&&(u.classList.add("rotate"),setTimeout(()=>{u.classList.remove("rotate")},1e3))};return(u,n)=>{const p=B("FontAwesomeIcon");return i(),r("div",Ut,[e("div",Ht,[n[1]||(n[1]=e("strong",null,"Matérias do Grande Expediente",-1)),R(p,{icon:"arrows-rotate",class:"resync-icon-expmateria cursor-pointer ms-2",title:"Recarregar matéria",onClick:h})]),e("div",Yt,[(i(!0),r(w,null,V(y.value,c=>(i(),T(H,{key:`is-${c.__label__}-${c.id}`,item:c,sessao:t.sessao,onResync:n[0]||(n[0]=O=>_("resync"))},null,8,["item","sessao"]))),128)),m.value?(i(),r("div",Gt," Carregando matérias do grande expediente... ")):x("",!0),!m.value&&y.value.length===0?(i(),r("div",Jt," Sem matérias no grande expediente. ")):x("",!0)])])}}},Qt={class:"ordemdia-list"},Wt={class:"title"},Xt={class:"ordemdia-content"},Zt={key:0,class:"ordemdia empty alert alert-info"},ea={key:1,class:"ordemdia empty alert alert-info"},ta={__name:"OrdemDiaList",props:{sessao:{type:Object,required:!0}},emits:["resync"],setup(t,{emit:g}){const _=g,$=E(),l=I("EventBus"),d=t,m=j(!0);l.on("ordemDiaOnLoad",()=>{m.value=!1});const y=k(()=>{const u=$.data_cache?.sessao_ordemdia||{},n=Object.values(u).filter(p=>p.sessao_plenaria===d.sessao?.id&&p.parent===null);return n.sort((p,c)=>p.numero_ordem-c.numero_ordem),n}),h=()=>{_("resync");const u=document.querySelector(".resync-icon-ordemdia");u&&(u.classList.add("rotate"),setTimeout(()=>{u.classList.remove("rotate")},1e3))};return(u,n)=>{const p=B("FontAwesomeIcon");return i(),r("div",Qt,[e("div",Wt,[n[1]||(n[1]=e("strong",null,"Matérias da Ordem do Dia",-1)),R(p,{icon:"arrows-rotate",class:"resync-icon-ordemdia cursor-pointer ms-2",title:"Recarregar matéria",onClick:h})]),e("div",Xt,[(i(!0),r(w,null,V(y.value,c=>(i(),T(H,{key:`is-${c.__label__}-${c.id}`,item:c,sessao:t.sessao,onResync:n[0]||(n[0]=O=>_("resync"))},null,8,["item","sessao"]))),128)),m.value?(i(),r("div",Zt," Carregando matérias da ordem do dia... ")):!m.value&&y.value.length===0?(i(),r("div",ea," Sem matérias na ordem do dia. ")):x("",!0)])])}}},aa=["href"],oa={key:1,class:"sessao-plenaria-content"},sa=["innerHTML"],ia=["innerHTML"],na=["innerHTML"],ua={__name:"SessaoPlenariaView",setup(t){const g=E(),_=W(),$=I("EventBus"),l=j(Number(_.params.id)||0),d=j(!1),m=k(()=>g.data_cache?.sessao_sessaoplenaria?.[l.value]);N(()=>{g.fetchSync({app:"sessao",model:"sessaoplenaria",id:l.value,params:{},force_fetch:!0}).then(()=>{p(!1)})});const y=k(()=>Object.values(g.data_cache?.sessao_expedientesessao||{}).filter(c=>c.sessao_plenaria===l.value&&c.tipo===1)),h=k(()=>Object.values(g.data_cache?.sessao_expedientesessao||{}).filter(c=>c.sessao_plenaria===l.value&&c.tipo===3)),u=k(()=>Object.values(g.data_cache?.sessao_expedientesessao||{}).filter(c=>c.sessao_plenaria===l.value&&c.tipo===4));$.on("rito-toggle",()=>{d.value=!d.value});const n=()=>{$.emit("rito-toggle")},p=(c=!0)=>{g.invalidateDataCache(["sessao"],["expedientemateria","ordemdia"]),g.fetchSync({app:"sessao",model:"expedientesessao",params:{sessao_plenaria:l.value,get_all:"True"}}),(async()=>await Promise.all([g.fetchSync({app:"sessao",model:"ordemdia",params:{sessao_plenaria:l.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}}),g.fetchSync({app:"sessao",model:"expedientemateria",params:{sessao_plenaria:l.value,expand:"materia.autores.tipo;tramitacao",exclude:"materia.metadata",get_all:"True"}})]))().then(()=>{const f=Object.values(g.data_cache?.sessao_ordemdia||{}).filter(v=>v.sessao_plenaria===l.value).map(v=>v.id),s=Object.values(g.data_cache?.sessao_expedientemateria||{}).filter(v=>v.sessao_plenaria===l.value).map(v=>v.id),a=new Set,o=g.data_cache?.sessao_expedientemateria||{};Object.values(o).forEach(v=>{v.sessao_plenaria===l.value&&a.add(v.materia)});const b=g.data_cache?.sessao_ordemdia||{};Object.values(b).forEach(v=>{v.sessao_plenaria===l.value&&a.add(v.materia)}),a.size>0&&(g.fetchSync({app:"materia",model:"materialegislativa",params:{id__in:Array.from(a),exclude:"metadata",get_all:"True"},force_fetch:c}),g.fetchSync({app:"sessao",model:"registroleitura",params:{materia__in:Array.from(a),get_all:"True"}}),g.fetchSync({app:"sessao",model:"registrovotacao",params:{materia__in:Array.from(a),get_all:"True",expand:"tipo_resultado_votacao"}}),g.fetchSync({app:"sessao",model:"votoparlamentar",params:{ordem__in:Array.from(f),get_all:"True"}}),g.fetchSync({app:"sessao",model:"votoparlamentar",params:{expediente__in:Array.from(s),get_all:"True"}}),g.fetchSync({app:"materia",model:"documentoacessorio",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),g.fetchSync({app:"norma",model:"legislacaocitada",params:{materia__in:Array.from(a),exclude:"metadata",get_all:"True"}}),g.fetchSync({app:"sessao",model:"tiporesultadovotacao",params:{get_all:"True"}}),g.fetchSync({app:"sessao",model:"sessaoplenariapresenca",params:{get_all:"True",sessao_plenaria:l.value,expand:"parlamentar"}}),g.fetchSync({app:"sessao",model:"presencaordemdia",params:{get_all:"True",sessao_plenaria:l.value,expand:"parlamentar"}})),$.emit("ordemDiaOnLoad"),$.emit("expMatOnLoad")})};return(c,O)=>(i(),r("div",{key:`sessao-plenaria-view-${l.value}`,class:"sessao-plenaria-view"},[m.value?(i(),r("a",{key:0,class:"sessao_link_manage",href:m.value.link_detail_backend,target:"_blank"},A(m.value.__str__),9,aa)):x("",!0),m.value?(i(),r("div",oa,[y.value.length>0?(i(),r("div",{key:0,onClick:n,class:S(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?y.value[0].conteudo:"Visualizar o Roteiro..."},null,8,sa)],2)):x("",!0),R(Kt,{sessao:m.value,onResync:p},null,8,["sessao"]),h.value.length>0?(i(),r("div",{key:1,onClick:n,class:S(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?h.value[0].conteudo:"Visualizar o Roteiro..."},null,8,ia)],2)):x("",!0),R(ta,{sessao:m.value,onResync:p},null,8,["sessao"]),u.value.length>0?(i(),r("div",{key:2,onClick:n,class:S(["sessao-plenaria-textos",d.value?"open":"closed"])},[e("div",{innerHTML:d.value?u.value[0].conteudo:"Visualizar o Roteiro..."},null,8,na)],2)):x("",!0)])):x("",!0)]))}};export{ua as default};
