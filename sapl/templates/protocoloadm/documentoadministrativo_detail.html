{% extends "crud/detail.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load common_tags %}

{% block detail_content %}

  <div class="item-listas">  

          {% with True as render_widget_file %}
            {% with object as d %}
              {% include "protocoloadm/documentoadministrativo_item_filter.html" %}
            {% endwith %}
          {% endwith %}

          {% for principal in object.documento_anexado_set.all %}
            {% if forloop.first %}
              <div class="item-raiz anexador">
              <strong>Anexado a:</strong>
              <ul>
            {% endif %}
            <li>
              {% with principal.documento_principal as d %}
                <a class="item-titulo" href="{% url 'sapl.protocoloadm:documentoadministrativo_detail' d.pk %}">{{ d }}</a>
                {% if d.certidao %}
                  <br><small>
                  <span class="text-danger">Certidão de Publicação nº {{d.certidao.id|stringformat:"06d" }} de {{d.certidao.created}}</span>
                  </small>
                {% endif %}
                <br><strong>Data do documento:</strong> {{d.data}} | {{d.tipo}} | {{d.tipo.sigla}} {{d.numero}}/{{d.ano}}

                {% if d.protocolo %}
                  | 
                  {% if perms.detail_protocolo %}
                    <strong>Protocolo:</strong>&nbsp;<a href="{% url 'sapl.protocoloadm:protocolo_mostrar' d.protocolo.id %}">{{ d.protocolo}}</a></br>
                  {% else %}
                    <strong>Protocolo:</strong> {{ d.protocolo}}
                  {% endif %}
                {% endif %}


                {% if d.assunto %}
                  <div class="text-ementa">{{ d.assunto|safe }}</div>
                {% endif %}


                <small>
                  {% if d.interessado %}
                    <strong>Interessado:</strong>&nbsp;{{ d.interessado|default_if_none:"Não informado"}}</br>
                  {% endif %}

                  {% define d.tramitacaoadministrativo_set.first as tram %}
                  {% if tram.unidade_tramitacao_destino %}        
                    <strong>Localização Atual:</strong> &nbsp;{{tram.unidade_tramitacao_destino}}</br>        
                    <strong>Status:</strong> {{tram.status}}
                  {% endif %}
                  {% if not d.anexo_de.first %}
                    {% if d.tramitacao and not perms.protocoloadm.detail_documentoadministrativo and d.workspace.tipo == d.workspace.TIPO_PUBLICO and mail_service_configured %}
                      <br><a class="btn btn-sm btn-outline-primary" href="{% url 'sapl.protocoloadm:acompanhar_documento' d.id %}">Acompanhar Tramitação</a>
                    {% endif %}
                  {% endif %}
                  </small>
                {% endwith %}
                  </li>
                {% if forloop.last %}
                  </ul>
                </div>
                {% endif %}
              {% endfor %}
  </div>

  {{ block.super }}

{% endblock detail_content %}